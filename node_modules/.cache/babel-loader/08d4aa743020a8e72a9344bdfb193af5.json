{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import avatar from'./../avatar.jpg';import React,{useState,useEffect}from\"react\";import Footer from'./../Footer.js';import Cookies from'universal-cookie';import{useHistory}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Login(){var history=useHistory();var _useState=useState({}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();useEffect(function(){var at=cookies.get(\"access_token\");if(at){// history.push(\"/dashboard/quotations\");\nwindow.location=\"/dashboard/analytics\";}});function me(){console.log(\"inside me\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/me',requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);cookies.set('user_name',data.result.name,{path:'/',expires:new Date(Date.now()+3600*1000*24*365)});cookies.set('user_id',data.result.id,{path:'/',expires:new Date(Date.now()+3600*1000*24*365)});if(data.result.admin===true){cookies.set('admin',true,{path:'/',expires:new Date(Date.now()+3600*1000*24*365)});}else{cookies.set('admin',false,{path:'/',expires:new Date(Date.now()+3600*1000*24*365)});}if(data.result.photo){cookies.set('user_photo',data.result.photo,{path:'/',expires:new Date(Date.now()+3600*1000*24*365)});}history.push(\"/dashboard/analytics\");case 18:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}function getAccessToken(authCode){console.log(\"inside access token\");var requestOptions={method:'POST',headers:{'Content-Type':'application/json','Authorization':authCode}};fetch('/v1/accesstoken',requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error,cookies,d;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get('content-type'))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes('application/json');_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}error=data&&data.errors;return _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);cookies=new Cookies();d=new Date(0);// The 0 there is the key, which sets the date to the epoch\nd.setUTCSeconds(data.result.expires_at);cookies.set('access_token',data.result.access_token,{path:'/',expires:d});me();case 18:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}function handleSubmit(event){console.log(\"Inside handle Submit\");event.preventDefault();var data={email:event.target[0].value,password:event.target[1].value};var requestOptions={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)};setProcessing(true);fetch('/v1/authorize',requestOptions).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response){var _response$headers$get3;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isJson=(_response$headers$get3=response.headers.get('content-type'))===null||_response$headers$get3===void 0?void 0:_response$headers$get3.includes('application/json');_context3.t0=isJson;if(!_context3.t0){_context3.next=6;break;}_context3.next=5;return response.json();case 5:_context3.t0=_context3.sent;case 6:data=_context3.t0;if(response.ok){_context3.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context3.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);getAccessToken(data.result.code);case 14:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(error);console.error('There was an error!',error);});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main\",children:[/*#__PURE__*/_jsx(\"main\",{className:\"d-flex w-100\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container d-flex flex-column\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row vh-100\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-table-cell align-middle\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mt-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"h2\",children:\"Start POS\"}),/*#__PURE__*/_jsx(\"p\",{className:\"lead\",children:\"Sign in to your account to continue\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"m-sm-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"img\",{src:avatar,alt:\"Charles Hall\",className:\"img-fluid rounded-circle\",width:\"132\",height:\"132\"})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control form-control-lg\",type:\"email\",name:\"email\",placeholder:\"Enter your email\"}),/*#__PURE__*/_jsx(\"span\",{style:{color:\"red\"},children:errors.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"form-label\",children:[\"Password \",isProcessing]}),/*#__PURE__*/_jsx(\"input\",{className:\"form-control form-control-lg\",type:\"password\",name:\"password\",placeholder:\"Enter your password\"}),/*#__PURE__*/_jsx(\"span\",{style:{color:\"red\"},children:errors.password})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"label\",{className:\"form-check\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mt-3\",children:[isProcessing?/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-lg btn-primary\",type:\"button\",disabled:true,children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner-border spinner-border-sm\",role:\"status\",\"aria-hidden\":true}),\"Logging In...\"]}):null,!isProcessing?/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-lg btn-primary\",type:\"submit\",children:\"Login\"}):null]})]})]})})}),/*#__PURE__*/_jsx(Footer,{})]})})})})}),\"  \"]}),\"   \"]});}export default Login;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/user/login.js"],"names":["avatar","React","useState","useEffect","Footer","Cookies","useHistory","Login","history","errors","setErrors","isProcessing","setProcessing","cookies","at","get","window","location","me","console","log","requestOptions","method","headers","fetch","then","response","isJson","includes","json","data","ok","error","Promise","reject","set","result","name","path","expires","Date","now","id","admin","photo","push","catch","getAccessToken","authCode","d","setUTCSeconds","expires_at","access_token","handleSubmit","event","preventDefault","email","target","value","password","body","JSON","stringify","code","color"],"mappings":"kZACA,MAAOA,CAAAA,MAAP,KAAmB,iBAAnB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,MAAP,KAAmB,gBAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,kBAApB,CACA,OAASC,UAAT,KAA2B,kBAA3B,C,6IAEA,QAASC,CAAAA,KAAT,EAAiB,CAEb,GAAMC,CAAAA,OAAO,CAAGF,UAAU,EAA1B,CACA,cAA4BJ,QAAQ,CAAC,EAAD,CAApC,wCAAOO,MAAP,eAAeC,SAAf,eACA,eAAsCR,QAAQ,CAAC,KAAD,CAA9C,yCAAOS,YAAP,eAAqBC,aAArB,eACA,GAAMC,CAAAA,OAAO,CAAG,GAAIR,CAAAA,OAAJ,EAAhB,CAEAF,SAAS,CAAC,UAAM,CACZ,GAAIW,CAAAA,EAAE,CAAGD,OAAO,CAACE,GAAR,CAAY,cAAZ,CAAT,CACA,GAAID,EAAJ,CAAQ,CACJ;AACAE,MAAM,CAACC,QAAP,CAAkB,sBAAlB,CACH,CACJ,CANQ,CAAT,CASA,QAASC,CAAAA,EAAT,EAAc,CACVC,OAAO,CAACC,GAAR,CAAY,WAAZ,EACA,GAAMC,CAAAA,cAAc,CAAG,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,gBAAiBV,OAAO,CAACE,GAAR,CAAY,cAAZ,CAFZ,CAFU,CAAvB,CAQAS,KAAK,CAAC,QAAD,CAAWH,cAAX,CAAL,CACKI,IADL,0FACU,iBAAMC,QAAN,kKACIC,MADJ,wBACaD,QAAQ,CAACH,OAAT,CAAiBR,GAAjB,CAAqB,cAArB,CADb,gDACa,sBAAsCa,QAAtC,CAA+C,kBAA/C,CADb,aAEWD,MAFX,+DAE2BD,CAAAA,QAAQ,CAACG,IAAT,EAF3B,yCAEIC,IAFJ,gBAKGJ,QAAQ,CAACK,EALZ,0BAMQC,KANR,CAMiBF,IAAI,EAAIA,IAAI,CAACrB,MAN9B,iCAOSwB,OAAO,CAACC,MAAR,CAAeF,KAAf,CAPT,UAUFtB,SAAS,CAAC,EAAD,CAAT,CAEAS,OAAO,CAACC,GAAR,CAAY,WAAZ,EACAD,OAAO,CAACC,GAAR,CAAYU,IAAZ,EAGAjB,OAAO,CAACsB,GAAR,CAAY,WAAZ,CAAyBL,IAAI,CAACM,MAAL,CAAYC,IAArC,CAA2C,CAAEC,IAAI,CAAE,GAAR,CAAaC,OAAO,CAAE,GAAIC,CAAAA,IAAJ,CAASA,IAAI,CAACC,GAAL,GAAc,KAAO,IAAP,CAAc,EAAd,CAAmB,GAA1C,CAAtB,CAA3C,EACA5B,OAAO,CAACsB,GAAR,CAAY,SAAZ,CAAuBL,IAAI,CAACM,MAAL,CAAYM,EAAnC,CAAuC,CAAEJ,IAAI,CAAE,GAAR,CAAaC,OAAO,CAAE,GAAIC,CAAAA,IAAJ,CAASA,IAAI,CAACC,GAAL,GAAc,KAAO,IAAP,CAAc,EAAd,CAAmB,GAA1C,CAAtB,CAAvC,EAEA,GAAIX,IAAI,CAACM,MAAL,CAAYO,KAAZ,GAAsB,IAA1B,CAAgC,CAC5B9B,OAAO,CAACsB,GAAR,CAAY,OAAZ,CAAqB,IAArB,CAA2B,CAAEG,IAAI,CAAE,GAAR,CAAaC,OAAO,CAAE,GAAIC,CAAAA,IAAJ,CAASA,IAAI,CAACC,GAAL,GAAc,KAAO,IAAP,CAAc,EAAd,CAAmB,GAA1C,CAAtB,CAA3B,EACH,CAFD,IAEO,CACH5B,OAAO,CAACsB,GAAR,CAAY,OAAZ,CAAqB,KAArB,CAA4B,CAAEG,IAAI,CAAE,GAAR,CAAaC,OAAO,CAAE,GAAIC,CAAAA,IAAJ,CAASA,IAAI,CAACC,GAAL,GAAc,KAAO,IAAP,CAAc,EAAd,CAAmB,GAA1C,CAAtB,CAA5B,EACH,CAED,GAAIX,IAAI,CAACM,MAAL,CAAYQ,KAAhB,CAAuB,CACnB/B,OAAO,CAACsB,GAAR,CAAY,YAAZ,CAA0BL,IAAI,CAACM,MAAL,CAAYQ,KAAtC,CAA6C,CAAEN,IAAI,CAAE,GAAR,CAAaC,OAAO,CAAE,GAAIC,CAAAA,IAAJ,CAASA,IAAI,CAACC,GAAL,GAAc,KAAO,IAAP,CAAc,EAAd,CAAmB,GAA1C,CAAtB,CAA7C,EACH,CAEDjC,OAAO,CAACqC,IAAR,CAAa,sBAAb,EA7BE,uDADV,gEAgCKC,KAhCL,CAgCW,SAAAd,KAAK,CAAI,CACZpB,aAAa,CAAC,KAAD,CAAb,CACAF,SAAS,CAACsB,KAAD,CAAT,CACH,CAnCL,EAoCH,CAED,QAASe,CAAAA,cAAT,CAAwBC,QAAxB,CAAkC,CAC9B7B,OAAO,CAACC,GAAR,CAAY,qBAAZ,EACA,GAAMC,CAAAA,cAAc,CAAG,CACnBC,MAAM,CAAE,MADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,gBAAiByB,QAFZ,CAFU,CAAvB,CAQAxB,KAAK,CAAC,iBAAD,CAAoBH,cAApB,CAAL,CACKI,IADL,2FACU,kBAAMC,QAAN,iLACIC,MADJ,yBACaD,QAAQ,CAACH,OAAT,CAAiBR,GAAjB,CAAqB,cAArB,CADb,iDACa,uBAAsCa,QAAtC,CAA+C,kBAA/C,CADb,cAEWD,MAFX,kEAE2BD,CAAAA,QAAQ,CAACG,IAAT,EAF3B,2CAEIC,IAFJ,iBAKGJ,QAAQ,CAACK,EALZ,2BAMQC,KANR,CAMiBF,IAAI,EAAIA,IAAI,CAACrB,MAN9B,kCAOSwB,OAAO,CAACC,MAAR,CAAeF,KAAf,CAPT,UAUFtB,SAAS,CAAC,EAAD,CAAT,CAEAS,OAAO,CAACC,GAAR,CAAY,WAAZ,EACAD,OAAO,CAACC,GAAR,CAAYU,IAAZ,EAEMjB,OAfJ,CAec,GAAIR,CAAAA,OAAJ,EAfd,CAgBE4C,CAhBF,CAgBM,GAAIT,CAAAA,IAAJ,CAAS,CAAT,CAhBN,CAgBmB;AACrBS,CAAC,CAACC,aAAF,CAAgBpB,IAAI,CAACM,MAAL,CAAYe,UAA5B,EACAtC,OAAO,CAACsB,GAAR,CAAY,cAAZ,CAA4BL,IAAI,CAACM,MAAL,CAAYgB,YAAxC,CAAsD,CAAEd,IAAI,CAAE,GAAR,CAAaC,OAAO,CAAEU,CAAtB,CAAtD,EACA/B,EAAE,GAnBA,yDADV,kEAsBK4B,KAtBL,CAsBW,SAAAd,KAAK,CAAI,CACZpB,aAAa,CAAC,KAAD,CAAb,CACAF,SAAS,CAACsB,KAAD,CAAT,CACH,CAzBL,EA0BH,CAGD,QAASqB,CAAAA,YAAT,CAAsBC,KAAtB,CAA6B,CACzBnC,OAAO,CAACC,GAAR,CAAY,sBAAZ,EACAkC,KAAK,CAACC,cAAN,GACA,GAAIzB,CAAAA,IAAI,CAAG,CACP0B,KAAK,CAAEF,KAAK,CAACG,MAAN,CAAa,CAAb,EAAgBC,KADhB,CAEPC,QAAQ,CAAEL,KAAK,CAACG,MAAN,CAAa,CAAb,EAAgBC,KAFnB,CAAX,CAKA,GAAMrC,CAAAA,cAAc,CAAG,CACnBC,MAAM,CAAE,MADW,CAEnBC,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CAFU,CAGnBqC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAehC,IAAf,CAHa,CAAvB,CAMAlB,aAAa,CAAC,IAAD,CAAb,CACAY,KAAK,CAAC,eAAD,CAAkBH,cAAlB,CAAL,CACKI,IADL,2FACU,kBAAMC,QAAN,uKACIC,MADJ,yBACaD,QAAQ,CAACH,OAAT,CAAiBR,GAAjB,CAAqB,cAArB,CADb,iDACa,uBAAsCa,QAAtC,CAA+C,kBAA/C,CADb,cAEWD,MAFX,kEAE2BD,CAAAA,QAAQ,CAACG,IAAT,EAF3B,2CAEIC,IAFJ,iBAKGJ,QAAQ,CAACK,EALZ,2BAME;AACMC,KAPR,CAOiBF,IAAI,EAAIA,IAAI,CAACrB,MAP9B,CAQE;AARF,iCASSwB,OAAO,CAACC,MAAR,CAAeF,KAAf,CATT,UAYFtB,SAAS,CAAC,EAAD,CAAT,CAEAS,OAAO,CAACC,GAAR,CAAY,WAAZ,EACAD,OAAO,CAACC,GAAR,CAAYU,IAAZ,EAEAiB,cAAc,CAACjB,IAAI,CAACM,MAAL,CAAY2B,IAAb,CAAd,CAjBE,yDADV,kEAoBKjB,KApBL,CAoBW,SAAAd,KAAK,CAAI,CACZpB,aAAa,CAAC,KAAD,CAAb,CACAO,OAAO,CAACC,GAAR,CAAY,cAAZ,EACAD,OAAO,CAACC,GAAR,CAAYY,KAAZ,EACAtB,SAAS,CAACsB,KAAD,CAAT,CACAb,OAAO,CAACa,KAAR,CAAc,qBAAd,CAAqCA,KAArC,EACH,CA1BL,EA6BH,CAED,mBAAQ,wCACJ,aAAK,SAAS,CAAC,MAAf,wBACI,aAAM,SAAS,CAAC,cAAhB,uBAEI,YAAK,SAAS,CAAC,8BAAf,uBACI,YAAK,SAAS,CAAC,YAAf,uBACI,YAAK,SAAS,CAAC,mDAAf,uBACI,aAAK,SAAS,CAAC,2BAAf,wBACI,aAAK,SAAS,CAAC,kBAAf,wBACI,WAAI,SAAS,CAAC,IAAd,uBADJ,cAEI,UAAG,SAAS,CAAC,MAAb,iDAFJ,GADJ,cAMI,YAAK,SAAS,CAAC,MAAf,uBACI,YAAK,SAAS,CAAC,WAAf,uBACI,aAAK,SAAS,CAAC,QAAf,wBACI,YAAK,SAAS,CAAC,aAAf,uBACI,YACI,GAAG,CAAEhC,MADT,CAEI,GAAG,CAAC,cAFR,CAGI,SAAS,CAAC,0BAHd,CAII,KAAK,CAAC,KAJV,CAKI,MAAM,CAAC,KALX,EADJ,EADJ,cAUI,cAAM,QAAQ,CAAEqD,YAAhB,wBACI,aAAK,SAAS,CAAC,MAAf,wBACI,cAAO,SAAS,CAAC,YAAjB,mBADJ,cAEI,cACI,SAAS,CAAC,8BADd,CAEI,IAAI,CAAC,OAFT,CAGI,IAAI,CAAC,OAHT,CAII,WAAW,CAAC,kBAJhB,EAFJ,cAQI,aAAM,KAAK,CAAE,CAAEW,KAAK,CAAE,KAAT,CAAb,UAAiCvD,MAAM,CAAC+C,KAAxC,EARJ,GADJ,cAWI,aAAK,SAAS,CAAC,MAAf,wBACI,eAAO,SAAS,CAAC,YAAjB,uBAAwC7C,YAAxC,GADJ,cAEI,cACI,SAAS,CAAC,8BADd,CAEI,IAAI,CAAC,UAFT,CAGI,IAAI,CAAC,UAHT,CAII,WAAW,CAAC,qBAJhB,EAFJ,cAQI,aAAM,KAAK,CAAE,CAAEqD,KAAK,CAAE,KAAT,CAAb,UAAiCvD,MAAM,CAACkD,QAAxC,EARJ,GAXJ,cA4BI,kCACI,cAAO,SAAS,CAAC,YAAjB,EADJ,EA5BJ,cA4CI,aAAK,SAAS,CAAC,kBAAf,WAEKhD,YAAY,cACT,gBAAQ,SAAS,CAAC,wBAAlB,CAA2C,IAAI,CAAC,QAAhD,CAAyD,QAAQ,KAAjE,wBACI,aAAM,SAAS,CAAC,kCAAhB,CAAmD,IAAI,CAAC,QAAxD,CAAiE,cAAa,IAA9E,EADJ,mBADS,CAIG,IANpB,CAQK,CAACA,YAAD,cACG,eAAQ,SAAS,CAAC,wBAAlB,CAA2C,IAAI,CAAC,QAAhD,mBADH,CAEK,IAVV,GA5CJ,GAVJ,GADJ,EADJ,EANJ,cAiFI,KAAC,MAAD,IAjFJ,GADJ,EADJ,EADJ,EAFJ,EADJ,QADI,SAAR,CAkGH,CAED,cAAeJ,CAAAA,KAAf","sourcesContent":["\nimport avatar from './../avatar.jpg';\nimport React, { useState, useEffect } from \"react\";\nimport Footer from './../Footer.js';\nimport Cookies from 'universal-cookie';\nimport { useHistory } from \"react-router-dom\";\n\nfunction Login() {\n\n    const history = useHistory();\n    const [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (at) {\n            // history.push(\"/dashboard/quotations\");\n            window.location = \"/dashboard/analytics\";\n        }\n    });\n\n\n    function me() {\n        console.log(\"inside me\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/me', requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n\n                cookies.set('user_name', data.result.name, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                cookies.set('user_id', data.result.id, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n\n                if (data.result.admin === true) {\n                    cookies.set('admin', true, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                } else {\n                    cookies.set('admin', false, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                }\n\n                if (data.result.photo) {\n                    cookies.set('user_photo', data.result.photo, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                }\n\n                history.push(\"/dashboard/analytics\");\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    function getAccessToken(authCode) {\n        console.log(\"inside access token\");\n        const requestOptions = {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': authCode,\n            },\n        };\n\n        fetch('/v1/accesstoken', requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                const cookies = new Cookies();\n                var d = new Date(0); // The 0 there is the key, which sets the date to the epoch\n                d.setUTCSeconds(data.result.expires_at);\n                cookies.set('access_token', data.result.access_token, { path: '/', expires: d });\n                me();\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n\n    function handleSubmit(event) {\n        console.log(\"Inside handle Submit\");\n        event.preventDefault();\n        var data = {\n            email: event.target[0].value,\n            password: event.target[1].value,\n        };\n\n        const requestOptions = {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(data)\n        };\n\n        setProcessing(true);\n        fetch('/v1/authorize', requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = (data && data.errors);\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                getAccessToken(data.result.code);\n            })\n            .catch(error => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors(error);\n                console.error('There was an error!', error);\n            });\n\n\n    }\n\n    return (<>\n        <div className=\"main\">\n            <main className=\"d-flex w-100\" >\n\n                <div className=\"container d-flex flex-column\">\n                    <div className=\"row vh-100\">\n                        <div className=\"col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100\">\n                            <div className=\"d-table-cell align-middle\">\n                                <div className=\"text-center mt-4\">\n                                    <h1 className=\"h2\">Start POS</h1>\n                                    <p className=\"lead\">Sign in to your account to continue</p>\n                                </div>\n\n                                <div className=\"card\">\n                                    <div className=\"card-body\">\n                                        <div className=\"m-sm-4\">\n                                            <div className=\"text-center\">\n                                                <img\n                                                    src={avatar}\n                                                    alt=\"Charles Hall\"\n                                                    className=\"img-fluid rounded-circle\"\n                                                    width=\"132\"\n                                                    height=\"132\"\n                                                />\n                                            </div>\n                                            <form onSubmit={handleSubmit}>\n                                                <div className=\"mb-3\">\n                                                    <label className=\"form-label\">Email</label>\n                                                    <input\n                                                        className=\"form-control form-control-lg\"\n                                                        type=\"email\"\n                                                        name=\"email\"\n                                                        placeholder=\"Enter your email\"\n                                                    />\n                                                    <span style={{ color: \"red\" }} >{errors.email}</span>\n                                                </div>\n                                                <div className=\"mb-3\">\n                                                    <label className=\"form-label\">Password {isProcessing}</label>\n                                                    <input\n                                                        className=\"form-control form-control-lg\"\n                                                        type=\"password\"\n                                                        name=\"password\"\n                                                        placeholder=\"Enter your password\"\n                                                    />\n                                                    <span style={{ color: \"red\" }} >{errors.password}</span>\n                                                    {/*\n                                                <small>\n                                                    <a href=\"/\"\n                                                    >Forgot password?</a\n                                                    >\n                                                </small>\n                                                */}\n                                                </div>\n                                                <div>\n                                                    <label className=\"form-check\">\n                                                        {/*\n                                                    <input\n                                                        className=\"form-check-input\"\n                                                        type=\"checkbox\"\n                                                        value=\"remember-me\"\n                                                        name=\"remember-me\"\n                                                        checked\n                                                        readOnly\n                                                    />\n                                                    <span className=\"form-check-label\">\n                                                        Remember me next time\n                                                    </span> */}\n                                                    </label>\n                                                </div>\n                                                <div className=\"text-center mt-3\">\n\n                                                    {isProcessing ?\n                                                        <button className=\"btn btn-lg btn-primary\" type=\"button\" disabled>\n                                                            <span className=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden={true}></span>\n                                                            Logging In...\n                                                        </button> : null}\n\n                                                    {!isProcessing ?\n                                                        <button className=\"btn btn-lg btn-primary\" type=\"submit\">Login</button>\n                                                        : null}\n\n                                                </div>\n                                            </form>\n                                        </div>\n\n                                    </div>\n\n                                </div>\n                                <Footer />\n                            </div>\n\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </main >  </div>   </>);\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}