{"ast":null,"code":"import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from\"react\";import OrderPreview from\"./preview.js\";import{Modal,Button,Form}from\"react-bootstrap\";import StoreCreate from\"../store/create.js\";import CustomerCreate from\"./../customer/create.js\";import ProductCreate from\"./../product/create.js\";import UserCreate from\"./../user/create.js\";import SignatureCreate from\"./../signature/create.js\";import Cookies from\"universal-cookie\";import{Typeahead}from\"react-bootstrap-typeahead\";import NumberFormat from\"react-number-format\";import DatePicker from\"react-datepicker\";import{format}from\"date-fns\";import{Spinner}from\"react-bootstrap\";import OrderView from\"./view.js\";import\"./style.css\";import{DebounceInput}from'react-debounce-input';//import BarcodeScannerComponent from \"react-qr-barcode-scanner\";\n//import Quagga from 'quagga';\nimport ProductView from\"./../product/view.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderCreate=/*#__PURE__*/forwardRef(function(props,ref){var _totalPrice,_vatPrice,_netTotal,_totalPaymentAmount,_balanceAmount;useImperativeHandle(ref,function(){return{open:function open(id){errors={};setErrors(_objectSpread({},errors));selectedProducts=[];setSelectedProducts([]);selectedStores=[];setSelectedStores([]);selectedCustomers=[];setSelectedCustomers([]);if(cookies.get(\"user_id\")){selectedDeliveredByUsers=[{id:cookies.get(\"user_id\"),name:cookies.get(\"user_name\")}];formData.delivered_by=cookies.get(\"user_id\");setFormData(_objectSpread({},formData));setSelectedDeliveredByUsers(_toConsumableArray(selectedDeliveredByUsers));}if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');formData.store_name=cookies.get('store_name');formData.vat_percent=parseFloat(cookies.get('vat_percent'));console.log(\"formData.store_id:\",formData.store_id);}formData.id=undefined;formData.discount=0.00;formData.discount_percent=0.00;formData.shipping_handling_fees=0.00;formData.partial_payment_amount=0.00;formData.cash_discount=0.00;formData.payment_method=\"\";formData.payment_status=\"\";formData.code=\"\";formData.net_total=0.00;formData.date_str=new Date();formData.payments_input=[{\"date_str\":formData.date_str,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false}];formData.cash_discount=0.00;if(id){getOrder(id);}setFormData(_objectSpread({},formData));reCalculate();setShow(true);}};});function getOrder(id){console.log(\"inside get Order\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/order/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,i,_formData$payments_in,selectedStores,searchLabel,selectedCustomers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);formData=data.result;formData.date_str=data.result.date;if(data.result.payments){console.log(\"data.result.payments:\",data.result.payments);formData.payments_input=data.result.payments;for(i=0;i<((_formData$payments_in=formData.payments_input)===null||_formData$payments_in===void 0?void 0:_formData$payments_in.length);i++){formData.payments_input[i].date_str=formData.payments_input[i].date;}}/*\n                let order = data.result;\n                formData = {\n                    id: order.id,\n                    code: order.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n                */if(formData.is_discount_percent){formData.discountValue=formData.discount_percent;}else{formData.discountValue=formData.discount;}selectedProducts=formData.products;setSelectedProducts(_toConsumableArray(selectedProducts));selectedStores=[{id:formData.store_id,name:formData.store_name}];searchLabel=formData.customer_name;selectedCustomers=[{id:formData.customer_id,name:formData.customer_name,search_label:searchLabel}];/*\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: formData.created_by,\n                        name: formData.created_by_name\n                    }\n                ];\n\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n                */setSelectedStores([].concat(selectedStores));setSelectedCustomers([].concat(selectedCustomers));reCalculate();setFormData(_objectSpread({},formData));case 26:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}useEffect(function(){var listener=function listener(event){if(event.code===\"Enter\"||event.code===\"NumpadEnter\"){console.log(\"Enter key was pressed. Run your function-order.123\");// event.preventDefault();\nvar form=event.target.form;if(form&&event.target){var index=Array.prototype.indexOf.call(form,event.target);if(form&&form.elements[index+1]){if(event.target.getAttribute(\"class\").includes(\"barcode\")){form.elements[index].focus();}else{form.elements[index+1].focus();}event.preventDefault();}}}};document.addEventListener(\"keydown\",listener);return function(){document.removeEventListener(\"keydown\",listener);};},[]);var selectedDate=new Date();//const history = useHistory();\nvar _useState=useState({\"payment_amount\":[]}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();//fields\nvar _useState5=useState({vat_percent:15.0,discountValue:0.00,discount:0.00,discount_percent:0.0,cash_discount:0.00,is_discount_percent:false,date_str:new Date(),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"delivered\",payment_status:\"\",payment_method:\"\",price_type:\"retail\",useLaserScanner:false,store_id:\"\"}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];//Store Auto Suggestion\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),storeOptions=_useState8[0],setStoreOptions=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedStores=_useState10[0],setSelectedStores=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isStoresLoading=_useState12[0],setIsStoresLoading=_useState12[1];//Customer Auto Suggestion\nvar _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),customerOptions=_useState14[0],setCustomerOptions=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedCustomers=_useState16[0],setSelectedCustomers=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isCustomersLoading=_useState18[0],setIsCustomersLoading=_useState18[1];//Product Auto Suggestion\nvar _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),productOptions=_useState20[0],setProductOptions=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),selectedProduct=_useState22[0],setSelectedProduct=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),selectedProducts=_useState24[0],setSelectedProducts=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isProductsLoading=_useState26[0],setIsProductsLoading=_useState26[1];//Delivered By Auto Suggestion\nvar _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),deliveredByUserOptions=_useState28[0],setDeliveredByUserOptions=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),selectedDeliveredByUsers=_useState30[0],setSelectedDeliveredByUsers=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isDeliveredByUsersLoading=_useState32[0],setIsDeliveredByUsersLoading=_useState32[1];//Delivered By Signature Auto Suggestion\nvar _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),deliveredBySignatureOptions=_useState34[0],setDeliveredBySignatureOptions=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),selectedDeliveredBySignatures=_useState36[0],setSelectedDeliveredBySignatures=_useState36[1];var _useState37=useState(false),_useState38=_slicedToArray(_useState37,2),isDeliveredBySignaturesLoading=_useState38[0],setIsDeliveredBySignaturesLoading=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),show=_useState40[0],setShow=_useState40[1];function handleClose(){setShow(false);}useEffect(function(){var at=cookies.get(\"access_token\");if(!at){// history.push(\"/dashboard/orders\");\nwindow.location=\"/\";}});function ObjectToSearchQueryParams(object){return Object.keys(object).map(function(key){return\"search[\".concat(key,\"]=\")+encodeURIComponent(object[key]);}).join(\"&\");}function suggestStores(_x2){return _suggestStores.apply(this,arguments);}function _suggestStores(){_suggestStores=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"Inside handle suggestStores\");setStoreOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsStoresLoading(true);_context3.next=13;return fetch(\"/v1/store?\"+Select+queryString,requestOptions);case 13:result=_context3.sent;_context3.next=16;return result.json();case 16:data=_context3.sent;setStoreOptions(data.result);setIsStoresLoading(false);case 19:case\"end\":return _context3.stop();}}},_callee3);}));return _suggestStores.apply(this,arguments);}function suggestCustomers(_x3){return _suggestCustomers.apply(this,arguments);}function _suggestCustomers(){_suggestCustomers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"Inside handle suggestCustomers\");setCustomerOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";setIsCustomersLoading(true);_context4.next=13;return fetch(\"/v1/customer?\"+Select+queryString,requestOptions);case 13:result=_context4.sent;_context4.next=16;return result.json();case 16:data=_context4.sent;setCustomerOptions(data.result);setIsCustomersLoading(false);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return _suggestCustomers.apply(this,arguments);}function GetProductUnitPriceInStore(storeId,productStores){if(!productStores){return\"\";}for(var i=0;i<productStores.length;i++){console.log(\"productStores[i]:\",productStores[i]);console.log(\"store_id:\",storeId);if(productStores[i].store_id===storeId){console.log(\"macthed\");console.log(\"productStores[i].retail_unit_price:\",productStores[i].retail_unit_price);return productStores[i];/*\n                if (formData.price_type === \"retail\") {\n                    return unitPriceListArray[i].retail_unit_price;\n                } else if (formData.price_type === \"wholesale\") {\n                    return unitPriceListArray[i].wholesale_unit_price;\n                } else if (formData.price_type === \"purchase\") {\n                    return unitPriceListArray[i].purchase_unit_price;\n                }\n                */}else{console.log(\"not matched\");}}return\"\";}var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),openProductSearchResult=_useState42[0],setOpenProductSearchResult=_useState42[1];function suggestProducts(_x4){return _suggestProducts.apply(this,arguments);}function _suggestProducts(){_suggestProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(searchTerm){var params,queryString,requestOptions,Select,result,data,products;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"Inside handle suggestProducts\");setProductOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context5.next=7;break;}openProductSearchResult=false;setOpenProductSearchResult(false);return _context5.abrupt(\"return\");case 7:params={name:searchTerm};if(cookies.get(\"store_id\")){params.store_id=cookies.get(\"store_id\");}queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,part_number,name,unit,part_number,name_in_arabic,product_stores\";setIsProductsLoading(true);_context5.next=16;return fetch(\"/v1/product?\"+Select+queryString+\"&limit=200\",requestOptions);case 16:result=_context5.sent;_context5.next=19;return result.json();case 19:data=_context5.sent;products=data.result;if(!(!products||products.length===0)){_context5.next=26;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 26:openProductSearchResult=true;setOpenProductSearchResult(true);setProductOptions(products);setIsProductsLoading(false);case 30:case\"end\":return _context5.stop();}}},_callee5);}));return _suggestProducts.apply(this,arguments);}function getProductByBarCode(_x5){return _getProductByBarCode.apply(this,arguments);}function _getProductByBarCode(){_getProductByBarCode=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(barcode){var requestOptions,Select,result,data,product;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:formData.barcode=barcode;setFormData(_objectSpread({},formData));console.log(\"Inside getProductByBarCode\");errors[\"bar_code\"]=\"\";setErrors(_objectSpread({},errors));console.log(\"barcode:\"+formData.barcode);if(formData.barcode){_context6.next=8;break;}return _context6.abrupt(\"return\");case 8:if(formData.barcode.length===13){formData.barcode=formData.barcode.slice(0,-1);}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,ean_12,part_number,name,product_stores,unit,part_number,name_in_arabic\";_context6.next=13;return fetch(\"/v1/product/barcode/\"+formData.barcode+\"?\"+Select,requestOptions);case 13:result=_context6.sent;_context6.next=16;return result.json();case 16:data=_context6.sent;product=data.result;if(product){addProduct(product);}else{errors[\"bar_code\"]=\"Invalid Barcode:\"+formData.barcode;setErrors(_objectSpread({},errors));}formData.barcode=\"\";setFormData(_objectSpread({},formData));case 21:case\"end\":return _context6.stop();}}},_callee6);}));return _getProductByBarCode.apply(this,arguments);}function suggestUsers(_x6){return _suggestUsers.apply(this,arguments);}function _suggestUsers(){_suggestUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:console.log(\"Inside handle suggestUsers\");setDeliveredByUserOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context7.next=5;break;}return _context7.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsDeliveredByUsersLoading(true);_context7.next=13;return fetch(\"/v1/user?\"+Select+queryString,requestOptions);case 13:result=_context7.sent;_context7.next=16;return result.json();case 16:data=_context7.sent;setDeliveredByUserOptions(data.result);setIsDeliveredByUsersLoading(false);case 19:case\"end\":return _context7.stop();}}},_callee7);}));return _suggestUsers.apply(this,arguments);}function suggestSignatures(_x7){return _suggestSignatures.apply(this,arguments);}function _suggestSignatures(){_suggestSignatures=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(\"Inside handle suggestSignatures\");setDeliveredBySignatureOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context8.next=5;break;}return _context8.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsDeliveredBySignaturesLoading(true);_context8.next=13;return fetch(\"/v1/signature?\"+Select+queryString,requestOptions);case 13:result=_context8.sent;_context8.next=16;return result.json();case 16:data=_context8.sent;setDeliveredBySignatureOptions(data.result);setIsDeliveredBySignaturesLoading(false);case 19:case\"end\":return _context8.stop();}}},_callee8);}));return _suggestSignatures.apply(this,arguments);}function handleCreate(event){event.preventDefault();var haveErrors=false;if(!formData.cash_discount){formData.cash_discount=0.00;}formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit_price:parseFloat(selectedProducts[i].unit_price),unit:selectedProducts[i].unit});}errors[\"products\"]=\"\";setErrors(_objectSpread({},errors));if(formData.products.length===0){errors[\"products\"]=\"No products added\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!validatePaymentAmounts()){console.log(\"Errors on payments\");haveErrors=true;}if(!formData.shipping_handling_fees&&formData.shipping_handling_fees!==0){errors[\"shipping_handling_fees\"]=\"Invalid shipping / handling fees\";setErrors(_objectSpread({},errors));haveErrors=true;}/*\n        if (formData.payment_status === \"paid_partially\" && !formData.partial_payment_amount && formData.partial_payment_amount !== 0) {\n            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount <= 0) {\n            errors[\"partial_payment_amount\"] = \"Partial payment should be > 0 \";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.id && formData.payment_status === \"paid_partially\" && formData.partial_payment_amount >= netTotal) {\n            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n            setErrors({ ...errors });\n            return;\n        }\n        \n\n        errors[\"payment_method\"] = \"\";\n        setErrors({ ...errors });\n        if (!formData.id && formData.payment_status != \"not_paid\" && !formData.payment_method) {\n            errors[\"payment_method\"] = \"Payment method is required\";\n            setErrors({ ...errors });\n            return;\n        }\n        */if(!formData.discount&&formData.discount!==0){errors[\"discount\"]=\"Invalid discount\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.discount_percent&&formData.discount_percent!==0){errors[\"discount_percent\"]=\"Invalid discount percent\";setErrors(_objectSpread({},errors));haveErrors=true;}if(parseFloat(formData.discount_percent)>100){errors[\"discount_percent\"]=\"Discount percent cannot be > 100\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.vat_percent&&formData.vat_percent!==0){errors[\"vat_percent\"]=\"Invalid vat percent\";setErrors(_objectSpread({},errors));haveErrors=true;}if(haveErrors){console.log(\"Errors: \",errors);return;}formData.discount=parseFloat(formData.discount);formData.discount_percent=parseFloat(formData.discount_percent);formData.vat_percent=parseFloat(formData.vat_percent);formData.net_total=parseFloat(netTotal);if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');}var endPoint=\"/v1/order\";var method=\"POST\";if(formData.id){endPoint=\"/v1/order/\"+formData.id;method=\"PUT\";}var requestOptions={method:method,headers:{'Accept':'application/json',\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")},body:JSON.stringify(formData)};console.log(\"formData:\",formData);setProcessing(true);fetch(endPoint,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get(\"content-type\"))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes(\"application/json\");_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});setProcessing(false);console.log(\"Response:\");console.log(data);props.showToastMessage(\"Order Created Successfully!\",\"success\");if(props.refreshList){props.refreshList();}handleClose();formData.products=[];selectedProducts=[];setSelectedProducts([]);formData.customer_id=\"\";setSelectedCustomers([]);setFormData(_objectSpread({},formData));reCalculate();openDetailsView(data.result.id);case 25:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x8){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(_objectSpread({},error));console.error(\"There was an error!\",error);props.showToastMessage(\"Error Creating Order!\",\"danger\");});}function getProductIndex(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return i;}}return false;}function isProductAdded(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return true;}}return false;}function GetProductStockInStore(storeId,productStores){if(!productStores){return 0.0;}for(var i=0;i<productStores.length;i++){if(productStores[i].store_id===storeId){return productStores[i].stock;}}return 0.0;}function addProduct(product){console.log(\"Inside Add product\");if(!formData.store_id){errors.product_id=\"Please Select a Store and try again\";setErrors(_objectSpread({},errors));return;}errors.product_id=\"\";if(!product){errors.product_id=\"Invalid Product\";setErrors(_objectSpread({},errors));return;}/*\n        let productStore = GetProductUnitPriceInStore(\n            formData.store_id,\n            product.stores\n        );\n        */ // product.unit_price = productStore.retail_unit_price;\nif(product.product_stores[formData.store_id]){product.unit_price=product.product_stores[formData.store_id].retail_unit_price;}errors.unit_price=\"\";if(!product.unit_price){errors.unit_price=\"Invalid Unit Price\";setErrors(_objectSpread({},errors));return;}var alreadyAdded=false;var index=false;var quantity=0.00;product.quantity=1.00;if(isProductAdded(product.id)){alreadyAdded=true;index=getProductIndex(product.id);quantity=parseFloat(selectedProducts[index].quantity+product.quantity);}else{quantity=parseFloat(product.quantity);}console.log(\"quantity:\",quantity);errors.quantity=\"\";//let stock = GetProductStockInStore(formData.store_id, product.stores);\nvar stock=0;if(product.product_stores[formData.store_id]){stock=product.product_stores[formData.store_id].stock;}if(stock<quantity){if(index===false){index=selectedProducts.length;}// errors[\"quantity_\" + index] = \"Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for product: \" + product.name;\nerrors[\"quantity_\"+index]=\"Warning: Available stock is \"+stock;console.log(\"errors:\",errors);setErrors(_objectSpread({},errors));}if(alreadyAdded){selectedProducts[index].quantity=parseFloat(quantity);}if(!alreadyAdded){selectedProducts.push({product_id:product.id,code:product.item_code,part_number:product.part_number,name:product.name,quantity:product.quantity,product_stores:product.product_stores,unit_price:parseFloat(product.unit_price).toFixed(2),unit:product.unit});}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}function removeProduct(product){var index=selectedProducts.indexOf(product);if(product.quantity_returned>0){errors[\"product_\"+index]=\"This product cannot be removed as it is returned, Note: Please remove the product from sales return and try again\";setErrors(_objectSpread({},errors));return;}if(index>-1){selectedProducts.splice(index,1);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}var _useState43=useState(0.0),_useState44=_slicedToArray(_useState43,2),totalPrice=_useState44[0],setTotalPrice=_useState44[1];function findTotalPrice(){totalPrice=0.00;for(var i=0;i<selectedProducts.length;i++){totalPrice+=parseFloat(selectedProducts[i].unit_price)*parseFloat(selectedProducts[i].quantity);}// totalPrice = totalPrice.toFixed(2);\n// totalPrice = Math.round(totalPrice * 100) / 100;\nsetTotalPrice(totalPrice);}var _useState45=useState(0.00),_useState46=_slicedToArray(_useState45,2),vatPrice=_useState46[0],setVatPrice=_useState46[1];function findVatPrice(){vatPrice=0.00;if(totalPrice>0){console.log(\"formData.vat_percent:\",formData.vat_percent);//(35.8 / 100) * 10000;\nvatPrice=parseFloat(formData.vat_percent)/100*(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount));console.log(\"vatPrice:\",vatPrice);}setVatPrice(vatPrice);}var _useState47=useState(0.00),_useState48=_slicedToArray(_useState47,2),netTotal=_useState48[0],setNetTotal=_useState48[1];function RoundFloat(val,precision){var ratio=Math.pow(10,precision);return Math.round(val*ratio)/ratio;}function findNetTotal(){netTotal=0.00;if(totalPrice>0){netTotal=parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount)+parseFloat(vatPrice);netTotal=parseFloat(netTotal);}netTotal=RoundFloat(netTotal,2);// netTotal = Math.round(netTotal * 100) / 100;\nsetNetTotal(netTotal);if(!formData.id){var method=\"\";if(formData.payments_input[0]){method=formData.payments_input[0].method;}formData.payments_input=[{\"date_str\":formData.date_str,\"amount\":0.00,\"method\":method,\"deleted\":false}];if(netTotal>0){formData.payments_input[0].amount=parseFloat(netTotal.toFixed(2));if(formData.cash_discount){var _formData$cash_discou;formData.payments_input[0].amount=formData.payments_input[0].amount-parseFloat((_formData$cash_discou=formData.cash_discount)===null||_formData$cash_discou===void 0?void 0:_formData$cash_discou.toFixed(2));}formData.payments_input[0].amount=parseFloat(formData.payments_input[0].amount.toFixed(2));}}/*\n        if (formData.payments_input[0].amount === 0) {\n            formData.payments_input[0].amount = \"\";\n        }\n        */setFormData(_objectSpread({},formData));validatePaymentAmounts();}var _useState49=useState(0.00),_useState50=_slicedToArray(_useState49,2),discountPercent=_useState50[0],setDiscountPercent=_useState50[1];function findDiscountPercent(){if(formData.discount>=0&&totalPrice>0){discountPercent=parseFloat(parseFloat(formData.discount/totalPrice)*100);setDiscountPercent(discountPercent);formData.discount_percent=discountPercent;//formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\nsetFormData(_objectSpread({},formData));}}function findDiscount(){if(formData.discount_percent>=0&&totalPrice>0){formData.discount=parseFloat(totalPrice*parseFloat(formData.discount_percent/100));// formData.discount = parseFloat(formData.discount.toFixed(2));\nsetFormData(_objectSpread({},formData));}}function reCalculate(){findTotalPrice();if(formData.is_discount_percent){findDiscount();}else{findDiscountPercent();}findVatPrice();findNetTotal();}var DetailsViewRef=useRef();function openDetailsView(id){DetailsViewRef.current.open(id);}var StoreCreateFormRef=useRef();function openStoreCreateForm(){StoreCreateFormRef.current.open();}var CustomerCreateFormRef=useRef();function openCustomerCreateForm(){CustomerCreateFormRef.current.open();}var ProductCreateFormRef=useRef();function openProductCreateForm(){ProductCreateFormRef.current.open();}var UserCreateFormRef=useRef();function openUserCreateForm(){UserCreateFormRef.current.open();}var SignatureCreateFormRef=useRef();function openSignatureCreateForm(){SignatureCreateFormRef.current.open();}var ProductDetailsViewRef=useRef();function openProductDetailsView(id){ProductDetailsViewRef.current.open(id);}function addNewPayment(){var date=new Date();if(!formData.id){date=formData.date_str;}formData.payments_input.push({\"date_str\":date,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false});setFormData(_objectSpread({},formData));validatePaymentAmounts();//validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n}function findTotalPayments(){var _parseFloat,_parseFloat2;var totalPayment=0.00;for(var i=0;i<((_formData$payments_in2=formData.payments_input)===null||_formData$payments_in2===void 0?void 0:_formData$payments_in2.length);i++){var _formData$payments_in2;if(formData.payments_input[i].amount&&!formData.payments_input[i].deleted){totalPayment+=formData.payments_input[i].amount;}}totalPaymentAmount=totalPayment;console.log(\"totalPaymentAmount:\",totalPaymentAmount);setTotalPaymentAmount(totalPaymentAmount);console.log(\"totalPayment:\",totalPayment);balanceAmount=parseFloat(netTotal.toFixed(2))-parseFloat((_parseFloat=parseFloat(formData.cash_discount))===null||_parseFloat===void 0?void 0:_parseFloat.toFixed(2))-parseFloat(totalPayment.toFixed(2));balanceAmount=parseFloat(balanceAmount.toFixed(2));setBalanceAmount(balanceAmount);if(balanceAmount===parseFloat((parseFloat(netTotal.toFixed(2))-parseFloat((_parseFloat2=parseFloat(formData.cash_discount))===null||_parseFloat2===void 0?void 0:_parseFloat2.toFixed(2))).toFixed(2))){paymentStatus=\"not_paid\";}else if(balanceAmount<=0){paymentStatus=\"paid\";}else if(balanceAmount>0){paymentStatus=\"paid_partially\";}setPaymentStatus(paymentStatus);return totalPayment;}var _useState51=useState(0.00),_useState52=_slicedToArray(_useState51,2),totalPaymentAmount=_useState52[0],setTotalPaymentAmount=_useState52[1];var _useState53=useState(0.00),_useState54=_slicedToArray(_useState53,2),balanceAmount=_useState54[0],setBalanceAmount=_useState54[1];var _useState55=useState(\"\"),_useState56=_slicedToArray(_useState55,2),paymentStatus=_useState56[0],setPaymentStatus=_useState56[1];function removePayment(key){var validatePayments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;formData.payments_input.splice(key,1);//formData.payments_input[key][\"deleted\"] = true;\nsetFormData(_objectSpread({},formData));if(validatePayments){validatePaymentAmounts();}findTotalPayments();}function validatePaymentAmounts(){console.log(\"validatePaymentAmount: netTotal:\",netTotal);errors[\"cash_discount\"]=\"\";setErrors(_objectSpread({},errors));var haveErrors=false;if(!netTotal){/*\n            removePayment(0, false);\n            totalPaymentAmount = 0.0;\n            setTotalPaymentAmount(0.00);\n            balanceAmount = 0.00;\n            setBalanceAmount(0.00);\n            paymentStatus = \"\";\n            setPaymentStatus(paymentStatus);\n            */return true;}if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toFixed(2).toString();setErrors(_objectSpread({},errors));haveErrors=true;return false;}var totalPayment=findTotalPayments();// errors[\"payment_date\"] = [];\n//errors[\"payment_method\"] = [];\n//errors[\"payment_amount\"] = [];\nfor(var key=0;key<formData.payments_input.length;key++){errors[\"payment_amount_\"+key]=\"\";errors[\"payment_date_\"+key]=\"\";errors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!formData.payments_input[key].amount){errors[\"payment_amount_\"+key]=\"Payment amount is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(formData.payments_input[key].amount===0){errors[\"payment_amount_\"+key]=\"Amount should be greater than zero\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].date_str){errors[\"payment_date_\"+key]=\"Payment date is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(new Date(formData.payments_input[key].date_str)<new Date(formData.date_str)){errors[\"payment_date_\"+key]=\"Payment date time should be greater than or equal to order date time\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].method){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));haveErrors=true;}if((formData.payments_input[key].amount||formData.payments_input[key].amount===0)&&!formData.payments_input[key].deleted){/* let maxAllowedAmount = (netTotal - formData.cash_discount) - (totalPayment - formData.payments_input[key].amount);\n\n                if (maxAllowedAmount < 0) {\n                    maxAllowedAmount = 0;\n                }\n\n                /*\n                \n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                */}}if(haveErrors){return false;}return true;}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(OrderView,{ref:DetailsViewRef,openCreateForm:props.openCreateForm}),/*#__PURE__*/_jsx(ProductView,{ref:ProductDetailsViewRef}),/*#__PURE__*/_jsx(StoreCreate,{ref:StoreCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(CustomerCreate,{ref:CustomerCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(ProductCreate,{ref:ProductCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(UserCreate,{ref:UserCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(SignatureCreate,{ref:SignatureCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsxs(Modal,{show:show,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,backdrop:\"static\",scrollable:true,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:formData.id?\"Update Sales Order #\"+formData.code:\"Create New Sales Order\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsx(OrderPreview,{}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?formData.id?\"Updating....\":\"Creating..\":formData.id?\"Update\":\"Create\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsxs(Modal.Body,{children:[Object.keys(errors).length>0?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"ul\",{children:errors&&Object.keys(errors).map(function(key,index){console.log(\"Key\",key);if(Array.isArray(errors[key])){return errors[key][0]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";}else{return errors[key]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";}})})}):\"\",/*#__PURE__*/_jsxs(\"form\",{className:\"row g-3 needs-validation\",onSubmit:function onSubmit(e){e.preventDefault();handleCreate(e);},children:[!cookies.get('store_name')?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Store*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"store_id\",labelKey:\"name\",isLoading:isStoresLoading,isInvalid:errors.store_id?true:false,onChange:function onChange(selectedItems){errors.store_id=\"\";errors[\"product_id\"]=\"\";setErrors(errors);if(selectedItems.length===0){errors.store_id=\"Invalid Store selected\";setErrors(errors);setFormData(_objectSpread({},formData));setSelectedStores([]);return;}formData.store_id=selectedItems[0].id;setFormData(_objectSpread({},formData));console.log(\"formData.store_id:\",formData.store_id);selectedStores=selectedItems;setSelectedStores(_toConsumableArray(selectedItems));if(formData.store_id){if(selectedProduct[0]&&selectedProduct[0].product_stores&&selectedProduct[0].quantity){var stock=0;if(selectedProduct[0].product_stores){//stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\nif(selectedProduct[0].product_stores[formData.store_id]){stock=selectedProduct[0].product_stores[formData.store_id].stock;}}if(stock<parseFloat(selectedProduct[0].quantity)){if(selectedStores[0]){errors.product_id=\"Stock is only \"+stock+\" in Store: \"+selectedStores[0].name+\" for this product\";}else{errors.product_id=\"Stock is only \"+stock+\" in Selected Store for this product\";}setErrors(_objectSpread({},errors));}}else if(selectedProduct[0]&&selectedProduct[0].product_stores){var _stock=0;//stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\nif(selectedProduct[0].product_stores[formData.store_id]){_stock=selectedProduct[0].product_stores[formData.store_id].stock;}if(_stock===0){if(selectedStores[0]){errors[\"product_id\"]=\"This product is not available in store: \"+selectedStores[0].name;}else{errors[\"product_id\"]=\"This product is not available in selected store.\";}setErrors(_objectSpread({},errors));}}if(selectedProduct[0]){/*\n                                                selectedProduct[0].unit_price = GetProductUnitPriceInStore(\n                                                    formData.store_id,\n                                                    selectedProduct[0].stores\n                                                );\n                                                */if(selectedProduct[0].product_stores[formData.store_id]){selectedProduct[0].unit_price=selectedProduct[0].product_stores[formData.store_id].retail_unit_price;}if(!selectedProduct[0].quantity){selectedProduct[0].quantity=1;}setSelectedProduct(_toConsumableArray(selectedProduct));}}},options:storeOptions,placeholder:\"Select Store\",selected:selectedStores,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestStores(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openStoreCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi x-lg\",children:\" \"}),errors.store_id]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",style:{border:\"solid 0px\"},children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Customer*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"customer_id\",labelKey:\"search_label\",isLoading:isCustomersLoading,isInvalid:errors.customer_id?true:false,onChange:function onChange(selectedItems){errors.customer_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.customer_id=\"Invalid Customer selected\";setErrors(errors);formData.customer_id=\"\";setFormData(_objectSpread({},formData));setSelectedCustomers([]);return;}formData.customer_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedCustomers(selectedItems);},options:customerOptions,placeholder:\"Type name or mob\",selected:selectedCustomers,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestCustomers(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openCustomerCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.customer_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.customer_id]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product Barcode Scan\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DebounceInput,{minLength:3,debounceTimeout:100,placeholder:\"Scan Barcode\",className:\"form-control barcode\",value:formData.barcode,onChange:function onChange(event){return getProductByBarCode(event.target.value);}}),errors.bar_code&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.bar_code]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.date_str?new Date(formData.date_str):null,value:formData.date_str?format(new Date(formData.date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.date_str=value;// formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\nsetFormData(_objectSpread({},formData));}}),errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.date_str]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product Search*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"product_id\",size:\"lg\",labelKey:\"search_label\",emptyLabel:\"\",clearButton:true,open:openProductSearchResult,isLoading:isProductsLoading,isInvalid:errors.product_id?true:false,onChange:function onChange(selectedItems){if(selectedItems.length===0){errors[\"product_id\"]=\"Invalid Product selected\";setErrors(errors);return;}errors[\"product_id\"]=\"\";setErrors(_objectSpread({},errors));if(formData.store_id){addProduct(selectedItems[0]);}setOpenProductSearchResult(false);},options:productOptions,selected:selectedProduct,placeholder:\"Search By Part No. / Name / Name in Arabic\",highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestProducts(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openProductCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.product_id?/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.product_id]}):\"\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\",maxHeight:\"400px\",overflowY:\"auto\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"3%\"},children:\"Remove\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"5%\"},children:\"SI No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"10%\"},children:\"Part No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"30%\"},className:\"text-start\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"15%\"},children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"18%\"},children:\"Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"32%\"},children:\"Price\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedProducts.map(function(product,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\",cursor:\"pointer\"},onClick:function onClick(){removeProduct(product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"})})}),/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:product.part_number}),/*#__PURE__*/_jsxs(\"td\",{style:{textDecoration:\"underline\",color:\"blue\",cursor:\"pointer\"},className:\"text-start\",onClick:function onClick(){openProductDetailsView(product.product_id);},children:[product.name,errors[\"product_\"+index]&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors[\"product_\"+index]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.quantity,className:\"form-control text-end\",placeholder:\"Quantity\",onChange:function onChange(e){errors[\"quantity_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"quantity_\"+index]=\"Invalid Quantity\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"quantity_\"+index]=\"Quantity should be > 0\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}product.quantity=parseFloat(e.target.value);selectedProducts[index].quantity=parseFloat(e.target.value);reCalculate();var stock=0;if(selectedProducts[index].product_stores){var _selectedProducts$ind;stock=(_selectedProducts$ind=selectedProducts[index].product_stores[formData.store_id])===null||_selectedProducts$ind===void 0?void 0:_selectedProducts$ind.stock;// stock = GetProductStockInStore(formData.store_id, selectedProducts[index].stores);\n}if(stock<parseFloat(e.target.value)&&selectedProducts[index].product_stores){// errors[\"quantity_\" + index] = \" Warning: Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for this product\";\nerrors[\"quantity_\"+index]=\" Warning: Available stock is \"+stock;setErrors(_objectSpread({},errors));return;}selectedProducts[index].quantity=parseFloat(e.target.value);console.log(\"selectedProducts[index].quantity:\",selectedProducts[index].quantity);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:selectedProducts[index].unit?selectedProducts[index].unit:\"Units\"})]}),errors[\"quantity_\"+index]&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors[\"quantity_\"+index]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.unit_price,className:\"form-control text-end\",placeholder:\"Unit Price\",onChange:function onChange(e){errors[\"unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"unit_price_\"+index]=\"Invalid Unit Price\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"unit_price_\"+index]=\"Unit Price should be > 0\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].unit_price:\",selectedProducts[index].unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"unit_price_\"+index]]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(product.unit_price*product.quantity).toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]},index);}).reverse()})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsx(\"table\",{className:\"table table-striped table-sm table-bordered\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Total\"}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",style:{width:\"200px\"},children:/*#__PURE__*/_jsx(NumberFormat,{value:(_totalPrice=totalPrice)===null||_totalPrice===void 0?void 0:_totalPrice.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Shipping & Handling Fees\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.shipping_handling_fees,onChange:function onChange(e){if(parseFloat(e.target.value)===0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"Shipping / Handling Fees should be > 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.shipping_handling_fees=\"\";errors[\"shipping_handling_fees\"]=\"Invalid Shipping / Handling Fees\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.shipping_handling_fees&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.shipping_handling_fees})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\"Discount  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"50px\"},className:\"text-start\",value:formData.discount_percent,onChange:function onChange(e){formData.is_discount_percent=true;if(parseFloat(e.target.value)===0){formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount_percent=parseFloat(e.target.value);formData.discount=0.00;setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"Discount percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount_percent=\"\";formData.discount=0.00;errors[\"discount_percent\"]=\"Invalid Discount Percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"discount_percent\"]=\"\";errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\"%\",errors.discount_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount_percent})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.discount,onChange:function onChange(e){formData.is_discount_percent=false;if(parseFloat(e.target.value)===0){formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount=parseFloat(e.target.value);formData.discount_percent=0.00;setFormData(_objectSpread({},formData));errors[\"discount\"]=\"Discount should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount=\"\";formData.discount_percent=0.00;errors[\"discount\"]=\"Invalid Discount\";setFormData(_objectSpread({},formData));reCalculate();setErrors(_objectSpread({},errors));return;}errors[\"discount\"]=\"\";errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.discount&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\" VAT  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"text-center\",style:{width:\"50px\"},value:formData.vat_percent,onChange:function onChange(e){console.log(\"Inside onchange vat percent\");if(parseFloat(e.target.value)===0){formData.vat_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.vat_percent=parseFloat(e.target.value);vatPrice=0.00;setVatPrice(vatPrice);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"Vat percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.vat_percent=\"\";vatPrice=0.00;setVatPrice(vatPrice);//formData.discount_percent = 0.00;\nerrors[\"vat_percent\"]=\"Invalid vat percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.vat_percent=e.target.value;reCalculate();setFormData(_objectSpread({},formData));console.log(formData);}}),\"%\",errors.vat_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.vat_percent})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(_vatPrice=vatPrice)===null||_vatPrice===void 0?void 0:_vatPrice.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Net Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(_netTotal=netTotal)===null||_netTotal===void 0?void 0:_netTotal.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Cash discount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.cash_discount,className:\"form-control \",onChange:function onChange(e){errors[\"cash_discount\"]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.cash_discount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.cash_discount=parseFloat(e.target.value);if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toString();setErrors(_objectSpread({},errors));return;}setFormData(_objectSpread({},formData));validatePaymentAmounts();console.log(formData);}}),errors.cash_discount&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.cash_discount]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payments Received\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"table-responsive\",style:{maxWidth:\"900px\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",style:{alignContent:\"right\",marginBottom:\"10px\"},onClick:addNewPayment,children:\"Create new payment\"}),/*#__PURE__*/_jsxs(\"table\",{class:\"table table-striped table-sm table-bordered\",children:[formData.payments_input&&formData.payments_input.length>0&&/*#__PURE__*/_jsxs(\"thead\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Payment method\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]}),/*#__PURE__*/_jsxs(\"tbody\",{children:[formData.payments_input&&formData.payments_input.filter(function(payment){return!payment.deleted;}).map(function(payment,key){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{style:{minWidth:\"220px\"},children:[/*#__PURE__*/_jsx(DatePicker,{id:\"payment_date_str\",selected:formData.payments_input[key].date_str?new Date(formData.payments_input[key].date_str):null,value:formData.payments_input[key].date_str?format(new Date(formData.payments_input[key].date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.payments_input[key].date_str=value;setFormData(_objectSpread({},formData));}}),errors[\"payment_date_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_date_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"300px\"},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.payments_input[key].amount,className:\"form-control \",onChange:function onChange(e){errors[\"payment_amount_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.payments_input[key].amount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.payments_input[key].amount=parseFloat(e.target.value);validatePaymentAmounts();setFormData(_objectSpread({},formData));console.log(formData);}}),errors[\"payment_amount_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_amount_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"200px\"},children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payments_input[key].method,className:\"form-control \",onChange:function onChange(e){// errors[\"payment_method\"] = [];\nerrors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));formData.payments_input[key].method=\"\";setFormData(_objectSpread({},formData));return;}// errors[\"payment_method\"] = \"\";\n//setErrors({ ...errors });\nformData.payments_input[key].method=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_account\",children:\"Bank Account / Debit / Credit Card\"}),/*#__PURE__*/_jsx(\"option\",{value:\"customer_account\",children:\"Customer Account\"})]}),errors[\"payment_method_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_method_\"+key]]})]}),/*#__PURE__*/_jsx(\"td\",{style:{width:\"200px\"},children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:function onClick(event){removePayment(key);},children:\"Remove\"})})]},key);}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{class:\"text-end\",children:/*#__PURE__*/_jsx(\"b\",{children:\"Total\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"b\",{style:{marginLeft:\"14px\"},children:(_totalPaymentAmount=totalPaymentAmount)===null||_totalPaymentAmount===void 0?void 0:_totalPaymentAmount.toFixed(2)})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"b\",{style:{marginLeft:\"12px\",alignSelf:\"end\"},children:[\"Balance: \",(_balanceAmount=balanceAmount)===null||_balanceAmount===void 0?void 0:_balanceAmount.toFixed(2)]})}),/*#__PURE__*/_jsxs(\"td\",{colSpan:1,children:[/*#__PURE__*/_jsx(\"b\",{children:\"Payment status: \"}),paymentStatus==\"paid\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success\",children:\"Paid\"}):\"\",paymentStatus==\"paid_partially\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-warning\",children:\"Paid Partially\"}):\"\",paymentStatus==\"not_paid\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-danger\",children:\"Not Paid\"}):\"\"]})]})]})]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?formData.id?\"Updating....\":\"Creating..\":formData.id?\"Update\":\"Create\"})]})]})]})]})]});});export default OrderCreate;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/order/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","OrderPreview","Modal","Button","Form","StoreCreate","CustomerCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","OrderView","DebounceInput","ProductView","OrderCreate","props","ref","open","id","errors","setErrors","selectedProducts","setSelectedProducts","selectedStores","setSelectedStores","selectedCustomers","setSelectedCustomers","cookies","get","selectedDeliveredByUsers","name","formData","delivered_by","setFormData","setSelectedDeliveredByUsers","store_id","store_name","vat_percent","parseFloat","console","log","undefined","discount","discount_percent","shipping_handling_fees","partial_payment_amount","cash_discount","payment_method","payment_status","code","net_total","date_str","Date","payments_input","getOrder","reCalculate","setShow","requestOptions","method","headers","fetch","then","response","isJson","includes","json","data","ok","error","Promise","reject","result","date","payments","i","length","is_discount_percent","discountValue","products","searchLabel","customer_name","customer_id","search_label","catch","setProcessing","listener","event","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","focus","preventDefault","document","addEventListener","removeEventListener","selectedDate","isProcessing","signature_date_str","status","price_type","useLaserScanner","storeOptions","setStoreOptions","isStoresLoading","setIsStoresLoading","customerOptions","setCustomerOptions","isCustomersLoading","setIsCustomersLoading","productOptions","setProductOptions","selectedProduct","setSelectedProduct","isProductsLoading","setIsProductsLoading","deliveredByUserOptions","setDeliveredByUserOptions","isDeliveredByUsersLoading","setIsDeliveredByUsersLoading","deliveredBySignatureOptions","setDeliveredBySignatureOptions","selectedDeliveredBySignatures","setSelectedDeliveredBySignatures","isDeliveredBySignaturesLoading","setIsDeliveredBySignaturesLoading","show","handleClose","at","window","location","ObjectToSearchQueryParams","object","Object","keys","map","key","encodeURIComponent","join","suggestStores","searchTerm","params","queryString","Authorization","Select","suggestCustomers","GetProductUnitPriceInStore","storeId","productStores","retail_unit_price","openProductSearchResult","setOpenProductSearchResult","suggestProducts","getProductByBarCode","barcode","slice","product","addProduct","suggestUsers","suggestSignatures","handleCreate","haveErrors","push","product_id","quantity","unit_price","unit","validatePaymentAmounts","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","getProductIndex","productID","isProductAdded","GetProductStockInStore","stock","product_stores","alreadyAdded","item_code","part_number","toFixed","removeProduct","quantity_returned","splice","totalPrice","setTotalPrice","findTotalPrice","vatPrice","setVatPrice","findVatPrice","setNetTotal","RoundFloat","val","precision","ratio","Math","pow","round","findNetTotal","amount","discountPercent","setDiscountPercent","findDiscountPercent","findDiscount","DetailsViewRef","current","StoreCreateFormRef","openStoreCreateForm","CustomerCreateFormRef","openCustomerCreateForm","ProductCreateFormRef","openProductCreateForm","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","addNewPayment","findTotalPayments","totalPayment","deleted","totalPaymentAmount","setTotalPaymentAmount","balanceAmount","setBalanceAmount","paymentStatus","setPaymentStatus","removePayment","validatePayments","toString","openCreateForm","isArray","color","e","selectedItems","border","value","bar_code","overflowX","maxHeight","overflowY","width","cursor","textDecoration","reverse","maxWidth","alignContent","marginBottom","filter","payment","minWidth","marginLeft","alignSelf"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport OrderPreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport CustomerCreate from \"./../customer/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport OrderView from \"./view.js\";\nimport \"./style.css\";\nimport { DebounceInput } from 'react-debounce-input';\n//import BarcodeScannerComponent from \"react-qr-barcode-scanner\";\n//import Quagga from 'quagga';\nimport ProductView from \"./../product/view.js\";\n\nconst OrderCreate = forwardRef((props, ref) => {\n\n\n    useImperativeHandle(ref, () => ({\n        open(id) {\n            errors = {};\n            setErrors({ ...errors });\n            selectedProducts = [];\n            setSelectedProducts([]);\n\n            selectedStores = [];\n            setSelectedStores([]);\n\n            selectedCustomers = [];\n            setSelectedCustomers([]);\n\n\n\n            if (cookies.get(\"user_id\")) {\n                selectedDeliveredByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.delivered_by = cookies.get(\"user_id\");\n                setFormData({ ...formData });\n                setSelectedDeliveredByUsers([...selectedDeliveredByUsers]);\n            }\n\n            if (cookies.get('store_id')) {\n                formData.store_id = cookies.get('store_id');\n                formData.store_name = cookies.get('store_name');\n                formData.vat_percent = parseFloat(cookies.get('vat_percent'));\n                console.log(\"formData.store_id:\", formData.store_id);\n            }\n\n            formData.id = undefined;\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            formData.shipping_handling_fees = 0.00;\n            formData.partial_payment_amount = 0.00;\n            formData.cash_discount = 0.00;\n            formData.payment_method = \"\";\n            formData.payment_status = \"\";\n            formData.code = \"\";\n            formData.net_total = 0.00;\n            formData.date_str = new Date();\n            formData.payments_input = [\n                {\n                    \"date_str\": formData.date_str,\n                    // \"amount\": \"\",\n                    \"amount\": 0.00,\n                    \"method\": \"\",\n                    \"deleted\": false,\n                }\n            ];\n            formData.cash_discount = 0.00;\n\n            if (id) {\n                getOrder(id);\n            }\n            setFormData({ ...formData });\n            reCalculate();\n            setShow(true);\n\n        },\n    }));\n\n\n    function getOrder(id) {\n        console.log(\"inside get Order\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/order/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                formData = data.result;\n                formData.date_str = data.result.date;\n                if (data.result.payments) {\n                    console.log(\"data.result.payments:\", data.result.payments);\n                    formData.payments_input = data.result.payments;\n                    for (var i = 0; i < formData.payments_input?.length; i++) {\n                        formData.payments_input[i].date_str = formData.payments_input[i].date\n                    }\n                }\n\n                /*\n                let order = data.result;\n                formData = {\n                    id: order.id,\n                    code: order.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n                */\n\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n\n                selectedProducts = formData.products;\n                setSelectedProducts([...selectedProducts]);\n\n\n                let selectedStores = [\n                    {\n                        id: formData.store_id,\n                        name: formData.store_name,\n                    }\n                ];\n\n\n                let searchLabel = formData.customer_name;\n\n                let selectedCustomers = [\n                    {\n                        id: formData.customer_id,\n                        name: formData.customer_name,\n                        search_label: searchLabel,\n                    }\n                ];\n\n                /*\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: formData.created_by,\n                        name: formData.created_by_name\n                    }\n                ];\n\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n                */\n\n                setSelectedStores([...selectedStores]);\n                setSelectedCustomers([...selectedCustomers]);\n\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function-order.123\");\n                // event.preventDefault();\n\n\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({\n        \"payment_amount\": [],\n    });\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        vat_percent: 15.0,\n        discountValue: 0.00,\n        discount: 0.00,\n        discount_percent: 0.0,\n        cash_discount: 0.00,\n        is_discount_percent: false,\n        date_str: new Date(),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"delivered\",\n        payment_status: \"\",\n        payment_method: \"\",\n        price_type: \"retail\",\n        useLaserScanner: false,\n        store_id: \"\",\n    });\n\n    //Store Auto Suggestion\n    const [storeOptions, setStoreOptions] = useState([]);\n    let [selectedStores, setSelectedStores] = useState([]);\n    const [isStoresLoading, setIsStoresLoading] = useState(false);\n\n    //Customer Auto Suggestion\n    const [customerOptions, setCustomerOptions] = useState([]);\n    let [selectedCustomers, setSelectedCustomers] = useState([]);\n    const [isCustomersLoading, setIsCustomersLoading] = useState(false);\n\n    //Product Auto Suggestion\n    const [productOptions, setProductOptions] = useState([]);\n    let [selectedProduct, setSelectedProduct] = useState([]);\n    let [selectedProducts, setSelectedProducts] = useState([]);\n    const [isProductsLoading, setIsProductsLoading] = useState(false);\n\n    //Delivered By Auto Suggestion\n    let [deliveredByUserOptions, setDeliveredByUserOptions] = useState([]);\n    let [selectedDeliveredByUsers, setSelectedDeliveredByUsers] = useState([]);\n    const [isDeliveredByUsersLoading, setIsDeliveredByUsersLoading] =\n        useState(false);\n\n    //Delivered By Signature Auto Suggestion\n    const [deliveredBySignatureOptions, setDeliveredBySignatureOptions] =\n        useState([]);\n    const [selectedDeliveredBySignatures, setSelectedDeliveredBySignatures] =\n        useState([]);\n    const [isDeliveredBySignaturesLoading, setIsDeliveredBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/orders\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=` + encodeURIComponent(object[key]);\n            })\n            .join(\"&\");\n    }\n\n    async function suggestStores(searchTerm) {\n        console.log(\"Inside handle suggestStores\");\n        setStoreOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsStoresLoading(true);\n        let result = await fetch(\n            \"/v1/store?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setStoreOptions(data.result);\n        setIsStoresLoading(false);\n    }\n\n    async function suggestCustomers(searchTerm) {\n        console.log(\"Inside handle suggestCustomers\");\n        setCustomerOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";\n        setIsCustomersLoading(true);\n        let result = await fetch(\n            \"/v1/customer?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setCustomerOptions(data.result);\n        setIsCustomersLoading(false);\n    }\n\n    function GetProductUnitPriceInStore(storeId, productStores) {\n        if (!productStores) {\n            return \"\";\n        }\n\n        for (var i = 0; i < productStores.length; i++) {\n            console.log(\"productStores[i]:\", productStores[i]);\n            console.log(\"store_id:\", storeId);\n\n            if (productStores[i].store_id === storeId) {\n                console.log(\"macthed\");\n                console.log(\n                    \"productStores[i].retail_unit_price:\",\n                    productStores[i].retail_unit_price\n                );\n                return productStores[i];\n                /*\n                if (formData.price_type === \"retail\") {\n                    return unitPriceListArray[i].retail_unit_price;\n                } else if (formData.price_type === \"wholesale\") {\n                    return unitPriceListArray[i].wholesale_unit_price;\n                } else if (formData.price_type === \"purchase\") {\n                    return unitPriceListArray[i].purchase_unit_price;\n                }\n                */\n\n            } else {\n                console.log(\"not matched\");\n            }\n        }\n        return \"\";\n    }\n\n\n\n    let [openProductSearchResult, setOpenProductSearchResult] = useState(false);\n\n    async function suggestProducts(searchTerm) {\n        console.log(\"Inside handle suggestProducts\");\n        setProductOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n\n        if (cookies.get(\"store_id\")) {\n            params.store_id = cookies.get(\"store_id\");\n        }\n\n\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,item_code,bar_code,part_number,name,unit,part_number,name_in_arabic,product_stores\";\n        setIsProductsLoading(true);\n        let result = await fetch(\n            \"/v1/product?\" + Select + queryString + \"&limit=200\",\n            requestOptions\n        );\n        let data = await result.json();\n\n        let products = data.result;\n        if (!products || products.length === 0) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n        openProductSearchResult = true;\n        setOpenProductSearchResult(true);\n        setProductOptions(products);\n        setIsProductsLoading(false);\n\n    }\n\n    async function getProductByBarCode(barcode) {\n        formData.barcode = barcode;\n        setFormData({ ...formData });\n        console.log(\"Inside getProductByBarCode\");\n        errors[\"bar_code\"] = \"\";\n        setErrors({ ...errors });\n\n        console.log(\"barcode:\" + formData.barcode);\n        if (!formData.barcode) {\n            return;\n        }\n\n        if (formData.barcode.length === 13) {\n            formData.barcode = formData.barcode.slice(0, -1);\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n\n        let Select = \"select=id,item_code,bar_code,ean_12,part_number,name,product_stores,unit,part_number,name_in_arabic\";\n        let result = await fetch(\n            \"/v1/product/barcode/\" + formData.barcode + \"?\" + Select,\n            requestOptions\n        );\n        let data = await result.json();\n\n\n        let product = data.result;\n        if (product) {\n            addProduct(product);\n        } else {\n            errors[\"bar_code\"] = \"Invalid Barcode:\" + formData.barcode\n            setErrors({ ...errors });\n        }\n\n        formData.barcode = \"\";\n        setFormData({ ...formData });\n\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setDeliveredByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsDeliveredByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setDeliveredByUserOptions(data.result);\n        setIsDeliveredByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setDeliveredBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsDeliveredBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setDeliveredBySignatureOptions(data.result);\n        setIsDeliveredBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        let haveErrors = false;\n\n        if (!formData.cash_discount) {\n            formData.cash_discount = 0.00;\n        }\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit_price: parseFloat(selectedProducts[i].unit_price),\n                unit: selectedProducts[i].unit,\n            });\n        }\n\n        errors[\"products\"] = \"\";\n        setErrors({ ...errors });\n\n        if (formData.products.length === 0) {\n            errors[\"products\"] = \"No products added\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n\n\n        if (!validatePaymentAmounts()) {\n            console.log(\"Errors on payments\")\n            haveErrors = true;\n        }\n\n\n\n\n        if (!formData.shipping_handling_fees && formData.shipping_handling_fees !== 0) {\n            errors[\"shipping_handling_fees\"] = \"Invalid shipping / handling fees\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        /*\n        if (formData.payment_status === \"paid_partially\" && !formData.partial_payment_amount && formData.partial_payment_amount !== 0) {\n            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount <= 0) {\n            errors[\"partial_payment_amount\"] = \"Partial payment should be > 0 \";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.id && formData.payment_status === \"paid_partially\" && formData.partial_payment_amount >= netTotal) {\n            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n            setErrors({ ...errors });\n            return;\n        }\n        \n\n        errors[\"payment_method\"] = \"\";\n        setErrors({ ...errors });\n        if (!formData.id && formData.payment_status != \"not_paid\" && !formData.payment_method) {\n            errors[\"payment_method\"] = \"Payment method is required\";\n            setErrors({ ...errors });\n            return;\n        }\n        */\n\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.vat_percent && formData.vat_percent !== 0) {\n            errors[\"vat_percent\"] = \"Invalid vat percent\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (haveErrors) {\n            console.log(\"Errors: \", errors);\n            return;\n        }\n\n\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        formData.net_total = parseFloat(netTotal);\n\n        if (cookies.get('store_id')) {\n            formData.store_id = cookies.get('store_id');\n        }\n\n\n        let endPoint = \"/v1/order\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/order/\" + formData.id;\n            method = \"PUT\";\n        }\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"Order Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n\n                handleClose();\n                formData.products = [];\n                selectedProducts = [];\n                setSelectedProducts([]);\n                formData.customer_id = \"\";\n                setSelectedCustomers([]);\n                setFormData({ ...formData });\n                reCalculate();\n\n                openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating Order!\", \"danger\");\n            });\n    }\n\n    function getProductIndex(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return i;\n            }\n        }\n        return false;\n    }\n\n\n    function isProductAdded(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function GetProductStockInStore(storeId, productStores) {\n        if (!productStores) {\n            return 0.0;\n        }\n\n        for (var i = 0; i < productStores.length; i++) {\n            if (productStores[i].store_id === storeId) {\n                return productStores[i].stock;\n            }\n        }\n        return 0.0;\n    }\n\n    function addProduct(product) {\n        console.log(\"Inside Add product\");\n        if (!formData.store_id) {\n            errors.product_id = \"Please Select a Store and try again\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        errors.product_id = \"\";\n        if (!product) {\n            errors.product_id = \"Invalid Product\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        /*\n        let productStore = GetProductUnitPriceInStore(\n            formData.store_id,\n            product.stores\n        );\n        */\n        // product.unit_price = productStore.retail_unit_price;\n\n        if (product.product_stores[formData.store_id]) {\n            product.unit_price = product.product_stores[formData.store_id].retail_unit_price;\n        }\n\n\n        errors.unit_price = \"\";\n        if (!product.unit_price) {\n            errors.unit_price = \"Invalid Unit Price\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        let alreadyAdded = false;\n        let index = false;\n        let quantity = 0.00;\n        product.quantity = 1.00;\n\n\n        if (isProductAdded(product.id)) {\n            alreadyAdded = true;\n            index = getProductIndex(product.id);\n            quantity = parseFloat(selectedProducts[index].quantity + product.quantity);\n        } else {\n            quantity = parseFloat(product.quantity);\n        }\n\n        console.log(\"quantity:\", quantity);\n\n        errors.quantity = \"\";\n\n        //let stock = GetProductStockInStore(formData.store_id, product.stores);\n        let stock = 0;\n\n        if (product.product_stores[formData.store_id]) {\n            stock = product.product_stores[formData.store_id].stock;\n        }\n\n        if (stock < quantity) {\n            if (index === false) {\n                index = selectedProducts.length;\n            }\n            // errors[\"quantity_\" + index] = \"Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for product: \" + product.name;\n            errors[\"quantity_\" + index] = \"Warning: Available stock is \" + stock\n            console.log(\"errors:\", errors);\n            setErrors({ ...errors });\n        }\n\n        if (alreadyAdded) {\n            selectedProducts[index].quantity = parseFloat(quantity);\n        }\n\n        if (!alreadyAdded) {\n            selectedProducts.push({\n                product_id: product.id,\n                code: product.item_code,\n                part_number: product.part_number,\n                name: product.name,\n                quantity: product.quantity,\n                product_stores: product.product_stores,\n                unit_price: parseFloat(product.unit_price).toFixed(2),\n                unit: product.unit,\n            });\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n    }\n\n    function removeProduct(product) {\n        const index = selectedProducts.indexOf(product);\n        if (product.quantity_returned > 0) {\n            errors[\"product_\" + index] = \"This product cannot be removed as it is returned, Note: Please remove the product from sales return and try again\"\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (index > -1) {\n            selectedProducts.splice(index, 1);\n        }\n        setSelectedProducts([...selectedProducts]);\n\n        reCalculate();\n    }\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            totalPrice +=\n                parseFloat(selectedProducts[i].unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n        // totalPrice = totalPrice.toFixed(2);\n        // totalPrice = Math.round(totalPrice * 100) / 100;\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            console.log(\"formData.vat_percent:\", formData.vat_percent);\n            //(35.8 / 100) * 10000;\n\n            vatPrice = (parseFloat(formData.vat_percent) / 100) * (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount));\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function RoundFloat(val, precision) {\n        var ratio = Math.pow(10, precision);\n        return Math.round(val * ratio) / ratio;\n    }\n\n    function findNetTotal() {\n        netTotal = 0.00;\n        if (totalPrice > 0) {\n            netTotal = (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount) + parseFloat(vatPrice));\n            netTotal = parseFloat(netTotal);\n        }\n        netTotal = RoundFloat(netTotal, 2);\n        // netTotal = Math.round(netTotal * 100) / 100;\n        setNetTotal(netTotal);\n\n        if (!formData.id) {\n            let method = \"\";\n            if (formData.payments_input[0]) {\n                method = formData.payments_input[0].method;\n            }\n\n            formData.payments_input = [{\n                \"date_str\": formData.date_str,\n                \"amount\": 0.00,\n                \"method\": method,\n                \"deleted\": false,\n            }];\n\n            if (netTotal > 0) {\n                formData.payments_input[0].amount = parseFloat(netTotal.toFixed(2));\n                if (formData.cash_discount) {\n                    formData.payments_input[0].amount = formData.payments_input[0].amount - parseFloat(formData.cash_discount?.toFixed(2));\n                }\n                formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n            }\n        }\n\n        /*\n        if (formData.payments_input[0].amount === 0) {\n            formData.payments_input[0].amount = \"\";\n        }\n        */\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            //formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100));\n            // formData.discount = parseFloat(formData.discount.toFixed(2));\n            setFormData({ ...formData });\n        }\n    }\n\n\n    function reCalculate() {\n        findTotalPrice();\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n    const DetailsViewRef = useRef();\n    function openDetailsView(id) {\n        DetailsViewRef.current.open(id);\n    }\n\n    const StoreCreateFormRef = useRef();\n    function openStoreCreateForm() {\n        StoreCreateFormRef.current.open();\n    }\n\n    const CustomerCreateFormRef = useRef();\n    function openCustomerCreateForm() {\n        CustomerCreateFormRef.current.open();\n    }\n\n    const ProductCreateFormRef = useRef();\n    function openProductCreateForm() {\n        ProductCreateFormRef.current.open();\n    }\n\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n    function addNewPayment() {\n        let date = new Date();\n        if (!formData.id) {\n            date = formData.date_str;\n        }\n\n        formData.payments_input.push({\n            \"date_str\": date,\n            // \"amount\": \"\",\n            \"amount\": 0.00,\n            \"method\": \"\",\n            \"deleted\": false,\n        });\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n        //validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n    }\n\n    function findTotalPayments() {\n        let totalPayment = 0.00;\n        for (var i = 0; i < formData.payments_input?.length; i++) {\n            if (formData.payments_input[i].amount && !formData.payments_input[i].deleted) {\n                totalPayment += formData.payments_input[i].amount;\n            }\n        }\n\n        totalPaymentAmount = totalPayment;\n        console.log(\"totalPaymentAmount:\", totalPaymentAmount);\n        setTotalPaymentAmount(totalPaymentAmount);\n        console.log(\"totalPayment:\", totalPayment)\n        balanceAmount = (parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))) - parseFloat(totalPayment.toFixed(2));\n        balanceAmount = parseFloat(balanceAmount.toFixed(2));\n        setBalanceAmount(balanceAmount);\n\n        if (balanceAmount === parseFloat((parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))).toFixed(2))) {\n            paymentStatus = \"not_paid\"\n        } else if (balanceAmount <= 0) {\n            paymentStatus = \"paid\"\n        } else if (balanceAmount > 0) {\n            paymentStatus = \"paid_partially\"\n        }\n\n        setPaymentStatus(paymentStatus);\n\n        return totalPayment;\n    }\n\n    let [totalPaymentAmount, setTotalPaymentAmount] = useState(0.00);\n    let [balanceAmount, setBalanceAmount] = useState(0.00);\n    let [paymentStatus, setPaymentStatus] = useState(\"\");\n\n\n\n    function removePayment(key, validatePayments = false) {\n        formData.payments_input.splice(key, 1);\n        //formData.payments_input[key][\"deleted\"] = true;\n        setFormData({ ...formData });\n        if (validatePayments) {\n            validatePaymentAmounts();\n        }\n        findTotalPayments()\n    }\n\n\n    function validatePaymentAmounts() {\n        console.log(\"validatePaymentAmount: netTotal:\", netTotal)\n        errors[\"cash_discount\"] = \"\";\n        setErrors({ ...errors });\n\n        let haveErrors = false;\n        if (!netTotal) {\n            /*\n            removePayment(0, false);\n            totalPaymentAmount = 0.0;\n            setTotalPaymentAmount(0.00);\n            balanceAmount = 0.00;\n            setBalanceAmount(0.00);\n            paymentStatus = \"\";\n            setPaymentStatus(paymentStatus);\n            */\n            return true;\n        }\n\n\n        if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n            errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toFixed(2).toString();\n            setErrors({ ...errors });\n            haveErrors = true\n            return false;\n        }\n\n        let totalPayment = findTotalPayments();\n\n        // errors[\"payment_date\"] = [];\n        //errors[\"payment_method\"] = [];\n        //errors[\"payment_amount\"] = [];\n        for (var key = 0; key < formData.payments_input.length; key++) {\n            errors[\"payment_amount_\" + key] = \"\";\n            errors[\"payment_date_\" + key] = \"\";\n            errors[\"payment_method_\" + key] = \"\";\n            setErrors({ ...errors });\n\n            if (!formData.payments_input[key].amount) {\n                errors[\"payment_amount_\" + key] = \"Payment amount is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if (formData.payments_input[key].amount === 0) {\n                errors[\"payment_amount_\" + key] = \"Amount should be greater than zero\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].date_str) {\n                errors[\"payment_date_\" + key] = \"Payment date is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if ((new Date(formData.payments_input[key].date_str)) < (new Date(formData.date_str))) {\n                errors[\"payment_date_\" + key] = \"Payment date time should be greater than or equal to order date time\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].method) {\n                errors[\"payment_method_\" + key] = \"Payment method is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n\n            if ((formData.payments_input[key].amount || formData.payments_input[key].amount === 0) && !formData.payments_input[key].deleted) {\n               /* let maxAllowedAmount = (netTotal - formData.cash_discount) - (totalPayment - formData.payments_input[key].amount);\n\n                if (maxAllowedAmount < 0) {\n                    maxAllowedAmount = 0;\n                }\n\n                /*\n                \n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                */\n\n\n            }\n        }\n\n        if (haveErrors) {\n            return false;\n        }\n\n        return true;\n    }\n\n    return (\n        <>\n            {/*\n            <div ref={camref}></div>\n        */}\n\n            {/*\n            <BarcodeScannerComponent\n                width={500}\n                height={500}\n                onUpdate={(err, result) => {\n                    console.log(\"Result:\", result);\n                }}\n            />\n            */}\n\n            <OrderView ref={DetailsViewRef} openCreateForm={props.openCreateForm} />\n            <ProductView ref={ProductDetailsViewRef} />\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n            <CustomerCreate ref={CustomerCreateFormRef} showToastMessage={props.showToastMessage} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} />\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n\n\n            <Modal show={show} size=\"xl\" fullscreen\n                onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Sales Order #\" + formData.code : \"Create New Sales Order\"}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <OrderPreview />\n                        <Button variant=\"primary\" onClick={handleCreate}>\n                            {isProcessing ? formData.id ? \"Updating....\" : \"Creating..\" : formData.id ? \"Update\" : \"Create\"\n                            }\n                        </Button>\n\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    {Object.keys(errors).length > 0 ?\n                        <div>\n                            <ul>\n\n                                {errors && Object.keys(errors).map((key, index) => {\n                                    console.log(\"Key\",key);\n                                    if (Array.isArray(errors[key])) {\n                                        return (errors[key][0] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                    } else {\n                                        return (errors[key] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                    }\n\n                                })}\n                            </ul></div> : \"\"}\n\n                    <form className=\"row g-3 needs-validation\" onSubmit={e => { e.preventDefault(); handleCreate(e); }} >\n                        {!cookies.get('store_name') ? <div className=\"col-md-6\">\n                            <label className=\"form-label\">Store*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"store_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isStoresLoading}\n                                    isInvalid={errors.store_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.store_id = \"\";\n                                        errors[\"product_id\"] = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.store_id = \"Invalid Store selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedStores([]);\n                                            return;\n                                        }\n                                        formData.store_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        console.log(\"formData.store_id:\", formData.store_id);\n                                        selectedStores = selectedItems;\n                                        setSelectedStores([...selectedItems]);\n\n                                        if (formData.store_id) {\n                                            if (selectedProduct[0] && selectedProduct[0].product_stores && selectedProduct[0].quantity) {\n                                                let stock = 0;\n                                                if (selectedProduct[0].product_stores) {\n                                                    //stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\n                                                    if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                        stock = selectedProduct[0].product_stores[formData.store_id].stock\n                                                    }\n                                                }\n\n                                                if (stock < parseFloat(selectedProduct[0].quantity)) {\n                                                    if (selectedStores[0]) {\n                                                        errors.product_id = \"Stock is only \" + stock + \" in Store: \" + selectedStores[0].name + \" for this product\";\n                                                    } else {\n                                                        errors.product_id = \"Stock is only \" + stock + \" in Selected Store for this product\";\n                                                    }\n\n                                                    setErrors({ ...errors });\n                                                }\n                                            } else if (selectedProduct[0] && selectedProduct[0].product_stores) {\n                                                let stock = 0;\n                                                //stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\n                                                if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                    stock = selectedProduct[0].product_stores[formData.store_id].stock\n                                                }\n\n                                                if (stock === 0) {\n                                                    if (selectedStores[0]) {\n                                                        errors[\"product_id\"] = \"This product is not available in store: \" + selectedStores[0].name;\n                                                    } else {\n                                                        errors[\"product_id\"] = \"This product is not available in selected store.\"\n                                                    }\n                                                    setErrors({ ...errors });\n                                                }\n                                            }\n\n                                            if (selectedProduct[0]) {\n                                                /*\n                                                selectedProduct[0].unit_price = GetProductUnitPriceInStore(\n                                                    formData.store_id,\n                                                    selectedProduct[0].stores\n                                                );\n                                                */\n                                                if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                    selectedProduct[0].unit_price = selectedProduct[0].product_stores[formData.store_id].retail_unit_price;\n                                                }\n\n\n                                                if (!selectedProduct[0].quantity) {\n                                                    selectedProduct[0].quantity = 1;\n                                                }\n                                                setSelectedProduct([...selectedProduct]);\n                                            }\n\n                                        }\n\n                                    }\n                                    }\n                                    options={storeOptions}\n                                    placeholder=\"Select Store\"\n                                    selected={selectedStores}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestStores(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openStoreCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi x-lg\"> </i>\n                                    {errors.store_id}\n                                </div>\n                            </div>\n                        </div> : \"\"}\n\n                        <div className=\"col-md-6\" style={{ border: \"solid 0px\" }}>\n                            <label className=\"form-label\">Customer*</label>\n                            <Typeahead\n                                id=\"customer_id\"\n                                labelKey=\"search_label\"\n                                isLoading={isCustomersLoading}\n                                isInvalid={errors.customer_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    errors.customer_id = \"\";\n                                    setErrors(errors);\n                                    if (selectedItems.length === 0) {\n                                        errors.customer_id = \"Invalid Customer selected\";\n                                        setErrors(errors);\n                                        formData.customer_id = \"\";\n                                        setFormData({ ...formData });\n                                        setSelectedCustomers([]);\n                                        return;\n                                    }\n                                    formData.customer_id = selectedItems[0].id;\n                                    setFormData({ ...formData });\n                                    setSelectedCustomers(selectedItems);\n                                }}\n                                options={customerOptions}\n                                placeholder=\"Type name or mob\"\n                                selected={selectedCustomers}\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestCustomers(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openCustomerCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.customer_id && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.customer_id}\n                                </div>\n                            )}\n\n                        </div>\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Product Barcode Scan</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DebounceInput\n                                    minLength={3}\n                                    debounceTimeout={100}\n                                    placeholder=\"Scan Barcode\"\n                                    className=\"form-control barcode\"\n                                    value={formData.barcode}\n                                    onChange={event => getProductByBarCode(event.target.value)} />\n                                {errors.bar_code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.bar_code}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Date*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    selected={formData.date_str ? new Date(formData.date_str) : null}\n                                    value={formData.date_str ? format(\n                                        new Date(formData.date_str),\n                                        \"MMMM d, yyyy h:mm aa\"\n                                    ) : null}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                    showTimeSelect\n                                    timeIntervals=\"1\"\n                                    onChange={(value) => {\n                                        console.log(\"Value\", value);\n                                        formData.date_str = value;\n                                        // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n\n                        <div className=\"col-md-12\">\n                            <label className=\"form-label\">Product Search*</label>\n                            {/*  \n                            <Form.Check\n                                type=\"switch\"\n                                as=\"input\"\n                                id=\"use_laser_scanner\"\n                                label=\"Use Laser Scanner to Read Barcode\"\n                                onChange={(e) => {\n\n                                    formData.useLaserScanner = !formData.useLaserScanner;\n\n                                    if (formData.useLaserScanner) {\n                                        console.log(\"adding keydown event\");\n                                        document.addEventListener(\"keydown\", keyPress);\n                                    } else {\n                                        console.log(\"removing keydown event\");\n                                        document.removeEventListener(\"keydown\", keyPress);\n                                    }\n\n                                    console.log(\"e.target.value:\", formData.useLaserScanner);\n\n                                    setFormData({ ...formData });\n\n                                }}\n                            />\n                            */}\n\n                            <Typeahead\n                                id=\"product_id\"\n                                size=\"lg\"\n                                labelKey=\"search_label\"\n                                emptyLabel=\"\"\n                                clearButton={true}\n                                open={openProductSearchResult}\n                                isLoading={isProductsLoading}\n                                isInvalid={errors.product_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    if (selectedItems.length === 0) {\n                                        errors[\"product_id\"] = \"Invalid Product selected\";\n                                        setErrors(errors);\n                                        return;\n                                    }\n                                    errors[\"product_id\"] = \"\";\n                                    setErrors({ ...errors });\n\n                                    if (formData.store_id) {\n                                        addProduct(selectedItems[0]);\n\n                                    }\n                                    setOpenProductSearchResult(false);\n                                }}\n                                options={productOptions}\n                                selected={selectedProduct}\n                                placeholder=\"Search By Part No. / Name / Name in Arabic\"\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestProducts(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openProductCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.product_id ? (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.product_id}\n                                </div>\n                            ) : \"\"}\n                        </div>\n\n\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", maxHeight: \"400px\", overflowY: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th style={{ width: \"3%\" }}>Remove</th>\n                                        <th style={{ width: \"5%\" }}>SI No.</th>\n                                        <th style={{ width: \"10%\" }}>Part No.</th>\n                                        <th style={{ width: \"30%\" }} className=\"text-start\">Name</th>\n                                        <th style={{ width: \"15%\" }} >Qty</th>\n                                        <th style={{ width: \"18%\" }}>Unit Price</th>\n                                        <th style={{ width: \"32%\" }}>Price</th>\n\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr className=\"text-center\" key={index}>\n                                            <td>\n                                                <div\n                                                    style={{ color: \"red\", cursor: \"pointer\" }}\n                                                    onClick={() => {\n                                                        removeProduct(product);\n                                                    }}\n                                                >\n                                                    <i className=\"bi bi-x-lg\"> </i>\n                                                </div>\n                                            </td>\n                                            <td >{index + 1}</td>\n                                            <td  >{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n\n                                            }}\n                                                className=\"text-start\"\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                }}>\n                                                {product.name}\n\n                                                {errors[\"product_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        {errors[\"product_\" + index]}\n                                                    </div>\n                                                )}\n                                            </td>\n                                            <td >\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.quantity} className=\"form-control text-end\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"quantity_\" + index] = \"Quantity should be > 0\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            reCalculate();\n\n                                                            let stock = 0;\n                                                            if (selectedProducts[index].product_stores) {\n                                                                stock = selectedProducts[index].product_stores[formData.store_id]?.stock;\n                                                                // stock = GetProductStockInStore(formData.store_id, selectedProducts[index].stores);\n                                                            }\n\n                                                            if (stock < parseFloat(e.target.value) && selectedProducts[index].product_stores) {\n                                                                // errors[\"quantity_\" + index] = \" Warning: Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for this product\";\n                                                                errors[\"quantity_\" + index] = \" Warning: Available stock is \" + stock;\n                                                                setErrors({ ...errors });\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].quantity:\", selectedProducts[index].quantity);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td>\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.unit_price} className=\"form-control text-end\"\n\n                                                        placeholder=\"Unit Price\" onChange={(e) => {\n                                                            errors[\"unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"unit_price_\" + index] = \"Unit Price should be > 0\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].unit_price:\", selectedProducts[index].unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n                                                {errors[\"unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td className=\"text-end\" >\n                                                <NumberFormat\n                                                    value={(product.unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n                                        </tr>\n                                    )).reverse()}\n                                </tbody>\n                            </table>\n                        </div>\n                        <div className=\"table-responsive\">\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n\n\n                                        <th colSpan=\"8\" className=\"text-end\">Total</th>\n                                        <td className=\"text-end\" style={{ width: \"200px\" }} >\n                                            <NumberFormat\n                                                value={totalPrice?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Shipping & Handling Fees\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.shipping_handling_fees} onChange={(e) => {\n\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"Shipping / Handling Fees should be > 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.shipping_handling_fees = \"\";\n                                                    errors[\"shipping_handling_fees\"] = \"Invalid Shipping / Handling Fees\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"shipping_handling_fees\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.shipping_handling_fees && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.shipping_handling_fees}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\"> VAT  <input type=\"number\" className=\"text-center\" style={{ width: \"50px\" }} value={formData.vat_percent} onChange={(e) => {\n                                            console.log(\"Inside onchange vat percent\");\n                                            if (parseFloat(e.target.value) === 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n                                            if (parseFloat(e.target.value) < 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"Vat percent should be >= 0\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n\n\n                                            if (!e.target.value) {\n                                                formData.vat_percent = \"\";\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                //formData.discount_percent = 0.00;\n                                                errors[\"vat_percent\"] = \"Invalid vat percent\";\n                                                setFormData({ ...formData });\n                                                setErrors({ ...errors });\n                                                return;\n                                            }\n                                            errors[\"vat_percent\"] = \"\";\n                                            setErrors({ ...errors });\n\n                                            formData.vat_percent = e.target.value;\n                                            reCalculate();\n                                            setFormData({ ...formData });\n                                            console.log(formData);\n                                        }} />{\"%\"}\n                                            {errors.vat_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.vat_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">\n                                Delivered By Signature(Optional)\n                            </label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"delivered_by_signature_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isDeliveredBySignaturesLoading}\n                                    isInvalid={errors.delivered_by_signature_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.delivered_by_signature_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.delivered_by_signature_id =\n                                                \"Invalid Signature Selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedDeliveredBySignatures([]);\n                                            return;\n                                        }\n                                        formData.delivered_by_signature_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedDeliveredBySignatures(selectedItems);\n                                    }}\n                                    options={deliveredBySignatureOptions}\n                                    placeholder=\"Select Signature\"\n                                    selected={selectedDeliveredBySignatures}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestSignatures(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openSignatureCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.delivered_by_signature_id ? (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>{\" \"}\n                                        {errors.delivered_by_signature_id}\n                                    </div>\n                                ) : \"\"}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Signature Date(Optional)</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"signature_date_str\"\n                                    value={formData.signature_date_str}\n                                    selected={selectedDate}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMM dd yyyy\"\n                                    onChange={(value) => {\n                                        formData.signature_date_str = format(new Date(value), \"MMM dd yyyy\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.signature_date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.signature_date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Cash discount</label>\n                            <input type='number' value={formData.cash_discount} className=\"form-control \"\n                                onChange={(e) => {\n                                    errors[\"cash_discount\"] = \"\";\n                                    setErrors({ ...errors });\n                                    if (!e.target.value) {\n                                        formData.cash_discount = e.target.value;\n                                        setFormData({ ...formData });\n                                        validatePaymentAmounts();\n                                        return;\n                                    }\n                                    formData.cash_discount = parseFloat(e.target.value);\n                                    if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n                                        errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toString();\n                                        setErrors({ ...errors });\n                                        return;\n                                    }\n\n                                    setFormData({ ...formData });\n                                    validatePaymentAmounts();\n                                    console.log(formData);\n                                }}\n                            />\n                            {errors.cash_discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.cash_discount}\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"col-md-8\">\n                            <label className=\"form-label\">Payments Received</label>\n\n                            <div class=\"table-responsive\" style={{ maxWidth: \"900px\" }}>\n                                <Button variant=\"secondary\" style={{ alignContent: \"right\", marginBottom: \"10px\" }} onClick={addNewPayment}>\n                                    Create new payment\n                                </Button>\n                                <table class=\"table table-striped table-sm table-bordered\">\n                                    {formData.payments_input && formData.payments_input.length > 0 &&\n                                        <thead>\n                                            <th>\n                                                Date\n                                            </th>\n                                            <th>\n                                                Amount\n                                            </th>\n                                            <th>\n                                                Payment method\n                                            </th>\n                                            <th>\n                                                Action\n                                            </th>\n                                        </thead>}\n                                    <tbody>\n                                        {formData.payments_input &&\n                                            formData.payments_input.filter(payment => !payment.deleted).map((payment, key) => (\n                                                <tr key={key}>\n                                                    <td style={{ minWidth: \"220px\" }}>\n\n                                                        <DatePicker\n                                                            id=\"payment_date_str\"\n                                                            selected={formData.payments_input[key].date_str ? new Date(formData.payments_input[key].date_str) : null}\n                                                            value={formData.payments_input[key].date_str ? format(\n                                                                new Date(formData.payments_input[key].date_str),\n                                                                \"MMMM d, yyyy h:mm aa\"\n                                                            ) : null}\n                                                            className=\"form-control\"\n                                                            dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                                            showTimeSelect\n                                                            timeIntervals=\"1\"\n                                                            onChange={(value) => {\n                                                                console.log(\"Value\", value);\n                                                                formData.payments_input[key].date_str = value;\n                                                                setFormData({ ...formData });\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_date_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_date_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"300px\" }}>\n                                                        <input type='number' value={formData.payments_input[key].amount} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                errors[\"payment_amount_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    formData.payments_input[key].amount = e.target.value;\n                                                                    setFormData({ ...formData });\n                                                                    validatePaymentAmounts();\n                                                                    return;\n                                                                }\n\n                                                                formData.payments_input[key].amount = parseFloat(e.target.value);\n\n                                                                validatePaymentAmounts();\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_amount_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_amount_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <select value={formData.payments_input[key].method} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                // errors[\"payment_method\"] = [];\n                                                                errors[\"payment_method_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    errors[\"payment_method_\" + key] = \"Payment method is required\";\n                                                                    setErrors({ ...errors });\n\n                                                                    formData.payments_input[key].method = \"\";\n                                                                    setFormData({ ...formData });\n                                                                    return;\n                                                                }\n\n                                                                // errors[\"payment_method\"] = \"\";\n                                                                //setErrors({ ...errors });\n\n                                                                formData.payments_input[key].method = e.target.value;\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        >\n                                                            <option value=\"\">Select</option>\n                                                            <option value=\"cash\">Cash</option>\n                                                            <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                                            <option value=\"customer_account\">Customer Account</option>\n                                                        </select>\n                                                        {errors[\"payment_method_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_method_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <Button variant=\"danger\" onClick={(event) => {\n                                                            removePayment(key);\n                                                        }}>\n                                                            Remove\n                                                        </Button>\n\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                        <tr>\n                                            <td class=\"text-end\">\n                                                <b>Total</b>\n                                            </td>\n                                            <td><b style={{ marginLeft: \"14px\" }}>{totalPaymentAmount?.toFixed(2)}</b>\n\n                                            </td>\n                                            <td>\n                                                <b style={{ marginLeft: \"12px\", alignSelf: \"end\" }}>Balance: {balanceAmount?.toFixed(2)}</b>\n                                            </td>\n                                            <td colSpan={1}>\n                                                <b>Payment status: </b>\n                                                {paymentStatus == \"paid\" ?\n                                                    <span className=\"badge bg-success\">\n                                                        Paid\n                                                    </span> : \"\"}\n                                                {paymentStatus == \"paid_partially\" ?\n                                                    <span className=\"badge bg-warning\">\n                                                        Paid Partially\n                                                    </span> : \"\"}\n                                                {paymentStatus == \"not_paid\" ?\n                                                    <span className=\"badge bg-danger\">\n                                                        Not Paid\n                                                    </span> : \"\"}\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                      \n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate}>\n                                {isProcessing ? formData.id ? \"Updating....\" : \"Creating..\" : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>\n                </Modal.Body>\n\n            </Modal >\n\n\n        </>\n    );\n});\n\nexport default OrderCreate;\n"]},"metadata":{},"sourceType":"module"}