{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{React,useState,useRef,forwardRef,useImperativeHandle}from\"react\";import{Modal,Button}from'react-bootstrap';import BalanceSheetPrintPreviewContent from'./printPreviewContent.js';import Cookies from\"universal-cookie\";import{useReactToPrint}from'react-to-print';import{Invoice}from'@axenda/zatca';import{format}from\"date-fns\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var BalanceSheetPrintPreview=/*#__PURE__*/forwardRef(function(props,ref){useImperativeHandle(ref,function(){return{open:function open(modelObj){console.log(\"modelObj:\",modelObj);if(modelObj){model=modelObj;setModel(_objectSpread({},model));if(model.store_id){getStore(model.store_id);}/*\n                if (model.reference_model===\"customer\") {\n                    getCustomer(model.reference_id);\n                }\n                */ /*\n                if (model.delivered_by) {\n                    getUser(model.delivered_by);\n                }\n                \n\n                if (model.delivered_by_signature_id) {\n                    getSignature(model.delivered_by_signature_id);\n                }\n                */var pageSize=8;model.pageSize=pageSize;var totalPosts=model.posts.length;var top=0;var totalPagesInt=parseInt(totalPosts/pageSize);var totalPagesFloat=parseFloat(totalPosts/pageSize);var totalPages=totalPagesInt;if(totalPagesFloat-totalPagesInt>0){totalPages++;}model.total_pages=totalPages;model.pages=[];var offset=0;for(var i=0;i<totalPages;i++){model.pages.push({top:top,posts:[],lastPage:false,firstPage:false});for(var j=offset;j<totalPosts;j++){for(var k=0;k<model.posts[j].posts.length;k++){model.pages[i].posts.push({\"date\":model.posts[j].posts[k].date,\"debit_account\":model.posts[j].posts[k].debit_or_credit===\"debit\"?\"To \"+model.posts[j].posts[k].account_name+\" A/c #\"+model.posts[j].posts[k].account_number+\" Dr.\":\"\",\"debit_account_number\":model.posts[j].posts[k].debit_or_credit===\"debit\"?model.posts[j].posts[k].account_number:\"\",\"credit_account\":model.posts[j].posts[k].debit_or_credit===\"credit\"?\"By \"+model.posts[j].posts[k].account_name+\" A/c #\"+model.posts[j].posts[k].account_number+\" Cr.\":\"\",\"credit_account_number\":model.posts[j].posts[k].debit_or_credit===\"credit\"?model.posts[j].posts[k].account_number:\"\",\"debit_or_credit\":model.posts[j].posts[k].debit_or_credit,\"debit_amount\":model.posts[j].posts[k].debit?model.posts[j].posts[0].debit:\"\",\"credit_amount\":model.posts[j].posts[k].credit?model.posts[j].posts[0].credit:\"\",\"reference_code\":model.posts[j].reference_code,\"reference_model\":model.posts[j].reference_model});}//  model.pages[i].posts.push(model.posts[j]);\nif(model.pages[i].posts.length===pageSize){break;}}if(model.pages[i].posts.length<pageSize){for(var s=model.pages[i].posts.length;s<pageSize;s++){model.pages[i].posts.push({});}}top+=1057;//1057\noffset+=pageSize;if(i===0){model.pages[i].firstPage=true;}if(i+1===totalPages){model.pages[i].lastPage=true;}}console.log(\"model.pages:\",model.pages);console.log(\"model.posts:\",model.posts);//  getQRCodeContents();\n//model.qr_content = getQRCodeContents();\n//setModel({ ...model });\nsetShow(true);console.log(\"model:\",model);}}};});var cookies=new Cookies();var _useState=useState({}),_useState2=_slicedToArray(_useState,2),model=_useState2[0],setModel=_useState2[1];var _useState3=useState(props.show),_useState4=_slicedToArray(_useState3,2),show=_useState4[0],setShow=_useState4[1];function handleClose(){setShow(false);}var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),qrContent=_useState6[0],setQrContent=_useState6[1];function getQRCodeContents(){qrContent=\"\";if(model.code){qrContent+=\"Invoice #: \"+model.code+\"<br />\";}if(model.store){qrContent+=\"Store: \"+model.store.name+\"<br />\";}if(model.customer){qrContent+=\"Customer: \"+model.customer.name+\"<br />\";}if(model.net_total){qrContent+=\"Net Total: \"+model.net_total+\"<br />\";}qrContent+=\"Store: Test <br />\";setQrContent(qrContent);model.qr_content=qrContent;setModel(_objectSpread({},model));console.log(\"QR content:\",model.qr_content);return model.qr_content;}function getStore(id){console.log(\"inside get Store\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/store/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,storeData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);storeData=data.result;model.store=storeData;setModel(_objectSpread({},model));case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){});}function getCustomer(id){console.log(\"inside get Customer\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/customer/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error,customerData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get('content-type'))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes('application/json');_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}error=data&&data.errors;return _context2.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);customerData=data.result;model.customer=customerData;setModel(_objectSpread({},model));case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){});}function getUser(id){console.log(\"inside get User(Delivered by)\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/user/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response){var _response$headers$get3;var isJson,data,error,userData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isJson=(_response$headers$get3=response.headers.get('content-type'))===null||_response$headers$get3===void 0?void 0:_response$headers$get3.includes('application/json');_context3.t0=isJson;if(!_context3.t0){_context3.next=6;break;}_context3.next=5;return response.json();case 5:_context3.t0=_context3.sent;case 6:data=_context3.t0;if(response.ok){_context3.next=10;break;}error=data&&data.errors;return _context3.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);userData=data.result;model.delivered_by_user=userData;setModel(_objectSpread({},model));case 15:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}()).catch(function(error){});}function getSignature(id){console.log(\"inside get Signature\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/signature/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response){var _response$headers$get4;var isJson,data,error,signatureData;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:isJson=(_response$headers$get4=response.headers.get('content-type'))===null||_response$headers$get4===void 0?void 0:_response$headers$get4.includes('application/json');_context4.t0=isJson;if(!_context4.t0){_context4.next=6;break;}_context4.next=5;return response.json();case 5:_context4.t0=_context4.sent;case 6:data=_context4.t0;if(response.ok){_context4.next=10;break;}error=data&&data.errors;return _context4.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);signatureData=data.result;model.delivered_by_signature=signatureData;setModel(_objectSpread({},model));case 15:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}()).catch(function(error){});}/*\n    function print() {\n        console.log(\"Print\");\n    }\n    */var printAreaRef=useRef();function getFileName(){var filename=\"\";if(model.name){filename+=model.name+\"_acc\"+\"_#\"+model.number;}filename=filename.split(' ').join('_');if(model.dateValue){filename+=\"_Date_\"+format(new Date(model.dateValue),\"MMM_dd_yyyy\");}else if(model.fromDateValue&&model.toDateValue){filename+=\"_Date_\"+format(new Date(model.fromDateValue),\"MMM_dd_yyyy\")+\"_to_\"+format(new Date(model.toDateValue),\"MMM dd yyyy\");}else if(model.fromDateValue&&!model.toDateValue&&!model.dateValue){filename+=\"_Date_from_\"+format(new Date(model.fromDateValue),\"MMM_dd_yyyy\")+\"_to_present\";}else if(model.toDateValue&&!model.fromDateValue&&!model.dateValue){filename+=\"_Date_upto_\"+format(new Date(model.toDateValue),\"MMM_dd_yyyy\");}filename+=\".pdf\";return filename;}var handlePrint=useReactToPrint({content:function content(){return printAreaRef.current;},documentTitle:getFileName()});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Modal,{show:show,scrollable:true,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:\"Balance sheet preview\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"primary\",className:\"btn btn-primary mb-3\",onClick:handlePrint,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-printer\"}),\" Print\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(\"div\",{ref:printAreaRef,children:/*#__PURE__*/_jsx(BalanceSheetPrintPreviewContent,{model:model})})}),/*#__PURE__*/_jsx(Modal.Footer,{})]})});});export default BalanceSheetPrintPreview;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/posting/printPreview.js"],"names":["React","useState","useRef","forwardRef","useImperativeHandle","Modal","Button","BalanceSheetPrintPreviewContent","Cookies","useReactToPrint","Invoice","format","BalanceSheetPrintPreview","props","ref","open","modelObj","console","log","model","setModel","store_id","getStore","pageSize","totalPosts","posts","length","top","totalPagesInt","parseInt","totalPagesFloat","parseFloat","totalPages","total_pages","pages","offset","i","push","lastPage","firstPage","j","k","date","debit_or_credit","account_name","account_number","debit","credit","reference_code","reference_model","s","setShow","cookies","show","handleClose","qrContent","setQrContent","getQRCodeContents","code","store","name","customer","net_total","qr_content","id","requestOptions","method","headers","get","fetch","then","response","isJson","includes","json","data","ok","error","errors","Promise","reject","storeData","result","catch","getCustomer","customerData","getUser","userData","delivered_by_user","getSignature","signatureData","delivered_by_signature","printAreaRef","getFileName","filename","number","split","join","dateValue","Date","fromDateValue","toDateValue","handlePrint","content","current","documentTitle"],"mappings":"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","sourcesContent":["import { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport BalanceSheetPrintPreviewContent from './printPreviewContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\nimport { format } from \"date-fns\";\n\nconst BalanceSheetPrintPreview = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(modelObj) {\n            console.log(\"modelObj:\", modelObj);\n            if (modelObj) {\n                model = modelObj;\n                setModel({ ...model })\n\n                if (model.store_id) {\n                    getStore(model.store_id);\n                }\n\n                /*\n                if (model.reference_model===\"customer\") {\n                    getCustomer(model.reference_id);\n                }\n                */\n\n                /*\n                if (model.delivered_by) {\n                    getUser(model.delivered_by);\n                }\n                \n\n                if (model.delivered_by_signature_id) {\n                    getSignature(model.delivered_by_signature_id);\n                }\n                */\n\n                let pageSize = 8;\n                model.pageSize = pageSize;\n                let totalPosts = model.posts.length;\n                let top = 0;\n                let totalPagesInt = parseInt(totalPosts / pageSize);\n                let totalPagesFloat = parseFloat(totalPosts / pageSize);\n\n                let totalPages = totalPagesInt;\n                if ((totalPagesFloat - totalPagesInt) > 0) {\n                    totalPages++;\n                }\n\n                model.total_pages = totalPages;\n\n\n                model.pages = [];\n\n\n                let offset = 0;\n\n                for (let i = 0; i < totalPages; i++) {\n                    model.pages.push({\n                        top: top,\n                        posts: [],\n                        lastPage: false,\n                        firstPage: false,\n                    });\n\n                    for (let j = offset; j < totalPosts; j++) {\n                        for (let k = 0; k < model.posts[j].posts.length; k++) {\n                            model.pages[i].posts.push({\n                                \"date\": model.posts[j].posts[k].date,\n                                \"debit_account\": model.posts[j].posts[k].debit_or_credit === \"debit\" ? \"To \" + model.posts[j].posts[k].account_name + \" A/c #\" + model.posts[j].posts[k].account_number + \" Dr.\" : \"\",\n                                \"debit_account_number\": model.posts[j].posts[k].debit_or_credit === \"debit\" ? model.posts[j].posts[k].account_number : \"\",\n                                \"credit_account\": model.posts[j].posts[k].debit_or_credit === \"credit\" ? \"By \" + model.posts[j].posts[k].account_name + \" A/c #\" + model.posts[j].posts[k].account_number + \" Cr.\" : \"\",\n                                \"credit_account_number\": model.posts[j].posts[k].debit_or_credit === \"credit\" ? model.posts[j].posts[k].account_number : \"\",\n                                \"debit_or_credit\": model.posts[j].posts[k].debit_or_credit,\n                                \"debit_amount\": model.posts[j].posts[k].debit ? model.posts[j].posts[0].debit : \"\",\n                                \"credit_amount\": model.posts[j].posts[k].credit ? model.posts[j].posts[0].credit : \"\",\n                                \"reference_code\": model.posts[j].reference_code,\n                                \"reference_model\": model.posts[j].reference_model,\n                            });\n                        }\n                        //  model.pages[i].posts.push(model.posts[j]);\n\n                        if (model.pages[i].posts.length === pageSize) {\n                            break;\n                        }\n                    }\n\n                    if (model.pages[i].posts.length < pageSize) {\n                        for (let s = model.pages[i].posts.length; s < pageSize; s++) {\n                            model.pages[i].posts.push({});\n                        }\n                    }\n\n                    top += 1057; //1057\n                    offset += pageSize;\n\n                    if (i === 0) {\n                        model.pages[i].firstPage = true;\n                    }\n\n                    if ((i + 1) === totalPages) {\n                        model.pages[i].lastPage = true;\n                    }\n                }\n\n                console.log(\"model.pages:\", model.pages);\n                console.log(\"model.posts:\", model.posts);\n                //  getQRCodeContents();\n                //model.qr_content = getQRCodeContents();\n                //setModel({ ...model });\n\n                setShow(true);\n                console.log(\"model:\", model);\n            }\n\n        },\n\n    }));\n\n    const cookies = new Cookies();\n\n    let [model, setModel] = useState({});\n\n    const [show, setShow] = useState(props.show);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n\n    let [qrContent, setQrContent] = useState(\"\");\n\n    function getQRCodeContents() {\n        qrContent = \"\";\n\n        if (model.code) {\n            qrContent += \"Invoice #: \" + model.code + \"<br />\";\n        }\n\n        if (model.store) {\n            qrContent += \"Store: \" + model.store.name + \"<br />\";\n        }\n\n        if (model.customer) {\n            qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n        }\n\n\n        if (model.net_total) {\n            qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n        }\n        qrContent += \"Store: Test <br />\";\n\n        setQrContent(qrContent);\n        model.qr_content = qrContent;\n        setModel({ ...model });\n        console.log(\"QR content:\", model.qr_content);\n\n        return model.qr_content;\n    }\n\n    function getStore(id) {\n        console.log(\"inside get Store\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/store/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let storeData = data.result;\n                model.store = storeData;\n\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n\n\n    function getCustomer(id) {\n        console.log(\"inside get Customer\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/customer/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let customerData = data.result;\n                model.customer = customerData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getUser(id) {\n        console.log(\"inside get User(Delivered by)\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/user/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n\n                console.log(\"Response:\");\n                console.log(data);\n                let userData = data.result;\n                model.delivered_by_user = userData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getSignature(id) {\n        console.log(\"inside get Signature\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/signature/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let signatureData = data.result;\n                model.delivered_by_signature = signatureData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n            });\n    }\n\n\n\n    /*\n    function print() {\n        console.log(\"Print\");\n    }\n    */\n\n    const printAreaRef = useRef();\n\n    function getFileName() {\n        let filename = \"\";\n\n        if (model.name) {\n            filename += model.name + \"_acc\" + \"_#\" + model.number;\n        }\n\n        filename=filename.split(' ').join('_')\n\n        if (model.dateValue) {\n            filename += \"_Date_\" + format(new Date(model.dateValue), \"MMM_dd_yyyy\")\n        } else if (model.fromDateValue && model.toDateValue) {\n            filename += \"_Date_\" + format(new Date(model.fromDateValue), \"MMM_dd_yyyy\") + \"_to_\" + format(new Date(model.toDateValue), \"MMM dd yyyy\")\n        } else if (model.fromDateValue && !model.toDateValue && !model.dateValue) {\n            filename += \"_Date_from_\" + format(new Date(model.fromDateValue), \"MMM_dd_yyyy\") + \"_to_present\"\n        } else if (model.toDateValue && !model.fromDateValue && !model.dateValue) {\n            filename += \"_Date_upto_\" + format(new Date(model.toDateValue), \"MMM_dd_yyyy\")\n        }\n\n       \n\n        filename += \".pdf\"\n\n        return filename;\n    }\n\n    const handlePrint = useReactToPrint({\n        content: () => printAreaRef.current,\n        documentTitle: getFileName(),\n    });\n\n\n    return (<>\n        <Modal show={show} scrollable={true} size=\"xl\" fullscreen onHide={handleClose} animation={false}>\n            <Modal.Header>\n                <Modal.Title>Balance sheet preview</Modal.Title>\n                <div className=\"col align-self-end text-end\">\n                    <Button variant=\"primary\" className=\"btn btn-primary mb-3\" onClick={handlePrint}>\n                        <i className=\"bi bi-printer\"></i> Print\n                    </Button>\n                    <button\n                        type=\"button\"\n                        className=\"btn-close\"\n                        onClick={handleClose}\n                        aria-label=\"Close\"\n                    ></button>\n\n                </div>\n\n            </Modal.Header>\n            <Modal.Body>\n                <div ref={printAreaRef}>\n                    <BalanceSheetPrintPreviewContent model={model} />\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n                {/*\n                <Button variant=\"secondary\" onClick={handleClose}>\n                    Close\n                </Button>\n                <Button variant=\"primary\" onClick={handleClose}>\n                    Save Changes\n                </Button>\n                */}\n            </Modal.Footer>\n        </Modal>\n    </>);\n\n});\n\nexport default BalanceSheetPrintPreview;"]},"metadata":{},"sourceType":"module"}