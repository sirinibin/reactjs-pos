{"ast":null,"code":"import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from\"react\";import OrderPreview from\"./preview.js\";import{Modal,Button,Form}from\"react-bootstrap\";import StoreCreate from\"../store/create.js\";import CustomerCreate from\"./../customer/create.js\";import ProductCreate from\"./../product/create.js\";import UserCreate from\"./../user/create.js\";import SignatureCreate from\"./../signature/create.js\";import Cookies from\"universal-cookie\";import{Typeahead}from\"react-bootstrap-typeahead\";import NumberFormat from\"react-number-format\";import DatePicker from\"react-datepicker\";import{format}from\"date-fns\";import{Spinner}from\"react-bootstrap\";import OrderView from\"./view.js\";import\"./style.css\";import{DebounceInput}from'react-debounce-input';//import BarcodeScannerComponent from \"react-qr-barcode-scanner\";\n//import Quagga from 'quagga';\nimport ProductView from\"./../product/view.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderCreate=/*#__PURE__*/forwardRef(function(props,ref){useImperativeHandle(ref,function(){return{open:function open(id){selectedProducts=[];setSelectedProducts([]);selectedStores=[];setSelectedStores([]);selectedCustomers=[];setSelectedCustomers([]);if(cookies.get(\"user_id\")){selectedDeliveredByUsers=[{id:cookies.get(\"user_id\"),name:cookies.get(\"user_name\")}];formData.delivered_by=cookies.get(\"user_id\");setFormData(_objectSpread({},formData));setSelectedDeliveredByUsers(_toConsumableArray(selectedDeliveredByUsers));}if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');formData.store_name=cookies.get('store_name');formData.vat_percent=parseFloat(cookies.get('vat_percent'));console.log(\"formData.store_id:\",formData.store_id);}formData.id=undefined;formData.discount=0.00;formData.discount_percent=0.00;formData.shipping_handling_fees=0.00;formData.partial_payment_amount=0.00;formData.status=\"delivered\";formData.payment_method=\"\";formData.payment_status=\"\";formData.date_str=new Date();if(id){getOrder(id);}setFormData(_objectSpread({},formData));reCalculate();setShow(true);}};});function getOrder(id){console.log(\"inside get Order\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/order/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,selectedStores,searchLabel,selectedCustomers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);formData=data.result;formData.date_str=data.result.date;/*\n                let order = data.result;\n                formData = {\n                    id: order.id,\n                    code: order.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n                */if(formData.is_discount_percent){formData.discountValue=formData.discount_percent;}else{formData.discountValue=formData.discount;}selectedProducts=formData.products;setSelectedProducts(_toConsumableArray(selectedProducts));selectedStores=[{id:formData.store_id,name:formData.store_name}];searchLabel=formData.customer_name;selectedCustomers=[{id:formData.customer_id,name:formData.customer_name,search_label:searchLabel}];/*\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: formData.created_by,\n                        name: formData.created_by_name\n                    }\n                ];\n\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n                */setSelectedStores([].concat(selectedStores));setSelectedCustomers([].concat(selectedCustomers));reCalculate();setFormData(_objectSpread({},formData));case 25:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}useEffect(function(){var listener=function listener(event){if(event.code===\"Enter\"||event.code===\"NumpadEnter\"){console.log(\"Enter key was pressed. Run your function-order.123\");// event.preventDefault();\nvar form=event.target.form;if(form&&event.target){var index=Array.prototype.indexOf.call(form,event.target);if(form&&form.elements[index+1]){if(event.target.getAttribute(\"class\").includes(\"barcode\")){form.elements[index].focus();}else{form.elements[index+1].focus();}event.preventDefault();}}}};document.addEventListener(\"keydown\",listener);return function(){document.removeEventListener(\"keydown\",listener);};},[]);var selectedDate=new Date();//const history = useHistory();\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();//fields\nvar _useState5=useState({vat_percent:15.0,discountValue:0.00,discount:0.00,discount_percent:0.0,is_discount_percent:false,date_str:new Date(),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"delivered\",payment_status:\"\",payment_method:\"\",price_type:\"retail\",useLaserScanner:false,store_id:\"\"}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];//Store Auto Suggestion\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),storeOptions=_useState8[0],setStoreOptions=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedStores=_useState10[0],setSelectedStores=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isStoresLoading=_useState12[0],setIsStoresLoading=_useState12[1];//Customer Auto Suggestion\nvar _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),customerOptions=_useState14[0],setCustomerOptions=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedCustomers=_useState16[0],setSelectedCustomers=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isCustomersLoading=_useState18[0],setIsCustomersLoading=_useState18[1];//Product Auto Suggestion\nvar _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),productOptions=_useState20[0],setProductOptions=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),selectedProduct=_useState22[0],setSelectedProduct=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),selectedProducts=_useState24[0],setSelectedProducts=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isProductsLoading=_useState26[0],setIsProductsLoading=_useState26[1];//Delivered By Auto Suggestion\nvar _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),deliveredByUserOptions=_useState28[0],setDeliveredByUserOptions=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),selectedDeliveredByUsers=_useState30[0],setSelectedDeliveredByUsers=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isDeliveredByUsersLoading=_useState32[0],setIsDeliveredByUsersLoading=_useState32[1];//Delivered By Signature Auto Suggestion\nvar _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),deliveredBySignatureOptions=_useState34[0],setDeliveredBySignatureOptions=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),selectedDeliveredBySignatures=_useState36[0],setSelectedDeliveredBySignatures=_useState36[1];var _useState37=useState(false),_useState38=_slicedToArray(_useState37,2),isDeliveredBySignaturesLoading=_useState38[0],setIsDeliveredBySignaturesLoading=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),show=_useState40[0],setShow=_useState40[1];function handleClose(){setShow(false);}useEffect(function(){var at=cookies.get(\"access_token\");if(!at){// history.push(\"/dashboard/orders\");\nwindow.location=\"/\";}});function ObjectToSearchQueryParams(object){return Object.keys(object).map(function(key){return\"search[\".concat(key,\"]=\")+encodeURIComponent(object[key]);}).join(\"&\");}function suggestStores(_x2){return _suggestStores.apply(this,arguments);}function _suggestStores(){_suggestStores=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"Inside handle suggestStores\");setStoreOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsStoresLoading(true);_context3.next=13;return fetch(\"/v1/store?\"+Select+queryString,requestOptions);case 13:result=_context3.sent;_context3.next=16;return result.json();case 16:data=_context3.sent;setStoreOptions(data.result);setIsStoresLoading(false);case 19:case\"end\":return _context3.stop();}}},_callee3);}));return _suggestStores.apply(this,arguments);}function suggestCustomers(_x3){return _suggestCustomers.apply(this,arguments);}function _suggestCustomers(){_suggestCustomers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"Inside handle suggestCustomers\");setCustomerOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";setIsCustomersLoading(true);_context4.next=13;return fetch(\"/v1/customer?\"+Select+queryString,requestOptions);case 13:result=_context4.sent;_context4.next=16;return result.json();case 16:data=_context4.sent;setCustomerOptions(data.result);setIsCustomersLoading(false);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return _suggestCustomers.apply(this,arguments);}function GetProductUnitPriceInStore(storeId,productStores){if(!productStores){return\"\";}for(var i=0;i<productStores.length;i++){console.log(\"productStores[i]:\",productStores[i]);console.log(\"store_id:\",storeId);if(productStores[i].store_id===storeId){console.log(\"macthed\");console.log(\"productStores[i].retail_unit_price:\",productStores[i].retail_unit_price);return productStores[i];/*\n                if (formData.price_type === \"retail\") {\n                    return unitPriceListArray[i].retail_unit_price;\n                } else if (formData.price_type === \"wholesale\") {\n                    return unitPriceListArray[i].wholesale_unit_price;\n                } else if (formData.price_type === \"purchase\") {\n                    return unitPriceListArray[i].purchase_unit_price;\n                }\n                */}else{console.log(\"not matched\");}}return\"\";}var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),openProductSearchResult=_useState42[0],setOpenProductSearchResult=_useState42[1];function suggestProducts(_x4){return _suggestProducts.apply(this,arguments);}function _suggestProducts(){_suggestProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(searchTerm){var params,queryString,requestOptions,Select,result,data,products;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"Inside handle suggestProducts\");setProductOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context5.next=7;break;}openProductSearchResult=false;setOpenProductSearchResult(false);return _context5.abrupt(\"return\");case 7:params={name:searchTerm};if(cookies.get(\"store_id\")){params.store_id=cookies.get(\"store_id\");}queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,part_number,name,unit,part_number,name_in_arabic,product_stores\";setIsProductsLoading(true);_context5.next=16;return fetch(\"/v1/product?\"+Select+queryString+\"&limit=200\",requestOptions);case 16:result=_context5.sent;_context5.next=19;return result.json();case 19:data=_context5.sent;products=data.result;if(!(!products||products.length===0)){_context5.next=26;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 26:openProductSearchResult=true;setOpenProductSearchResult(true);setProductOptions(products);setIsProductsLoading(false);case 30:case\"end\":return _context5.stop();}}},_callee5);}));return _suggestProducts.apply(this,arguments);}function getProductByBarCode(_x5){return _getProductByBarCode.apply(this,arguments);}function _getProductByBarCode(){_getProductByBarCode=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(barcode){var requestOptions,Select,result,data,product;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:formData.barcode=barcode;setFormData(_objectSpread({},formData));console.log(\"Inside getProductByBarCode\");errors[\"bar_code\"]=\"\";setErrors(_objectSpread({},errors));console.log(\"barcode:\"+formData.barcode);if(formData.barcode){_context6.next=8;break;}return _context6.abrupt(\"return\");case 8:if(formData.barcode.length===13){formData.barcode=formData.barcode.slice(0,-1);}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,ean_12,part_number,name,product_stores,unit,part_number,name_in_arabic\";_context6.next=13;return fetch(\"/v1/product/barcode/\"+formData.barcode+\"?\"+Select,requestOptions);case 13:result=_context6.sent;_context6.next=16;return result.json();case 16:data=_context6.sent;product=data.result;if(product){addProduct(product);}else{errors[\"bar_code\"]=\"Invalid Barcode:\"+formData.barcode;setErrors(_objectSpread({},errors));}formData.barcode=\"\";setFormData(_objectSpread({},formData));case 21:case\"end\":return _context6.stop();}}},_callee6);}));return _getProductByBarCode.apply(this,arguments);}function suggestUsers(_x6){return _suggestUsers.apply(this,arguments);}function _suggestUsers(){_suggestUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:console.log(\"Inside handle suggestUsers\");setDeliveredByUserOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context7.next=5;break;}return _context7.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsDeliveredByUsersLoading(true);_context7.next=13;return fetch(\"/v1/user?\"+Select+queryString,requestOptions);case 13:result=_context7.sent;_context7.next=16;return result.json();case 16:data=_context7.sent;setDeliveredByUserOptions(data.result);setIsDeliveredByUsersLoading(false);case 19:case\"end\":return _context7.stop();}}},_callee7);}));return _suggestUsers.apply(this,arguments);}function suggestSignatures(_x7){return _suggestSignatures.apply(this,arguments);}function _suggestSignatures(){_suggestSignatures=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(\"Inside handle suggestSignatures\");setDeliveredBySignatureOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context8.next=5;break;}return _context8.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsDeliveredBySignaturesLoading(true);_context8.next=13;return fetch(\"/v1/signature?\"+Select+queryString,requestOptions);case 13:result=_context8.sent;_context8.next=16;return result.json();case 16:data=_context8.sent;setDeliveredBySignatureOptions(data.result);setIsDeliveredBySignaturesLoading(false);case 19:case\"end\":return _context8.stop();}}},_callee8);}));return _suggestSignatures.apply(this,arguments);}function handleCreate(event){event.preventDefault();formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit_price:parseFloat(selectedProducts[i].unit_price),unit:selectedProducts[i].unit});}if(!formData.shipping_handling_fees&&formData.shipping_handling_fees!==0){errors[\"shipping_handling_fees\"]=\"Invalid shipping / handling fees\";setErrors(_objectSpread({},errors));return;}if(formData.payment_status===\"paid_partially\"&&!formData.partial_payment_amount&&formData.partial_payment_amount!==0){errors[\"partial_payment_amount\"]=\"Invalid partial payment amount\";setErrors(_objectSpread({},errors));return;}if(formData.payment_status===\"paid_partially\"&&formData.partial_payment_amount<=0){errors[\"partial_payment_amount\"]=\"Partial payment should be > 0 \";setErrors(_objectSpread({},errors));return;}if(formData.payment_status===\"paid_partially\"&&formData.partial_payment_amount>=netTotal){errors[\"partial_payment_amount\"]=\"Partial payment cannot be >= \"+netTotal;setErrors(_objectSpread({},errors));return;}errors[\"payment_method\"]=\"\";setErrors(_objectSpread({},errors));if(!formData.id&&formData.payment_status!=\"not_paid\"&&!formData.payment_method){errors[\"payment_method\"]=\"Payment method is required\";setErrors(_objectSpread({},errors));return;}if(!formData.discount&&formData.discount!==0){errors[\"discount\"]=\"Invalid discount\";setErrors(_objectSpread({},errors));return;}if(!formData.discount_percent&&formData.discount_percent!==0){errors[\"discount_percent\"]=\"Invalid discount percent\";setErrors(_objectSpread({},errors));return;}if(parseFloat(formData.discount_percent)>100){errors[\"discount_percent\"]=\"Discount percent cannot be > 100\";setErrors(_objectSpread({},errors));return;}if(!formData.vat_percent&&formData.vat_percent!==0){errors[\"vat_percent\"]=\"Invalid vat percent\";setErrors(_objectSpread({},errors));return;}formData.discount=parseFloat(formData.discount);formData.discount_percent=parseFloat(formData.discount_percent);formData.vat_percent=parseFloat(formData.vat_percent);formData.partial_payment_amount=parseFloat(formData.partial_payment_amount);if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');}var endPoint=\"/v1/order\";var method=\"POST\";if(formData.id){endPoint=\"/v1/order/\"+formData.id;method=\"PUT\";}var requestOptions={method:method,headers:{'Accept':'application/json',\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")},body:JSON.stringify(formData)};console.log(\"formData:\",formData);setProcessing(true);fetch(endPoint,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get(\"content-type\"))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes(\"application/json\");_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});setProcessing(false);console.log(\"Response:\");console.log(data);props.showToastMessage(\"Order Created Successfully!\",\"success\");if(props.refreshList){props.refreshList();}handleClose();formData.products=[];selectedProducts=[];setSelectedProducts([]);formData.customer_id=\"\";setSelectedCustomers([]);setFormData(_objectSpread({},formData));reCalculate();openDetailsView(data.result.id);case 25:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x8){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(_objectSpread({},error));console.error(\"There was an error!\",error);props.showToastMessage(\"Error Creating Order!\",\"danger\");});}function getProductIndex(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return i;}}return false;}function isProductAdded(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return true;}}return false;}function GetProductStockInStore(storeId,productStores){if(!productStores){return 0.0;}for(var i=0;i<productStores.length;i++){if(productStores[i].store_id===storeId){return productStores[i].stock;}}return 0.0;}function addProduct(product){console.log(\"Inside Add product\");if(!formData.store_id){errors.product_id=\"Please Select a Store and try again\";setErrors(_objectSpread({},errors));return;}errors.product_id=\"\";if(!product){errors.product_id=\"Invalid Product\";setErrors(_objectSpread({},errors));return;}/*\n        let productStore = GetProductUnitPriceInStore(\n            formData.store_id,\n            product.stores\n        );\n        */ // product.unit_price = productStore.retail_unit_price;\nif(product.product_stores[formData.store_id]){product.unit_price=product.product_stores[formData.store_id].retail_unit_price;}errors.unit_price=\"\";if(!product.unit_price){errors.unit_price=\"Invalid Unit Price\";setErrors(_objectSpread({},errors));return;}var alreadyAdded=false;var index=false;var quantity=0.00;product.quantity=1.00;if(isProductAdded(product.id)){alreadyAdded=true;index=getProductIndex(product.id);quantity=parseFloat(selectedProducts[index].quantity+product.quantity);}else{quantity=parseFloat(product.quantity);}console.log(\"quantity:\",quantity);errors.quantity=\"\";//let stock = GetProductStockInStore(formData.store_id, product.stores);\nvar stock=0;if(product.product_stores[formData.store_id]){stock=product.product_stores[formData.store_id].stock;}if(stock<quantity){if(index===false){index=selectedProducts.length;}// errors[\"quantity_\" + index] = \"Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for product: \" + product.name;\nerrors[\"quantity_\"+index]=\"Warning: Available stock is \"+stock;console.log(\"errors:\",errors);setErrors(_objectSpread({},errors));}if(alreadyAdded){selectedProducts[index].quantity=parseFloat(quantity);}if(!alreadyAdded){selectedProducts.push({product_id:product.id,code:product.item_code,part_number:product.part_number,name:product.name,quantity:product.quantity,product_stores:product.product_stores,unit_price:parseFloat(product.unit_price).toFixed(2),unit:product.unit});}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}function removeProduct(product){var index=selectedProducts.indexOf(product);if(index>-1){selectedProducts.splice(index,1);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}var _useState43=useState(0.0),_useState44=_slicedToArray(_useState43,2),totalPrice=_useState44[0],setTotalPrice=_useState44[1];function findTotalPrice(){totalPrice=0.00;for(var i=0;i<selectedProducts.length;i++){totalPrice+=parseFloat(selectedProducts[i].unit_price)*parseFloat(selectedProducts[i].quantity);}totalPrice=totalPrice.toFixed(2);setTotalPrice(totalPrice);}var _useState45=useState(0.00),_useState46=_slicedToArray(_useState45,2),vatPrice=_useState46[0],setVatPrice=_useState46[1];function findVatPrice(){vatPrice=0.00;if(totalPrice>0){vatPrice=(parseFloat(parseFloat(formData.vat_percent)/100)*(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount))).toFixed(2);;console.log(\"vatPrice:\",vatPrice);}setVatPrice(vatPrice);}var _useState47=useState(0.00),_useState48=_slicedToArray(_useState47,2),netTotal=_useState48[0],setNetTotal=_useState48[1];function findNetTotal(){netTotal=0.00;if(totalPrice>0){netTotal=(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount)+parseFloat(vatPrice)).toFixed(2);}setNetTotal(netTotal);}var _useState49=useState(0.00),_useState50=_slicedToArray(_useState49,2),discountPercent=_useState50[0],setDiscountPercent=_useState50[1];function findDiscountPercent(){if(formData.discount>=0&&totalPrice>0){discountPercent=parseFloat(parseFloat(formData.discount/totalPrice)*100).toFixed(2);setDiscountPercent(discountPercent);formData.discount_percent=discountPercent;setFormData(_objectSpread({},formData));}}function findDiscount(){if(formData.discount_percent>=0&&totalPrice>0){formData.discount=parseFloat(totalPrice*parseFloat(formData.discount_percent/100)).toFixed(2);setFormData(_objectSpread({},formData));}}function reCalculate(){findTotalPrice();if(formData.is_discount_percent){findDiscount();}else{findDiscountPercent();}findVatPrice();findNetTotal();}var DetailsViewRef=useRef();function openDetailsView(id){DetailsViewRef.current.open(id);}var StoreCreateFormRef=useRef();function openStoreCreateForm(){StoreCreateFormRef.current.open();}var CustomerCreateFormRef=useRef();function openCustomerCreateForm(){CustomerCreateFormRef.current.open();}var ProductCreateFormRef=useRef();function openProductCreateForm(){ProductCreateFormRef.current.open();}var UserCreateFormRef=useRef();function openUserCreateForm(){UserCreateFormRef.current.open();}var SignatureCreateFormRef=useRef();function openSignatureCreateForm(){SignatureCreateFormRef.current.open();}var ProductDetailsViewRef=useRef();function openProductDetailsView(id){ProductDetailsViewRef.current.open(id);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(OrderView,{ref:DetailsViewRef,openCreateForm:props.openCreateForm}),/*#__PURE__*/_jsx(ProductView,{ref:ProductDetailsViewRef}),/*#__PURE__*/_jsx(StoreCreate,{ref:StoreCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(CustomerCreate,{ref:CustomerCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(ProductCreate,{ref:ProductCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(UserCreate,{ref:UserCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(SignatureCreate,{ref:SignatureCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsxs(Modal,{show:show,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,backdrop:\"static\",scrollable:true,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:formData.id?\"Update Sales Order #\"+formData.code:\"Create New Sales Order\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsx(OrderPreview,{}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?formData.id?\"Updating....\":\"Creating..\":formData.id?\"Update\":\"Create\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsxs(Modal.Body,{children:[Object.keys(errors).length>0?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"ul\",{children:errors&&Object.keys(errors).map(function(key,index){return errors[key]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";})})}):\"\",/*#__PURE__*/_jsxs(\"form\",{className:\"row g-3 needs-validation\",onSubmit:function onSubmit(e){e.preventDefault();handleCreate(e);},children:[!cookies.get('store_name')?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Store*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"store_id\",labelKey:\"name\",isLoading:isStoresLoading,isInvalid:errors.store_id?true:false,onChange:function onChange(selectedItems){errors.store_id=\"\";errors[\"product_id\"]=\"\";setErrors(errors);if(selectedItems.length===0){errors.store_id=\"Invalid Store selected\";setErrors(errors);setFormData(_objectSpread({},formData));setSelectedStores([]);return;}formData.store_id=selectedItems[0].id;setFormData(_objectSpread({},formData));console.log(\"formData.store_id:\",formData.store_id);selectedStores=selectedItems;setSelectedStores(_toConsumableArray(selectedItems));if(formData.store_id){if(selectedProduct[0]&&selectedProduct[0].product_stores&&selectedProduct[0].quantity){var stock=0;if(selectedProduct[0].product_stores){//stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\nif(selectedProduct[0].product_stores[formData.store_id]){stock=selectedProduct[0].product_stores[formData.store_id].stock;}}if(stock<parseFloat(selectedProduct[0].quantity)){if(selectedStores[0]){errors.product_id=\"Stock is only \"+stock+\" in Store: \"+selectedStores[0].name+\" for this product\";}else{errors.product_id=\"Stock is only \"+stock+\" in Selected Store for this product\";}setErrors(_objectSpread({},errors));}}else if(selectedProduct[0]&&selectedProduct[0].product_stores){var _stock=0;//stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\nif(selectedProduct[0].product_stores[formData.store_id]){_stock=selectedProduct[0].product_stores[formData.store_id].stock;}if(_stock===0){if(selectedStores[0]){errors[\"product_id\"]=\"This product is not available in store: \"+selectedStores[0].name;}else{errors[\"product_id\"]=\"This product is not available in selected store.\";}setErrors(_objectSpread({},errors));}}if(selectedProduct[0]){/*\n                                                selectedProduct[0].unit_price = GetProductUnitPriceInStore(\n                                                    formData.store_id,\n                                                    selectedProduct[0].stores\n                                                );\n                                                */if(selectedProduct[0].product_stores[formData.store_id]){selectedProduct[0].unit_price=selectedProduct[0].product_stores[formData.store_id].retail_unit_price;}if(!selectedProduct[0].quantity){selectedProduct[0].quantity=1;}setSelectedProduct(_toConsumableArray(selectedProduct));}}},options:storeOptions,placeholder:\"Select Store\",selected:selectedStores,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestStores(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openStoreCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi x-lg\",children:\" \"}),errors.store_id]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Customer*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"customer_id\",labelKey:\"search_label\",isLoading:isCustomersLoading,isInvalid:errors.customer_id?true:false,onChange:function onChange(selectedItems){errors.customer_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.customer_id=\"Invalid Customer selected\";setErrors(errors);formData.customer_id=\"\";setFormData(_objectSpread({},formData));setSelectedCustomers([]);return;}formData.customer_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedCustomers(selectedItems);},options:customerOptions,placeholder:\"Type name or mob\",selected:selectedCustomers,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestCustomers(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openCustomerCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.customer_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.customer_id]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product Barcode Scan\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DebounceInput,{minLength:3,debounceTimeout:100,placeholder:\"Scan Barcode\",className:\"form-control barcode\",value:formData.barcode,onChange:function onChange(event){return getProductByBarCode(event.target.value);}}),errors.bar_code&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.bar_code]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product Search*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"product_id\",size:\"lg\",labelKey:\"search_label\",emptyLabel:\"\",clearButton:true,open:openProductSearchResult,isLoading:isProductsLoading,isInvalid:errors.product_id?true:false,onChange:function onChange(selectedItems){if(selectedItems.length===0){errors[\"product_id\"]=\"Invalid Product selected\";setErrors(errors);return;}errors[\"product_id\"]=\"\";setErrors(_objectSpread({},errors));if(formData.store_id){addProduct(selectedItems[0]);}setOpenProductSearchResult(false);},options:productOptions,selected:selectedProduct,placeholder:\"Search By Part No. / Name / Name in Arabic\",highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestProducts(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openProductCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.product_id?/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.product_id]}):\"\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\",maxHeight:\"400px\",overflowY:\"auto\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"3%\"},children:\"Remove\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"5%\"},children:\"SI No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"10%\"},children:\"Part No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"30%\"},className:\"text-start\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"15%\"},children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"18%\"},children:\"Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"32%\"},children:\"Price\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedProducts.map(function(product,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\",cursor:\"pointer\"},onClick:function onClick(){removeProduct(product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"})})}),/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:product.part_number}),/*#__PURE__*/_jsx(\"td\",{style:{textDecoration:\"underline\",color:\"blue\",cursor:\"pointer\"},className:\"text-start\",onClick:function onClick(){openProductDetailsView(product.product_id);},children:product.name}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.quantity,className:\"form-control text-end\",placeholder:\"Quantity\",onChange:function onChange(e){errors[\"quantity_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"quantity_\"+index]=\"Invalid Quantity\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"quantity_\"+index]=\"Quantity should be > 0\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}product.quantity=parseFloat(e.target.value);selectedProducts[index].quantity=parseFloat(e.target.value);reCalculate();var stock=0;if(selectedProducts[index].product_stores){var _selectedProducts$ind;stock=(_selectedProducts$ind=selectedProducts[index].product_stores[formData.store_id])===null||_selectedProducts$ind===void 0?void 0:_selectedProducts$ind.stock;// stock = GetProductStockInStore(formData.store_id, selectedProducts[index].stores);\n}if(stock<parseFloat(e.target.value)&&selectedProducts[index].product_stores){// errors[\"quantity_\" + index] = \" Warning: Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for this product\";\nerrors[\"quantity_\"+index]=\" Warning: Available stock is \"+stock;setErrors(_objectSpread({},errors));return;}selectedProducts[index].quantity=parseFloat(e.target.value);console.log(\"selectedProducts[index].quantity:\",selectedProducts[index].quantity);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:selectedProducts[index].unit?selectedProducts[index].unit:\"Units\"})]}),errors[\"quantity_\"+index]&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors[\"quantity_\"+index]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.unit_price,className:\"form-control text-end\",placeholder:\"Unit Price\",onChange:function onChange(e){errors[\"unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"unit_price_\"+index]=\"Invalid Unit Price\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"unit_price_\"+index]=\"Unit Price should be > 0\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].unit_price:\",selectedProducts[index].unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"unit_price_\"+index]]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(product.unit_price*product.quantity).toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]},index);}).reverse()})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsx(\"table\",{className:\"table table-striped table-sm table-bordered\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Total\"}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",style:{width:\"200px\"},children:/*#__PURE__*/_jsx(NumberFormat,{value:totalPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Shipping & Handling Fees\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.shipping_handling_fees,onChange:function onChange(e){if(parseFloat(e.target.value)===0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"Shipping / Handling Fees should be > 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.shipping_handling_fees=\"\";errors[\"shipping_handling_fees\"]=\"Invalid Shipping / Handling Fees\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.shipping_handling_fees&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.shipping_handling_fees})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\"Discount  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"50px\"},className:\"text-start\",value:formData.discount_percent,onChange:function onChange(e){formData.is_discount_percent=true;if(parseFloat(e.target.value)===0){formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount_percent=parseFloat(e.target.value);formData.discount=0.00;setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"Discount percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount_percent=\"\";formData.discount=0.00;errors[\"discount_percent\"]=\"Invalid Discount Percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"discount_percent\"]=\"\";errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\"%\",errors.discount_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount_percent})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.discount,onChange:function onChange(e){formData.is_discount_percent=false;if(parseFloat(e.target.value)===0){formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount=parseFloat(e.target.value);formData.discount_percent=0.00;setFormData(_objectSpread({},formData));errors[\"discount\"]=\"Discount should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount=\"\";formData.discount_percent=0.00;errors[\"discount\"]=\"Invalid Discount\";setFormData(_objectSpread({},formData));reCalculate();setErrors(_objectSpread({},errors));return;}errors[\"discount\"]=\"\";errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.discount&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\" VAT  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"text-center\",style:{width:\"50px\"},value:formData.vat_percent,onChange:function onChange(e){console.log(\"Inside onchange vat percent\");if(parseFloat(e.target.value)===0){formData.vat_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.vat_percent=parseFloat(e.target.value);vatPrice=0.00;setVatPrice(vatPrice);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"Vat percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.vat_percent=\"\";vatPrice=0.00;setVatPrice(vatPrice);//formData.discount_percent = 0.00;\nerrors[\"vat_percent\"]=\"Invalid vat percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.vat_percent=e.target.value;reCalculate();setFormData(_objectSpread({},formData));console.log(formData);}}),\"%\",errors.vat_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.vat_percent})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:vatPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Net Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:netTotal,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]})]})})}),!formData.id?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payment method*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payment_method,disabled:formData.payment_status==\"not_paid\"?\"disabled\":\"\",onChange:function onChange(e){if(!e.target.value){errors[\"payment_method\"]=\"Payment method is required\";setErrors(_objectSpread({},errors));formData.payment_method=\"\";setFormData(_objectSpread({},formData));return;}errors[\"payment_method\"]=\"\";setErrors(_objectSpread({},errors));formData.payment_method=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_account\",children:\"Bank Account / Debit / Credit Card\"})]}),errors.payment_method&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.payment_method]})]})]}):\"\",!formData.id?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payment Status*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payment_status,onChange:function onChange(e){console.log(\"Inside onchange payment Status\");if(!e.target.value){errors[\"payment_status\"]=\"Payment status is required\";formData.payment_status=\"\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"payment_status\"]=\"\";setErrors(_objectSpread({},errors));formData.payment_status=e.target.value;if(formData.payment_status!==\"paid_partially\"){formData.partial_payment_amount=0.00;}setFormData(_objectSpread({},formData));if(formData.payment_status==\"not_paid\"){formData.payment_method=\"\";setFormData(_objectSpread({},formData));}console.log(formData);},className:\"form-control\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"paid\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"not_paid\",children:\"Not Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"paid_partially\",children:\"Paid Partially\"})]}),errors.payment_status&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.payment_status]})]})]}):\"\",!formData.id&&formData.payment_status===\"paid_partially\"?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Patial Payment Amount*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.partial_payment_amount,onChange:function onChange(e){console.log(\"Inside onchange vat discount\");if(!e.target.value){formData.partial_payment_amount=e.target.value;errors[\"partial_payment_amount\"]=\"Invalid partial payment amount\";setErrors(_objectSpread({},errors));return;}formData.partial_payment_amount=parseFloat(e.target.value);errors[\"partial_payment_amount\"]=\"\";if(formData.partial_payment_amount>=netTotal){errors[\"partial_payment_amount\"]=\"Partial payment cannot be >= \"+netTotal;setErrors(_objectSpread({},errors));return;}setErrors(_objectSpread({},errors));setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",id:\"validationCustom02\",placeholder:\"Amount\"}),errors.partial_payment_amount&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.partial_payment_amount]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.date_str?new Date(formData.date_str):null,value:formData.date_str?format(new Date(formData.date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.date_str=value;// formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\nsetFormData(_objectSpread({},formData));}}),errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.date_str]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?formData.id?\"Updating....\":\"Creating..\":formData.id?\"Update\":\"Create\"})]})]})]})]})]});});export default OrderCreate;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/order/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","OrderPreview","Modal","Button","Form","StoreCreate","CustomerCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","OrderView","DebounceInput","ProductView","OrderCreate","props","ref","open","id","selectedProducts","setSelectedProducts","selectedStores","setSelectedStores","selectedCustomers","setSelectedCustomers","cookies","get","selectedDeliveredByUsers","name","formData","delivered_by","setFormData","setSelectedDeliveredByUsers","store_id","store_name","vat_percent","parseFloat","console","log","undefined","discount","discount_percent","shipping_handling_fees","partial_payment_amount","status","payment_method","payment_status","date_str","Date","getOrder","reCalculate","setShow","requestOptions","method","headers","fetch","then","response","isJson","includes","json","data","ok","error","errors","Promise","reject","setErrors","result","date","is_discount_percent","discountValue","products","searchLabel","customer_name","customer_id","search_label","catch","setProcessing","listener","event","code","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","focus","preventDefault","document","addEventListener","removeEventListener","selectedDate","isProcessing","signature_date_str","price_type","useLaserScanner","storeOptions","setStoreOptions","isStoresLoading","setIsStoresLoading","customerOptions","setCustomerOptions","isCustomersLoading","setIsCustomersLoading","productOptions","setProductOptions","selectedProduct","setSelectedProduct","isProductsLoading","setIsProductsLoading","deliveredByUserOptions","setDeliveredByUserOptions","isDeliveredByUsersLoading","setIsDeliveredByUsersLoading","deliveredBySignatureOptions","setDeliveredBySignatureOptions","selectedDeliveredBySignatures","setSelectedDeliveredBySignatures","isDeliveredBySignaturesLoading","setIsDeliveredBySignaturesLoading","show","handleClose","at","window","location","ObjectToSearchQueryParams","object","Object","keys","map","key","encodeURIComponent","join","suggestStores","searchTerm","params","queryString","Authorization","Select","suggestCustomers","GetProductUnitPriceInStore","storeId","productStores","i","length","retail_unit_price","openProductSearchResult","setOpenProductSearchResult","suggestProducts","getProductByBarCode","barcode","slice","product","addProduct","suggestUsers","suggestSignatures","handleCreate","push","product_id","quantity","unit_price","unit","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","getProductIndex","productID","isProductAdded","GetProductStockInStore","stock","product_stores","alreadyAdded","item_code","part_number","toFixed","removeProduct","splice","totalPrice","setTotalPrice","findTotalPrice","vatPrice","setVatPrice","findVatPrice","setNetTotal","findNetTotal","discountPercent","setDiscountPercent","findDiscountPercent","findDiscount","DetailsViewRef","current","StoreCreateFormRef","openStoreCreateForm","CustomerCreateFormRef","openCustomerCreateForm","ProductCreateFormRef","openProductCreateForm","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","openCreateForm","color","e","selectedItems","toString","value","bar_code","overflowX","maxHeight","overflowY","width","cursor","textDecoration","reverse"],"mappings":"uqBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,MAArC,CAA6CC,UAA7C,CAAyDC,mBAAzD,KAAoF,OAApF,CACA,MAAOC,CAAAA,YAAP,KAAyB,cAAzB,CACA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,IAAxB,KAAoC,iBAApC,CACA,MAAOC,CAAAA,WAAP,KAAwB,oBAAxB,CACA,MAAOC,CAAAA,cAAP,KAA2B,yBAA3B,CACA,MAAOC,CAAAA,aAAP,KAA0B,wBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,qBAAvB,CACA,MAAOC,CAAAA,eAAP,KAA4B,0BAA5B,CACA,MAAOC,CAAAA,OAAP,KAAoB,kBAApB,CACA,OAASC,SAAT,KAA0B,2BAA1B,CACA,MAAOC,CAAAA,YAAP,KAAyB,qBAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,kBAAvB,CACA,OAASC,MAAT,KAAuB,UAAvB,CACA,OAASC,OAAT,KAAwB,iBAAxB,CACA,MAAOC,CAAAA,SAAP,KAAsB,WAAtB,CACA,MAAO,aAAP,CACA,OAASC,aAAT,KAA8B,sBAA9B,CACA;AACA;AACA,MAAOC,CAAAA,WAAP,KAAwB,sBAAxB,C,6IAEA,GAAMC,CAAAA,WAAW,cAAGpB,UAAU,CAAC,SAACqB,KAAD,CAAQC,GAAR,CAAgB,CAG3CrB,mBAAmB,CAACqB,GAAD,CAAM,iBAAO,CAC5BC,IAD4B,eACvBC,EADuB,CACnB,CACLC,gBAAgB,CAAG,EAAnB,CACAC,mBAAmB,CAAC,EAAD,CAAnB,CAEAC,cAAc,CAAG,EAAjB,CACAC,iBAAiB,CAAC,EAAD,CAAjB,CAEAC,iBAAiB,CAAG,EAApB,CACAC,oBAAoB,CAAC,EAAD,CAApB,CAIA,GAAIC,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAJ,CAA4B,CACxBC,wBAAwB,CAAG,CAAC,CACxBT,EAAE,CAAEO,OAAO,CAACC,GAAR,CAAY,SAAZ,CADoB,CAExBE,IAAI,CAAEH,OAAO,CAACC,GAAR,CAAY,WAAZ,CAFkB,CAAD,CAA3B,CAIAG,QAAQ,CAACC,YAAT,CAAwBL,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAxB,CACAK,WAAW,kBAAMF,QAAN,EAAX,CACAG,2BAA2B,oBAAKL,wBAAL,EAA3B,CACH,CAED,GAAIF,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAJ,CAA6B,CACzBG,QAAQ,CAACI,QAAT,CAAoBR,OAAO,CAACC,GAAR,CAAY,UAAZ,CAApB,CACAG,QAAQ,CAACK,UAAT,CAAsBT,OAAO,CAACC,GAAR,CAAY,YAAZ,CAAtB,CACAG,QAAQ,CAACM,WAAT,CAAuBC,UAAU,CAACX,OAAO,CAACC,GAAR,CAAY,aAAZ,CAAD,CAAjC,CACAW,OAAO,CAACC,GAAR,CAAY,oBAAZ,CAAkCT,QAAQ,CAACI,QAA3C,EACH,CAEDJ,QAAQ,CAACX,EAAT,CAAcqB,SAAd,CACAV,QAAQ,CAACW,QAAT,CAAoB,IAApB,CACAX,QAAQ,CAACY,gBAAT,CAA4B,IAA5B,CACAZ,QAAQ,CAACa,sBAAT,CAAkC,IAAlC,CACAb,QAAQ,CAACc,sBAAT,CAAkC,IAAlC,CACAd,QAAQ,CAACe,MAAT,CAAkB,WAAlB,CACAf,QAAQ,CAACgB,cAAT,CAA0B,EAA1B,CACAhB,QAAQ,CAACiB,cAAT,CAA0B,EAA1B,CACAjB,QAAQ,CAACkB,QAAT,CAAoB,GAAIC,CAAAA,IAAJ,EAApB,CACA,GAAI9B,EAAJ,CAAQ,CACJ+B,QAAQ,CAAC/B,EAAD,CAAR,CACH,CACDa,WAAW,kBAAMF,QAAN,EAAX,CACAqB,WAAW,GACXC,OAAO,CAAC,IAAD,CAAP,CAEH,CA9C2B,CAAP,EAAN,CAAnB,CAkDA,QAASF,CAAAA,QAAT,CAAkB/B,EAAlB,CAAsB,CAClBmB,OAAO,CAACC,GAAR,CAAY,kBAAZ,EACA,GAAMc,CAAAA,cAAc,CAAG,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,gBAAiB7B,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFZ,CAFU,CAAvB,CAQA6B,KAAK,CAAC,aAAerC,EAAhB,CAAoBkC,cAApB,CAAL,CACKI,IADL,0FACU,iBAAMC,QAAN,+MACIC,MADJ,wBACaD,QAAQ,CAACH,OAAT,CAAiB5B,GAAjB,CAAqB,cAArB,CADb,gDACa,sBAAsCiC,QAAtC,CAA+C,kBAA/C,CADb,aAEWD,MAFX,+DAE2BD,CAAAA,QAAQ,CAACG,IAAT,EAF3B,yCAEIC,IAFJ,gBAKGJ,QAAQ,CAACK,EALZ,0BAMQC,KANR,CAMiBF,IAAI,EAAIA,IAAI,CAACG,MAN9B,iCAOSC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAPT,UAUFI,SAAS,CAAC,EAAD,CAAT,CAEA9B,OAAO,CAACC,GAAR,CAAY,WAAZ,EACAD,OAAO,CAACC,GAAR,CAAYuB,IAAZ,EAEAhC,QAAQ,CAAGgC,IAAI,CAACO,MAAhB,CACAvC,QAAQ,CAACkB,QAAT,CAAoBc,IAAI,CAACO,MAAL,CAAYC,IAAhC,CACA;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAEgB,GAAIxC,QAAQ,CAACyC,mBAAb,CAAkC,CAC9BzC,QAAQ,CAAC0C,aAAT,CAAyB1C,QAAQ,CAACY,gBAAlC,CACH,CAFD,IAEO,CACHZ,QAAQ,CAAC0C,aAAT,CAAyB1C,QAAQ,CAACW,QAAlC,CACH,CAEDrB,gBAAgB,CAAGU,QAAQ,CAAC2C,QAA5B,CACApD,mBAAmB,oBAAKD,gBAAL,EAAnB,CAGIE,cAlDF,CAkDmB,CACjB,CACIH,EAAE,CAAEW,QAAQ,CAACI,QADjB,CAEIL,IAAI,CAAEC,QAAQ,CAACK,UAFnB,CADiB,CAlDnB,CA0DEuC,WA1DF,CA0DgB5C,QAAQ,CAAC6C,aA1DzB,CA4DEnD,iBA5DF,CA4DsB,CACpB,CACIL,EAAE,CAAEW,QAAQ,CAAC8C,WADjB,CAEI/C,IAAI,CAAEC,QAAQ,CAAC6C,aAFnB,CAGIE,YAAY,CAAEH,WAHlB,CADoB,CA5DtB,CAoEF;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAEgBnD,iBAAiB,WAAKD,cAAL,EAAjB,CACAG,oBAAoB,WAAKD,iBAAL,EAApB,CAEA2B,WAAW,GACXnB,WAAW,kBAAMF,QAAN,EAAX,CApFE,uDADV,gEAyFKgD,KAzFL,CAyFW,SAAAd,KAAK,CAAI,CACZe,aAAa,CAAC,KAAD,CAAb,CACAX,SAAS,CAACJ,KAAD,CAAT,CACH,CA5FL,EA6FH,CAEDvE,SAAS,CAAC,UAAM,CACZ,GAAMuF,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAC,KAAK,CAAI,CACtB,GAAIA,KAAK,CAACC,IAAN,GAAe,OAAf,EAA0BD,KAAK,CAACC,IAAN,GAAe,aAA7C,CAA4D,CACxD5C,OAAO,CAACC,GAAR,CAAY,oDAAZ,EACA;AAIA,GAAI4C,CAAAA,IAAI,CAAGF,KAAK,CAACG,MAAN,CAAaD,IAAxB,CACA,GAAIA,IAAI,EAAIF,KAAK,CAACG,MAAlB,CAA0B,CACtB,GAAIC,CAAAA,KAAK,CAAGC,KAAK,CAACC,SAAN,CAAgBC,OAAhB,CAAwBC,IAAxB,CAA6BN,IAA7B,CAAmCF,KAAK,CAACG,MAAzC,CAAZ,CACA,GAAID,IAAI,EAAIA,IAAI,CAACO,QAAL,CAAcL,KAAK,CAAG,CAAtB,CAAZ,CAAsC,CAClC,GAAIJ,KAAK,CAACG,MAAN,CAAaO,YAAb,CAA0B,OAA1B,EAAmC/B,QAAnC,CAA4C,SAA5C,CAAJ,CAA4D,CACxDuB,IAAI,CAACO,QAAL,CAAcL,KAAd,EAAqBO,KAArB,GACH,CAFD,IAEO,CACHT,IAAI,CAACO,QAAL,CAAcL,KAAK,CAAG,CAAtB,EAAyBO,KAAzB,GACH,CACDX,KAAK,CAACY,cAAN,GACH,CACJ,CACJ,CACJ,CApBD,CAqBAC,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,CAAqCf,QAArC,EACA,MAAO,WAAM,CACTc,QAAQ,CAACE,mBAAT,CAA6B,SAA7B,CAAwChB,QAAxC,EACH,CAFD,CAGH,CA1BQ,CA0BN,EA1BM,CAAT,CA6BA,GAAMiB,CAAAA,YAAY,CAAG,GAAIhD,CAAAA,IAAJ,EAArB,CAEA;AACA,cAA0BzD,QAAQ,CAAC,EAAD,CAAlC,wCAAKyE,MAAL,eAAaG,SAAb,eACA,eAAsC5E,QAAQ,CAAC,KAAD,CAA9C,yCAAO0G,YAAP,eAAqBnB,aAArB,eACA,GAAMrD,CAAAA,OAAO,CAAG,GAAIpB,CAAAA,OAAJ,EAAhB,CAEA;AACA,eAA8Bd,QAAQ,CAAC,CACnC4C,WAAW,CAAE,IADsB,CAEnCoC,aAAa,CAAE,IAFoB,CAGnC/B,QAAQ,CAAE,IAHyB,CAInCC,gBAAgB,CAAE,GAJiB,CAKnC6B,mBAAmB,CAAE,KALc,CAMnCvB,QAAQ,CAAE,GAAIC,CAAAA,IAAJ,EANyB,CAOnCkD,kBAAkB,CAAEzF,MAAM,CAAC,GAAIuC,CAAAA,IAAJ,EAAD,CAAa,aAAb,CAPS,CAQnCJ,MAAM,CAAE,WAR2B,CASnCE,cAAc,CAAE,EATmB,CAUnCD,cAAc,CAAE,EAVmB,CAWnCsD,UAAU,CAAE,QAXuB,CAYnCC,eAAe,CAAE,KAZkB,CAanCnE,QAAQ,CAAE,EAbyB,CAAD,CAAtC,yCAAKJ,QAAL,eAAeE,WAAf,eAgBA;AACA,eAAwCxC,QAAQ,CAAC,EAAD,CAAhD,yCAAO8G,YAAP,eAAqBC,eAArB,eACA,eAA0C/G,QAAQ,CAAC,EAAD,CAAlD,0CAAK8B,cAAL,gBAAqBC,iBAArB,gBACA,gBAA8C/B,QAAQ,CAAC,KAAD,CAAtD,2CAAOgH,eAAP,gBAAwBC,kBAAxB,gBAEA;AACA,gBAA8CjH,QAAQ,CAAC,EAAD,CAAtD,2CAAOkH,eAAP,gBAAwBC,kBAAxB,gBACA,gBAAgDnH,QAAQ,CAAC,EAAD,CAAxD,2CAAKgC,iBAAL,gBAAwBC,oBAAxB,gBACA,gBAAoDjC,QAAQ,CAAC,KAAD,CAA5D,2CAAOoH,kBAAP,gBAA2BC,qBAA3B,gBAEA;AACA,gBAA4CrH,QAAQ,CAAC,EAAD,CAApD,2CAAOsH,cAAP,gBAAuBC,iBAAvB,gBACA,gBAA4CvH,QAAQ,CAAC,EAAD,CAApD,2CAAKwH,eAAL,gBAAsBC,kBAAtB,gBACA,gBAA8CzH,QAAQ,CAAC,EAAD,CAAtD,2CAAK4B,gBAAL,gBAAuBC,mBAAvB,gBACA,gBAAkD7B,QAAQ,CAAC,KAAD,CAA1D,2CAAO0H,iBAAP,gBAA0BC,oBAA1B,gBAEA;AACA,gBAA0D3H,QAAQ,CAAC,EAAD,CAAlE,2CAAK4H,sBAAL,gBAA6BC,yBAA7B,gBACA,gBAA8D7H,QAAQ,CAAC,EAAD,CAAtE,2CAAKoC,wBAAL,gBAA+BK,2BAA/B,gBACA,gBACIzC,QAAQ,CAAC,KAAD,CADZ,2CAAO8H,yBAAP,gBAAkCC,4BAAlC,gBAGA;AACA,gBACI/H,QAAQ,CAAC,EAAD,CADZ,2CAAOgI,2BAAP,gBAAoCC,8BAApC,gBAEA,gBACIjI,QAAQ,CAAC,EAAD,CADZ,2CAAOkI,6BAAP,gBAAsCC,gCAAtC,gBAEA,gBACInI,QAAQ,CAAC,KAAD,CADZ,2CAAOoI,8BAAP,gBAAuCC,iCAAvC,gBAGA,gBAAwBrI,QAAQ,CAAC,KAAD,CAAhC,2CAAOsI,IAAP,gBAAa1E,OAAb,gBAEA,QAAS2E,CAAAA,WAAT,EAAuB,CACnB3E,OAAO,CAAC,KAAD,CAAP,CACH,CAED3D,SAAS,CAAC,UAAM,CACZ,GAAIuI,CAAAA,EAAE,CAAGtG,OAAO,CAACC,GAAR,CAAY,cAAZ,CAAT,CACA,GAAI,CAACqG,EAAL,CAAS,CACL;AACAC,MAAM,CAACC,QAAP,CAAkB,GAAlB,CACH,CACJ,CANQ,CAAT,CASA,QAASC,CAAAA,yBAAT,CAAmCC,MAAnC,CAA2C,CACvC,MAAOC,CAAAA,MAAM,CAACC,IAAP,CAAYF,MAAZ,EACFG,GADE,CACE,SAAUC,GAAV,CAAe,CAChB,MAAO,iBAAUA,GAAV,OAAoBC,kBAAkB,CAACL,MAAM,CAACI,GAAD,CAAP,CAA7C,CACH,CAHE,EAIFE,IAJE,CAIG,GAJH,CAAP,CAKH,CAtQ0C,QAwQ5BC,CAAAA,aAxQ4B,oJAwQ3C,kBAA6BC,UAA7B,+KACItG,OAAO,CAACC,GAAR,CAAY,6BAAZ,EACAgE,eAAe,CAAC,EAAD,CAAf,CAEAjE,OAAO,CAACC,GAAR,CAAY,cAAgBqG,UAA5B,EAJJ,GAKSA,UALT,mEASQC,MATR,CASiB,CACThH,IAAI,CAAE+G,UADG,CATjB,CAYQE,WAZR,CAYsBX,yBAAyB,CAACU,MAAD,CAZ/C,CAaI,GAAIC,WAAW,GAAK,EAApB,CAAwB,CACpBA,WAAW,CAAG,IAAMA,WAApB,CACH,CAEKzF,cAjBV,CAiB2B,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAELwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFV,CAFU,CAjB3B,CAyBQqH,MAzBR,CAyBiB,gBAzBjB,CA0BIvC,kBAAkB,CAAC,IAAD,CAAlB,CA1BJ,wBA2BuBjD,CAAAA,KAAK,CACpB,aAAewF,MAAf,CAAwBF,WADJ,CAEpBzF,cAFoB,CA3B5B,SA2BQgB,MA3BR,wCA+BqBA,CAAAA,MAAM,CAACR,IAAP,EA/BrB,SA+BQC,IA/BR,gBAiCIyC,eAAe,CAACzC,IAAI,CAACO,MAAN,CAAf,CACAoC,kBAAkB,CAAC,KAAD,CAAlB,CAlCJ,yDAxQ2C,wDA6S5BwC,CAAAA,gBA7S4B,6JA6S3C,kBAAgCL,UAAhC,+KACItG,OAAO,CAACC,GAAR,CAAY,gCAAZ,EACAoE,kBAAkB,CAAC,EAAD,CAAlB,CAEArE,OAAO,CAACC,GAAR,CAAY,cAAgBqG,UAA5B,EAJJ,GAKSA,UALT,mEASQC,MATR,CASiB,CACThH,IAAI,CAAE+G,UADG,CATjB,CAYQE,WAZR,CAYsBX,yBAAyB,CAACU,MAAD,CAZ/C,CAaI,GAAIC,WAAW,GAAK,EAApB,CAAwB,CACpBA,WAAW,CAAG,IAAMA,WAApB,CACH,CAEKzF,cAjBV,CAiB2B,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAELwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFV,CAFU,CAjB3B,CAyBQqH,MAzBR,CAyBiB,kEAzBjB,CA0BInC,qBAAqB,CAAC,IAAD,CAArB,CA1BJ,wBA2BuBrD,CAAAA,KAAK,CACpB,gBAAkBwF,MAAlB,CAA2BF,WADP,CAEpBzF,cAFoB,CA3B5B,SA2BQgB,MA3BR,wCA+BqBA,CAAAA,MAAM,CAACR,IAAP,EA/BrB,SA+BQC,IA/BR,gBAiCI6C,kBAAkB,CAAC7C,IAAI,CAACO,MAAN,CAAlB,CACAwC,qBAAqB,CAAC,KAAD,CAArB,CAlCJ,yDA7S2C,mDAkV3C,QAASqC,CAAAA,0BAAT,CAAoCC,OAApC,CAA6CC,aAA7C,CAA4D,CACxD,GAAI,CAACA,aAAL,CAAoB,CAChB,MAAO,EAAP,CACH,CAED,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,aAAa,CAACE,MAAlC,CAA0CD,CAAC,EAA3C,CAA+C,CAC3C/G,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAiC6G,aAAa,CAACC,CAAD,CAA9C,EACA/G,OAAO,CAACC,GAAR,CAAY,WAAZ,CAAyB4G,OAAzB,EAEA,GAAIC,aAAa,CAACC,CAAD,CAAb,CAAiBnH,QAAjB,GAA8BiH,OAAlC,CAA2C,CACvC7G,OAAO,CAACC,GAAR,CAAY,SAAZ,EACAD,OAAO,CAACC,GAAR,CACI,qCADJ,CAEI6G,aAAa,CAACC,CAAD,CAAb,CAAiBE,iBAFrB,EAIA,MAAOH,CAAAA,aAAa,CAACC,CAAD,CAApB,CACA;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAEa,CAjBD,IAiBO,CACH/G,OAAO,CAACC,GAAR,CAAY,aAAZ,EACH,CACJ,CACD,MAAO,EAAP,CACH,CAID,gBAA4D/C,QAAQ,CAAC,KAAD,CAApE,2CAAKgK,uBAAL,gBAA8BC,0BAA9B,gBArX2C,QAuX5BC,CAAAA,eAvX4B,0JAuX3C,kBAA+Bd,UAA/B,wLACItG,OAAO,CAACC,GAAR,CAAY,+BAAZ,EACAwE,iBAAiB,CAAC,EAAD,CAAjB,CAEAzE,OAAO,CAACC,GAAR,CAAY,cAAgBqG,UAA5B,EAJJ,GAKSA,UALT,0BAMQY,uBAAuB,CAAG,KAA1B,CACAC,0BAA0B,CAAC,KAAD,CAA1B,CAPR,yCAWQZ,MAXR,CAWiB,CACThH,IAAI,CAAE+G,UADG,CAXjB,CAeI,GAAIlH,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAJ,CAA6B,CACzBkH,MAAM,CAAC3G,QAAP,CAAkBR,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAlB,CACH,CAGGmH,WApBR,CAoBsBX,yBAAyB,CAACU,MAAD,CApB/C,CAqBI,GAAIC,WAAW,GAAK,EAApB,CAAwB,CACpBA,WAAW,CAAG,IAAMA,WAApB,CACH,CAEKzF,cAzBV,CAyB2B,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAELwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFV,CAFU,CAzB3B,CAiCQqH,MAjCR,CAiCiB,8FAjCjB,CAkCI7B,oBAAoB,CAAC,IAAD,CAApB,CAlCJ,wBAmCuB3D,CAAAA,KAAK,CACpB,eAAiBwF,MAAjB,CAA0BF,WAA1B,CAAwC,YADpB,CAEpBzF,cAFoB,CAnC5B,SAmCQgB,MAnCR,wCAuCqBA,CAAAA,MAAM,CAACR,IAAP,EAvCrB,SAuCQC,IAvCR,gBAyCQW,QAzCR,CAyCmBX,IAAI,CAACO,MAzCxB,MA0CQ,CAACI,QAAD,EAAaA,QAAQ,CAAC6E,MAAT,GAAoB,CA1CzC,4BA2CQE,uBAAuB,CAAG,KAA1B,CACAC,0BAA0B,CAAC,KAAD,CAA1B,CACAtC,oBAAoB,CAAC,KAAD,CAApB,CA7CR,0CAiDIqC,uBAAuB,CAAG,IAA1B,CACAC,0BAA0B,CAAC,IAAD,CAA1B,CACA1C,iBAAiB,CAACtC,QAAD,CAAjB,CACA0C,oBAAoB,CAAC,KAAD,CAApB,CApDJ,yDAvX2C,0DA+a5BwC,CAAAA,mBA/a4B,sKA+a3C,kBAAmCC,OAAnC,oKACI9H,QAAQ,CAAC8H,OAAT,CAAmBA,OAAnB,CACA5H,WAAW,kBAAMF,QAAN,EAAX,CACAQ,OAAO,CAACC,GAAR,CAAY,4BAAZ,EACA0B,MAAM,CAAC,UAAD,CAAN,CAAqB,EAArB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEA3B,OAAO,CAACC,GAAR,CAAY,WAAaT,QAAQ,CAAC8H,OAAlC,EAPJ,GAQS9H,QAAQ,CAAC8H,OARlB,mEAYI,GAAI9H,QAAQ,CAAC8H,OAAT,CAAiBN,MAAjB,GAA4B,EAAhC,CAAoC,CAChCxH,QAAQ,CAAC8H,OAAT,CAAmB9H,QAAQ,CAAC8H,OAAT,CAAiBC,KAAjB,CAAuB,CAAvB,CAA0B,CAAC,CAA3B,CAAnB,CACH,CAEKxG,cAhBV,CAgB2B,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAELwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFV,CAFU,CAhB3B,CAyBQqH,MAzBR,CAyBiB,qGAzBjB,yBA0BuBxF,CAAAA,KAAK,CACpB,uBAAyB1B,QAAQ,CAAC8H,OAAlC,CAA4C,GAA5C,CAAkDZ,MAD9B,CAEpB3F,cAFoB,CA1B5B,SA0BQgB,MA1BR,wCA8BqBA,CAAAA,MAAM,CAACR,IAAP,EA9BrB,SA8BQC,IA9BR,gBAiCQgG,OAjCR,CAiCkBhG,IAAI,CAACO,MAjCvB,CAkCI,GAAIyF,OAAJ,CAAa,CACTC,UAAU,CAACD,OAAD,CAAV,CACH,CAFD,IAEO,CACH7F,MAAM,CAAC,UAAD,CAAN,CAAqB,mBAAqBnC,QAAQ,CAAC8H,OAAnD,CACAxF,SAAS,kBAAMH,MAAN,EAAT,CACH,CAEDnC,QAAQ,CAAC8H,OAAT,CAAmB,EAAnB,CACA5H,WAAW,kBAAMF,QAAN,EAAX,CA1CJ,yDA/a2C,8DA6d5BkI,CAAAA,YA7d4B,iJA6d3C,kBAA4BpB,UAA5B,+KACItG,OAAO,CAACC,GAAR,CAAY,4BAAZ,EACA8E,yBAAyB,CAAC,EAAD,CAAzB,CAEA/E,OAAO,CAACC,GAAR,CAAY,cAAgBqG,UAA5B,EAJJ,GAKSA,UALT,mEASQC,MATR,CASiB,CACThH,IAAI,CAAE+G,UADG,CATjB,CAYQE,WAZR,CAYsBX,yBAAyB,CAACU,MAAD,CAZ/C,CAaI,GAAIC,WAAW,GAAK,EAApB,CAAwB,CACpBA,WAAW,CAAG,IAAMA,WAApB,CACH,CAEKzF,cAjBV,CAiB2B,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAELwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFV,CAFU,CAjB3B,CAyBQqH,MAzBR,CAyBiB,gBAzBjB,CA0BIzB,4BAA4B,CAAC,IAAD,CAA5B,CA1BJ,wBA2BuB/D,CAAAA,KAAK,CACpB,YAAcwF,MAAd,CAAuBF,WADH,CAEpBzF,cAFoB,CA3B5B,SA2BQgB,MA3BR,wCA+BqBA,CAAAA,MAAM,CAACR,IAAP,EA/BrB,SA+BQC,IA/BR,gBAiCIuD,yBAAyB,CAACvD,IAAI,CAACO,MAAN,CAAzB,CACAkD,4BAA4B,CAAC,KAAD,CAA5B,CAlCJ,yDA7d2C,uDAkgB5B0C,CAAAA,iBAlgB4B,gKAkgB3C,kBAAiCrB,UAAjC,+KACItG,OAAO,CAACC,GAAR,CAAY,iCAAZ,EACAkF,8BAA8B,CAAC,EAAD,CAA9B,CAEAnF,OAAO,CAACC,GAAR,CAAY,cAAgBqG,UAA5B,EAJJ,GAKSA,UALT,mEASQC,MATR,CASiB,CACThH,IAAI,CAAE+G,UADG,CATjB,CAYQE,WAZR,CAYsBX,yBAAyB,CAACU,MAAD,CAZ/C,CAaI,GAAIC,WAAW,GAAK,EAApB,CAAwB,CACpBA,WAAW,CAAG,IAAMA,WAApB,CACH,CAEKzF,cAjBV,CAiB2B,CACnBC,MAAM,CAAE,KADW,CAEnBC,OAAO,CAAE,CACL,eAAgB,kBADX,CAELwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAFV,CAFU,CAjB3B,CAyBQqH,MAzBR,CAyBiB,gBAzBjB,CA0BInB,iCAAiC,CAAC,IAAD,CAAjC,CA1BJ,wBA2BuBrE,CAAAA,KAAK,CACpB,iBAAmBwF,MAAnB,CAA4BF,WADR,CAEpBzF,cAFoB,CA3B5B,SA2BQgB,MA3BR,wCA+BqBA,CAAAA,MAAM,CAACR,IAAP,EA/BrB,SA+BQC,IA/BR,gBAiCI2D,8BAA8B,CAAC3D,IAAI,CAACO,MAAN,CAA9B,CACAwD,iCAAiC,CAAC,KAAD,CAAjC,CAlCJ,yDAlgB2C,oDAuiB3C,QAASqC,CAAAA,YAAT,CAAsBjF,KAAtB,CAA6B,CACzBA,KAAK,CAACY,cAAN,GAEA/D,QAAQ,CAAC2C,QAAT,CAAoB,EAApB,CACA,IAAK,GAAI4E,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGjI,gBAAgB,CAACkI,MAArC,CAA6CD,CAAC,EAA9C,CAAkD,CAC9CvH,QAAQ,CAAC2C,QAAT,CAAkB0F,IAAlB,CAAuB,CACnBC,UAAU,CAAEhJ,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBe,UADb,CAEnBC,QAAQ,CAAEhI,UAAU,CAACjB,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBgB,QAArB,CAFD,CAGnBC,UAAU,CAAEjI,UAAU,CAACjB,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBiB,UAArB,CAHH,CAInBC,IAAI,CAAEnJ,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBkB,IAJP,CAAvB,EAMH,CAGD,GAAI,CAACzI,QAAQ,CAACa,sBAAV,EAAoCb,QAAQ,CAACa,sBAAT,GAAoC,CAA5E,CAA+E,CAC3EsB,MAAM,CAAC,wBAAD,CAAN,CAAmC,kCAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAInC,QAAQ,CAACiB,cAAT,GAA4B,gBAA5B,EAAgD,CAACjB,QAAQ,CAACc,sBAA1D,EAAoFd,QAAQ,CAACc,sBAAT,GAAoC,CAA5H,CAA+H,CAC3HqB,MAAM,CAAC,wBAAD,CAAN,CAAmC,gCAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAInC,QAAQ,CAACiB,cAAT,GAA4B,gBAA5B,EAAgDjB,QAAQ,CAACc,sBAAT,EAAmC,CAAvF,CAA0F,CACtFqB,MAAM,CAAC,wBAAD,CAAN,CAAmC,gCAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAInC,QAAQ,CAACiB,cAAT,GAA4B,gBAA5B,EAAgDjB,QAAQ,CAACc,sBAAT,EAAmC4H,QAAvF,CAAiG,CAC7FvG,MAAM,CAAC,wBAAD,CAAN,CAAmC,gCAAkCuG,QAArE,CACApG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAEDA,MAAM,CAAC,gBAAD,CAAN,CAA2B,EAA3B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,GAAI,CAACnC,QAAQ,CAACX,EAAV,EAAgBW,QAAQ,CAACiB,cAAT,EAA2B,UAA3C,EAAyD,CAACjB,QAAQ,CAACgB,cAAvE,CAAuF,CACnFmB,MAAM,CAAC,gBAAD,CAAN,CAA2B,4BAA3B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAI,CAACnC,QAAQ,CAACW,QAAV,EAAsBX,QAAQ,CAACW,QAAT,GAAsB,CAAhD,CAAmD,CAC/CwB,MAAM,CAAC,UAAD,CAAN,CAAqB,kBAArB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAI,CAACnC,QAAQ,CAACY,gBAAV,EAA8BZ,QAAQ,CAACY,gBAAT,GAA8B,CAAhE,CAAmE,CAC/DuB,MAAM,CAAC,kBAAD,CAAN,CAA6B,0BAA7B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAI5B,UAAU,CAACP,QAAQ,CAACY,gBAAV,CAAV,CAAwC,GAA5C,CAAiD,CAC7CuB,MAAM,CAAC,kBAAD,CAAN,CAA6B,kCAA7B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAI,CAACnC,QAAQ,CAACM,WAAV,EAAyBN,QAAQ,CAACM,WAAT,GAAyB,CAAtD,CAAyD,CACrD6B,MAAM,CAAC,aAAD,CAAN,CAAwB,qBAAxB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAIDnC,QAAQ,CAACW,QAAT,CAAoBJ,UAAU,CAACP,QAAQ,CAACW,QAAV,CAA9B,CACAX,QAAQ,CAACY,gBAAT,CAA4BL,UAAU,CAACP,QAAQ,CAACY,gBAAV,CAAtC,CACAZ,QAAQ,CAACM,WAAT,CAAuBC,UAAU,CAACP,QAAQ,CAACM,WAAV,CAAjC,CACAN,QAAQ,CAACc,sBAAT,CAAkCP,UAAU,CAACP,QAAQ,CAACc,sBAAV,CAA5C,CAEA,GAAIlB,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAJ,CAA6B,CACzBG,QAAQ,CAACI,QAAT,CAAoBR,OAAO,CAACC,GAAR,CAAY,UAAZ,CAApB,CACH,CAGD,GAAI8I,CAAAA,QAAQ,CAAG,WAAf,CACA,GAAInH,CAAAA,MAAM,CAAG,MAAb,CACA,GAAIxB,QAAQ,CAACX,EAAb,CAAiB,CACbsJ,QAAQ,CAAG,aAAe3I,QAAQ,CAACX,EAAnC,CACAmC,MAAM,CAAG,KAAT,CACH,CAED,GAAMD,CAAAA,cAAc,CAAG,CACnBC,MAAM,CAAEA,MADW,CAEnBC,OAAO,CAAE,CACL,SAAU,kBADL,CAEL,eAAgB,kBAFX,CAGLwF,aAAa,CAAErH,OAAO,CAACC,GAAR,CAAY,cAAZ,CAHV,CAFU,CAOnB+I,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe9I,QAAf,CAPa,CAAvB,CAUAQ,OAAO,CAACC,GAAR,CAAY,WAAZ,CAAyBT,QAAzB,EAEAiD,aAAa,CAAC,IAAD,CAAb,CACAvB,KAAK,CAACiH,QAAD,CAAWpH,cAAX,CAAL,CACKI,IADL,2FACU,kBAAOC,QAAP,uKACIC,MADJ,yBACaD,QAAQ,CAACH,OAAT,CACV5B,GADU,CACN,cADM,CADb,iDACa,uBAETiC,QAFS,CAEA,kBAFA,CADb,cAIWD,MAJX,kEAI4BD,CAAAA,QAAQ,CAACG,IAAT,EAJ5B,2CAIIC,IAJJ,iBAOGJ,QAAQ,CAACK,EAPZ,2BAQE;AACMC,KATR,CASgBF,IAAI,EAAIA,IAAI,CAACG,MAT7B,CAUE;AAVF,iCAWSC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAXT,UAcFI,SAAS,CAAC,EAAD,CAAT,CACAW,aAAa,CAAC,KAAD,CAAb,CAEAzC,OAAO,CAACC,GAAR,CAAY,WAAZ,EACAD,OAAO,CAACC,GAAR,CAAYuB,IAAZ,EACA9C,KAAK,CAAC6J,gBAAN,CAAuB,6BAAvB,CAAsD,SAAtD,EACA,GAAI7J,KAAK,CAAC8J,WAAV,CAAuB,CACnB9J,KAAK,CAAC8J,WAAN,GACH,CAED/C,WAAW,GACXjG,QAAQ,CAAC2C,QAAT,CAAoB,EAApB,CACArD,gBAAgB,CAAG,EAAnB,CACAC,mBAAmB,CAAC,EAAD,CAAnB,CACAS,QAAQ,CAAC8C,WAAT,CAAuB,EAAvB,CACAnD,oBAAoB,CAAC,EAAD,CAApB,CACAO,WAAW,kBAAMF,QAAN,EAAX,CACAqB,WAAW,GAEX4H,eAAe,CAACjH,IAAI,CAACO,MAAL,CAAYlD,EAAb,CAAf,CAjCE,yDADV,kEAoCK2D,KApCL,CAoCW,SAACd,KAAD,CAAW,CACde,aAAa,CAAC,KAAD,CAAb,CACAzC,OAAO,CAACC,GAAR,CAAY,cAAZ,EACAD,OAAO,CAACC,GAAR,CAAYyB,KAAZ,EACAI,SAAS,kBAAMJ,KAAN,EAAT,CACA1B,OAAO,CAAC0B,KAAR,CAAc,qBAAd,CAAqCA,KAArC,EACAhD,KAAK,CAAC6J,gBAAN,CAAuB,uBAAvB,CAAgD,QAAhD,EACH,CA3CL,EA4CH,CAED,QAASG,CAAAA,eAAT,CAAyBC,SAAzB,CAAoC,CAChC,IAAK,GAAI5B,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGjI,gBAAgB,CAACkI,MAArC,CAA6CD,CAAC,EAA9C,CAAkD,CAC9C,GAAIjI,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBe,UAApB,GAAmCa,SAAvC,CAAkD,CAC9C,MAAO5B,CAAAA,CAAP,CACH,CACJ,CACD,MAAO,MAAP,CACH,CAGD,QAAS6B,CAAAA,cAAT,CAAwBD,SAAxB,CAAmC,CAC/B,IAAK,GAAI5B,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGjI,gBAAgB,CAACkI,MAArC,CAA6CD,CAAC,EAA9C,CAAkD,CAC9C,GAAIjI,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBe,UAApB,GAAmCa,SAAvC,CAAkD,CAC9C,MAAO,KAAP,CACH,CACJ,CACD,MAAO,MAAP,CACH,CAED,QAASE,CAAAA,sBAAT,CAAgChC,OAAhC,CAAyCC,aAAzC,CAAwD,CACpD,GAAI,CAACA,aAAL,CAAoB,CAChB,MAAO,IAAP,CACH,CAED,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,aAAa,CAACE,MAAlC,CAA0CD,CAAC,EAA3C,CAA+C,CAC3C,GAAID,aAAa,CAACC,CAAD,CAAb,CAAiBnH,QAAjB,GAA8BiH,OAAlC,CAA2C,CACvC,MAAOC,CAAAA,aAAa,CAACC,CAAD,CAAb,CAAiB+B,KAAxB,CACH,CACJ,CACD,MAAO,IAAP,CACH,CAED,QAASrB,CAAAA,UAAT,CAAoBD,OAApB,CAA6B,CACzBxH,OAAO,CAACC,GAAR,CAAY,oBAAZ,EACA,GAAI,CAACT,QAAQ,CAACI,QAAd,CAAwB,CACpB+B,MAAM,CAACmG,UAAP,CAAoB,qCAApB,CACAhG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAGDA,MAAM,CAACmG,UAAP,CAAoB,EAApB,CACA,GAAI,CAACN,OAAL,CAAc,CACV7F,MAAM,CAACmG,UAAP,CAAoB,iBAApB,CACAhG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED;AACR;AACA;AACA;AACA;AACA,UArBiC,CAsBzB;AAEA,GAAI6F,OAAO,CAACuB,cAAR,CAAuBvJ,QAAQ,CAACI,QAAhC,CAAJ,CAA+C,CAC3C4H,OAAO,CAACQ,UAAR,CAAqBR,OAAO,CAACuB,cAAR,CAAuBvJ,QAAQ,CAACI,QAAhC,EAA0CqH,iBAA/D,CACH,CAGDtF,MAAM,CAACqG,UAAP,CAAoB,EAApB,CACA,GAAI,CAACR,OAAO,CAACQ,UAAb,CAAyB,CACrBrG,MAAM,CAACqG,UAAP,CAAoB,oBAApB,CACAlG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED,GAAIqH,CAAAA,YAAY,CAAG,KAAnB,CACA,GAAIjG,CAAAA,KAAK,CAAG,KAAZ,CACA,GAAIgF,CAAAA,QAAQ,CAAG,IAAf,CACAP,OAAO,CAACO,QAAR,CAAmB,IAAnB,CAGA,GAAIa,cAAc,CAACpB,OAAO,CAAC3I,EAAT,CAAlB,CAAgC,CAC5BmK,YAAY,CAAG,IAAf,CACAjG,KAAK,CAAG2F,eAAe,CAAClB,OAAO,CAAC3I,EAAT,CAAvB,CACAkJ,QAAQ,CAAGhI,UAAU,CAACjB,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAxB,CAAmCP,OAAO,CAACO,QAA5C,CAArB,CACH,CAJD,IAIO,CACHA,QAAQ,CAAGhI,UAAU,CAACyH,OAAO,CAACO,QAAT,CAArB,CACH,CAED/H,OAAO,CAACC,GAAR,CAAY,WAAZ,CAAyB8H,QAAzB,EAEApG,MAAM,CAACoG,QAAP,CAAkB,EAAlB,CAEA;AACA,GAAIe,CAAAA,KAAK,CAAG,CAAZ,CAEA,GAAItB,OAAO,CAACuB,cAAR,CAAuBvJ,QAAQ,CAACI,QAAhC,CAAJ,CAA+C,CAC3CkJ,KAAK,CAAGtB,OAAO,CAACuB,cAAR,CAAuBvJ,QAAQ,CAACI,QAAhC,EAA0CkJ,KAAlD,CACH,CAED,GAAIA,KAAK,CAAGf,QAAZ,CAAsB,CAClB,GAAIhF,KAAK,GAAK,KAAd,CAAqB,CACjBA,KAAK,CAAGjE,gBAAgB,CAACkI,MAAzB,CACH,CACD;AACArF,MAAM,CAAC,YAAcoB,KAAf,CAAN,CAA8B,+BAAiC+F,KAA/D,CACA9I,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB0B,MAAvB,EACAG,SAAS,kBAAMH,MAAN,EAAT,CACH,CAED,GAAIqH,YAAJ,CAAkB,CACdlK,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAxB,CAAmChI,UAAU,CAACgI,QAAD,CAA7C,CACH,CAED,GAAI,CAACiB,YAAL,CAAmB,CACflK,gBAAgB,CAAC+I,IAAjB,CAAsB,CAClBC,UAAU,CAAEN,OAAO,CAAC3I,EADF,CAElB+D,IAAI,CAAE4E,OAAO,CAACyB,SAFI,CAGlBC,WAAW,CAAE1B,OAAO,CAAC0B,WAHH,CAIlB3J,IAAI,CAAEiI,OAAO,CAACjI,IAJI,CAKlBwI,QAAQ,CAAEP,OAAO,CAACO,QALA,CAMlBgB,cAAc,CAAEvB,OAAO,CAACuB,cANN,CAOlBf,UAAU,CAAEjI,UAAU,CAACyH,OAAO,CAACQ,UAAT,CAAV,CAA+BmB,OAA/B,CAAuC,CAAvC,CAPM,CAQlBlB,IAAI,CAAET,OAAO,CAACS,IARI,CAAtB,EAUH,CACDlJ,mBAAmB,oBAAKD,gBAAL,EAAnB,CACA+B,WAAW,GACd,CAED,QAASuI,CAAAA,aAAT,CAAuB5B,OAAvB,CAAgC,CAC5B,GAAMzE,CAAAA,KAAK,CAAGjE,gBAAgB,CAACoE,OAAjB,CAAyBsE,OAAzB,CAAd,CACA,GAAIzE,KAAK,CAAG,CAAC,CAAb,CAAgB,CACZjE,gBAAgB,CAACuK,MAAjB,CAAwBtG,KAAxB,CAA+B,CAA/B,EACH,CACDhE,mBAAmB,oBAAKD,gBAAL,EAAnB,CAEA+B,WAAW,GACd,CAED,gBAAkC3D,QAAQ,CAAC,GAAD,CAA1C,2CAAKoM,UAAL,gBAAiBC,aAAjB,gBAEA,QAASC,CAAAA,cAAT,EAA0B,CACtBF,UAAU,CAAG,IAAb,CACA,IAAK,GAAIvC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGjI,gBAAgB,CAACkI,MAArC,CAA6CD,CAAC,EAA9C,CAAkD,CAC9CuC,UAAU,EACNvJ,UAAU,CAACjB,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBiB,UAArB,CAAV,CACAjI,UAAU,CAACjB,gBAAgB,CAACiI,CAAD,CAAhB,CAAoBgB,QAArB,CAFd,CAGH,CACDuB,UAAU,CAAGA,UAAU,CAACH,OAAX,CAAmB,CAAnB,CAAb,CACAI,aAAa,CAACD,UAAD,CAAb,CACH,CAED,gBAA8BpM,QAAQ,CAAC,IAAD,CAAtC,2CAAKuM,QAAL,gBAAeC,WAAf,gBAEA,QAASC,CAAAA,YAAT,EAAwB,CACpBF,QAAQ,CAAG,IAAX,CACA,GAAIH,UAAU,CAAG,CAAjB,CAAoB,CAChBG,QAAQ,CAAG,CAAC1J,UAAU,CAAEA,UAAU,CAACP,QAAQ,CAACM,WAAV,CAAV,CAAmC,GAArC,CAAV,EAAwDC,UAAU,CAACuJ,UAAD,CAAV,CAAyBvJ,UAAU,CAACP,QAAQ,CAACa,sBAAV,CAAnC,CAAuEN,UAAU,CAACP,QAAQ,CAACW,QAAV,CAAzI,CAAD,EAAgKgJ,OAAhK,CAAwK,CAAxK,CAAX,CAAsL,CACtLnJ,OAAO,CAACC,GAAR,CAAY,WAAZ,CAAyBwJ,QAAzB,EACH,CACDC,WAAW,CAACD,QAAD,CAAX,CACH,CAED,gBAA8BvM,QAAQ,CAAC,IAAD,CAAtC,2CAAKgL,QAAL,gBAAe0B,WAAf,gBAEA,QAASC,CAAAA,YAAT,EAAwB,CACpB3B,QAAQ,CAAG,IAAX,CACA,GAAIoB,UAAU,CAAG,CAAjB,CAAoB,CAChBpB,QAAQ,CAAG,CAACnI,UAAU,CAACuJ,UAAD,CAAV,CAAyBvJ,UAAU,CAACP,QAAQ,CAACa,sBAAV,CAAnC,CAAuEN,UAAU,CAACP,QAAQ,CAACW,QAAV,CAAjF,CAAuGJ,UAAU,CAAC0J,QAAD,CAAlH,EAA8HN,OAA9H,CAAsI,CAAtI,CAAX,CACH,CACDS,WAAW,CAAC1B,QAAD,CAAX,CAEH,CAED,gBAA4ChL,QAAQ,CAAC,IAAD,CAApD,2CAAK4M,eAAL,gBAAsBC,kBAAtB,gBAEA,QAASC,CAAAA,mBAAT,EAA+B,CAC3B,GAAIxK,QAAQ,CAACW,QAAT,EAAqB,CAArB,EAA0BmJ,UAAU,CAAG,CAA3C,CAA8C,CAC1CQ,eAAe,CAAG/J,UAAU,CAACA,UAAU,CAACP,QAAQ,CAACW,QAAT,CAAoBmJ,UAArB,CAAV,CAA6C,GAA9C,CAAV,CAA6DH,OAA7D,CAAqE,CAArE,CAAlB,CACAY,kBAAkB,CAACD,eAAD,CAAlB,CACAtK,QAAQ,CAACY,gBAAT,CAA4B0J,eAA5B,CACApK,WAAW,kBAAMF,QAAN,EAAX,CACH,CACJ,CAED,QAASyK,CAAAA,YAAT,EAAwB,CACpB,GAAIzK,QAAQ,CAACY,gBAAT,EAA6B,CAA7B,EAAkCkJ,UAAU,CAAG,CAAnD,CAAsD,CAClD9J,QAAQ,CAACW,QAAT,CAAoBJ,UAAU,CAACuJ,UAAU,CAAGvJ,UAAU,CAACP,QAAQ,CAACY,gBAAT,CAA4B,GAA7B,CAAxB,CAAV,CAAqE+I,OAArE,CAA6E,CAA7E,CAApB,CACAzJ,WAAW,kBAAMF,QAAN,EAAX,CACH,CACJ,CAGD,QAASqB,CAAAA,WAAT,EAAuB,CACnB2I,cAAc,GACd,GAAIhK,QAAQ,CAACyC,mBAAb,CAAkC,CAC9BgI,YAAY,GACf,CAFD,IAEO,CACHD,mBAAmB,GACtB,CACDL,YAAY,GACZE,YAAY,GACf,CAED,GAAMK,CAAAA,cAAc,CAAG9M,MAAM,EAA7B,CACA,QAASqL,CAAAA,eAAT,CAAyB5J,EAAzB,CAA6B,CACzBqL,cAAc,CAACC,OAAf,CAAuBvL,IAAvB,CAA4BC,EAA5B,EACH,CAED,GAAMuL,CAAAA,kBAAkB,CAAGhN,MAAM,EAAjC,CACA,QAASiN,CAAAA,mBAAT,EAA+B,CAC3BD,kBAAkB,CAACD,OAAnB,CAA2BvL,IAA3B,GACH,CAED,GAAM0L,CAAAA,qBAAqB,CAAGlN,MAAM,EAApC,CACA,QAASmN,CAAAA,sBAAT,EAAkC,CAC9BD,qBAAqB,CAACH,OAAtB,CAA8BvL,IAA9B,GACH,CAED,GAAM4L,CAAAA,oBAAoB,CAAGpN,MAAM,EAAnC,CACA,QAASqN,CAAAA,qBAAT,EAAiC,CAC7BD,oBAAoB,CAACL,OAArB,CAA6BvL,IAA7B,GACH,CAGD,GAAM8L,CAAAA,iBAAiB,CAAGtN,MAAM,EAAhC,CACA,QAASuN,CAAAA,kBAAT,EAA8B,CAC1BD,iBAAiB,CAACP,OAAlB,CAA0BvL,IAA1B,GACH,CAGD,GAAMgM,CAAAA,sBAAsB,CAAGxN,MAAM,EAArC,CACA,QAASyN,CAAAA,uBAAT,EAAmC,CAC/BD,sBAAsB,CAACT,OAAvB,CAA+BvL,IAA/B,GACH,CAGD,GAAMkM,CAAAA,qBAAqB,CAAG1N,MAAM,EAApC,CACA,QAAS2N,CAAAA,sBAAT,CAAgClM,EAAhC,CAAoC,CAChCiM,qBAAqB,CAACX,OAAtB,CAA8BvL,IAA9B,CAAmCC,EAAnC,EACH,CAGD,mBACI,wCAeI,KAAC,SAAD,EAAW,GAAG,CAAEqL,cAAhB,CAAgC,cAAc,CAAExL,KAAK,CAACsM,cAAtD,EAfJ,cAgBI,KAAC,WAAD,EAAa,GAAG,CAAEF,qBAAlB,EAhBJ,cAiBI,KAAC,WAAD,EAAa,GAAG,CAAEV,kBAAlB,CAAsC,gBAAgB,CAAE1L,KAAK,CAAC6J,gBAA9D,EAjBJ,cAkBI,KAAC,cAAD,EAAgB,GAAG,CAAE+B,qBAArB,CAA4C,gBAAgB,CAAE5L,KAAK,CAAC6J,gBAApE,EAlBJ,cAmBI,KAAC,aAAD,EAAe,GAAG,CAAEiC,oBAApB,CAA0C,gBAAgB,CAAE9L,KAAK,CAAC6J,gBAAlE,EAnBJ,cAoBI,KAAC,UAAD,EAAY,GAAG,CAAEmC,iBAAjB,CAAoC,gBAAgB,CAAEhM,KAAK,CAAC6J,gBAA5D,EApBJ,cAqBI,KAAC,eAAD,EAAiB,GAAG,CAAEqC,sBAAtB,CAA8C,gBAAgB,CAAElM,KAAK,CAAC6J,gBAAtE,EArBJ,cAwBI,MAAC,KAAD,EAAO,IAAI,CAAE/C,IAAb,CAAmB,IAAI,CAAC,IAAxB,CAA6B,UAAU,KAAvC,CACI,MAAM,CAAEC,WADZ,CACyB,SAAS,CAAE,KADpC,CAC2C,QAAQ,CAAC,QADpD,CAC6D,UAAU,CAAE,IADzE,wBAEI,MAAC,KAAD,CAAO,MAAP,yBACI,KAAC,KAAD,CAAO,KAAP,WACKjG,QAAQ,CAACX,EAAT,CAAc,uBAAyBW,QAAQ,CAACoD,IAAhD,CAAuD,wBAD5D,EADJ,cAKI,aAAK,SAAS,CAAC,6BAAf,wBACI,KAAC,YAAD,IADJ,cAEI,KAAC,MAAD,EAAQ,OAAO,CAAC,SAAhB,CAA0B,OAAO,CAAEgF,YAAnC,UACKhE,YAAY,CAAGpE,QAAQ,CAACX,EAAT,CAAc,cAAd,CAA+B,YAAlC,CAAiDW,QAAQ,CAACX,EAAT,CAAc,QAAd,CAAyB,QAD3F,EAFJ,cAOI,eACI,IAAI,CAAC,QADT,CAEI,SAAS,CAAC,WAFd,CAGI,OAAO,CAAE4G,WAHb,CAII,aAAW,OAJf,EAPJ,GALJ,GAFJ,cAsBI,MAAC,KAAD,CAAO,IAAP,YACKM,MAAM,CAACC,IAAP,CAAYrE,MAAZ,EAAoBqF,MAApB,CAA6B,CAA7B,cACG,kCACI,oBAEKrF,MAAM,EAAIoE,MAAM,CAACC,IAAP,CAAYrE,MAAZ,EAAoBsE,GAApB,CAAwB,SAACC,GAAD,CAAMnD,KAAN,CAAgB,CAC/C,MAAQpB,CAAAA,MAAM,CAACuE,GAAD,CAAN,cAAc,WAAI,KAAK,CAAE,CAAE+E,KAAK,CAAE,KAAT,CAAX,UAA8BtJ,MAAM,CAACuE,GAAD,CAApC,EAAd,CAAgE,EAAxE,CACH,CAFU,CAFf,EADJ,EADH,CAOqB,EAR1B,cAUI,cAAM,SAAS,CAAC,0BAAhB,CAA2C,QAAQ,CAAE,kBAAAgF,CAAC,CAAI,CAAEA,CAAC,CAAC3H,cAAF,GAAoBqE,YAAY,CAACsD,CAAD,CAAZ,CAAkB,CAAlG,WACK,CAAC9L,OAAO,CAACC,GAAR,CAAY,YAAZ,CAAD,cAA6B,aAAK,SAAS,CAAC,UAAf,wBAC1B,cAAO,SAAS,CAAC,YAAjB,oBAD0B,cAG1B,aAAK,SAAS,CAAC,kBAAf,wBACI,KAAC,SAAD,EACI,EAAE,CAAC,UADP,CAEI,QAAQ,CAAC,MAFb,CAGI,SAAS,CAAE6E,eAHf,CAII,SAAS,CAAEvC,MAAM,CAAC/B,QAAP,CAAkB,IAAlB,CAAyB,KAJxC,CAKI,QAAQ,CAAE,kBAACuL,aAAD,CAAmB,CACzBxJ,MAAM,CAAC/B,QAAP,CAAkB,EAAlB,CACA+B,MAAM,CAAC,YAAD,CAAN,CAAuB,EAAvB,CACAG,SAAS,CAACH,MAAD,CAAT,CACA,GAAIwJ,aAAa,CAACnE,MAAd,GAAyB,CAA7B,CAAgC,CAC5BrF,MAAM,CAAC/B,QAAP,CAAkB,wBAAlB,CACAkC,SAAS,CAACH,MAAD,CAAT,CACAjC,WAAW,kBAAMF,QAAN,EAAX,CACAP,iBAAiB,CAAC,EAAD,CAAjB,CACA,OACH,CACDO,QAAQ,CAACI,QAAT,CAAoBuL,aAAa,CAAC,CAAD,CAAb,CAAiBtM,EAArC,CACAa,WAAW,kBAAMF,QAAN,EAAX,CACAQ,OAAO,CAACC,GAAR,CAAY,oBAAZ,CAAkCT,QAAQ,CAACI,QAA3C,EACAZ,cAAc,CAAGmM,aAAjB,CACAlM,iBAAiB,oBAAKkM,aAAL,EAAjB,CAEA,GAAI3L,QAAQ,CAACI,QAAb,CAAuB,CACnB,GAAI8E,eAAe,CAAC,CAAD,CAAf,EAAsBA,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAzC,EAA2DrE,eAAe,CAAC,CAAD,CAAf,CAAmBqD,QAAlF,CAA4F,CACxF,GAAIe,CAAAA,KAAK,CAAG,CAAZ,CACA,GAAIpE,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAvB,CAAuC,CACnC;AACA,GAAIrE,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAnB,CAAkCvJ,QAAQ,CAACI,QAA3C,CAAJ,CAA0D,CACtDkJ,KAAK,CAAGpE,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAnB,CAAkCvJ,QAAQ,CAACI,QAA3C,EAAqDkJ,KAA7D,CACH,CACJ,CAED,GAAIA,KAAK,CAAG/I,UAAU,CAAC2E,eAAe,CAAC,CAAD,CAAf,CAAmBqD,QAApB,CAAtB,CAAqD,CACjD,GAAI/I,cAAc,CAAC,CAAD,CAAlB,CAAuB,CACnB2C,MAAM,CAACmG,UAAP,CAAoB,iBAAmBgB,KAAnB,CAA2B,aAA3B,CAA2C9J,cAAc,CAAC,CAAD,CAAd,CAAkBO,IAA7D,CAAoE,mBAAxF,CACH,CAFD,IAEO,CACHoC,MAAM,CAACmG,UAAP,CAAoB,iBAAmBgB,KAAnB,CAA2B,qCAA/C,CACH,CAEDhH,SAAS,kBAAMH,MAAN,EAAT,CACH,CACJ,CAlBD,IAkBO,IAAI+C,eAAe,CAAC,CAAD,CAAf,EAAsBA,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAA7C,CAA6D,CAChE,GAAID,CAAAA,MAAK,CAAG,CAAZ,CACA;AACA,GAAIpE,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAnB,CAAkCvJ,QAAQ,CAACI,QAA3C,CAAJ,CAA0D,CACtDkJ,MAAK,CAAGpE,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAnB,CAAkCvJ,QAAQ,CAACI,QAA3C,EAAqDkJ,KAA7D,CACH,CAED,GAAIA,MAAK,GAAK,CAAd,CAAiB,CACb,GAAI9J,cAAc,CAAC,CAAD,CAAlB,CAAuB,CACnB2C,MAAM,CAAC,YAAD,CAAN,CAAuB,2CAA6C3C,cAAc,CAAC,CAAD,CAAd,CAAkBO,IAAtF,CACH,CAFD,IAEO,CACHoC,MAAM,CAAC,YAAD,CAAN,CAAuB,kDAAvB,CACH,CACDG,SAAS,kBAAMH,MAAN,EAAT,CACH,CACJ,CAED,GAAI+C,eAAe,CAAC,CAAD,CAAnB,CAAwB,CACpB;AAChD;AACA;AACA;AACA;AACA,kDACgD,GAAIA,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAnB,CAAkCvJ,QAAQ,CAACI,QAA3C,CAAJ,CAA0D,CACtD8E,eAAe,CAAC,CAAD,CAAf,CAAmBsD,UAAnB,CAAgCtD,eAAe,CAAC,CAAD,CAAf,CAAmBqE,cAAnB,CAAkCvJ,QAAQ,CAACI,QAA3C,EAAqDqH,iBAArF,CACH,CAGD,GAAI,CAACvC,eAAe,CAAC,CAAD,CAAf,CAAmBqD,QAAxB,CAAkC,CAC9BrD,eAAe,CAAC,CAAD,CAAf,CAAmBqD,QAAnB,CAA8B,CAA9B,CACH,CACDpD,kBAAkB,oBAAKD,eAAL,EAAlB,CACH,CAEJ,CAEJ,CA9EL,CAgFI,OAAO,CAAEV,YAhFb,CAiFI,WAAW,CAAC,cAjFhB,CAkFI,QAAQ,CAAEhF,cAlFd,CAmFI,mBAAmB,CAAE,IAnFzB,CAoFI,aAAa,CAAE,uBAACsH,UAAD,CAAa4E,CAAb,CAAmB,CAC9B7E,aAAa,CAACC,UAAD,CAAb,CACH,CAtFL,EADJ,cA0FI,MAAC,MAAD,EAAQ,IAAI,CAAE,KAAK8E,QAAL,EAAd,CAA+B,OAAO,CAAEf,mBAAxC,CAA6D,SAAS,CAAC,8CAAvE,CAAsH,IAAI,CAAC,QAA3H,CAAoI,EAAE,CAAC,eAAvI,4BAAwJ,UAAG,SAAS,CAAC,eAAb,EAAxJ,UA1FJ,cA2FI,aAAK,KAAK,CAAE,CAAEY,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,SAAb,eADJ,CAEKtJ,MAAM,CAAC/B,QAFZ,GA3FJ,GAH0B,GAA7B,CAmGQ,EApGb,cAqGI,aAAK,SAAS,CAAC,UAAf,wBACI,cAAO,SAAS,CAAC,YAAjB,uBADJ,cAGI,aAAK,SAAS,CAAC,kBAAf,wBACI,KAAC,SAAD,EACI,EAAE,CAAC,aADP,CAEI,QAAQ,CAAC,cAFb,CAGI,SAAS,CAAE0E,kBAHf,CAII,SAAS,CAAE3C,MAAM,CAACW,WAAP,CAAqB,IAArB,CAA4B,KAJ3C,CAKI,QAAQ,CAAE,kBAAC6I,aAAD,CAAmB,CACzBxJ,MAAM,CAACW,WAAP,CAAqB,EAArB,CACAR,SAAS,CAACH,MAAD,CAAT,CACA,GAAIwJ,aAAa,CAACnE,MAAd,GAAyB,CAA7B,CAAgC,CAC5BrF,MAAM,CAACW,WAAP,CAAqB,2BAArB,CACAR,SAAS,CAACH,MAAD,CAAT,CACAnC,QAAQ,CAAC8C,WAAT,CAAuB,EAAvB,CACA5C,WAAW,kBAAMF,QAAN,EAAX,CACAL,oBAAoB,CAAC,EAAD,CAApB,CACA,OACH,CACDK,QAAQ,CAAC8C,WAAT,CAAuB6I,aAAa,CAAC,CAAD,CAAb,CAAiBtM,EAAxC,CACAa,WAAW,kBAAMF,QAAN,EAAX,CACAL,oBAAoB,CAACgM,aAAD,CAApB,CACH,CAnBL,CAoBI,OAAO,CAAE/G,eApBb,CAqBI,WAAW,CAAC,kBArBhB,CAsBI,QAAQ,CAAElF,iBAtBd,CAuBI,mBAAmB,CAAE,IAvBzB,CAwBI,aAAa,CAAE,uBAACoH,UAAD,CAAa4E,CAAb,CAAmB,CAC9BvE,gBAAgB,CAACL,UAAD,CAAhB,CACH,CA1BL,EADJ,cA6BI,MAAC,MAAD,EAAQ,IAAI,CAAE,KAAK8E,QAAL,EAAd,CAA+B,OAAO,CAAEb,sBAAxC,CAAgE,SAAS,CAAC,8CAA1E,CAAyH,IAAI,CAAC,QAA9H,CAAuI,EAAE,CAAC,eAA1I,4BAA2J,UAAG,SAAS,CAAC,eAAb,EAA3J,UA7BJ,CA8BK5I,MAAM,CAACW,WAAP,eACG,aAAK,KAAK,CAAE,CAAE2I,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAACW,WAFZ,GA/BR,GAHJ,GArGJ,cA+II,aAAK,SAAS,CAAC,UAAf,wBACI,cAAO,SAAS,CAAC,YAAjB,kCADJ,cAGI,aAAK,SAAS,CAAC,kBAAf,wBACI,KAAC,aAAD,EACI,SAAS,CAAE,CADf,CAEI,eAAe,CAAE,GAFrB,CAGI,WAAW,CAAC,cAHhB,CAII,SAAS,CAAC,sBAJd,CAKI,KAAK,CAAE9C,QAAQ,CAAC8H,OALpB,CAMI,QAAQ,CAAE,kBAAA3E,KAAK,QAAI0E,CAAAA,mBAAmB,CAAC1E,KAAK,CAACG,MAAN,CAAauI,KAAd,CAAvB,EANnB,EADJ,CAQK1J,MAAM,CAAC2J,QAAP,eACG,aAAK,KAAK,CAAE,CAAEL,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAAC2J,QAFZ,GATR,GAHJ,GA/IJ,cAoKI,aAAK,SAAS,CAAC,WAAf,wBACI,cAAO,SAAS,CAAC,YAAjB,6BADJ,cA4BI,KAAC,SAAD,EACI,EAAE,CAAC,YADP,CAEI,IAAI,CAAC,IAFT,CAGI,QAAQ,CAAC,cAHb,CAII,UAAU,CAAC,EAJf,CAKI,WAAW,CAAE,IALjB,CAMI,IAAI,CAAEpE,uBANV,CAOI,SAAS,CAAEtC,iBAPf,CAQI,SAAS,CAAEjD,MAAM,CAACmG,UAAP,CAAoB,IAApB,CAA2B,KAR1C,CASI,QAAQ,CAAE,kBAACqD,aAAD,CAAmB,CACzB,GAAIA,aAAa,CAACnE,MAAd,GAAyB,CAA7B,CAAgC,CAC5BrF,MAAM,CAAC,YAAD,CAAN,CAAuB,0BAAvB,CACAG,SAAS,CAACH,MAAD,CAAT,CACA,OACH,CACDA,MAAM,CAAC,YAAD,CAAN,CAAuB,EAAvB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEA,GAAInC,QAAQ,CAACI,QAAb,CAAuB,CACnB6H,UAAU,CAAC0D,aAAa,CAAC,CAAD,CAAd,CAAV,CAEH,CACDhE,0BAA0B,CAAC,KAAD,CAA1B,CACH,CAvBL,CAwBI,OAAO,CAAE3C,cAxBb,CAyBI,QAAQ,CAAEE,eAzBd,CA0BI,WAAW,CAAC,4CA1BhB,CA2BI,mBAAmB,CAAE,IA3BzB,CA4BI,aAAa,CAAE,uBAAC4B,UAAD,CAAa4E,CAAb,CAAmB,CAC9B9D,eAAe,CAACd,UAAD,CAAf,CACH,CA9BL,EA5BJ,cA4DI,MAAC,MAAD,EAAQ,IAAI,CAAE,KAAK8E,QAAL,EAAd,CAA+B,OAAO,CAAEX,qBAAxC,CAA+D,SAAS,CAAC,8CAAzE,CAAwH,IAAI,CAAC,QAA7H,CAAsI,EAAE,CAAC,eAAzI,4BAA0J,UAAG,SAAS,CAAC,eAAb,EAA1J,UA5DJ,CA6DK9I,MAAM,CAACmG,UAAP,cACG,aAAK,KAAK,CAAE,CAAEmD,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAACmG,UAFZ,GADH,CAKG,EAlER,GApKJ,cA2OI,YAAK,SAAS,CAAC,kBAAf,CAAkC,KAAK,CAAE,CAAEyD,SAAS,CAAE,MAAb,CAAqBC,SAAS,CAAE,OAAhC,CAAyCC,SAAS,CAAE,MAApD,CAAzC,uBACI,eAAO,SAAS,CAAC,6CAAjB,wBACI,oCACI,YAAI,SAAS,CAAC,aAAd,wBACI,WAAI,KAAK,CAAE,CAAEC,KAAK,CAAE,IAAT,CAAX,oBADJ,cAEI,WAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,IAAT,CAAX,oBAFJ,cAGI,WAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,KAAT,CAAX,sBAHJ,cAII,WAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,KAAT,CAAX,CAA6B,SAAS,CAAC,YAAvC,kBAJJ,cAKI,WAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,KAAT,CAAX,iBALJ,cAMI,WAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,KAAT,CAAX,wBANJ,cAOI,WAAI,KAAK,CAAE,CAAEA,KAAK,CAAE,KAAT,CAAX,mBAPJ,GADJ,EADJ,cAaI,uBACK5M,gBAAgB,CAACmH,GAAjB,CAAqB,SAACuB,OAAD,CAAUzE,KAAV,qBAClB,YAAI,SAAS,CAAC,aAAd,wBACI,iCACI,YACI,KAAK,CAAE,CAAEkI,KAAK,CAAE,KAAT,CAAgBU,MAAM,CAAE,SAAxB,CADX,CAEI,OAAO,CAAE,kBAAM,CACXvC,aAAa,CAAC5B,OAAD,CAAb,CACH,CAJL,uBAMI,UAAG,SAAS,CAAC,YAAb,eANJ,EADJ,EADJ,cAWI,oBAAMzE,KAAK,CAAG,CAAd,EAXJ,cAYI,oBAAOyE,OAAO,CAAC0B,WAAf,EAZJ,cAaI,WAAI,KAAK,CAAE,CACP0C,cAAc,CAAE,WADT,CAEPX,KAAK,CAAE,MAFA,CAGPU,MAAM,CAAE,SAHD,CAAX,CAMI,SAAS,CAAC,YANd,CAOI,OAAO,CAAE,kBAAM,CACXZ,sBAAsB,CAACvD,OAAO,CAACM,UAAT,CAAtB,CACH,CATL,UASQN,OAAO,CAACjI,IAThB,EAbJ,cAwBI,mCAEI,aAAK,SAAS,CAAC,kBAAf,wBACI,cAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAEiI,OAAO,CAACO,QAApC,CAA8C,SAAS,CAAC,uBAAxD,CAEI,WAAW,CAAC,UAFhB,CAE2B,QAAQ,CAAE,kBAACmD,CAAD,CAAO,CACpCvJ,MAAM,CAAC,YAAcoB,KAAf,CAAN,CAA8B,EAA9B,CACAjB,SAAS,kBAAMH,MAAN,EAAT,CACA,GAAI,CAACuJ,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB1J,MAAM,CAAC,YAAcoB,KAAf,CAAN,CAA8B,kBAA9B,CACAjE,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAxB,CAAmCmD,CAAC,CAACpI,MAAF,CAASuI,KAA5C,CACAtM,mBAAmB,oBAAKD,gBAAL,EAAnB,CACAgD,SAAS,kBAAMH,MAAN,EAAT,CACA3B,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB0B,MAAvB,EACA,OACH,CAED,GAAIuJ,CAAC,CAACpI,MAAF,CAASuI,KAAT,GAAmB,CAAvB,CAA0B,CACtB1J,MAAM,CAAC,YAAcoB,KAAf,CAAN,CAA8B,wBAA9B,CACAjE,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAxB,CAAmCmD,CAAC,CAACpI,MAAF,CAASuI,KAA5C,CACAtM,mBAAmB,oBAAKD,gBAAL,EAAnB,CACAgD,SAAS,kBAAMH,MAAN,EAAT,CACA3B,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB0B,MAAvB,EACA,OACH,CAED6F,OAAO,CAACO,QAAR,CAAmBhI,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA7B,CACAvM,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAxB,CAAmChI,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA7C,CACAxK,WAAW,GAEX,GAAIiI,CAAAA,KAAK,CAAG,CAAZ,CACA,GAAIhK,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgG,cAA5B,CAA4C,2BACxCD,KAAK,wBAAGhK,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgG,cAAxB,CAAuCvJ,QAAQ,CAACI,QAAhD,CAAH,gDAAG,sBAA2DkJ,KAAnE,CACA;AACH,CAED,GAAIA,KAAK,CAAG/I,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAlB,EAAsCvM,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgG,cAAlE,CAAkF,CAC9E;AACApH,MAAM,CAAC,YAAcoB,KAAf,CAAN,CAA8B,gCAAkC+F,KAAhE,CACAhH,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAED7C,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAxB,CAAmChI,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA7C,CACArL,OAAO,CAACC,GAAR,CAAY,mCAAZ,CAAiDnB,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBgF,QAAzE,EACAhJ,mBAAmB,oBAAKD,gBAAL,EAAnB,CACA+B,WAAW,GAEd,CA7CL,EADJ,cA+CI,aAAM,SAAS,CAAC,kBAAhB,CAAmC,EAAE,CAAC,cAAtC,UAAsD/B,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBkF,IAAxB,CAA+BnJ,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBkF,IAAvD,CAA8D,OAApH,EA/CJ,GAFJ,CAmDKtG,MAAM,CAAC,YAAcoB,KAAf,CAAN,eACG,YAAK,KAAK,CAAE,CAAEkI,KAAK,CAAE,KAAT,CAAZ,UACKtJ,MAAM,CAAC,YAAcoB,KAAf,CADX,EApDR,GAxBJ,cAkFI,mCAEI,aAAK,SAAS,CAAC,kBAAf,wBACI,cAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAEyE,OAAO,CAACQ,UAApC,CAAgD,SAAS,CAAC,uBAA1D,CAEI,WAAW,CAAC,YAFhB,CAE6B,QAAQ,CAAE,kBAACkD,CAAD,CAAO,CACtCvJ,MAAM,CAAC,cAAgBoB,KAAjB,CAAN,CAAgC,EAAhC,CACAjB,SAAS,kBAAMH,MAAN,EAAT,CACA,GAAI,CAACuJ,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB1J,MAAM,CAAC,cAAgBoB,KAAjB,CAAN,CAAgC,oBAAhC,CACAjE,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBiF,UAAxB,CAAqCjI,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA/C,CACAtM,mBAAmB,oBAAKD,gBAAL,EAAnB,CACAgD,SAAS,kBAAMH,MAAN,EAAT,CACA3B,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB0B,MAAvB,EACA,OACH,CAED,GAAIuJ,CAAC,CAACpI,MAAF,CAASuI,KAAT,GAAmB,CAAvB,CAA0B,CACtB1J,MAAM,CAAC,cAAgBoB,KAAjB,CAAN,CAAgC,0BAAhC,CACAjE,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBiF,UAAxB,CAAqCjI,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA/C,CACAtM,mBAAmB,oBAAKD,gBAAL,EAAnB,CACAgD,SAAS,kBAAMH,MAAN,EAAT,CACA3B,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB0B,MAAvB,EACA,OACH,CAGD7C,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBiF,UAAxB,CAAqCjI,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA/C,CACArL,OAAO,CAACC,GAAR,CAAY,qCAAZ,CAAmDnB,gBAAgB,CAACiE,KAAD,CAAhB,CAAwBiF,UAA3E,EACAjJ,mBAAmB,oBAAKD,gBAAL,EAAnB,CACA+B,WAAW,GAEd,CA7BL,EADJ,cA+BI,aAAM,SAAS,CAAC,kBAAhB,CAAmC,EAAE,CAAC,cAAtC,iBA/BJ,GAFJ,CAmCKc,MAAM,CAAC,cAAgBoB,KAAjB,CAAN,eACG,aAAK,KAAK,CAAE,CAAEkI,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAAC,cAAgBoB,KAAjB,CAFX,GApCR,GAlFJ,cA6HI,WAAI,SAAS,CAAC,UAAd,uBACI,KAAC,YAAD,EACI,KAAK,CAAE,CAACyE,OAAO,CAACQ,UAAR,CAAqBR,OAAO,CAACO,QAA9B,EAAwCoB,OAAxC,CAAgD,CAAhD,CADX,CAEI,WAAW,CAAE,MAFjB,CAGI,iBAAiB,CAAE,IAHvB,CAII,MAAM,CAAE,MAJZ,CAKI,UAAU,CAAE,oBAACkC,KAAD,CAAQ3M,KAAR,QAAkB2M,CAAAA,KAAlB,EALhB,EADJ,EA7HJ,GAAiCtI,KAAjC,CADkB,EAArB,EAwIE8I,OAxIF,EADL,EAbJ,GADJ,EA3OJ,cAsYI,YAAK,SAAS,CAAC,kBAAf,uBACI,cAAO,SAAS,CAAC,6CAAjB,uBACI,sCACI,mCAGI,WAAI,OAAO,CAAC,GAAZ,CAAgB,SAAS,CAAC,UAA1B,mBAHJ,cAII,WAAI,SAAS,CAAC,UAAd,CAAyB,KAAK,CAAE,CAAEH,KAAK,CAAE,OAAT,CAAhC,uBACI,KAAC,YAAD,EACI,KAAK,CAAEpC,UADX,CAEI,WAAW,CAAE,MAFjB,CAGI,iBAAiB,CAAE,IAHvB,CAII,MAAM,CAAE,MAJZ,CAKI,UAAU,CAAE,oBAAC+B,KAAD,CAAQ3M,KAAR,QAAkB2M,CAAAA,KAAlB,EALhB,EADJ,EAJJ,GADJ,cAeI,mCACI,WAAI,OAAO,CAAC,GAAZ,CAAgB,SAAS,CAAC,UAA1B,sCADJ,cAII,YAAI,SAAS,CAAC,UAAd,wBACI,cAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAE,CAAEK,KAAK,CAAE,OAAT,CAA5B,CAAgD,SAAS,CAAC,YAA1D,CAAuE,KAAK,CAAElM,QAAQ,CAACa,sBAAvF,CAA+G,QAAQ,CAAE,kBAAC6K,CAAD,CAAO,CAE5H,GAAInL,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,GAA+B,CAAnC,CAAsC,CAClC7L,QAAQ,CAACa,sBAAT,CAAkCN,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA5C,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,wBAAD,CAAN,CAAmC,EAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAED,GAAId,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,CAA6B,CAAjC,CAAoC,CAChC7L,QAAQ,CAACa,sBAAT,CAAkCN,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA5C,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,wBAAD,CAAN,CAAmC,wCAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAED,GAAI,CAACqK,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB7L,QAAQ,CAACa,sBAAT,CAAkC,EAAlC,CACAsB,MAAM,CAAC,wBAAD,CAAN,CAAmC,kCAAnC,CACAjC,WAAW,kBAAMF,QAAN,EAAX,CACAsC,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAEDA,MAAM,CAAC,wBAAD,CAAN,CAAmC,EAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEAnC,QAAQ,CAACa,sBAAT,CAAkCN,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA5C,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAqB,WAAW,GACd,CAlCD,EADJ,CAoCK,MApCL,CAqCKc,MAAM,CAACtB,sBAAP,eACG,YAAK,KAAK,CAAE,CAAE4K,KAAK,CAAE,KAAT,CAAZ,UACKtJ,MAAM,CAACtB,sBADZ,EAtCR,GAJJ,GAfJ,cA+DI,mCACI,YAAI,OAAO,CAAC,GAAZ,CAAgB,SAAS,CAAC,UAA1B,qCACc,cAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAE,CAAEqL,KAAK,CAAE,MAAT,CAA5B,CAA+C,SAAS,CAAC,YAAzD,CAAsE,KAAK,CAAElM,QAAQ,CAACY,gBAAtF,CAAwG,QAAQ,CAAE,kBAAC8K,CAAD,CAAO,CAC/H1L,QAAQ,CAACyC,mBAAT,CAA+B,IAA/B,CACA,GAAIlC,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,GAA+B,CAAnC,CAAsC,CAClC7L,QAAQ,CAACY,gBAAT,CAA4BL,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAtC,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,kBAAD,CAAN,CAA6B,EAA7B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAED,GAAId,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,CAA6B,CAAjC,CAAoC,CAChC7L,QAAQ,CAACY,gBAAT,CAA4BL,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAtC,CACA7L,QAAQ,CAACW,QAAT,CAAoB,IAApB,CACAT,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,kBAAD,CAAN,CAA6B,iCAA7B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAED,GAAI,CAACqK,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB7L,QAAQ,CAACY,gBAAT,CAA4B,EAA5B,CACAZ,QAAQ,CAACW,QAAT,CAAoB,IAApB,CACAwB,MAAM,CAAC,kBAAD,CAAN,CAA6B,0BAA7B,CACAjC,WAAW,kBAAMF,QAAN,EAAX,CACAsC,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAEDA,MAAM,CAAC,kBAAD,CAAN,CAA6B,EAA7B,CACAA,MAAM,CAAC,UAAD,CAAN,CAAqB,EAArB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEAnC,QAAQ,CAACY,gBAAT,CAA4BL,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAtC,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAqB,WAAW,GACd,CArCS,EADd,CAsCU,GAtCV,CAuCKc,MAAM,CAACvB,gBAAP,eACG,YAAK,KAAK,CAAE,CAAE6K,KAAK,CAAE,KAAT,CAAZ,UACKtJ,MAAM,CAACvB,gBADZ,EAxCR,GADJ,cA8CI,YAAI,SAAS,CAAC,UAAd,wBACI,cAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAE,CAAEsL,KAAK,CAAE,OAAT,CAA5B,CAAgD,SAAS,CAAC,YAA1D,CAAuE,KAAK,CAAElM,QAAQ,CAACW,QAAvF,CAAiG,QAAQ,CAAE,kBAAC+K,CAAD,CAAO,CAC9G1L,QAAQ,CAACyC,mBAAT,CAA+B,KAA/B,CACA,GAAIlC,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,GAA+B,CAAnC,CAAsC,CAClC7L,QAAQ,CAACW,QAAT,CAAoBJ,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA9B,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,UAAD,CAAN,CAAqB,EAArB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAED,GAAId,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,CAA6B,CAAjC,CAAoC,CAChC7L,QAAQ,CAACW,QAAT,CAAoBJ,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA9B,CACA7L,QAAQ,CAACY,gBAAT,CAA4B,IAA5B,CACAV,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,UAAD,CAAN,CAAqB,yBAArB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAED,GAAI,CAACqK,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB7L,QAAQ,CAACW,QAAT,CAAoB,EAApB,CACAX,QAAQ,CAACY,gBAAT,CAA4B,IAA5B,CACAuB,MAAM,CAAC,UAAD,CAAN,CAAqB,kBAArB,CACAjC,WAAW,kBAAMF,QAAN,EAAX,CACAqB,WAAW,GACXiB,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAEDA,MAAM,CAAC,UAAD,CAAN,CAAqB,EAArB,CACAA,MAAM,CAAC,kBAAD,CAAN,CAA6B,EAA7B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEAnC,QAAQ,CAACW,QAAT,CAAoBJ,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA9B,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAqB,WAAW,GACd,CAtCD,EADJ,CAwCK,MAxCL,CAyCKc,MAAM,CAACxB,QAAP,eACG,YAAK,KAAK,CAAE,CAAE8K,KAAK,CAAE,KAAT,CAAZ,UACKtJ,MAAM,CAACxB,QADZ,EA1CR,GA9CJ,GA/DJ,cA6JI,mCAEI,YAAI,OAAO,CAAC,GAAZ,CAAgB,SAAS,CAAC,UAA1B,iCAA2C,cAAO,IAAI,CAAC,QAAZ,CAAqB,SAAS,CAAC,aAA/B,CAA6C,KAAK,CAAE,CAAEuL,KAAK,CAAE,MAAT,CAApD,CAAuE,KAAK,CAAElM,QAAQ,CAACM,WAAvF,CAAoG,QAAQ,CAAE,kBAACoL,CAAD,CAAO,CAC5JlL,OAAO,CAACC,GAAR,CAAY,6BAAZ,EACA,GAAIF,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,GAA+B,CAAnC,CAAsC,CAClC7L,QAAQ,CAACM,WAAT,CAAuBC,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAjC,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,aAAD,CAAN,CAAwB,EAAxB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CACD,GAAId,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAV,CAA6B,CAAjC,CAAoC,CAChC7L,QAAQ,CAACM,WAAT,CAAuBC,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAAjC,CACA5B,QAAQ,CAAG,IAAX,CACAC,WAAW,CAACD,QAAD,CAAX,CACA/J,WAAW,kBAAMF,QAAN,EAAX,CACAmC,MAAM,CAAC,aAAD,CAAN,CAAwB,4BAAxB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAd,WAAW,GACX,OACH,CAGD,GAAI,CAACqK,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB7L,QAAQ,CAACM,WAAT,CAAuB,EAAvB,CACA2J,QAAQ,CAAG,IAAX,CACAC,WAAW,CAACD,QAAD,CAAX,CACA;AACA9H,MAAM,CAAC,aAAD,CAAN,CAAwB,qBAAxB,CACAjC,WAAW,kBAAMF,QAAN,EAAX,CACAsC,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CACDA,MAAM,CAAC,aAAD,CAAN,CAAwB,EAAxB,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEAnC,QAAQ,CAACM,WAAT,CAAuBoL,CAAC,CAACpI,MAAF,CAASuI,KAAhC,CACAxK,WAAW,GACXnB,WAAW,kBAAMF,QAAN,EAAX,CACAQ,OAAO,CAACC,GAAR,CAAYT,QAAZ,EACH,CAvC0C,EAA3C,CAuCM,GAvCN,CAwCKmC,MAAM,CAAC7B,WAAP,eACG,YAAK,KAAK,CAAE,CAAEmL,KAAK,CAAE,KAAT,CAAZ,UACKtJ,MAAM,CAAC7B,WADZ,EAzCR,GAFJ,cAgDI,WAAI,SAAS,CAAC,UAAd,uBACI,KAAC,YAAD,EACI,KAAK,CAAE2J,QADX,CAEI,WAAW,CAAE,MAFjB,CAGI,iBAAiB,CAAE,IAHvB,CAII,MAAM,CAAE,MAJZ,CAKI,UAAU,CAAE,oBAAC4B,KAAD,CAAQ3M,KAAR,QAAkB2M,CAAAA,KAAlB,EALhB,EADJ,EAhDJ,GA7JJ,cAuNI,mCAEI,WAAI,OAAO,CAAC,GAAZ,CAAgB,SAAS,CAAC,UAA1B,uBAFJ,cAGI,WAAI,SAAS,CAAC,UAAd,uBACI,KAAC,YAAD,EACI,KAAK,CAAEnD,QADX,CAEI,WAAW,CAAE,MAFjB,CAGI,iBAAiB,CAAE,IAHvB,CAII,MAAM,CAAE,MAJZ,CAKI,UAAU,CAAE,oBAACmD,KAAD,CAAQ3M,KAAR,QAAkB2M,CAAAA,KAAlB,EALhB,EADJ,EAHJ,GAvNJ,GADJ,EADJ,EAtYJ,CAk2BK,CAAC7L,QAAQ,CAACX,EAAV,cAAe,aAAK,SAAS,CAAC,UAAf,wBACZ,cAAO,SAAS,CAAC,YAAjB,6BADY,cAGZ,aAAK,SAAS,CAAC,kBAAf,wBACI,gBACI,KAAK,CAAEW,QAAQ,CAACgB,cADpB,CAEI,QAAQ,CAAEhB,QAAQ,CAACiB,cAAT,EAA2B,UAA3B,CAAwC,UAAxC,CAAqD,EAFnE,CAGI,QAAQ,CAAE,kBAACyK,CAAD,CAAO,CACb,GAAI,CAACA,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB1J,MAAM,CAAC,gBAAD,CAAN,CAA2B,4BAA3B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACAnC,QAAQ,CAACgB,cAAT,CAA0B,EAA1B,CACAd,WAAW,kBAAMF,QAAN,EAAX,CACA,OACH,CAEDmC,MAAM,CAAC,gBAAD,CAAN,CAA2B,EAA3B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEAnC,QAAQ,CAACgB,cAAT,CAA0B0K,CAAC,CAACpI,MAAF,CAASuI,KAAnC,CACA3L,WAAW,kBAAMF,QAAN,EAAX,CACAQ,OAAO,CAACC,GAAR,CAAYT,QAAZ,EACH,CAlBL,CAmBI,SAAS,CAAC,cAnBd,wBAqBI,eAAQ,KAAK,CAAC,EAAd,oBArBJ,cAsBI,eAAQ,KAAK,CAAC,MAAd,kBAtBJ,cAuBI,eAAQ,KAAK,CAAC,cAAd,gDAvBJ,GADJ,CA0BKmC,MAAM,CAACnB,cAAP,eACG,aAAK,KAAK,CAAE,CAAEyK,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAACnB,cAFZ,GA3BR,GAHY,GAAf,CAoCQ,EAt4Bb,CAw4BK,CAAChB,QAAQ,CAACX,EAAV,cAAe,aAAK,SAAS,CAAC,UAAf,wBACZ,cAAO,SAAS,CAAC,YAAjB,6BADY,cAGZ,aAAK,SAAS,CAAC,kBAAf,wBACI,gBACI,KAAK,CAAEW,QAAQ,CAACiB,cADpB,CAEI,QAAQ,CAAE,kBAACyK,CAAD,CAAO,CACblL,OAAO,CAACC,GAAR,CAAY,gCAAZ,EACA,GAAI,CAACiL,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB1J,MAAM,CAAC,gBAAD,CAAN,CAA2B,4BAA3B,CACAnC,QAAQ,CAACiB,cAAT,CAA0B,EAA1B,CACAf,WAAW,kBAAMF,QAAN,EAAX,CACAsC,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CAEDA,MAAM,CAAC,gBAAD,CAAN,CAA2B,EAA3B,CACAG,SAAS,kBAAMH,MAAN,EAAT,CAEAnC,QAAQ,CAACiB,cAAT,CAA0ByK,CAAC,CAACpI,MAAF,CAASuI,KAAnC,CACA,GAAI7L,QAAQ,CAACiB,cAAT,GAA4B,gBAAhC,CAAkD,CAC9CjB,QAAQ,CAACc,sBAAT,CAAkC,IAAlC,CACH,CACDZ,WAAW,kBAAMF,QAAN,EAAX,CAEA,GAAIA,QAAQ,CAACiB,cAAT,EAA2B,UAA/B,CAA2C,CACvCjB,QAAQ,CAACgB,cAAT,CAA0B,EAA1B,CACAd,WAAW,kBAAMF,QAAN,EAAX,CACH,CAEDQ,OAAO,CAACC,GAAR,CAAYT,QAAZ,EACH,CA3BL,CA4BI,SAAS,CAAC,cA5Bd,wBA8BI,eAAQ,KAAK,CAAC,EAAd,oBA9BJ,cA+BI,eAAQ,KAAK,CAAC,MAAd,kBA/BJ,cAgCI,eAAQ,KAAK,CAAC,UAAd,sBAhCJ,cAiCI,eAAQ,KAAK,CAAC,gBAAd,4BAjCJ,GADJ,CAoCKmC,MAAM,CAAClB,cAAP,eACG,aAAK,KAAK,CAAE,CAAEwK,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAAClB,cAFZ,GArCR,GAHY,GAAf,CA8CQ,EAt7Bb,CAy7BK,CAACjB,QAAQ,CAACX,EAAV,EAAgBW,QAAQ,CAACiB,cAAT,GAA4B,gBAA5C,cAA+D,aAAK,SAAS,CAAC,UAAf,wBAC5D,cAAO,SAAS,CAAC,YAAjB,oCAD4D,cAG5D,aAAK,SAAS,CAAC,kBAAf,wBACI,cACI,IAAI,CAAC,QADT,CAEI,KAAK,CAAEjB,QAAQ,CAACc,sBAFpB,CAGI,QAAQ,CAAE,kBAAC4K,CAAD,CAAO,CACblL,OAAO,CAACC,GAAR,CAAY,8BAAZ,EACA,GAAI,CAACiL,CAAC,CAACpI,MAAF,CAASuI,KAAd,CAAqB,CACjB7L,QAAQ,CAACc,sBAAT,CAAkC4K,CAAC,CAACpI,MAAF,CAASuI,KAA3C,CACA1J,MAAM,CAAC,wBAAD,CAAN,CAAmC,gCAAnC,CACAG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CACDnC,QAAQ,CAACc,sBAAT,CAAkCP,UAAU,CAACmL,CAAC,CAACpI,MAAF,CAASuI,KAAV,CAA5C,CACA1J,MAAM,CAAC,wBAAD,CAAN,CAAmC,EAAnC,CAEA,GAAInC,QAAQ,CAACc,sBAAT,EAAmC4H,QAAvC,CAAiD,CAC7CvG,MAAM,CAAC,wBAAD,CAAN,CAAmC,gCAAkCuG,QAArE,CACApG,SAAS,kBAAMH,MAAN,EAAT,CACA,OACH,CACDG,SAAS,kBAAMH,MAAN,EAAT,CACAjC,WAAW,kBAAMF,QAAN,EAAX,CACAQ,OAAO,CAACC,GAAR,CAAYT,QAAZ,EACH,CAtBL,CAuBI,SAAS,CAAC,cAvBd,CAwBI,EAAE,CAAC,oBAxBP,CAyBI,WAAW,CAAC,QAzBhB,EADJ,CA4BKmC,MAAM,CAACrB,sBAAP,eACG,aAAK,KAAK,CAAE,CAAE2K,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAACrB,sBAFZ,GA7BR,GAH4D,GAA/D,CAsCQ,EA/9Bb,cAi+BI,aAAK,SAAS,CAAC,UAAf,wBACI,cAAO,SAAS,CAAC,YAAjB,mBADJ,cAGI,aAAK,SAAS,CAAC,kBAAf,wBACI,KAAC,UAAD,EACI,EAAE,CAAC,UADP,CAEI,QAAQ,CAAEd,QAAQ,CAACkB,QAAT,CAAoB,GAAIC,CAAAA,IAAJ,CAASnB,QAAQ,CAACkB,QAAlB,CAApB,CAAkD,IAFhE,CAGI,KAAK,CAAElB,QAAQ,CAACkB,QAAT,CAAoBtC,MAAM,CAC7B,GAAIuC,CAAAA,IAAJ,CAASnB,QAAQ,CAACkB,QAAlB,CAD6B,CAE7B,sBAF6B,CAA1B,CAGH,IANR,CAOI,SAAS,CAAC,cAPd,CAQI,UAAU,CAAC,sBARf,CASI,cAAc,KATlB,CAUI,aAAa,CAAC,GAVlB,CAWI,QAAQ,CAAE,kBAAC2K,KAAD,CAAW,CACjBrL,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAqBoL,KAArB,EACA7L,QAAQ,CAACkB,QAAT,CAAoB2K,KAApB,CACA;AACA3L,WAAW,kBAAMF,QAAN,EAAX,CACH,CAhBL,EADJ,CAoBKmC,MAAM,CAACjB,QAAP,eACG,aAAK,KAAK,CAAE,CAAEuK,KAAK,CAAE,KAAT,CAAZ,wBACI,UAAG,SAAS,CAAC,YAAb,eADJ,CAEKtJ,MAAM,CAACjB,QAFZ,GArBR,GAHJ,GAj+BJ,cAoiCI,MAAC,KAAD,CAAO,MAAP,yBACI,KAAC,MAAD,EAAQ,OAAO,CAAC,WAAhB,CAA4B,OAAO,CAAE+E,WAArC,mBADJ,cAII,KAAC,MAAD,EAAQ,OAAO,CAAC,SAAhB,CAA0B,OAAO,CAAEmC,YAAnC,UACKhE,YAAY,CAAGpE,QAAQ,CAACX,EAAT,CAAc,cAAd,CAA+B,YAAlC,CAAiDW,QAAQ,CAACX,EAAT,CAAc,QAAd,CAAyB,QAD3F,EAJJ,GApiCJ,GAVJ,GAtBJ,GAxBJ,GADJ,CA8mCH,CAthE6B,CAA9B,CAwhEA,cAAeJ,CAAAA,WAAf","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport OrderPreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport CustomerCreate from \"./../customer/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport OrderView from \"./view.js\";\nimport \"./style.css\";\nimport { DebounceInput } from 'react-debounce-input';\n//import BarcodeScannerComponent from \"react-qr-barcode-scanner\";\n//import Quagga from 'quagga';\nimport ProductView from \"./../product/view.js\";\n\nconst OrderCreate = forwardRef((props, ref) => {\n\n\n    useImperativeHandle(ref, () => ({\n        open(id) {\n            selectedProducts = [];\n            setSelectedProducts([]);\n\n            selectedStores = [];\n            setSelectedStores([]);\n\n            selectedCustomers = [];\n            setSelectedCustomers([]);\n\n\n\n            if (cookies.get(\"user_id\")) {\n                selectedDeliveredByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.delivered_by = cookies.get(\"user_id\");\n                setFormData({ ...formData });\n                setSelectedDeliveredByUsers([...selectedDeliveredByUsers]);\n            }\n\n            if (cookies.get('store_id')) {\n                formData.store_id = cookies.get('store_id');\n                formData.store_name = cookies.get('store_name');\n                formData.vat_percent = parseFloat(cookies.get('vat_percent'));\n                console.log(\"formData.store_id:\", formData.store_id);\n            }\n\n            formData.id = undefined;\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            formData.shipping_handling_fees = 0.00;\n            formData.partial_payment_amount = 0.00;\n            formData.status = \"delivered\";\n            formData.payment_method = \"\";\n            formData.payment_status = \"\";\n            formData.date_str = new Date();\n            if (id) {\n                getOrder(id);\n            }\n            setFormData({ ...formData });\n            reCalculate();\n            setShow(true);\n\n        },\n    }));\n\n\n    function getOrder(id) {\n        console.log(\"inside get Order\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/order/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                formData = data.result;\n                formData.date_str = data.result.date;\n                /*\n                let order = data.result;\n                formData = {\n                    id: order.id,\n                    code: order.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n                */\n\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n\n                selectedProducts = formData.products;\n                setSelectedProducts([...selectedProducts]);\n\n\n                let selectedStores = [\n                    {\n                        id: formData.store_id,\n                        name: formData.store_name,\n                    }\n                ];\n\n\n                let searchLabel = formData.customer_name;\n\n                let selectedCustomers = [\n                    {\n                        id: formData.customer_id,\n                        name: formData.customer_name,\n                        search_label: searchLabel,\n                    }\n                ];\n\n                /*\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: formData.created_by,\n                        name: formData.created_by_name\n                    }\n                ];\n\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n                */\n\n                setSelectedStores([...selectedStores]);\n                setSelectedCustomers([...selectedCustomers]);\n\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function-order.123\");\n                // event.preventDefault();\n\n\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        vat_percent: 15.0,\n        discountValue: 0.00,\n        discount: 0.00,\n        discount_percent: 0.0,\n        is_discount_percent: false,\n        date_str: new Date(),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"delivered\",\n        payment_status: \"\",\n        payment_method: \"\",\n        price_type: \"retail\",\n        useLaserScanner: false,\n        store_id: \"\",\n    });\n\n    //Store Auto Suggestion\n    const [storeOptions, setStoreOptions] = useState([]);\n    let [selectedStores, setSelectedStores] = useState([]);\n    const [isStoresLoading, setIsStoresLoading] = useState(false);\n\n    //Customer Auto Suggestion\n    const [customerOptions, setCustomerOptions] = useState([]);\n    let [selectedCustomers, setSelectedCustomers] = useState([]);\n    const [isCustomersLoading, setIsCustomersLoading] = useState(false);\n\n    //Product Auto Suggestion\n    const [productOptions, setProductOptions] = useState([]);\n    let [selectedProduct, setSelectedProduct] = useState([]);\n    let [selectedProducts, setSelectedProducts] = useState([]);\n    const [isProductsLoading, setIsProductsLoading] = useState(false);\n\n    //Delivered By Auto Suggestion\n    let [deliveredByUserOptions, setDeliveredByUserOptions] = useState([]);\n    let [selectedDeliveredByUsers, setSelectedDeliveredByUsers] = useState([]);\n    const [isDeliveredByUsersLoading, setIsDeliveredByUsersLoading] =\n        useState(false);\n\n    //Delivered By Signature Auto Suggestion\n    const [deliveredBySignatureOptions, setDeliveredBySignatureOptions] =\n        useState([]);\n    const [selectedDeliveredBySignatures, setSelectedDeliveredBySignatures] =\n        useState([]);\n    const [isDeliveredBySignaturesLoading, setIsDeliveredBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/orders\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=` + encodeURIComponent(object[key]);\n            })\n            .join(\"&\");\n    }\n\n    async function suggestStores(searchTerm) {\n        console.log(\"Inside handle suggestStores\");\n        setStoreOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsStoresLoading(true);\n        let result = await fetch(\n            \"/v1/store?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setStoreOptions(data.result);\n        setIsStoresLoading(false);\n    }\n\n    async function suggestCustomers(searchTerm) {\n        console.log(\"Inside handle suggestCustomers\");\n        setCustomerOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";\n        setIsCustomersLoading(true);\n        let result = await fetch(\n            \"/v1/customer?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setCustomerOptions(data.result);\n        setIsCustomersLoading(false);\n    }\n\n    function GetProductUnitPriceInStore(storeId, productStores) {\n        if (!productStores) {\n            return \"\";\n        }\n\n        for (var i = 0; i < productStores.length; i++) {\n            console.log(\"productStores[i]:\", productStores[i]);\n            console.log(\"store_id:\", storeId);\n\n            if (productStores[i].store_id === storeId) {\n                console.log(\"macthed\");\n                console.log(\n                    \"productStores[i].retail_unit_price:\",\n                    productStores[i].retail_unit_price\n                );\n                return productStores[i];\n                /*\n                if (formData.price_type === \"retail\") {\n                    return unitPriceListArray[i].retail_unit_price;\n                } else if (formData.price_type === \"wholesale\") {\n                    return unitPriceListArray[i].wholesale_unit_price;\n                } else if (formData.price_type === \"purchase\") {\n                    return unitPriceListArray[i].purchase_unit_price;\n                }\n                */\n\n            } else {\n                console.log(\"not matched\");\n            }\n        }\n        return \"\";\n    }\n\n\n\n    let [openProductSearchResult, setOpenProductSearchResult] = useState(false);\n\n    async function suggestProducts(searchTerm) {\n        console.log(\"Inside handle suggestProducts\");\n        setProductOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n\n        if (cookies.get(\"store_id\")) {\n            params.store_id = cookies.get(\"store_id\");\n        }\n\n\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,item_code,bar_code,part_number,name,unit,part_number,name_in_arabic,product_stores\";\n        setIsProductsLoading(true);\n        let result = await fetch(\n            \"/v1/product?\" + Select + queryString + \"&limit=200\",\n            requestOptions\n        );\n        let data = await result.json();\n\n        let products = data.result;\n        if (!products || products.length === 0) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n        openProductSearchResult = true;\n        setOpenProductSearchResult(true);\n        setProductOptions(products);\n        setIsProductsLoading(false);\n\n    }\n\n    async function getProductByBarCode(barcode) {\n        formData.barcode = barcode;\n        setFormData({ ...formData });\n        console.log(\"Inside getProductByBarCode\");\n        errors[\"bar_code\"] = \"\";\n        setErrors({ ...errors });\n\n        console.log(\"barcode:\" + formData.barcode);\n        if (!formData.barcode) {\n            return;\n        }\n\n        if (formData.barcode.length === 13) {\n            formData.barcode = formData.barcode.slice(0, -1);\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n\n        let Select = \"select=id,item_code,bar_code,ean_12,part_number,name,product_stores,unit,part_number,name_in_arabic\";\n        let result = await fetch(\n            \"/v1/product/barcode/\" + formData.barcode + \"?\" + Select,\n            requestOptions\n        );\n        let data = await result.json();\n\n\n        let product = data.result;\n        if (product) {\n            addProduct(product);\n        } else {\n            errors[\"bar_code\"] = \"Invalid Barcode:\" + formData.barcode\n            setErrors({ ...errors });\n        }\n\n        formData.barcode = \"\";\n        setFormData({ ...formData });\n\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setDeliveredByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsDeliveredByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setDeliveredByUserOptions(data.result);\n        setIsDeliveredByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setDeliveredBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsDeliveredBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setDeliveredBySignatureOptions(data.result);\n        setIsDeliveredBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit_price: parseFloat(selectedProducts[i].unit_price),\n                unit: selectedProducts[i].unit,\n            });\n        }\n\n\n        if (!formData.shipping_handling_fees && formData.shipping_handling_fees !== 0) {\n            errors[\"shipping_handling_fees\"] = \"Invalid shipping / handling fees\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && !formData.partial_payment_amount && formData.partial_payment_amount !== 0) {\n            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount <= 0) {\n            errors[\"partial_payment_amount\"] = \"Partial payment should be > 0 \";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount >= netTotal) {\n            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n            setErrors({ ...errors });\n            return;\n        }\n\n        errors[\"payment_method\"] = \"\";\n        setErrors({ ...errors });\n        if (!formData.id && formData.payment_status != \"not_paid\" && !formData.payment_method) {\n            errors[\"payment_method\"] = \"Payment method is required\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.vat_percent && formData.vat_percent !== 0) {\n            errors[\"vat_percent\"] = \"Invalid vat percent\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        formData.partial_payment_amount = parseFloat(formData.partial_payment_amount);\n\n        if (cookies.get('store_id')) {\n            formData.store_id = cookies.get('store_id');\n        }\n\n\n        let endPoint = \"/v1/order\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/order/\" + formData.id;\n            method = \"PUT\";\n        }\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"Order Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n\n                handleClose();\n                formData.products = [];\n                selectedProducts = [];\n                setSelectedProducts([]);\n                formData.customer_id = \"\";\n                setSelectedCustomers([]);\n                setFormData({ ...formData });\n                reCalculate();\n\n                openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating Order!\", \"danger\");\n            });\n    }\n\n    function getProductIndex(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return i;\n            }\n        }\n        return false;\n    }\n\n\n    function isProductAdded(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function GetProductStockInStore(storeId, productStores) {\n        if (!productStores) {\n            return 0.0;\n        }\n\n        for (var i = 0; i < productStores.length; i++) {\n            if (productStores[i].store_id === storeId) {\n                return productStores[i].stock;\n            }\n        }\n        return 0.0;\n    }\n\n    function addProduct(product) {\n        console.log(\"Inside Add product\");\n        if (!formData.store_id) {\n            errors.product_id = \"Please Select a Store and try again\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        errors.product_id = \"\";\n        if (!product) {\n            errors.product_id = \"Invalid Product\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        /*\n        let productStore = GetProductUnitPriceInStore(\n            formData.store_id,\n            product.stores\n        );\n        */\n        // product.unit_price = productStore.retail_unit_price;\n\n        if (product.product_stores[formData.store_id]) {\n            product.unit_price = product.product_stores[formData.store_id].retail_unit_price;\n        }\n\n\n        errors.unit_price = \"\";\n        if (!product.unit_price) {\n            errors.unit_price = \"Invalid Unit Price\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        let alreadyAdded = false;\n        let index = false;\n        let quantity = 0.00;\n        product.quantity = 1.00;\n\n\n        if (isProductAdded(product.id)) {\n            alreadyAdded = true;\n            index = getProductIndex(product.id);\n            quantity = parseFloat(selectedProducts[index].quantity + product.quantity);\n        } else {\n            quantity = parseFloat(product.quantity);\n        }\n\n        console.log(\"quantity:\", quantity);\n\n        errors.quantity = \"\";\n\n        //let stock = GetProductStockInStore(formData.store_id, product.stores);\n        let stock = 0;\n\n        if (product.product_stores[formData.store_id]) {\n            stock = product.product_stores[formData.store_id].stock;\n        }\n\n        if (stock < quantity) {\n            if (index === false) {\n                index = selectedProducts.length;\n            }\n            // errors[\"quantity_\" + index] = \"Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for product: \" + product.name;\n            errors[\"quantity_\" + index] = \"Warning: Available stock is \" + stock\n            console.log(\"errors:\", errors);\n            setErrors({ ...errors });\n        }\n\n        if (alreadyAdded) {\n            selectedProducts[index].quantity = parseFloat(quantity);\n        }\n\n        if (!alreadyAdded) {\n            selectedProducts.push({\n                product_id: product.id,\n                code: product.item_code,\n                part_number: product.part_number,\n                name: product.name,\n                quantity: product.quantity,\n                product_stores: product.product_stores,\n                unit_price: parseFloat(product.unit_price).toFixed(2),\n                unit: product.unit,\n            });\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n    }\n\n    function removeProduct(product) {\n        const index = selectedProducts.indexOf(product);\n        if (index > -1) {\n            selectedProducts.splice(index, 1);\n        }\n        setSelectedProducts([...selectedProducts]);\n\n        reCalculate();\n    }\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            totalPrice +=\n                parseFloat(selectedProducts[i].unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n        totalPrice = totalPrice.toFixed(2);\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            vatPrice = (parseFloat((parseFloat(formData.vat_percent) / 100)) * (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount))).toFixed(2);;\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function findNetTotal() {\n        netTotal = 0.00;\n        if (totalPrice > 0) {\n            netTotal = (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount) + parseFloat(vatPrice)).toFixed(2);\n        }\n        setNetTotal(netTotal);\n\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n            setFormData({ ...formData });\n        }\n    }\n\n\n    function reCalculate() {\n        findTotalPrice();\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n    const DetailsViewRef = useRef();\n    function openDetailsView(id) {\n        DetailsViewRef.current.open(id);\n    }\n\n    const StoreCreateFormRef = useRef();\n    function openStoreCreateForm() {\n        StoreCreateFormRef.current.open();\n    }\n\n    const CustomerCreateFormRef = useRef();\n    function openCustomerCreateForm() {\n        CustomerCreateFormRef.current.open();\n    }\n\n    const ProductCreateFormRef = useRef();\n    function openProductCreateForm() {\n        ProductCreateFormRef.current.open();\n    }\n\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n\n    return (\n        <>\n            {/*\n            <div ref={camref}></div>\n        */}\n\n            {/*\n            <BarcodeScannerComponent\n                width={500}\n                height={500}\n                onUpdate={(err, result) => {\n                    console.log(\"Result:\", result);\n                }}\n            />\n            */}\n\n            <OrderView ref={DetailsViewRef} openCreateForm={props.openCreateForm} />\n            <ProductView ref={ProductDetailsViewRef} />\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n            <CustomerCreate ref={CustomerCreateFormRef} showToastMessage={props.showToastMessage} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} />\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n\n\n            <Modal show={show} size=\"xl\" fullscreen\n                onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Sales Order #\" + formData.code : \"Create New Sales Order\"}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <OrderPreview />\n                        <Button variant=\"primary\" onClick={handleCreate}>\n                            {isProcessing ? formData.id ? \"Updating....\" : \"Creating..\" : formData.id ? \"Update\" : \"Create\"\n                            }\n                        </Button>\n\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    {Object.keys(errors).length > 0 ?\n                        <div>\n                            <ul>\n\n                                {errors && Object.keys(errors).map((key, index) => {\n                                    return (errors[key] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                })}\n                            </ul></div> : \"\"}\n\n                    <form className=\"row g-3 needs-validation\" onSubmit={e => { e.preventDefault(); handleCreate(e); }} >\n                        {!cookies.get('store_name') ? <div className=\"col-md-6\">\n                            <label className=\"form-label\">Store*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"store_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isStoresLoading}\n                                    isInvalid={errors.store_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.store_id = \"\";\n                                        errors[\"product_id\"] = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.store_id = \"Invalid Store selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedStores([]);\n                                            return;\n                                        }\n                                        formData.store_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        console.log(\"formData.store_id:\", formData.store_id);\n                                        selectedStores = selectedItems;\n                                        setSelectedStores([...selectedItems]);\n\n                                        if (formData.store_id) {\n                                            if (selectedProduct[0] && selectedProduct[0].product_stores && selectedProduct[0].quantity) {\n                                                let stock = 0;\n                                                if (selectedProduct[0].product_stores) {\n                                                    //stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\n                                                    if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                        stock = selectedProduct[0].product_stores[formData.store_id].stock\n                                                    }\n                                                }\n\n                                                if (stock < parseFloat(selectedProduct[0].quantity)) {\n                                                    if (selectedStores[0]) {\n                                                        errors.product_id = \"Stock is only \" + stock + \" in Store: \" + selectedStores[0].name + \" for this product\";\n                                                    } else {\n                                                        errors.product_id = \"Stock is only \" + stock + \" in Selected Store for this product\";\n                                                    }\n\n                                                    setErrors({ ...errors });\n                                                }\n                                            } else if (selectedProduct[0] && selectedProduct[0].product_stores) {\n                                                let stock = 0;\n                                                //stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\n                                                if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                    stock = selectedProduct[0].product_stores[formData.store_id].stock\n                                                }\n\n                                                if (stock === 0) {\n                                                    if (selectedStores[0]) {\n                                                        errors[\"product_id\"] = \"This product is not available in store: \" + selectedStores[0].name;\n                                                    } else {\n                                                        errors[\"product_id\"] = \"This product is not available in selected store.\"\n                                                    }\n                                                    setErrors({ ...errors });\n                                                }\n                                            }\n\n                                            if (selectedProduct[0]) {\n                                                /*\n                                                selectedProduct[0].unit_price = GetProductUnitPriceInStore(\n                                                    formData.store_id,\n                                                    selectedProduct[0].stores\n                                                );\n                                                */\n                                                if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                    selectedProduct[0].unit_price = selectedProduct[0].product_stores[formData.store_id].retail_unit_price;\n                                                }\n\n\n                                                if (!selectedProduct[0].quantity) {\n                                                    selectedProduct[0].quantity = 1;\n                                                }\n                                                setSelectedProduct([...selectedProduct]);\n                                            }\n\n                                        }\n\n                                    }\n                                    }\n                                    options={storeOptions}\n                                    placeholder=\"Select Store\"\n                                    selected={selectedStores}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestStores(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openStoreCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi x-lg\"> </i>\n                                    {errors.store_id}\n                                </div>\n                            </div>\n                        </div> : \"\"}\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Customer*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"customer_id\"\n                                    labelKey=\"search_label\"\n                                    isLoading={isCustomersLoading}\n                                    isInvalid={errors.customer_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.customer_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.customer_id = \"Invalid Customer selected\";\n                                            setErrors(errors);\n                                            formData.customer_id = \"\";\n                                            setFormData({ ...formData });\n                                            setSelectedCustomers([]);\n                                            return;\n                                        }\n                                        formData.customer_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedCustomers(selectedItems);\n                                    }}\n                                    options={customerOptions}\n                                    placeholder=\"Type name or mob\"\n                                    selected={selectedCustomers}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestCustomers(searchTerm);\n                                    }}\n                                />\n                                <Button hide={true.toString()} onClick={openCustomerCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.customer_id && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.customer_id}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Product Barcode Scan</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DebounceInput\n                                    minLength={3}\n                                    debounceTimeout={100}\n                                    placeholder=\"Scan Barcode\"\n                                    className=\"form-control barcode\"\n                                    value={formData.barcode}\n                                    onChange={event => getProductByBarCode(event.target.value)} />\n                                {errors.bar_code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.bar_code}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n\n                        <div className=\"col-md-12\">\n                            <label className=\"form-label\">Product Search*</label>\n                            {/*  \n                            <Form.Check\n                                type=\"switch\"\n                                as=\"input\"\n                                id=\"use_laser_scanner\"\n                                label=\"Use Laser Scanner to Read Barcode\"\n                                onChange={(e) => {\n\n                                    formData.useLaserScanner = !formData.useLaserScanner;\n\n                                    if (formData.useLaserScanner) {\n                                        console.log(\"adding keydown event\");\n                                        document.addEventListener(\"keydown\", keyPress);\n                                    } else {\n                                        console.log(\"removing keydown event\");\n                                        document.removeEventListener(\"keydown\", keyPress);\n                                    }\n\n                                    console.log(\"e.target.value:\", formData.useLaserScanner);\n\n                                    setFormData({ ...formData });\n\n                                }}\n                            />\n                            */}\n\n                            <Typeahead\n                                id=\"product_id\"\n                                size=\"lg\"\n                                labelKey=\"search_label\"\n                                emptyLabel=\"\"\n                                clearButton={true}\n                                open={openProductSearchResult}\n                                isLoading={isProductsLoading}\n                                isInvalid={errors.product_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    if (selectedItems.length === 0) {\n                                        errors[\"product_id\"] = \"Invalid Product selected\";\n                                        setErrors(errors);\n                                        return;\n                                    }\n                                    errors[\"product_id\"] = \"\";\n                                    setErrors({ ...errors });\n\n                                    if (formData.store_id) {\n                                        addProduct(selectedItems[0]);\n\n                                    }\n                                    setOpenProductSearchResult(false);\n                                }}\n                                options={productOptions}\n                                selected={selectedProduct}\n                                placeholder=\"Search By Part No. / Name / Name in Arabic\"\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestProducts(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openProductCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.product_id ? (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.product_id}\n                                </div>\n                            ) : \"\"}\n                        </div>\n\n\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", maxHeight: \"400px\", overflowY: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th style={{ width: \"3%\" }}>Remove</th>\n                                        <th style={{ width: \"5%\" }}>SI No.</th>\n                                        <th style={{ width: \"10%\" }}>Part No.</th>\n                                        <th style={{ width: \"30%\" }} className=\"text-start\">Name</th>\n                                        <th style={{ width: \"15%\" }} >Qty</th>\n                                        <th style={{ width: \"18%\" }}>Unit Price</th>\n                                        <th style={{ width: \"32%\" }}>Price</th>\n\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr className=\"text-center\" key={index}>\n                                            <td>\n                                                <div\n                                                    style={{ color: \"red\", cursor: \"pointer\" }}\n                                                    onClick={() => {\n                                                        removeProduct(product);\n                                                    }}\n                                                >\n                                                    <i className=\"bi bi-x-lg\"> </i>\n                                                </div>\n                                            </td>\n                                            <td >{index + 1}</td>\n                                            <td  >{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n\n                                            }}\n                                                className=\"text-start\"\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                }}>{product.name}\n                                            </td>\n                                            <td >\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.quantity} className=\"form-control text-end\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"quantity_\" + index] = \"Quantity should be > 0\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            reCalculate();\n\n                                                            let stock = 0;\n                                                            if (selectedProducts[index].product_stores) {\n                                                                stock = selectedProducts[index].product_stores[formData.store_id]?.stock;\n                                                                // stock = GetProductStockInStore(formData.store_id, selectedProducts[index].stores);\n                                                            }\n\n                                                            if (stock < parseFloat(e.target.value) && selectedProducts[index].product_stores) {\n                                                                // errors[\"quantity_\" + index] = \" Warning: Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for this product\";\n                                                                errors[\"quantity_\" + index] = \" Warning: Available stock is \" + stock;\n                                                                setErrors({ ...errors });\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].quantity:\", selectedProducts[index].quantity);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td>\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.unit_price} className=\"form-control text-end\"\n\n                                                        placeholder=\"Unit Price\" onChange={(e) => {\n                                                            errors[\"unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"unit_price_\" + index] = \"Unit Price should be > 0\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].unit_price:\", selectedProducts[index].unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n                                                {errors[\"unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td className=\"text-end\" >\n                                                <NumberFormat\n                                                    value={(product.unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n                                        </tr>\n                                    )).reverse()}\n                                </tbody>\n                            </table>\n                        </div>\n                        <div className=\"table-responsive\">\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n\n\n                                        <th colSpan=\"8\" className=\"text-end\">Total</th>\n                                        <td className=\"text-end\" style={{ width: \"200px\" }} >\n                                            <NumberFormat\n                                                value={totalPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Shipping & Handling Fees\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.shipping_handling_fees} onChange={(e) => {\n\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"Shipping / Handling Fees should be > 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.shipping_handling_fees = \"\";\n                                                    errors[\"shipping_handling_fees\"] = \"Invalid Shipping / Handling Fees\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"shipping_handling_fees\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.shipping_handling_fees && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.shipping_handling_fees}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\"> VAT  <input type=\"number\" className=\"text-center\" style={{ width: \"50px\" }} value={formData.vat_percent} onChange={(e) => {\n                                            console.log(\"Inside onchange vat percent\");\n                                            if (parseFloat(e.target.value) === 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n                                            if (parseFloat(e.target.value) < 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"Vat percent should be >= 0\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n\n\n                                            if (!e.target.value) {\n                                                formData.vat_percent = \"\";\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                //formData.discount_percent = 0.00;\n                                                errors[\"vat_percent\"] = \"Invalid vat percent\";\n                                                setFormData({ ...formData });\n                                                setErrors({ ...errors });\n                                                return;\n                                            }\n                                            errors[\"vat_percent\"] = \"\";\n                                            setErrors({ ...errors });\n\n                                            formData.vat_percent = e.target.value;\n                                            reCalculate();\n                                            setFormData({ ...formData });\n                                            console.log(formData);\n                                        }} />{\"%\"}\n                                            {errors.vat_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.vat_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n                        {/*  \n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Date*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    value={formData.date_str}\n                                    selected={selectedDate}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMM dd yyyy\"\n                                    onChange={(value) => {\n                                        formData.date_str = format(new Date(value), \"MMM dd yyyy\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">VAT %*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.vat_percent}\n                                    type='number'\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange vat percent\");\n                                        if (isNaN(e.target.value)) {\n                                            errors[\"vat_percent\"] = \"Invalid VAT percentage\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"vat_percent\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.vat_percent = e.target.value;\n                                        findVatPrice();\n                                        findNetTotal();\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom01\"\n                                    placeholder=\"VAT %\"\n                                    aria-label=\"Select Store\"\n                                    aria-describedby=\"button-addon1\"\n                                />\n                                {errors.vat_percent && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.vat_percent}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Discount*</label>\n                            <Form.Check\n                                type=\"switch\"\n                                id=\"custom-switch\"\n                                label=\"%\"\n                                value={formData.is_discount_percent}\n                                onChange={(e) => {\n                                    formData.is_discount_percent = !formData.is_discount_percent;\n                                    console.log(\"e.target.value:\", formData.is_discount_percent);\n                                    setFormData({ ...formData });\n                                    reCalculate();\n                                }}\n                            />\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.discountValue}\n                                    type='number'\n                                    onChange={(e) => {\n\n                                        if (parseFloat(e.target.value) === 0) {\n                                            formData.discountValue = parseFloat(e.target.value);\n                                            setFormData({ ...formData });\n                                            errors[\"discount\"] = \"\";\n                                            setErrors({ ...errors });\n                                            reCalculate();\n                                            return;\n                                        }\n\n                                        if (!e.target.value) {\n                                            formData.discountValue = \"\";\n                                            errors[\"discount\"] = \"Invalid Discount\";\n                                            setFormData({ ...formData });\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"discount\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.discountValue = e.target.value;\n                                        setFormData({ ...formData });\n                                        reCalculate();\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Discount\"\n                                    aria-label=\"Select Customer\"\n                                    aria-describedby=\"button-addon2\"\n                                />\n                                {errors.discount && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.discount}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n\n                        {/*  \n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Delivered By*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"delivered_by\"\n                                    labelKey=\"name\"\n                                    isLoading={isDeliveredByUsersLoading}\n                                    isInvalid={errors.delivered_by ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.delivered_by = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.delivered_by = \"Invalid User Selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedDeliveredByUsers([]);\n                                            return;\n                                        }\n                                        formData.delivered_by = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedDeliveredByUsers(selectedItems);\n                                    }}\n                                    options={deliveredByUserOptions}\n                                    placeholder=\"Select User\"\n                                    selected={selectedDeliveredByUsers}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestUsers(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openUserCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.delivered_by ? (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i> {errors.delivered_by}\n                                    </div>\n                                ) : \"\"}\n                            </div>\n                        </div>\n                                */}\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">\n                                Delivered By Signature(Optional)\n                            </label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"delivered_by_signature_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isDeliveredBySignaturesLoading}\n                                    isInvalid={errors.delivered_by_signature_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.delivered_by_signature_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.delivered_by_signature_id =\n                                                \"Invalid Signature Selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedDeliveredBySignatures([]);\n                                            return;\n                                        }\n                                        formData.delivered_by_signature_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedDeliveredBySignatures(selectedItems);\n                                    }}\n                                    options={deliveredBySignatureOptions}\n                                    placeholder=\"Select Signature\"\n                                    selected={selectedDeliveredBySignatures}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestSignatures(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openSignatureCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.delivered_by_signature_id ? (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>{\" \"}\n                                        {errors.delivered_by_signature_id}\n                                    </div>\n                                ) : \"\"}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Signature Date(Optional)</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"signature_date_str\"\n                                    value={formData.signature_date_str}\n                                    selected={selectedDate}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMM dd yyyy\"\n                                    onChange={(value) => {\n                                        formData.signature_date_str = format(new Date(value), \"MMM dd yyyy\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.signature_date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.signature_date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n                        {!formData.id ? <div className=\"col-md-2\">\n                            <label className=\"form-label\">Payment method*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <select\n                                    value={formData.payment_method}\n                                    disabled={formData.payment_status == \"not_paid\" ? \"disabled\" : \"\"}\n                                    onChange={(e) => {\n                                        if (!e.target.value) {\n                                            errors[\"payment_method\"] = \"Payment method is required\";\n                                            setErrors({ ...errors });\n                                            formData.payment_method = \"\";\n                                            setFormData({ ...formData });\n                                            return;\n                                        }\n\n                                        errors[\"payment_method\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.payment_method = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                >\n                                    <option value=\"\">Select</option>\n                                    <option value=\"cash\">Cash</option>\n                                    <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                </select>\n                                {errors.payment_method && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.payment_method}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n                        {!formData.id ? <div className=\"col-md-2\">\n                            <label className=\"form-label\">Payment Status*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <select\n                                    value={formData.payment_status}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange payment Status\");\n                                        if (!e.target.value) {\n                                            errors[\"payment_status\"] = \"Payment status is required\";\n                                            formData.payment_status = \"\";\n                                            setFormData({ ...formData });\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"payment_status\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.payment_status = e.target.value;\n                                        if (formData.payment_status !== \"paid_partially\") {\n                                            formData.partial_payment_amount = 0.00;\n                                        }\n                                        setFormData({ ...formData });\n\n                                        if (formData.payment_status == \"not_paid\") {\n                                            formData.payment_method = \"\";\n                                            setFormData({ ...formData });\n                                        }\n\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                >\n                                    <option value=\"\">Select</option>\n                                    <option value=\"paid\">Paid</option>\n                                    <option value=\"not_paid\">Not Paid</option>\n                                    <option value=\"paid_partially\">Paid Partially</option>\n                                </select>\n                                {errors.payment_status && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.payment_status}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n\n                        {!formData.id && formData.payment_status === \"paid_partially\" ? <div className=\"col-md-3\">\n                            <label className=\"form-label\">Patial Payment Amount*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    type='number'\n                                    value={formData.partial_payment_amount}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange vat discount\");\n                                        if (!e.target.value) {\n                                            formData.partial_payment_amount = e.target.value;\n                                            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        formData.partial_payment_amount = parseFloat(e.target.value);\n                                        errors[\"partial_payment_amount\"] = \"\";\n\n                                        if (formData.partial_payment_amount >= netTotal) {\n                                            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        setErrors({ ...errors });\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Amount\"\n                                />\n                                {errors.partial_payment_amount && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.partial_payment_amount}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Date*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    selected={formData.date_str ? new Date(formData.date_str) : null}\n                                    value={formData.date_str ? format(\n                                        new Date(formData.date_str),\n                                        \"MMMM d, yyyy h:mm aa\"\n                                    ) : null}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                    showTimeSelect\n                                    timeIntervals=\"1\"\n                                    onChange={(value) => {\n                                        console.log(\"Value\", value);\n                                        formData.date_str = value;\n                                        // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">ID</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.code ? formData.code : \"\"}\n                                    type='string'\n                                    onChange={(e) => {\n                                        errors[\"code\"] = \"\";\n                                        setErrors({ ...errors });\n                                        formData.code = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"code\"\n                                    placeholder=\"Code\"\n                                />\n                                {errors.code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.code}\n                                    </div>\n                                )}\n                                {formData.code && !errors.code && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate}>\n                                {isProcessing ? formData.id ? \"Updating....\" : \"Creating..\" : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>\n                </Modal.Body>\n\n            </Modal >\n\n\n        </>\n    );\n});\n\nexport default OrderCreate;\n"]},"metadata":{},"sourceType":"module"}