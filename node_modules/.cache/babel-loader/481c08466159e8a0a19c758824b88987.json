{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{React,useState,useRef,forwardRef,useImperativeHandle}from\"react\";import{Modal,Button}from'react-bootstrap';import OrderPreviewContent from'./previewContent.js';import Cookies from\"universal-cookie\";import{useReactToPrint}from'react-to-print';import{Invoice}from'@axenda/zatca';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderPreview=/*#__PURE__*/forwardRef(function(props,ref){useImperativeHandle(ref,function(){return{open:function open(modelObj){if(modelObj){model=modelObj;setModel(_objectSpread({},model));if(model.store_id){getStore(model.store_id);}if(model.customer_id){getCustomer(model.customer_id);}if(model.delivered_by){getUser(model.delivered_by);}if(model.delivered_by_signature_id){getSignature(model.delivered_by_signature_id);}var pageSize=20;model.pageSize=pageSize;var totalProducts=model.products.length;var top=0;var totalPagesInt=parseInt(totalProducts/pageSize);var totalPagesFloat=parseFloat(totalProducts/pageSize);var totalPages=totalPagesInt;if(totalPagesFloat-totalPagesInt>0){totalPages++;}model.total_pages=totalPages;model.pages=[];var offset=0;for(var i=0;i<totalPages;i++){model.pages.push({top:top,products:[],lastPage:false,firstPage:false});for(var j=offset;j<totalProducts;j++){model.pages[i].products.push(model.products[j]);if(model.pages[i].products.length===pageSize){break;}}if(model.pages[i].products.length<pageSize){for(var s=model.pages[i].products.length;s<pageSize;s++){model.pages[i].products.push({});}}top+=1057;//1057\noffset+=pageSize;if(i===0){model.pages[i].firstPage=true;}if(i+1===totalPages){model.pages[i].lastPage=true;}}console.log(\"model.pages:\",model.pages);console.log(\"model.products:\",model.products);getQRCodeContents();//model.qr_content = getQRCodeContents();\n//setModel({ ...model });\nsetShow(true);console.log(\"model:\",model);}}};});var cookies=new Cookies();var _useState=useState({}),_useState2=_slicedToArray(_useState,2),model=_useState2[0],setModel=_useState2[1];var _useState3=useState(props.show),_useState4=_slicedToArray(_useState3,2),show=_useState4[0],setShow=_useState4[1];function handleClose(){setShow(false);}var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),qrContent=_useState6[0],setQrContent=_useState6[1];function getQRCodeContents(){qrContent=\"\";if(model.code){qrContent+=\"Invoice #: \"+model.code+\"<br />\";}if(model.store){qrContent+=\"Store: \"+model.store.name+\"<br />\";}if(model.customer){qrContent+=\"Customer: \"+model.customer.name+\"<br />\";}if(model.net_total){qrContent+=\"Net Total: \"+model.net_total+\"<br />\";}qrContent+=\"Store: Test <br />\";setQrContent(qrContent);model.qr_content=qrContent;setModel(_objectSpread({},model));console.log(\"QR content:\",model.qr_content);return model.qr_content;}function getStore(id){console.log(\"inside get Store\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/store/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,storeData,invoice;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);storeData=data.result;model.store=storeData;invoice=new Invoice({sellerName:model.store_name,vatRegistrationNumber:model.store.vat_no,invoiceTimestamp:model.date,invoiceTotal:model.net_total,invoiceVatTotal:model.vat_price});_context.next=17;return invoice.render();case 17:model.QRImageData=_context.sent;console.log(\"model.QRImageData:\",model.QRImageData);setModel(_objectSpread({},model));case 20:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){});}function getCustomer(id){console.log(\"inside get Customer\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/customer/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error,customerData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get('content-type'))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes('application/json');_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}error=data&&data.errors;return _context2.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);customerData=data.result;model.customer=customerData;setModel(_objectSpread({},model));case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){});}function getUser(id){console.log(\"inside get User(Delivered by)\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/user/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response){var _response$headers$get3;var isJson,data,error,userData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isJson=(_response$headers$get3=response.headers.get('content-type'))===null||_response$headers$get3===void 0?void 0:_response$headers$get3.includes('application/json');_context3.t0=isJson;if(!_context3.t0){_context3.next=6;break;}_context3.next=5;return response.json();case 5:_context3.t0=_context3.sent;case 6:data=_context3.t0;if(response.ok){_context3.next=10;break;}error=data&&data.errors;return _context3.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);userData=data.result;model.delivered_by_user=userData;setModel(_objectSpread({},model));case 15:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}()).catch(function(error){});}function getSignature(id){console.log(\"inside get Signature\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/signature/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response){var _response$headers$get4;var isJson,data,error,signatureData;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:isJson=(_response$headers$get4=response.headers.get('content-type'))===null||_response$headers$get4===void 0?void 0:_response$headers$get4.includes('application/json');_context4.t0=isJson;if(!_context4.t0){_context4.next=6;break;}_context4.next=5;return response.json();case 5:_context4.t0=_context4.sent;case 6:data=_context4.t0;if(response.ok){_context4.next=10;break;}error=data&&data.errors;return _context4.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);signatureData=data.result;model.delivered_by_signature=signatureData;setModel(_objectSpread({},model));case 15:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}()).catch(function(error){});}/*\n    function print() {\n        console.log(\"Print\");\n    }\n    */var printAreaRef=useRef();function getFileName(){var filename=\"Sales_\";if(model.id){filename+=\"_#\"+model.code;}return filename;}var handlePrint=useReactToPrint({content:function content(){return printAreaRef.current;},documentTitle:getFileName()});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Modal,{show:show,scrollable:true,size:\"xl\",onHide:handleClose,animation:false,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:\"Invoice Preview\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"primary\",className:\"btn btn-primary mb-3\",onClick:handlePrint,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-printer\"}),\" Print\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(\"div\",{ref:printAreaRef,children:/*#__PURE__*/_jsx(OrderPreviewContent,{model:model})})}),/*#__PURE__*/_jsx(Modal.Footer,{})]})});});export default OrderPreview;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/order/preview.js"],"names":["React","useState","useRef","forwardRef","useImperativeHandle","Modal","Button","OrderPreviewContent","Cookies","useReactToPrint","Invoice","OrderPreview","props","ref","open","modelObj","model","setModel","store_id","getStore","customer_id","getCustomer","delivered_by","getUser","delivered_by_signature_id","getSignature","pageSize","totalProducts","products","length","top","totalPagesInt","parseInt","totalPagesFloat","parseFloat","totalPages","total_pages","pages","offset","i","push","lastPage","firstPage","j","s","console","log","getQRCodeContents","setShow","cookies","show","handleClose","qrContent","setQrContent","code","store","name","customer","net_total","qr_content","id","requestOptions","method","headers","get","fetch","then","response","isJson","includes","json","data","ok","error","errors","Promise","reject","storeData","result","invoice","sellerName","store_name","vatRegistrationNumber","vat_no","invoiceTimestamp","date","invoiceTotal","invoiceVatTotal","vat_price","render","QRImageData","catch","customerData","userData","delivered_by_user","signatureData","delivered_by_signature","printAreaRef","getFileName","filename","handlePrint","content","current","documentTitle"],"mappings":"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","sourcesContent":["import { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport OrderPreviewContent from './previewContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\n\nconst OrderPreview = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(modelObj) {\n            if (modelObj) {\n                model = modelObj;\n                setModel({ ...model })\n\n                if (model.store_id) {\n                    getStore(model.store_id);\n                }\n\n                if (model.customer_id) {\n                    getCustomer(model.customer_id);\n                }\n\n                if (model.delivered_by) {\n                    getUser(model.delivered_by);\n                }\n\n                if (model.delivered_by_signature_id) {\n                    getSignature(model.delivered_by_signature_id);\n                }\n\n                let pageSize = 20;\n                model.pageSize = pageSize;\n                let totalProducts = model.products.length;\n                let top = 0;\n                let totalPagesInt = parseInt(totalProducts / pageSize);\n                let totalPagesFloat = parseFloat(totalProducts / pageSize);\n\n                let totalPages = totalPagesInt;\n                if ((totalPagesFloat - totalPagesInt) > 0) {\n                    totalPages++;\n                }\n\n                model.total_pages = totalPages;\n\n\n                model.pages = [];\n\n\n                let offset = 0;\n\n                for (let i = 0; i < totalPages; i++) {\n                    model.pages.push({\n                        top: top,\n                        products: [],\n                        lastPage: false,\n                        firstPage: false,\n                    });\n\n                    for (let j = offset; j < totalProducts; j++) {\n                        model.pages[i].products.push(model.products[j]);\n\n                        if (model.pages[i].products.length === pageSize) {\n                            break;\n                        }\n                    }\n\n                    if (model.pages[i].products.length < pageSize) {\n                        for (let s = model.pages[i].products.length; s < pageSize; s++) {\n                            model.pages[i].products.push({});\n                        }\n                    }\n\n                    top += 1057; //1057\n                    offset += pageSize;\n\n                    if (i === 0) {\n                        model.pages[i].firstPage = true;\n                    }\n\n                    if ((i + 1) === totalPages) {\n                        model.pages[i].lastPage = true;\n                    }\n                }\n\n                console.log(\"model.pages:\", model.pages);\n                console.log(\"model.products:\", model.products);\n                getQRCodeContents();\n                //model.qr_content = getQRCodeContents();\n                //setModel({ ...model });\n\n                setShow(true);\n                console.log(\"model:\", model);\n            }\n\n        },\n\n    }));\n\n    const cookies = new Cookies();\n\n    let [model, setModel] = useState({});\n\n    const [show, setShow] = useState(props.show);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n\n    let [qrContent, setQrContent] = useState(\"\");\n\n    function getQRCodeContents() {\n        qrContent = \"\";\n\n        if (model.code) {\n            qrContent += \"Invoice #: \" + model.code + \"<br />\";\n        }\n\n        if (model.store) {\n            qrContent += \"Store: \" + model.store.name + \"<br />\";\n        }\n\n        if (model.customer) {\n            qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n        }\n\n\n        if (model.net_total) {\n            qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n        }\n        qrContent += \"Store: Test <br />\";\n\n        setQrContent(qrContent);\n        model.qr_content = qrContent;\n        setModel({ ...model });\n        console.log(\"QR content:\", model.qr_content);\n\n        return model.qr_content;\n    }\n\n    function getStore(id) {\n        console.log(\"inside get Store\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/store/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let storeData = data.result;\n                model.store = storeData;\n\n                const invoice = new Invoice({\n                    sellerName: model.store_name,\n                    vatRegistrationNumber: model.store.vat_no,\n                    invoiceTimestamp: model.date,\n                    invoiceTotal: model.net_total,\n                    invoiceVatTotal: model.vat_price,\n                });\n\n                model.QRImageData = await invoice.render();\n                console.log(\"model.QRImageData:\", model.QRImageData);\n\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n\n\n    function getCustomer(id) {\n        console.log(\"inside get Customer\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/customer/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let customerData = data.result;\n                model.customer = customerData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getUser(id) {\n        console.log(\"inside get User(Delivered by)\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/user/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n\n                console.log(\"Response:\");\n                console.log(data);\n                let userData = data.result;\n                model.delivered_by_user = userData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getSignature(id) {\n        console.log(\"inside get Signature\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/signature/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let signatureData = data.result;\n                model.delivered_by_signature = signatureData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n            });\n    }\n\n\n\n    /*\n    function print() {\n        console.log(\"Print\");\n    }\n    */\n\n    const printAreaRef = useRef();\n\n    function getFileName() {\n        let filename = \"Sales_\";\n\n        if (model.id) {\n            filename += \"_#\" + model.code;\n        }\n\n        return filename;\n    }\n\n    const handlePrint = useReactToPrint({\n        content: () => printAreaRef.current,\n        documentTitle: getFileName(),\n    });\n\n\n    return (<>\n        <Modal show={show} scrollable={true} size=\"xl\" onHide={handleClose} animation={false}>\n            <Modal.Header>\n                <Modal.Title>Invoice Preview</Modal.Title>\n                <div className=\"col align-self-end text-end\">\n                    <Button variant=\"primary\" className=\"btn btn-primary mb-3\" onClick={handlePrint}>\n                        <i className=\"bi bi-printer\"></i> Print\n                    </Button>\n                    <button\n                        type=\"button\"\n                        className=\"btn-close\"\n                        onClick={handleClose}\n                        aria-label=\"Close\"\n                    ></button>\n\n                </div>\n\n            </Modal.Header>\n            <Modal.Body>\n                <div ref={printAreaRef}>\n                    <OrderPreviewContent model={model} />\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n                {/*\n                <Button variant=\"secondary\" onClick={handleClose}>\n                    Close\n                </Button>\n                <Button variant=\"primary\" onClick={handleClose}>\n                    Save Changes\n                </Button>\n                */}\n            </Modal.Footer>\n        </Modal>\n    </>);\n\n});\n\nexport default OrderPreview;"]},"metadata":{},"sourceType":"module"}