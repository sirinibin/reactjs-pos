{"ast":null,"code":"var _jsxFileName = \"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/sales_return_payment/create.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport Cookies from \"universal-cookie\";\nimport { Spinner } from \"react-bootstrap\";\nimport SalesReturnPaymentView from \"./view.js\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SalesReturnPaymentCreate = /*#__PURE__*/forwardRef(_c = _s((props, ref) => {\n  _s();\n\n  useImperativeHandle(ref, () => ({\n    open(id, salesreturn) {\n      salesreturn = salesreturn;\n      setSalesReturn({ ...salesreturn\n      });\n      formData = {\n        method: \"\"\n      };\n      formData.date_str = new Date();\n\n      if (salesreturn) {\n        formData.sales_return_id = salesreturn.id;\n        formData.sales_return_code = salesreturn.code;\n        formData.order_id = salesreturn.order_id;\n        formData.order_code = salesreturn.order_code;\n        formData.store_id = salesreturn.store_id;\n        console.log(\"formData.store_id:\", formData.store_id);\n      } else {\n        console.log(\"Not set\");\n      }\n\n      setFormData(formData);\n      selectedParentCategories = [];\n      setSelectedParentCategories(selectedParentCategories);\n\n      if (id) {\n        getSalesReturnPayment(id);\n      }\n\n      errors = {};\n      setErrors({ ...errors\n      });\n      SetShow(true);\n    }\n\n  }));\n  let [salesreturn, setSalesReturn] = useState({});\n  useEffect(() => {\n    const listener = event => {\n      if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n        console.log(\"Enter key was pressed. Run your function-product category.\"); // event.preventDefault();\n\n        var form = event.target.form;\n\n        if (form && event.target) {\n          var index = Array.prototype.indexOf.call(form, event.target);\n\n          if (form && form.elements[index + 1]) {\n            if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n              form.elements[index].focus();\n            } else {\n              form.elements[index + 1].focus();\n            }\n\n            event.preventDefault();\n          }\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", listener);\n    return () => {\n      document.removeEventListener(\"keydown\", listener);\n    };\n  }, []);\n  let [errors, setErrors] = useState({});\n  const [isProcessing, setProcessing] = useState(false);\n  const cookies = new Cookies();\n  const [parentCategoryOptions, setParentCategoryOptions] = useState([]);\n  let [selectedParentCategories, setSelectedParentCategories] = useState([]);\n  const [isProductCategoriesLoading, setIsProductCategoriesLoading] = useState(false); //fields\n\n  let [formData, setFormData] = useState({});\n  const [show, SetShow] = useState(false);\n\n  function handleClose() {\n    SetShow(false);\n  }\n\n  useEffect(() => {\n    let at = cookies.get(\"access_token\");\n\n    if (!at) {\n      window.location = \"/\";\n    }\n  });\n\n  function getSalesReturnPayment(id) {\n    console.log(\"inside get Product Category\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    formData = {};\n    setFormData({ ...formData\n    });\n    selectedParentCategories = [];\n    setSelectedParentCategories([...selectedParentCategories]);\n    fetch('/v1/sales-return-payment/' + id, requestOptions).then(async response => {\n      var _response$headers$get;\n\n      const isJson = (_response$headers$get = response.headers.get('content-type')) === null || _response$headers$get === void 0 ? void 0 : _response$headers$get.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      console.log(\"Response:\");\n      console.log(data);\n      formData = data.result;\n      formData.date_str = data.result.date;\n      console.log(\"formData:\", formData);\n      /*\n      formData.sales_return_id = salesreturn.id;\n      formData.sales_return_code = salesreturn.code;\n       formData.order_id = salesreturn.order_id;\n      formData.order_code = salesreturn.order_code;\n       formData.store_id = salesreturn.store_id;\n       */\n\n      setFormData({ ...formData\n      });\n      console.log(\"formData:\", formData);\n    }).catch(error => {\n      setProcessing(false);\n      setErrors(error);\n    });\n  }\n\n  function ObjectToSearchQueryParams(object) {\n    return Object.keys(object).map(function (key) {\n      return `search[${key}]=${object[key]}`;\n    }).join(\"&\");\n  }\n\n  function handleCreate(event) {\n    event.preventDefault();\n    console.log(\"Inside handle Create\");\n    console.log(\"formData.logo:\", formData.logo);\n    setIsProductCategoriesLoading(true);\n    let endPoint = \"/v1/sales-return-payment\";\n    let method = \"POST\";\n\n    if (formData.id) {\n      endPoint = \"/v1/sales-return-payment/\" + formData.id;\n      method = \"PUT\";\n    }\n\n    if (formData.amount <= 0) {\n      errors[\"amount\"] = \"Amount should be > 0:\";\n      setErrors({ ...errors\n      });\n      return;\n    }\n\n    if (formData.amount > salesreturn.net_total) {\n      errors[\"amount\"] = \"Amount should be less than or equal to net total amount:\" + salesreturn.net_total;\n      setErrors({ ...errors\n      });\n      return;\n    }\n\n    console.log(\"salesreturn.order_id:\", salesreturn.order_id);\n    formData.order_id = salesreturn.order_id;\n    formData.order_code = salesreturn.order_code;\n    const requestOptions = {\n      method: method,\n      headers: {\n        'Accept': 'application/json',\n        \"Content-Type\": \"application/json\",\n        Authorization: cookies.get(\"access_token\")\n      },\n      body: JSON.stringify(formData)\n    };\n    console.log(\"formData:\", formData);\n    setProcessing(true);\n    fetch(endPoint, requestOptions).then(async response => {\n      var _response$headers$get2;\n\n      const isJson = (_response$headers$get2 = response.headers.get(\"content-type\")) === null || _response$headers$get2 === void 0 ? void 0 : _response$headers$get2.includes(\"application/json\");\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        // get error message from body or default to response status\n        const error = data && data.errors; //const error = data.errors\n\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      setProcessing(false);\n      setIsProductCategoriesLoading(false);\n      console.log(\"Response:\");\n      console.log(data);\n      props.showToastMessage(\"Product Category Created Successfully!\", \"success\");\n\n      if (props.refreshList) {\n        props.refreshList();\n      }\n\n      handleClose();\n\n      if (props.refreshSalesReturnList) {\n        props.refreshSalesReturnList();\n      }\n\n      props.openDetailsView(data.result.id);\n    }).catch(error => {\n      setProcessing(false);\n      setIsProductCategoriesLoading(false);\n      console.log(\"Inside catch\");\n      console.log(error);\n      setErrors({ ...error\n      });\n      console.error(\"There was an error!\", error);\n      props.showToastMessage(\"Error Creating SalesReturnPayment!\", \"danger\");\n    });\n  }\n\n  async function suggestCategories(searchTerm) {\n    console.log(\"Inside handle suggest Categories\");\n    setParentCategoryOptions([]);\n    console.log(\"searchTerm:\" + searchTerm);\n\n    if (!searchTerm) {\n      return;\n    }\n\n    var params = {\n      name: searchTerm\n    };\n    var queryString = ObjectToSearchQueryParams(params);\n\n    if (queryString !== \"\") {\n      queryString = \"&\" + queryString;\n    }\n\n    const requestOptions = {\n      method: \"GET\",\n      headers: {\n        Authorization: cookies.get(\"access_token\"),\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    let Select = \"select=id,name\";\n    setIsProductCategoriesLoading(true);\n    let result = await fetch(\"/v1/sales-return-payment?\" + Select + queryString, requestOptions);\n    let data = await result.json();\n    setParentCategoryOptions(data.result);\n    setIsProductCategoriesLoading(false);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      show: show,\n      size: \"lg\",\n      onHide: handleClose,\n      animation: false,\n      backdrop: \"static\",\n      scrollable: true,\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        children: [/*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: formData.id ? \"Update Payment of sales return #\" + formData.sales_return_code : \"Add Payment of sales return  #\" + formData.sales_return_code\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col align-self-end text-end\",\n          children: [formData.id ? /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: () => {\n              handleClose();\n              props.openDetailsView(formData.id);\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-eye\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 29\n            }, this), \" View Detail\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 40\n          }, this) : \"\", \"\\xA0\\xA0\", /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleCreate,\n            children: [isProcessing ? /*#__PURE__*/_jsxDEV(Spinner, {\n              as: \"span\",\n              animation: \"bsalesreturn\",\n              size: \"sm\",\n              role: \"status\",\n              \"aria-hidden\": true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 33\n            }, this) + \" Creating...\" : \"\", formData.id ? \"Update\" : \"Create\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn-close\",\n            onClick: handleClose,\n            \"aria-label\": \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"row g-3 needs-validation\",\n          onSubmit: handleCreate,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"form-label\",\n              children: \"Amount*\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group mb-3\",\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                value: formData.amount ? formData.amount : \"\",\n                type: \"number\",\n                onChange: e => {\n                  console.log(\"Inside onchange vat \");\n\n                  if (!e.target.value) {\n                    formData.amount = e.target.value;\n                    errors[\"amount\"] = \"Invalid amount\";\n                    setErrors({ ...errors\n                    });\n                    return;\n                  }\n\n                  if (parseFloat(e.target.value) <= 0) {\n                    formData.amount = e.target.value;\n                    errors[\"amount\"] = \"Amount should be > 0\";\n                    setErrors({ ...errors\n                    });\n                    return;\n                  }\n\n                  formData.amount = parseFloat(e.target.value);\n                  errors[\"amount\"] = \"\";\n\n                  if (formData.amount > salesreturn.net_total) {\n                    errors[\"amount\"] = \"Amount should be less than or equal to net total amount:\" + salesreturn.net_total;\n                    setErrors({ ...errors\n                    });\n                    return;\n                  }\n\n                  setErrors({ ...errors\n                  });\n                  setFormData({ ...formData\n                  });\n                  console.log(formData);\n                },\n                className: \"form-control\",\n                id: \"name\",\n                placeholder: \"Amount\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 338,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 29\n            }, this), errors.amount && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                color: \"red\"\n              },\n              children: errors.amount\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 376,\n              columnNumber: 33\n            }, this), formData.amount && !errors.amount && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                color: \"green\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-check-lg\",\n                children: \" \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 382,\n                columnNumber: 37\n              }, this), \"Looks good!\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"form-label\",\n              children: \"Date*\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 389,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(DatePicker, {\n                id: \"date_str\",\n                selected: formData.date_str ? new Date(formData.date_str) : null,\n                value: formData.date_str ? format(new Date(formData.date_str), \"MMMM d, yyyy h:mm aa\") : null,\n                className: \"form-control\",\n                dateFormat: \"MMMM d, yyyy h:mm aa\",\n                showTimeSelect: true,\n                timeIntervals: \"1\",\n                onChange: value => {\n                  console.log(\"Value\", value);\n                  formData.date_str = value; // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n\n                  setFormData({ ...formData\n                  });\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 392,\n                columnNumber: 33\n              }, this), errors.date_str && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: \"red\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"bi bi-x-lg\",\n                  children: \" \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 413,\n                  columnNumber: 41\n                }, this), errors.date_str]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 412,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 391,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-md-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"form-label\",\n                children: \"Payment method*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 424,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"input-group mb-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"select\", {\n                  value: formData.method,\n                  onChange: e => {\n                    console.log(\"Inside onchange payment method\");\n\n                    if (!e.target.value) {\n                      errors[\"method\"] = \"Invalid Payment Method\";\n                      formData.method = \"\";\n                      setFormData({ ...formData\n                      });\n                      setErrors({ ...errors\n                      });\n                      return;\n                    }\n\n                    errors[\"method\"] = \"\";\n                    setErrors({ ...errors\n                    });\n                    formData.method = e.target.value;\n                    setFormData({ ...formData\n                    });\n                    console.log(formData);\n                  },\n                  className: \"form-control\",\n                  children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"\",\n                    children: \"Select\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 448,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"cash\",\n                    children: \"Cash\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 449,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"bank_account\",\n                    children: \"Bank Account / Debit / Credit Card\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 450,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 427,\n                  columnNumber: 37\n                }, this), errors.method && /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    color: \"red\"\n                  },\n                  children: errors.method\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 453,\n                  columnNumber: 41\n                }, this), formData.method && !errors.method && /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    color: \"green\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"bi bi-check-lg\",\n                    children: \" \"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 459,\n                    columnNumber: 45\n                  }, this), \"Looks good!\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 458,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 426,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 423,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 422,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row  g-5\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-md-3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 468,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 467,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"secondary\",\n              onClick: handleClose,\n              children: \"Close\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 473,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"primary\",\n              onClick: handleCreate,\n              children: isProcessing ? /*#__PURE__*/_jsxDEV(Spinner, {\n                as: \"span\",\n                animation: \"bsalesreturnpayment\",\n                size: \"sm\",\n                role: \"status\",\n                \"aria-hidden\": true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 478,\n                columnNumber: 37\n              }, this) + \" Processing...\" : formData.id ? \"Update\" : \"Create\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 476,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n}, \"iR0sqwxiVxJGXqyNC2CHbF+G4Zo=\", false, function () {\n  return [useImperativeHandle];\n}));\n_c2 = SalesReturnPaymentCreate;\nexport default SalesReturnPaymentCreate;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"SalesReturnPaymentCreate$forwardRef\");\n$RefreshReg$(_c2, \"SalesReturnPaymentCreate\");","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/sales_return_payment/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","Modal","Button","Cookies","Spinner","SalesReturnPaymentView","Typeahead","DatePicker","format","SalesReturnPaymentCreate","props","ref","open","id","salesreturn","setSalesReturn","formData","method","date_str","Date","sales_return_id","sales_return_code","code","order_id","order_code","store_id","console","log","setFormData","selectedParentCategories","setSelectedParentCategories","getSalesReturnPayment","errors","setErrors","SetShow","listener","event","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","includes","focus","preventDefault","document","addEventListener","removeEventListener","isProcessing","setProcessing","cookies","parentCategoryOptions","setParentCategoryOptions","isProductCategoriesLoading","setIsProductCategoriesLoading","show","handleClose","at","get","window","location","requestOptions","headers","fetch","then","response","isJson","data","json","ok","error","Promise","reject","result","date","catch","ObjectToSearchQueryParams","object","Object","keys","map","key","join","handleCreate","logo","endPoint","amount","net_total","Authorization","body","JSON","stringify","showToastMessage","refreshList","refreshSalesReturnList","openDetailsView","suggestCategories","searchTerm","params","name","queryString","Select","e","value","parseFloat","color"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport Cookies from \"universal-cookie\";\nimport { Spinner } from \"react-bootstrap\";\nimport SalesReturnPaymentView from \"./view.js\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\n\n\nconst SalesReturnPaymentCreate = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(id, salesreturn) {\n            salesreturn = salesreturn;\n            setSalesReturn({ ...salesreturn });\n            formData = {\n                method: \"\",\n            };\n\n            formData.date_str = new Date();\n\n            if (salesreturn) {\n                formData.sales_return_id = salesreturn.id;\n                formData.sales_return_code = salesreturn.code;\n\n                formData.order_id = salesreturn.order_id;\n                formData.order_code = salesreturn.order_code;\n\n                formData.store_id = salesreturn.store_id;\n                console.log(\"formData.store_id:\",formData.store_id);\n            }else {\n                console.log(\"Not set\");\n            }\n            \n            setFormData(formData);\n            selectedParentCategories = [];\n            setSelectedParentCategories(selectedParentCategories);\n\n            if (id) {\n                getSalesReturnPayment(id);\n            }\n            errors = {};\n            setErrors({ ...errors });\n            SetShow(true);\n        },\n\n    }));\n\n    let [salesreturn, setSalesReturn] = useState({});\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function-product category.\");\n                // event.preventDefault();\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n    let [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    const [parentCategoryOptions, setParentCategoryOptions] = useState([]);\n    let [selectedParentCategories, setSelectedParentCategories] = useState([]);\n    const [isProductCategoriesLoading, setIsProductCategoriesLoading] = useState(false);\n\n    //fields\n    let [formData, setFormData] = useState({});\n\n    const [show, SetShow] = useState(false);\n\n    function handleClose() {\n        SetShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            window.location = \"/\";\n        }\n    });\n\n\n    function getSalesReturnPayment(id) {\n        console.log(\"inside get Product Category\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n        formData = {};\n        setFormData({ ...formData });\n        selectedParentCategories = [];\n        setSelectedParentCategories([...selectedParentCategories]);\n        fetch('/v1/sales-return-payment/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                formData = data.result;\n                formData.date_str = data.result.date;\n                console.log(\"formData:\", formData);\n\n                /*\n                formData.sales_return_id = salesreturn.id;\n                formData.sales_return_code = salesreturn.code;\n\n                formData.order_id = salesreturn.order_id;\n                formData.order_code = salesreturn.order_code;\n\n                formData.store_id = salesreturn.store_id;\n                 */\n\n                setFormData({ ...formData });\n                console.log(\"formData:\", formData);\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=${object[key]}`;\n            })\n            .join(\"&\");\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        console.log(\"Inside handle Create\");\n\n\n        console.log(\"formData.logo:\", formData.logo);\n\n        setIsProductCategoriesLoading(true);\n\n        let endPoint = \"/v1/sales-return-payment\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/sales-return-payment/\" + formData.id;\n            method = \"PUT\";\n        }\n\n        if (formData.amount <= 0) {\n            errors[\"amount\"] = \"Amount should be > 0:\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        if (formData.amount > salesreturn.net_total) {\n            errors[\"amount\"] = \"Amount should be less than or equal to net total amount:\" + salesreturn.net_total;\n            setErrors({ ...errors });\n            return;\n        }\n\n        console.log(\"salesreturn.order_id:\", salesreturn.order_id);\n\n        formData.order_id = salesreturn.order_id;\n        formData.order_code = salesreturn.order_code;\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n                setIsProductCategoriesLoading(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"Product Category Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n                handleClose();\n                if (props.refreshSalesReturnList) {\n                    props.refreshSalesReturnList();\n                }\n                props.openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                setIsProductCategoriesLoading(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating SalesReturnPayment!\", \"danger\");\n            });\n    }\n\n    async function suggestCategories(searchTerm) {\n        console.log(\"Inside handle suggest Categories\");\n        setParentCategoryOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                Authorization: cookies.get(\"access_token\"),\n                \"Content-Type\": \"application/json\",\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsProductCategoriesLoading(true);\n        let result = await fetch(\n            \"/v1/sales-return-payment?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setParentCategoryOptions(data.result);\n        setIsProductCategoriesLoading(false);\n    }\n\n\n\n    return (\n        <>\n            <Modal show={show} size=\"lg\" onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Payment of sales return #\" + formData.sales_return_code : \"Add Payment of sales return  #\" + formData.sales_return_code}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        {formData.id ? <Button variant=\"primary\" onClick={() => {\n                            handleClose();\n                            props.openDetailsView(formData.id);\n                        }}>\n                            <i className=\"bi bi-eye\"></i> View Detail\n                        </Button> : \"\"}\n                        &nbsp;&nbsp;\n                        <Button variant=\"primary\" onClick={handleCreate} >\n                            {isProcessing ?\n                                <Spinner\n                                    as=\"span\"\n                                    animation=\"bsalesreturn\"\n                                    size=\"sm\"\n                                    role=\"status\"\n                                    aria-hidden={true}\n                                /> + \" Creating...\"\n\n                                : \"\"\n                            }\n                            {formData.id ? \"Update\" : \"Create\"}\n\n                        </Button>\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    <form className=\"row g-3 needs-validation\" onSubmit={handleCreate}>\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Amount*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.amount ? formData.amount : \"\"}\n                                    type='number'\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange vat \");\n                                        if (!e.target.value) {\n                                            formData.amount = e.target.value;\n                                            errors[\"amount\"] = \"Invalid amount\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        if (parseFloat(e.target.value) <= 0) {\n                                            formData.amount = e.target.value;\n                                            errors[\"amount\"] = \"Amount should be > 0\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n\n                                        formData.amount = parseFloat(e.target.value);\n                                        errors[\"amount\"] = \"\";\n\n                                        if (formData.amount > salesreturn.net_total) {\n                                            errors[\"amount\"] = \"Amount should be less than or equal to net total amount:\" + salesreturn.net_total;\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        setErrors({ ...errors });\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"name\"\n                                    placeholder=\"Amount\"\n                                />\n                            </div>\n                            {errors.amount && (\n                                <div style={{ color: \"red\" }}>\n                                    {errors.amount}\n                                </div>\n                            )}\n                            {formData.amount && !errors.amount && (\n                                <div style={{ color: \"green\" }}>\n                                    <i className=\"bi bi-check-lg\"> </i>\n                                    Looks good!\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Date*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    selected={formData.date_str ? new Date(formData.date_str) : null}\n                                    value={formData.date_str ? format(\n                                        new Date(formData.date_str),\n                                        \"MMMM d, yyyy h:mm aa\"\n                                    ) : null}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                    showTimeSelect\n                                    timeIntervals=\"1\"\n                                    onChange={(value) => {\n                                        console.log(\"Value\", value);\n                                        formData.date_str = value;\n                                        // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n\n                        </div>\n\n\n                        <div className=\"row\">\n                            <div className=\"col-md-3\">\n                                <label className=\"form-label\">Payment method*</label>\n\n                                <div className=\"input-group mb-3\" >\n                                    <select\n                                        value={formData.method}\n                                        onChange={(e) => {\n                                            console.log(\"Inside onchange payment method\");\n                                            if (!e.target.value) {\n                                                errors[\"method\"] = \"Invalid Payment Method\";\n                                                formData.method=\"\";\n                                                setFormData({ ...formData });\n                                                setErrors({ ...errors });\n                                                return;\n                                            }\n\n                                            errors[\"method\"] = \"\";\n                                            setErrors({ ...errors });\n\n                                            formData.method = e.target.value;\n                                            setFormData({ ...formData });\n                                            console.log(formData);\n                                        }}\n                                        className=\"form-control\"\n                                    >\n                                        <option value=\"\">Select</option>\n                                        <option value=\"cash\">Cash</option>\n                                        <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                    </select>\n                                    {errors.method && (\n                                        <div style={{ color: \"red\" }}>\n                                            {errors.method}\n                                        </div>\n                                    )}\n                                    {formData.method && !errors.method && (\n                                        <div style={{ color: \"green\" }}>\n                                            <i className=\"bi bi-check-lg\"> </i>\n                                            Looks good!\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"row  g-5\">\n                            <div className=\"col-md-3\">\n                            </div>\n                        </div>\n\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate} >\n                                {isProcessing ?\n                                    <Spinner\n                                        as=\"span\"\n                                        animation=\"bsalesreturnpayment\"\n                                        size=\"sm\"\n                                        role=\"status\"\n                                        aria-hidden={true}\n                                    /> + \" Processing...\"\n\n                                    : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>\n                </Modal.Body>\n\n            </Modal>\n\n\n        </>\n    );\n});\n\nexport default SalesReturnPaymentCreate;\n"]},"metadata":{},"sourceType":"module"}