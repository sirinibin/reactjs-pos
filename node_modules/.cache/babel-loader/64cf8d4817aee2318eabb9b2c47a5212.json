{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{React,useState,useRef,forwardRef,useImperativeHandle}from\"react\";import{Modal,Button}from'react-bootstrap';import PurchasePreviewContent from'./previewContent.js';import Cookies from\"universal-cookie\";import{useReactToPrint}from'react-to-print';import{Invoice}from'@axenda/zatca';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var QuotationPreview=/*#__PURE__*/forwardRef(function(props,ref){useImperativeHandle(ref,function(){return{open:function open(modelObj){if(modelObj){model=modelObj;setModel(_objectSpread({},model));if(model.store_id){getStore(model.store_id);}if(model.vendor_id){getVendor(model.vendor_id);}if(model.order_placed_by){getUser(model.order_placed_by);}if(model.order_placed_by_signature_id){getSignature(model.order_placed_by_signature_id);}var pageSize=16;model.pageSize=pageSize;var totalProducts=model.products.length;var top=0;var totalPagesInt=parseInt(totalProducts/pageSize);var totalPagesFloat=parseFloat(totalProducts/pageSize);var totalPages=totalPagesInt;if(totalPagesFloat-totalPagesInt>0){totalPages++;}model.total_pages=totalPages;model.pages=[];var offset=0;for(var i=0;i<totalPages;i++){model.pages.push({top:top,products:[],lastPage:false,firstPage:false});for(var j=offset;j<totalProducts;j++){model.pages[i].products.push(model.products[j]);if(model.pages[i].products.length===pageSize){break;}}top+=1057;offset+=pageSize;if(i===0){model.pages[i].firstPage=true;}if(i+1===totalPages){model.pages[i].lastPage=true;}}console.log(\"model.pages:\",model.pages);console.log(\"model.products:\",model.products);getQRCodeContents();//model.qr_content = getQRCodeContents();\n//setModel({ ...model });\nsetShow(true);console.log(\"model:\",model);}}};});var cookies=new Cookies();var _useState=useState({}),_useState2=_slicedToArray(_useState,2),model=_useState2[0],setModel=_useState2[1];var _useState3=useState(props.show),_useState4=_slicedToArray(_useState3,2),show=_useState4[0],setShow=_useState4[1];function handleClose(){setShow(false);}var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),qrContent=_useState6[0],setQrContent=_useState6[1];function getVendor(id){console.log(\"inside get Order\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/vendor/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,vendorData,invoice;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);vendorData=data.result;model.vendor=vendorData;invoice=new Invoice({sellerName:model.vendor.name,vatRegistrationNumber:model.vendor.vat_no,invoiceTimestamp:model.date,invoiceTotal:model.net_total,invoiceVatTotal:model.vat_price});_context.next=17;return invoice.render();case 17:model.QRImageData=_context.sent;setModel(_objectSpread({},model));case 19:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){});}function getQRCodeContents(){qrContent=\"\";if(model.code){qrContent+=\"Quotation #: \"+model.code+\"<br />\";}if(model.store){qrContent+=\"Store: \"+model.store.name+\"<br />\";}if(model.customer){qrContent+=\"Customer: \"+model.customer.name+\"<br />\";}if(model.net_total){qrContent+=\"Net Total: \"+model.net_total+\"<br />\";}qrContent+=\"Store: Test <br />\";setQrContent(qrContent);model.qr_content=qrContent;setModel(_objectSpread({},model));console.log(\"QR content:\",model.qr_content);return model.qr_content;}function getStore(id){console.log(\"inside get Store\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/store/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error,storeData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get('content-type'))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes('application/json');_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}error=data&&data.errors;return _context2.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);storeData=data.result;model.store=storeData;setModel(_objectSpread({},model));case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){});}function getUser(id){console.log(\"inside get User(Delivered by)\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/user/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response){var _response$headers$get3;var isJson,data,error,userData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isJson=(_response$headers$get3=response.headers.get('content-type'))===null||_response$headers$get3===void 0?void 0:_response$headers$get3.includes('application/json');_context3.t0=isJson;if(!_context3.t0){_context3.next=6;break;}_context3.next=5;return response.json();case 5:_context3.t0=_context3.sent;case 6:data=_context3.t0;if(response.ok){_context3.next=10;break;}error=data&&data.errors;return _context3.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);userData=data.result;model.order_placed_by_user=userData;setModel(_objectSpread({},model));case 15:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}()).catch(function(error){});}function getSignature(id){console.log(\"inside get Signature\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/signature/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(response){var _response$headers$get4;var isJson,data,error,signatureData;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:isJson=(_response$headers$get4=response.headers.get('content-type'))===null||_response$headers$get4===void 0?void 0:_response$headers$get4.includes('application/json');_context4.t0=isJson;if(!_context4.t0){_context4.next=6;break;}_context4.next=5;return response.json();case 5:_context4.t0=_context4.sent;case 6:data=_context4.t0;if(response.ok){_context4.next=10;break;}error=data&&data.errors;return _context4.abrupt(\"return\",Promise.reject(error));case 10:console.log(\"Response:\");console.log(data);signatureData=data.result;model.order_placed_by_signature=signatureData;setModel(_objectSpread({},model));case 15:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}()).catch(function(error){});}/*\n    function print() {\n        console.log(\"Print\");\n    }\n    */var printAreaRef=useRef();function getFileName(){var filename=\"Quotation\";if(model.id){filename+=\"_#\"+model.code;}return filename;}var handlePrint=useReactToPrint({content:function content(){return printAreaRef.current;},documentTitle:getFileName()});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Modal,{show:show,scrollable:true,size:\"xl\",onHide:handleClose,animation:false,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:\"Purchase Invoice Preview\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"primary\",className:\"btn btn-primary mb-3\",onClick:handlePrint,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-printer\"}),\" Print\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(\"div\",{ref:printAreaRef,children:/*#__PURE__*/_jsx(PurchasePreviewContent,{model:model})})}),/*#__PURE__*/_jsx(Modal.Footer,{})]})});});export default QuotationPreview;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/purchase/preview.js"],"names":["React","useState","useRef","forwardRef","useImperativeHandle","Modal","Button","PurchasePreviewContent","Cookies","useReactToPrint","Invoice","QuotationPreview","props","ref","open","modelObj","model","setModel","store_id","getStore","vendor_id","getVendor","order_placed_by","getUser","order_placed_by_signature_id","getSignature","pageSize","totalProducts","products","length","top","totalPagesInt","parseInt","totalPagesFloat","parseFloat","totalPages","total_pages","pages","offset","i","push","lastPage","firstPage","j","console","log","getQRCodeContents","setShow","cookies","show","handleClose","qrContent","setQrContent","id","requestOptions","method","headers","get","fetch","then","response","isJson","includes","json","data","ok","error","errors","Promise","reject","vendorData","result","vendor","invoice","sellerName","name","vatRegistrationNumber","vat_no","invoiceTimestamp","date","invoiceTotal","net_total","invoiceVatTotal","vat_price","render","QRImageData","catch","code","store","customer","qr_content","storeData","userData","order_placed_by_user","signatureData","order_placed_by_signature","printAreaRef","getFileName","filename","handlePrint","content","current","documentTitle"],"mappings":"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","sourcesContent":["import { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport PurchasePreviewContent from './previewContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\n\nconst QuotationPreview = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(modelObj) {\n            if (modelObj) {\n                model = modelObj;\n                setModel({ ...model })\n\n                if (model.store_id) {\n                    getStore(model.store_id);\n                }\n\n                if (model.vendor_id) {\n                    getVendor(model.vendor_id);\n                }\n\n                if (model.order_placed_by) {\n                    getUser(model.order_placed_by);\n                }\n\n                if (model.order_placed_by_signature_id) {\n                    getSignature(model.order_placed_by_signature_id);\n                }\n\n                let pageSize = 16;\n                model.pageSize = pageSize;\n                let totalProducts = model.products.length;\n                let top = 0;\n                let totalPagesInt = parseInt(totalProducts / pageSize);\n                let totalPagesFloat = parseFloat(totalProducts / pageSize);\n\n                let totalPages = totalPagesInt;\n                if ((totalPagesFloat - totalPagesInt) > 0) {\n                    totalPages++;\n                }\n\n                model.total_pages = totalPages;\n\n\n                model.pages = [];\n\n\n                let offset = 0;\n\n                for (let i = 0; i < totalPages; i++) {\n                    model.pages.push({\n                        top: top,\n                        products: [],\n                        lastPage: false,\n                        firstPage: false,\n                    });\n\n                    for (let j = offset; j < totalProducts; j++) {\n                        model.pages[i].products.push(model.products[j]);\n\n                        if (model.pages[i].products.length === pageSize) {\n                            break;\n                        }\n                    }\n\n                    top += 1057;\n                    offset += pageSize;\n\n                    if (i === 0) {\n                        model.pages[i].firstPage = true;\n                    }\n\n                    if ((i + 1) === totalPages) {\n                        model.pages[i].lastPage = true;\n                    }\n                }\n\n                console.log(\"model.pages:\", model.pages);\n\n                console.log(\"model.products:\", model.products);\n                getQRCodeContents();\n                //model.qr_content = getQRCodeContents();\n                //setModel({ ...model });\n\n                setShow(true);\n                console.log(\"model:\", model);\n            }\n\n        },\n\n    }));\n\n    const cookies = new Cookies();\n\n    let [model, setModel] = useState({});\n\n    const [show, setShow] = useState(props.show);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n\n    let [qrContent, setQrContent] = useState(\"\");\n\n    function getVendor(id) {\n        console.log(\"inside get Order\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/vendor/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let vendorData = data.result;\n                model.vendor = vendorData;\n\n                const invoice = new Invoice({\n                    sellerName: model.vendor.name,\n                    vatRegistrationNumber: model.vendor.vat_no,\n                    invoiceTimestamp: model.date,\n                    invoiceTotal: model.net_total,\n                    invoiceVatTotal: model.vat_price,\n                });\n\n                model.QRImageData = await invoice.render();\n\n\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getQRCodeContents() {\n        qrContent = \"\";\n\n        if (model.code) {\n            qrContent += \"Quotation #: \" + model.code + \"<br />\";\n        }\n\n        if (model.store) {\n            qrContent += \"Store: \" + model.store.name + \"<br />\";\n        }\n\n        if (model.customer) {\n            qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n        }\n\n\n        if (model.net_total) {\n            qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n        }\n        qrContent += \"Store: Test <br />\";\n\n        setQrContent(qrContent);\n        model.qr_content = qrContent;\n        setModel({ ...model });\n        console.log(\"QR content:\", model.qr_content);\n\n        return model.qr_content;\n    }\n\n    function getStore(id) {\n        console.log(\"inside get Store\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/store/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let storeData = data.result;\n                model.store = storeData;\n\n                \n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getUser(id) {\n        console.log(\"inside get User(Delivered by)\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/user/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n\n                console.log(\"Response:\");\n                console.log(data);\n                let userData = data.result;\n                model.order_placed_by_user = userData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getSignature(id) {\n        console.log(\"inside get Signature\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/signature/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let signatureData = data.result;\n                model.order_placed_by_signature = signatureData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n\n\n    /*\n    function print() {\n        console.log(\"Print\");\n    }\n    */\n\n    const printAreaRef = useRef();\n\n    function getFileName() {\n        let filename = \"Quotation\";\n\n        if (model.id) {\n            filename += \"_#\" + model.code;\n        }\n\n        return filename;\n    }\n\n    const handlePrint = useReactToPrint({\n        content: () => printAreaRef.current,\n        documentTitle: getFileName(),\n    });\n\n\n    return (<>\n        <Modal show={show} scrollable={true} size=\"xl\" onHide={handleClose} animation={false}>\n            <Modal.Header>\n                <Modal.Title>Purchase Invoice Preview</Modal.Title>\n                <div className=\"col align-self-end text-end\">\n                    <Button variant=\"primary\" className=\"btn btn-primary mb-3\" onClick={handlePrint}>\n                        <i className=\"bi bi-printer\"></i> Print\n                    </Button>\n                    <button\n                        type=\"button\"\n                        className=\"btn-close\"\n                        onClick={handleClose}\n                        aria-label=\"Close\"\n                    ></button>\n\n                </div>\n\n            </Modal.Header>\n            <Modal.Body>\n                <div ref={printAreaRef}>\n                    <PurchasePreviewContent model={model} />\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n                {/*\n                <Button variant=\"secondary\" onClick={handleClose}>\n                    Close\n                </Button>\n                <Button variant=\"primary\" onClick={handleClose}>\n                    Save Changes\n                </Button>\n                */}\n            </Modal.Footer>\n        </Modal>\n    </>);\n\n});\n\nexport default QuotationPreview;"]},"metadata":{},"sourceType":"module"}