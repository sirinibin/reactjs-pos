{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from\"react\";import PurchasePreview from\"./preview.js\";import{Modal,Button,Form}from\"react-bootstrap\";import StoreCreate from\"../store/create.js\";import VendorCreate from\"./../vendor/create.js\";import ProductCreate from\"./../product/create.js\";import UserCreate from\"./../user/create.js\";import SignatureCreate from\"./../signature/create.js\";import Cookies from\"universal-cookie\";import{Typeahead}from\"react-bootstrap-typeahead\";import NumberFormat from\"react-number-format\";import DatePicker from\"react-datepicker\";import{format}from\"date-fns\";import{Spinner}from\"react-bootstrap\";import PurchaseView from\"./view.js\";import ProductView from\"./../product/view.js\";import{DebounceInput}from'react-debounce-input';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PurchaseCreate=/*#__PURE__*/forwardRef(function(props,ref){var _totalPaymentAmount,_balanceAmount;useImperativeHandle(ref,function(){return{open:function open(id){selectedProducts=[];setSelectedProducts([]);selectedStores=[];setSelectedStores([]);selectedVendors=[];setSelectedVendors([]);selectedOrderPlacedByUsers=[];setSelectedOrderPlacedByUsers([]);selectedOrderPlacedBySignatures=[];setSelectedOrderPlacedBySignatures([]);formData={vat_percent:15.0,discount:0.0,discountValue:0.0,discount_percent:0.0,shipping_handling_fees:0.00,partial_payment_amount:0.00,is_discount_percent:false,date_str:new Date(),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"delivered\",payment_method:\"\",payment_status:\"paid\"};formData.payments_input=[{\"date_str\":formData.date_str,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false}];formData.cash_discount=0.00;if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');formData.store_name=cookies.get('store_name');}if(cookies.get(\"user_id\")){selectedOrderPlacedByUsers=[{id:cookies.get(\"user_id\"),name:cookies.get(\"user_name\")}];formData.order_placed_by=cookies.get(\"user_id\");formData.vat_percent=parseFloat(cookies.get('vat_percent'));setFormData(_objectSpread({},formData));setSelectedOrderPlacedByUsers(_toConsumableArray(selectedOrderPlacedByUsers));}setFormData(_objectSpread({},formData));if(id){getPurchase(id);}reCalculate();setShow(true);}};});useEffect(function(){var listener=function listener(event){if(event.code===\"Enter\"||event.code===\"NumpadEnter\"){console.log(\"Enter key was pressed. Run your function-purchase.\");// event.preventDefault();\nvar form=event.target.form;if(form&&event.target){var index=Array.prototype.indexOf.call(form,event.target);if(form&&form.elements[index+1]){if(event.target.getAttribute(\"class\").includes(\"barcode\")){form.elements[index].focus();}else{form.elements[index+1].focus();}event.preventDefault();}}}};document.addEventListener(\"keydown\",listener);return function(){document.removeEventListener(\"keydown\",listener);};},[]);useEffect(function(){console.log(\"inside change on formData:\",formData);// localStorage\n});var selectedDate=new Date();//const history = useHistory();\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();//fields\nvar _useState5=useState({vat_percent:10.0,discount:0.0,discountValue:0.0,discount_percent:0.0,is_discount_percent:false,date_str:format(new Date(),\"MMM dd yyyy\"),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"created\"}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];//Store Auto Suggestion\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),storeOptions=_useState8[0],setStoreOptions=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedStores=_useState10[0],setSelectedStores=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isStoresLoading=_useState12[0],setIsStoresLoading=_useState12[1];//Vendor Auto Suggestion\nvar _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),vendorOptions=_useState14[0],setVendorOptions=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedVendors=_useState16[0],setSelectedVendors=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isVendorsLoading=_useState18[0],setIsVendorsLoading=_useState18[1];//Product Auto Suggestion\nvar _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),productOptions=_useState20[0],setProductOptions=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),selectedProduct=_useState22[0],setSelectedProduct=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),selectedProducts=_useState24[0],setSelectedProducts=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isProductsLoading=_useState26[0],setIsProductsLoading=_useState26[1];//Order Placed By Auto Suggestion\nvar _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),orderPlacedByUserOptions=_useState28[0],setOrderPlacedByUserOptions=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),selectedOrderPlacedByUsers=_useState30[0],setSelectedOrderPlacedByUsers=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isOrderPlacedByUsersLoading=_useState32[0],setIsOrderPlacedByUsersLoading=_useState32[1];//Order Placed By Signature Auto Suggestion\nvar _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),orderPlacedBySignatureOptions=_useState34[0],setOrderPlacedBySignatureOptions=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),selectedOrderPlacedBySignatures=_useState36[0],setSelectedOrderPlacedBySignatures=_useState36[1];var _useState37=useState(false),_useState38=_slicedToArray(_useState37,2),isOrderPlacedBySignaturesLoading=_useState38[0],setIsOrderPlacedBySignaturesLoading=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),show=_useState40[0],setShow=_useState40[1];function handleClose(){setShow(false);}useEffect(function(){var at=cookies.get(\"access_token\");if(!at){// history.push(\"/dashboard/purchases\");\nwindow.location=\"/\";}});function getPurchase(id){console.log(\"inside get Purchase\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/purchase/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,purchase,i,_formData$payments_in,selectedStores,selectedVendors,selectedOrderPlacedByUsers,_selectedOrderPlacedBySignatures;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);purchase=data.result;formData={id:purchase.id,code:purchase.code,store_id:purchase.store_id,vendor_id:purchase.vendor_id,date_str:purchase.date,// date: purchase.date,\nvat_percent:purchase.vat_percent,discount:purchase.discount,cash_discount:purchase.cash_discount,discount_percent:purchase.discount_percent,status:purchase.status,order_placed_by:purchase.order_placed_by,order_placed_by_signature_id:purchase.order_placed_by_signature_id,is_discount_percent:purchase.is_discount_percent,partial_payment_amount:purchase.partial_payment_amount,payment_method:purchase.payment_method,payment_status:purchase.payment_status,shipping_handling_fees:purchase.shipping_handling_fees};if(data.result.payments){console.log(\"data.result.payments:\",data.result.payments);formData.payments_input=data.result.payments;for(i=0;i<((_formData$payments_in=formData.payments_input)===null||_formData$payments_in===void 0?void 0:_formData$payments_in.length);i++){formData.payments_input[i].date_str=formData.payments_input[i].date;}}if(formData.is_discount_percent){formData.discountValue=formData.discount_percent;}else{formData.discountValue=formData.discount;}selectedProducts=purchase.products;setSelectedProducts(_toConsumableArray(selectedProducts));selectedStores=[{id:purchase.store_id,name:purchase.store_name}];selectedVendors=[{id:purchase.vendor_id,name:purchase.vendor_name,search_label:purchase.vendor_name}];selectedOrderPlacedByUsers=[{id:purchase.order_placed_by,name:purchase.order_placed_by_name}];if(purchase.order_placed_by_signature_id){_selectedOrderPlacedBySignatures=[{id:purchase.order_placed_by_signature_id,name:purchase.order_placed_by_signature_name}];setSelectedOrderPlacedBySignatures([].concat(_selectedOrderPlacedBySignatures));}setSelectedOrderPlacedByUsers([].concat(selectedOrderPlacedByUsers));setSelectedStores([].concat(selectedStores));setSelectedVendors([].concat(selectedVendors));reCalculate();setFormData(_objectSpread({},formData));case 28:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}function ObjectToSearchQueryParams(object){return Object.keys(object).map(function(key){return\"search[\".concat(key,\"]=\")+encodeURIComponent(object[key]);}).join(\"&\");}function suggestStores(_x2){return _suggestStores.apply(this,arguments);}function _suggestStores(){_suggestStores=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"Inside handle suggestStores\");setStoreOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsStoresLoading(true);_context3.next=13;return fetch(\"/v1/store?\"+Select+queryString,requestOptions);case 13:result=_context3.sent;_context3.next=16;return result.json();case 16:data=_context3.sent;setStoreOptions(data.result);setIsStoresLoading(false);case 19:case\"end\":return _context3.stop();}}},_callee3);}));return _suggestStores.apply(this,arguments);}function suggestVendors(_x3){return _suggestVendors.apply(this,arguments);}function _suggestVendors(){_suggestVendors=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"Inside handle suggestVendors\");setVendorOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";setIsVendorsLoading(true);_context4.next=13;return fetch(\"/v1/vendor?\"+Select+queryString,requestOptions);case 13:result=_context4.sent;_context4.next=16;return result.json();case 16:data=_context4.sent;setVendorOptions(data.result);setIsVendorsLoading(false);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return _suggestVendors.apply(this,arguments);}function GetProductUnitPriceInStore(storeId,productStores){console.log(\"Inside GetProductUnitPriceInStore\");if(!productStores){return\"\";}console.log(\"Cool\");for(var i=0;i<productStores.length;i++){console.log(\"productStores[i]:\",productStores[i]);console.log(\"store_id:\",storeId);if(productStores[i].store_id===storeId){console.log(\"macthed\");console.log(\"unitPrice.retail_unit_price:\",productStores[i].purchase_unit_price);return productStores[i];}}console.log(\"not matched\");return\"\";}var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),openProductSearchResult=_useState42[0],setOpenProductSearchResult=_useState42[1];function suggestProducts(_x4){return _suggestProducts.apply(this,arguments);}function _suggestProducts(){_suggestProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(searchTerm){var params,queryString,requestOptions,Select,result,data,products;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"Inside handle suggestProducts\");setProductOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context5.next=8;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 8:params={name:searchTerm};if(cookies.get(\"store_id\")){params.store_id=cookies.get(\"store_id\");}queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,name,product_stores,unit,part_number,name_in_arabic\";setIsProductsLoading(true);_context5.next=17;return fetch(\"/v1/product?\"+Select+queryString+\"&limit=200\",requestOptions);case 17:result=_context5.sent;_context5.next=20;return result.json();case 20:data=_context5.sent;products=data.result;if(!(!products||products.length===0)){_context5.next=27;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 27:openProductSearchResult=true;setOpenProductSearchResult(true);setProductOptions(products);setIsProductsLoading(false);case 31:case\"end\":return _context5.stop();}}},_callee5);}));return _suggestProducts.apply(this,arguments);}function getProductByBarCode(_x5){return _getProductByBarCode.apply(this,arguments);}function _getProductByBarCode(){_getProductByBarCode=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(barcode){var requestOptions,Select,result,data,product;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:formData.barcode=barcode;setFormData(_objectSpread({},formData));console.log(\"Inside getProductByBarCode\");errors[\"bar_code\"]=\"\";setErrors(_objectSpread({},errors));console.log(\"barcode:\"+formData.barcode);if(formData.barcode){_context6.next=8;break;}return _context6.abrupt(\"return\");case 8:if(formData.barcode.length===13){formData.barcode=formData.barcode.slice(0,-1);}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,part_number,name,product_stores,unit,part_number,name_in_arabic\";_context6.next=13;return fetch(\"/v1/product/barcode/\"+formData.barcode+\"?\"+Select,requestOptions);case 13:result=_context6.sent;_context6.next=16;return result.json();case 16:data=_context6.sent;product=data.result;if(product){addProduct(product);}else{errors[\"bar_code\"]=\"Invalid Barcode:\"+formData.barcode;setErrors(_objectSpread({},errors));}formData.barcode=\"\";setFormData(_objectSpread({},formData));case 21:case\"end\":return _context6.stop();}}},_callee6);}));return _getProductByBarCode.apply(this,arguments);}function suggestUsers(_x6){return _suggestUsers.apply(this,arguments);}function _suggestUsers(){_suggestUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:console.log(\"Inside handle suggestUsers\");setOrderPlacedByUserOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context7.next=5;break;}return _context7.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsOrderPlacedByUsersLoading(true);_context7.next=13;return fetch(\"/v1/user?\"+Select+queryString,requestOptions);case 13:result=_context7.sent;_context7.next=16;return result.json();case 16:data=_context7.sent;setOrderPlacedByUserOptions(data.result);setIsOrderPlacedByUsersLoading(false);case 19:case\"end\":return _context7.stop();}}},_callee7);}));return _suggestUsers.apply(this,arguments);}function suggestSignatures(_x7){return _suggestSignatures.apply(this,arguments);}function _suggestSignatures(){_suggestSignatures=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(\"Inside handle suggestSignatures\");setOrderPlacedBySignatureOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context8.next=5;break;}return _context8.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsOrderPlacedBySignaturesLoading(true);_context8.next=13;return fetch(\"/v1/signature?\"+Select+queryString,requestOptions);case 13:result=_context8.sent;_context8.next=16;return result.json();case 16:data=_context8.sent;setOrderPlacedBySignatureOptions(data.result);setIsOrderPlacedBySignaturesLoading(false);case 19:case\"end\":return _context8.stop();}}},_callee8);}));return _suggestSignatures.apply(this,arguments);}function handleCreate(event){event.preventDefault();console.log(\"Inside handle Create\");console.log(\"selectedProducts:\",selectedProducts);if(!formData.cash_discount){formData.cash_discount=0.00;}formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit:selectedProducts[i].unit,purchase_unit_price:parseFloat(selectedProducts[i].purchase_unit_price),retail_unit_price:parseFloat(selectedProducts[i].retail_unit_price),wholesale_unit_price:parseFloat(selectedProducts[i].wholesale_unit_price)});}formData.discount=parseFloat(formData.discount);formData.discount_percent=parseFloat(formData.discount_percent);formData.vat_percent=parseFloat(formData.vat_percent);formData.net_total=parseFloat(netTotal);console.log(\"formData.discount:\",formData.discount);console.log(\"formData.discount_percent:\",formData.discount_percent);if(!formData.shipping_handling_fees&&formData.shipping_handling_fees!==0){errors[\"shipping_handling_fees\"]=\"Invalid shipping / handling fees\";setErrors(_objectSpread({},errors));return;}if(!formData.discount&&formData.discount!==0){errors[\"discount\"]=\"Invalid discount\";setErrors(_objectSpread({},errors));return;}if(!formData.discount_percent&&formData.discount_percent!==0){errors[\"discount_percent\"]=\"Invalid discount percent\";setErrors(_objectSpread({},errors));return;}if(parseFloat(formData.discount_percent)>100){errors[\"discount_percent\"]=\"Discount percent cannot be > 100\";setErrors(_objectSpread({},errors));return;}if(!formData.vat_percent&&formData.vat_percent!==0){errors[\"vat_percent\"]=\"Invalid vat percent\";setErrors(_objectSpread({},errors));return;}if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');}var endPoint=\"/v1/purchase\";var method=\"POST\";if(formData.id){endPoint=\"/v1/purchase/\"+formData.id;method=\"PUT\";}var requestOptions={method:method,headers:{'Accept':'application/json',\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")},body:JSON.stringify(formData)};setProcessing(true);fetch(endPoint,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get(\"content-type\"))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes(\"application/json\");_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});setProcessing(false);console.log(\"Response:\");console.log(data);props.showToastMessage(\"Purchase Created Successfully!\",\"success\");if(props.refreshList){props.refreshList();}handleClose();props.openDetailsView(data.result.id);case 18:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x8){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(_objectSpread({},error));console.error(\"There was an error!\",error);props.showToastMessage(\"Error Creating Purchase!\",\"danger\");});}function isProductAdded(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return true;}}return false;}function addProduct(product){console.log(\"Inside Add product\");if(!formData.store_id){errors.product_id=\"Please Select a Store and try again\";setErrors(_objectSpread({},errors));return;}errors.product_id=\"\";if(!product){errors.product_id=\"Invalid Product\";setErrors(_objectSpread({},errors));return;}var productStore={};if(product.product_stores){/*\n            productStore = GetProductUnitPriceInStore(\n                formData.store_id,\n                product.stores\n            );\n            */if(product.product_stores[formData.store_id]){product.retail_unit_price=product.product_stores[formData.store_id].retail_unit_price;}if(product.product_stores[formData.store_id]){//product.purchase_unit_price = productStore.purchase_unit_price;\nproduct.purchase_unit_price=product.product_stores[formData.store_id].purchase_unit_price;}if(product.product_stores[formData.store_id]){// product.wholesale_unit_price = productStore.wholesale_unit_price;\nproduct.wholesale_unit_price=product.product_stores[formData.store_id].wholesale_unit_price;}}var alreadyAdded=false;var index=-1;var quantity=0.00;product.quantity=1.00;if(isProductAdded(product.id)){alreadyAdded=true;index=getProductIndex(product.id);quantity=parseFloat(selectedProducts[index].quantity+product.quantity);}else{quantity=parseFloat(product.quantity);}console.log(\"quantity:\",quantity);errors.quantity=\"\";if(alreadyAdded){selectedProducts[index].quantity=parseFloat(quantity);// setSelectedProducts([...selectedProducts]);\n}if(!alreadyAdded){var item={product_id:product.id,code:product.item_code,part_number:product.part_number,name:product.name,quantity:product.quantity,product_stores:product.product_stores,unit:product.unit};if(product.purchase_unit_price){item.purchase_unit_price=parseFloat(product.purchase_unit_price).toFixed(2);}if(product.retail_unit_price){item.retail_unit_price=parseFloat(product.retail_unit_price).toFixed(2);}if(product.wholesale_unit_price){item.wholesale_unit_price=parseFloat(product.wholesale_unit_price).toFixed(2);}selectedProducts.push(item);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit:selectedProducts[i].unit,purchase_unit_price:parseFloat(selectedProducts[i].purchase_unit_price),retail_unit_price:parseFloat(selectedProducts[i].retail_unit_price),wholesale_unit_price:parseFloat(selectedProducts[i].wholesale_unit_price)});}setFormData(_objectSpread({},formData));}function getProductIndex(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return i;}}return false;}function removeProduct(product){if(product.quantity_returned>0){errors[\"product_\"+index]=\"This product cannot be removed as it is returned, Note: Please remove the product from purchase return and try again\";setErrors(_objectSpread({},errors));return;}var index=selectedProducts.indexOf(product);if(index>-1){selectedProducts.splice(index,1);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}var _useState43=useState(0.0),_useState44=_slicedToArray(_useState43,2),totalPrice=_useState44[0],setTotalPrice=_useState44[1];function findTotalPrice(){totalPrice=0.00;for(var i=0;i<selectedProducts.length;i++){totalPrice+=parseFloat(selectedProducts[i].purchase_unit_price)*parseFloat(selectedProducts[i].quantity);}totalPrice=totalPrice.toFixed(2);setTotalPrice(totalPrice);}var _useState45=useState(0.00),_useState46=_slicedToArray(_useState45,2),vatPrice=_useState46[0],setVatPrice=_useState46[1];function findVatPrice(){vatPrice=0.00;if(totalPrice>0){vatPrice=(parseFloat(parseFloat(formData.vat_percent)/100)*(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount))).toFixed(2);;console.log(\"vatPrice:\",vatPrice);}setVatPrice(vatPrice);}var _useState47=useState(0.00),_useState48=_slicedToArray(_useState47,2),netTotal=_useState48[0],setNetTotal=_useState48[1];function findNetTotal(){netTotal=0.00;if(totalPrice>0){netTotal=parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount)+parseFloat(vatPrice);netTotal=parseFloat(netTotal);}netTotal=RoundFloat(netTotal,2);// netTotal = Math.round(netTotal * 100) / 100;\nsetNetTotal(netTotal);if(!formData.id){var method=\"\";if(formData.payments_input[0]){method=formData.payments_input[0].method;}formData.payments_input=[{\"date_str\":formData.date_str,\"amount\":0.00,\"method\":method,\"deleted\":false}];if(netTotal>0){formData.payments_input[0].amount=parseFloat(netTotal.toFixed(2));if(formData.cash_discount){var _formData$cash_discou;formData.payments_input[0].amount=formData.payments_input[0].amount-parseFloat((_formData$cash_discou=formData.cash_discount)===null||_formData$cash_discou===void 0?void 0:_formData$cash_discou.toFixed(2));}formData.payments_input[0].amount=parseFloat(formData.payments_input[0].amount.toFixed(2));}}setFormData(_objectSpread({},formData));validatePaymentAmounts();}function RoundFloat(val,precision){var ratio=Math.pow(10,precision);return Math.round(val*ratio)/ratio;}var _useState49=useState(0.00),_useState50=_slicedToArray(_useState49,2),discountPercent=_useState50[0],setDiscountPercent=_useState50[1];function findDiscountPercent(){if(formData.discount>=0&&totalPrice>0){discountPercent=parseFloat(parseFloat(formData.discount/totalPrice)*100).toFixed(2);setDiscountPercent(discountPercent);formData.discount_percent=discountPercent;setFormData(_objectSpread({},formData));}}function findDiscount(){if(formData.discount_percent>=0&&totalPrice>0){formData.discount=parseFloat(totalPrice*parseFloat(formData.discount_percent/100)).toFixed(2);setFormData(_objectSpread({},formData));}}function reCalculate(){findTotalPrice();if(formData.is_discount_percent){findDiscount();}else{findDiscountPercent();}findVatPrice();findNetTotal();}function addNewPayment(){var date=new Date();if(!formData.id){date=formData.date_str;}formData.payments_input.push({\"date_str\":date,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false});setFormData(_objectSpread({},formData));validatePaymentAmounts();//validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n}function findTotalPayments(){var _parseFloat,_parseFloat2;var totalPayment=0.00;for(var i=0;i<((_formData$payments_in2=formData.payments_input)===null||_formData$payments_in2===void 0?void 0:_formData$payments_in2.length);i++){var _formData$payments_in2;if(formData.payments_input[i].amount&&!formData.payments_input[i].deleted){totalPayment+=formData.payments_input[i].amount;}}totalPaymentAmount=totalPayment;console.log(\"totalPaymentAmount:\",totalPaymentAmount);setTotalPaymentAmount(totalPaymentAmount);console.log(\"totalPayment:\",totalPayment);balanceAmount=parseFloat(netTotal.toFixed(2))-parseFloat((_parseFloat=parseFloat(formData.cash_discount))===null||_parseFloat===void 0?void 0:_parseFloat.toFixed(2))-parseFloat(totalPayment.toFixed(2));balanceAmount=parseFloat(balanceAmount.toFixed(2));setBalanceAmount(balanceAmount);if(balanceAmount===parseFloat((parseFloat(netTotal.toFixed(2))-parseFloat((_parseFloat2=parseFloat(formData.cash_discount))===null||_parseFloat2===void 0?void 0:_parseFloat2.toFixed(2))).toFixed(2))){paymentStatus=\"not_paid\";}else if(balanceAmount<=0){paymentStatus=\"paid\";}else if(balanceAmount>0){paymentStatus=\"paid_partially\";}setPaymentStatus(paymentStatus);return totalPayment;}var _useState51=useState(0.00),_useState52=_slicedToArray(_useState51,2),totalPaymentAmount=_useState52[0],setTotalPaymentAmount=_useState52[1];var _useState53=useState(0.00),_useState54=_slicedToArray(_useState53,2),balanceAmount=_useState54[0],setBalanceAmount=_useState54[1];var _useState55=useState(\"\"),_useState56=_slicedToArray(_useState55,2),paymentStatus=_useState56[0],setPaymentStatus=_useState56[1];function removePayment(key){var validatePayments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;formData.payments_input.splice(key,1);//formData.payments_input[key][\"deleted\"] = true;\nsetFormData(_objectSpread({},formData));if(validatePayments){validatePaymentAmounts();}findTotalPayments();}function validatePaymentAmounts(){console.log(\"validatePaymentAmount: netTotal:\",netTotal);errors[\"cash_discount\"]=\"\";setErrors(_objectSpread({},errors));var haveErrors=false;if(!netTotal){/*\n            removePayment(0, false);\n            totalPaymentAmount = 0.0;\n            setTotalPaymentAmount(0.00);\n            balanceAmount = 0.00;\n            setBalanceAmount(0.00);\n            paymentStatus = \"\";\n            setPaymentStatus(paymentStatus);\n            */return true;}if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toFixed(2).toString();setErrors(_objectSpread({},errors));haveErrors=true;return false;}var totalPayment=findTotalPayments();// errors[\"payment_date\"] = [];\n//errors[\"payment_method\"] = [];\n//errors[\"payment_amount\"] = [];\nfor(var key=0;key<formData.payments_input.length;key++){errors[\"payment_amount_\"+key]=\"\";errors[\"payment_date_\"+key]=\"\";errors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!formData.payments_input[key].amount){errors[\"payment_amount_\"+key]=\"Payment amount is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(formData.payments_input[key].amount===0){errors[\"payment_amount_\"+key]=\"Amount should be greater than zero\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].date_str){errors[\"payment_date_\"+key]=\"Payment date is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(new Date(formData.payments_input[key].date_str)<new Date(formData.date_str)){errors[\"payment_date_\"+key]=\"Payment date time should be greater than or equal to order date time\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].method){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));haveErrors=true;}if((formData.payments_input[key].amount||formData.payments_input[key].amount===0)&&!formData.payments_input[key].deleted){var maxAllowedAmount=netTotal-formData.cash_discount-(totalPayment-formData.payments_input[key].amount);if(maxAllowedAmount<0){maxAllowedAmount=0;}/*\n                \n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                */}}if(haveErrors){return false;}return true;}var StoreCreateFormRef=useRef();function openStoreCreateForm(){StoreCreateFormRef.current.open();}var ProductCreateFormRef=useRef();function openProductCreateForm(){ProductCreateFormRef.current.open();}function openProductUpdateForm(id){ProductCreateFormRef.current.open(id);}var VendorCreateFormRef=useRef();function openVendorCreateForm(){VendorCreateFormRef.current.open();}var UserCreateFormRef=useRef();function openUserCreateForm(){UserCreateFormRef.current.open();}var SignatureCreateFormRef=useRef();function openSignatureCreateForm(){SignatureCreateFormRef.current.open();}var ProductDetailsViewRef=useRef();function openProductDetailsView(id){ProductDetailsViewRef.current.open(id);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ProductView,{ref:ProductDetailsViewRef,openUpdateForm:openProductUpdateForm,openCreateForm:openProductCreateForm}),/*#__PURE__*/_jsx(ProductCreate,{ref:ProductCreateFormRef,showToastMessage:props.showToastMessage,openDetailsView:openProductDetailsView}),/*#__PURE__*/_jsx(StoreCreate,{ref:StoreCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(UserCreate,{ref:UserCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(SignatureCreate,{ref:SignatureCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(VendorCreate,{ref:VendorCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsxs(Modal,{show:show,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,backdrop:\"static\",scrollable:true,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:formData.id?\"Update Purchase #\"+formData.code:\"Create New Purchase\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsx(PurchasePreview,{}),formData.id?/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:function onClick(){handleClose();props.openDetailsView(formData.id);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-eye\"}),\" View Detail\"]}):\"\",\"\\xA0\\xA0\",/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:handleCreate,children:[isProcessing?/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"border\",size:\"sm\",role:\"status\",\"aria-hidden\":true})+\" Creating...\":\"\",formData.id?\"Update\":\"Create\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsxs(Modal.Body,{children:[Object.keys(errors).length>0?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"ul\",{children:errors&&Object.keys(errors).map(function(key,index){return errors[key]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";})})}):\"\",/*#__PURE__*/_jsxs(\"form\",{className:\"row g-3 needs-validation\",onSubmit:handleCreate,children:[!cookies.get('store_name')?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Purchase to Store*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"store_id\",labelKey:\"name\",isLoading:isStoresLoading,isInvalid:errors.store_id?true:false,onChange:function onChange(selectedItems){errors.store_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.store_id=\"Invalid Store selected\";setErrors(errors);setFormData(_objectSpread({},formData));setSelectedStores([]);return;}formData.store_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedStores(selectedItems);//SetPriceOfAllProducts(selectedItems[0].id);\n},options:storeOptions,placeholder:\"Select Store\",selected:selectedStores,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestStores(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openStoreCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi x-lg\",children:\" \"}),errors.store_id]}),formData.store_id&&!errors.store_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Purchase From Vendor*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"vendor_id\",labelKey:\"search_label\",isLoading:isVendorsLoading,isInvalid:errors.vendor_id?true:false,onChange:function onChange(selectedItems){errors.vendor_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.vendor_id=\"Invalid Vendor selected\";setErrors(errors);formData.vendor_id=\"\";setFormData(_objectSpread({},formData));setSelectedVendors([]);return;}formData.vendor_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedVendors(selectedItems);},options:vendorOptions,placeholder:\"Type name or mob\",selected:selectedVendors,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestVendors(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openVendorCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.vendor_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.vendor_id]}),formData.vendor_id&&!errors.vendor_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Vendor Invoice No. (Optional)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{value:formData.vendor_invoice_no?formData.vendor_invoice_no:\"\",type:\"string\",onChange:function onChange(e){errors[\"vendor_invoice_no\"]=\"\";setErrors(_objectSpread({},errors));formData.vendor_invoice_no=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",id:\"vendor_invoice_no\",placeholder:\"Vendor Invoice No.\"}),errors.vendor_invoice_no&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.vendor_invoice_no]}),formData.vendor_invoice_no&&!errors.rack&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date Time*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.date_str?new Date(formData.date_str):null,value:formData.date_str?format(new Date(formData.date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.date_str=value;// formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\nsetFormData(_objectSpread({},formData));}}),errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.date_str]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"product_id\",size:\"lg\",labelKey:\"search_label\",emptyLabel:\"\",clearButton:true,open:openProductSearchResult,isLoading:isProductsLoading,isInvalid:errors.product_id?true:false,onChange:function onChange(selectedItems){if(selectedItems.length===0){errors[\"product_id\"]=\"Invalid Product selected\";setErrors(errors);return;}errors[\"product_id\"]=\"\";setErrors(_objectSpread({},errors));if(formData.store_id){addProduct(selectedItems[0]);}setOpenProductSearchResult(false);},options:productOptions,selected:selectedProduct,placeholder:\"Search By Part No. / Name / Name in Arabic\",highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestProducts(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openProductCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.product_id?/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.product_id]}):\"\",selectedProduct[0]&&selectedProduct[0].id&&!errors.product_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\",maxHeight:\"400px\",overflowY:\"auto\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"2%\"},children:\"Remove\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"5%\"},children:\"SI No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"8%\"},children:\"Part No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"26%\"},className:\"text-start\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Purchase Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Wholesale Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Retail Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"15%\"},children:\"Purchase Price\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedProducts.map(function(product,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\",cursor:\"pointer\"},onClick:function onClick(){removeProduct(product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"})})}),/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:product.part_number}),/*#__PURE__*/_jsx(\"td\",{style:{textDecoration:\"underline\",color:\"blue\",cursor:\"pointer\"},className:\"text-start\",onClick:function onClick(){openProductDetailsView(product.product_id);console.log(\"okk,id:\",product.product_id);},children:product.name}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"155px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.quantity,className:\"form-control\",placeholder:\"Quantity\",onChange:function onChange(e){errors[\"quantity_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"quantity_\"+index]=\"Invalid Quantity\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"quantity_\"+index]=\"Invalid Quantity should be > 0\";selectedProducts[index].quantity=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}product.quantity=parseFloat(e.target.value);reCalculate();selectedProducts[index].quantity=parseFloat(e.target.value);console.log(\"selectedProducts[index].quantity:\",selectedProducts[index].quantity);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:selectedProducts[index].unit?selectedProducts[index].unit:\"Units\"})]}),errors[\"quantity_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"quantity_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.purchase_unit_price,className:\"form-control\",placeholder:\"Purchase Unit Price\",onChange:function onChange(e){errors[\"purchase_unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"purchase_unit_price_\"+index]=\"Invalid Purchase Unit Price\";selectedProducts[index].purchase_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"purchase_unit_price_\"+index]=\"Purchase Unit Price should be > 0\";selectedProducts[index].purchase_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].purchase_unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].purchase_unit_price:\",selectedProducts[index].purchase_unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"purchase_unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"purchase_unit_price_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.wholesale_unit_price,className:\"form-control\",placeholder:\"Wholesale Unit Price\",onChange:function onChange(e){errors[\"wholesale_unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"wholesale_unit_price_\"+index]=\"Invalid Wholesale Unit Price\";selectedProducts[index].wholesale_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"wholesale_unit_price_\"+index]=\"Wholesale Unit Price should be > 0\";selectedProducts[index].wholesale_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].wholesale_unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].wholesale_unit_price:\",selectedProducts[index].wholesale_unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"wholesale_unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"wholesale_unit_price_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.retail_unit_price,className:\"form-control\",placeholder:\"Retail Unit Price\",onChange:function onChange(e){errors[\"retail_unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"retail_unit_price_\"+index]=\"Invalid Retail Unit Price\";selectedProducts[index].retail_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"retail_unit_price_\"+index]=\"Retail Unit Price should be > 0\";selectedProducts[index].retail_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].retail_unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].retail_unit_price:\",selectedProducts[index].retail_unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"retail_unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"retail_unit_price_\"+index]]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(product.purchase_unit_price*product.quantity).toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]},index);}).reverse()})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\"},children:/*#__PURE__*/_jsx(\"table\",{className:\"table table-striped table-sm table-bordered\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"90%\"},colSpan:\"8\",className:\"text-end\",children:\"Total\"}),/*#__PURE__*/_jsx(\"td\",{style:{width:\"10%\"},className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:totalPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Shipping & Handling Fees\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.shipping_handling_fees,onChange:function onChange(e){if(parseFloat(e.target.value)===0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"Shipping / Handling Fees should be > 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.shipping_handling_fees=\"\";errors[\"shipping_handling_fees\"]=\"Invalid Shipping / Handling Fees\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.shipping_handling_fees&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.shipping_handling_fees})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\"Discount  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"50px\"},className:\"text-start\",value:formData.discount_percent,onChange:function onChange(e){formData.is_discount_percent=true;if(parseFloat(e.target.value)===0){formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount_percent=parseFloat(e.target.value);formData.discount=0.00;setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"Discount percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount_percent=\"\";formData.discount=0.00;errors[\"discount_percent\"]=\"Invalid Discount Percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"discount_percent\"]=\"\";errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\"%\",errors.discount_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount_percent})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.discount,onChange:function onChange(e){formData.is_discount_percent=false;if(parseFloat(e.target.value)===0){formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount=parseFloat(e.target.value);formData.discount_percent=0.00;setFormData(_objectSpread({},formData));errors[\"discount\"]=\"Discount should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount=\"\";formData.discount_percent=0.00;errors[\"discount\"]=\"Invalid Discount\";setFormData(_objectSpread({},formData));reCalculate();setErrors(_objectSpread({},errors));return;}errors[\"discount\"]=\"\";errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.discount&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\" VAT  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"text-center\",style:{width:\"50px\"},value:formData.vat_percent,onChange:function onChange(e){console.log(\"Inside onchange vat percent\");if(parseFloat(e.target.value)===0){formData.vat_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.vat_percent=parseFloat(e.target.value);vatPrice=0.00;setVatPrice(vatPrice);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"Vat percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.vat_percent=\"\";vatPrice=0.00;setVatPrice(vatPrice);//formData.discount_percent = 0.00;\nerrors[\"vat_percent\"]=\"Invalid vat percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.vat_percent=e.target.value;reCalculate();setFormData(_objectSpread({},formData));console.log(formData);}}),\"%\",errors.vat_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.vat_percent})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:vatPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Net Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:netTotal,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Cash discount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.cash_discount,className:\"form-control \",onChange:function onChange(e){errors[\"cash_discount\"]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.cash_discount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.cash_discount=parseFloat(e.target.value);if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toString();setErrors(_objectSpread({},errors));return;}setFormData(_objectSpread({},formData));validatePaymentAmounts();console.log(formData);}}),errors.cash_discount&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.cash_discount]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payments Paid\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"table-responsive\",style:{maxWidth:\"900px\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",style:{alignContent:\"right\",marginBottom:\"10px\"},onClick:addNewPayment,children:\"Create new payment\"}),/*#__PURE__*/_jsxs(\"table\",{class:\"table table-striped table-sm table-bordered\",children:[formData.payments_input&&formData.payments_input.length>0&&/*#__PURE__*/_jsxs(\"thead\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Payment method\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]}),/*#__PURE__*/_jsxs(\"tbody\",{children:[formData.payments_input&&formData.payments_input.filter(function(payment){return!payment.deleted;}).map(function(payment,key){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{style:{minWidth:\"220px\"},children:[/*#__PURE__*/_jsx(DatePicker,{id:\"payment_date_str\",selected:formData.payments_input[key].date_str?new Date(formData.payments_input[key].date_str):null,value:formData.payments_input[key].date_str?format(new Date(formData.payments_input[key].date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.payments_input[key].date_str=value;setFormData(_objectSpread({},formData));}}),errors[\"payment_date_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_date_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"300px\"},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.payments_input[key].amount,className:\"form-control \",onChange:function onChange(e){errors[\"payment_amount_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.payments_input[key].amount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.payments_input[key].amount=parseFloat(e.target.value);validatePaymentAmounts();setFormData(_objectSpread({},formData));console.log(formData);}}),errors[\"payment_amount_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_amount_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"200px\"},children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payments_input[key].method,className:\"form-control \",onChange:function onChange(e){// errors[\"payment_method\"] = [];\nerrors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));formData.payments_input[key].method=\"\";setFormData(_objectSpread({},formData));return;}// errors[\"payment_method\"] = \"\";\n//setErrors({ ...errors });\nformData.payments_input[key].method=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_account\",children:\"Bank Account / Debit / Credit Card\"}),/*#__PURE__*/_jsx(\"option\",{value:\"vendor_account\",children:\"Vendor Account\"})]}),errors[\"payment_method_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_method_\"+key]]})]}),/*#__PURE__*/_jsx(\"td\",{style:{width:\"200px\"},children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:function onClick(event){removePayment(key);},children:\"Remove\"})})]},key);}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{class:\"text-end\",children:/*#__PURE__*/_jsx(\"b\",{children:\"Total\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"b\",{style:{marginLeft:\"14px\"},children:(_totalPaymentAmount=totalPaymentAmount)===null||_totalPaymentAmount===void 0?void 0:_totalPaymentAmount.toFixed(2)})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"b\",{style:{marginLeft:\"12px\",alignSelf:\"end\"},children:[\"Balance: \",(_balanceAmount=balanceAmount)===null||_balanceAmount===void 0?void 0:_balanceAmount.toFixed(2)]})}),/*#__PURE__*/_jsxs(\"td\",{colSpan:1,children:[/*#__PURE__*/_jsx(\"b\",{children:\"Payment status: \"}),paymentStatus==\"paid\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success\",children:\"Paid\"}):\"\",paymentStatus==\"paid_partially\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-warning\",children:\"Paid Partially\"}):\"\",paymentStatus==\"not_paid\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-danger\",children:\"Not Paid\"}):\"\"]})]})]})]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"border\",size:\"sm\",role:\"status\",\"aria-hidden\":true})+\" Creating...\":formData.id?\"Update\":\"Create\"})]})]})]})]})]});});export default PurchaseCreate;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/purchase/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","PurchasePreview","Modal","Button","Form","StoreCreate","VendorCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","PurchaseView","ProductView","DebounceInput","PurchaseCreate","props","ref","open","id","selectedProducts","setSelectedProducts","selectedStores","setSelectedStores","selectedVendors","setSelectedVendors","selectedOrderPlacedByUsers","setSelectedOrderPlacedByUsers","selectedOrderPlacedBySignatures","setSelectedOrderPlacedBySignatures","formData","vat_percent","discount","discountValue","discount_percent","shipping_handling_fees","partial_payment_amount","is_discount_percent","date_str","Date","signature_date_str","status","payment_method","payment_status","payments_input","cash_discount","cookies","get","store_id","store_name","name","order_placed_by","parseFloat","setFormData","getPurchase","reCalculate","setShow","listener","event","code","console","log","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","includes","focus","preventDefault","document","addEventListener","removeEventListener","selectedDate","errors","setErrors","isProcessing","setProcessing","storeOptions","setStoreOptions","isStoresLoading","setIsStoresLoading","vendorOptions","setVendorOptions","isVendorsLoading","setIsVendorsLoading","productOptions","setProductOptions","selectedProduct","setSelectedProduct","isProductsLoading","setIsProductsLoading","orderPlacedByUserOptions","setOrderPlacedByUserOptions","isOrderPlacedByUsersLoading","setIsOrderPlacedByUsersLoading","orderPlacedBySignatureOptions","setOrderPlacedBySignatureOptions","isOrderPlacedBySignaturesLoading","setIsOrderPlacedBySignaturesLoading","show","handleClose","at","window","location","requestOptions","method","headers","fetch","then","response","isJson","json","data","ok","error","Promise","reject","purchase","result","vendor_id","date","order_placed_by_signature_id","payments","i","length","products","vendor_name","search_label","order_placed_by_name","order_placed_by_signature_name","catch","ObjectToSearchQueryParams","object","Object","keys","map","key","encodeURIComponent","join","suggestStores","searchTerm","params","queryString","Authorization","Select","suggestVendors","GetProductUnitPriceInStore","storeId","productStores","purchase_unit_price","openProductSearchResult","setOpenProductSearchResult","suggestProducts","getProductByBarCode","barcode","slice","product","addProduct","suggestUsers","suggestSignatures","handleCreate","push","product_id","quantity","unit","retail_unit_price","wholesale_unit_price","net_total","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","isProductAdded","productID","productStore","product_stores","alreadyAdded","getProductIndex","item","item_code","part_number","toFixed","removeProduct","quantity_returned","splice","totalPrice","setTotalPrice","findTotalPrice","vatPrice","setVatPrice","findVatPrice","setNetTotal","findNetTotal","RoundFloat","amount","validatePaymentAmounts","val","precision","ratio","Math","pow","round","discountPercent","setDiscountPercent","findDiscountPercent","findDiscount","addNewPayment","findTotalPayments","totalPayment","deleted","totalPaymentAmount","setTotalPaymentAmount","balanceAmount","setBalanceAmount","paymentStatus","setPaymentStatus","removePayment","validatePayments","haveErrors","toString","maxAllowedAmount","StoreCreateFormRef","openStoreCreateForm","current","ProductCreateFormRef","openProductCreateForm","openProductUpdateForm","VendorCreateFormRef","openVendorCreateForm","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","color","selectedItems","e","vendor_invoice_no","value","rack","overflowX","maxHeight","overflowY","width","cursor","textDecoration","reverse","maxWidth","alignContent","marginBottom","filter","payment","minWidth","marginLeft","alignSelf"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport PurchasePreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport VendorCreate from \"./../vendor/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport PurchaseView from \"./view.js\";\nimport ProductView from \"./../product/view.js\";\nimport { DebounceInput } from 'react-debounce-input';\n\n\nconst PurchaseCreate = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(id) {\n\n            selectedProducts = [];\n            setSelectedProducts([]);\n\n            selectedStores = [];\n            setSelectedStores([]);\n\n            selectedVendors = [];\n            setSelectedVendors([]);\n\n            selectedOrderPlacedByUsers = [];\n            setSelectedOrderPlacedByUsers([]);\n\n            selectedOrderPlacedBySignatures = [];\n            setSelectedOrderPlacedBySignatures([]);\n\n\n            formData = {\n                vat_percent: 15.0,\n                discount: 0.0,\n                discountValue: 0.0,\n                discount_percent: 0.0,\n                shipping_handling_fees: 0.00,\n                partial_payment_amount: 0.00,\n                is_discount_percent: false,\n                date_str: new Date(),\n                signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n                status: \"delivered\",\n                payment_method: \"\",\n                payment_status: \"paid\",\n\n            };\n\n            formData.payments_input = [\n                {\n                    \"date_str\": formData.date_str,\n                    // \"amount\": \"\",\n                    \"amount\": 0.00,\n                    \"method\": \"\",\n                    \"deleted\": false,\n                }\n            ];\n            formData.cash_discount = 0.00;\n\n\n            if (cookies.get('store_id')) {\n                formData.store_id = cookies.get('store_id');\n                formData.store_name = cookies.get('store_name');\n            }\n\n            if (cookies.get(\"user_id\")) {\n                selectedOrderPlacedByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.order_placed_by = cookies.get(\"user_id\");\n                formData.vat_percent = parseFloat(cookies.get('vat_percent'));\n                setFormData({ ...formData });\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n            }\n\n            setFormData({ ...formData });\n\n            if (id) {\n                getPurchase(id);\n            }\n            reCalculate();\n            setShow(true);\n        },\n\n    }));\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function-purchase.\");\n                // event.preventDefault();\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n\n    useEffect(() => {\n        console.log(\"inside change on formData:\", formData);\n        // localStorage\n\n    });\n\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        vat_percent: 10.0,\n        discount: 0.0,\n        discountValue: 0.0,\n        discount_percent: 0.0,\n        is_discount_percent: false,\n        date_str: format(new Date(), \"MMM dd yyyy\"),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"created\",\n    });\n\n    //Store Auto Suggestion\n    const [storeOptions, setStoreOptions] = useState([]);\n    let [selectedStores, setSelectedStores] = useState([]);\n    const [isStoresLoading, setIsStoresLoading] = useState(false);\n\n    //Vendor Auto Suggestion\n    const [vendorOptions, setVendorOptions] = useState([]);\n    let [selectedVendors, setSelectedVendors] = useState([]);\n    const [isVendorsLoading, setIsVendorsLoading] = useState(false);\n\n    //Product Auto Suggestion\n    const [productOptions, setProductOptions] = useState([]);\n    let [selectedProduct, setSelectedProduct] = useState([]);\n    let [selectedProducts, setSelectedProducts] = useState([]);\n    const [isProductsLoading, setIsProductsLoading] = useState(false);\n\n    //Order Placed By Auto Suggestion\n    const [orderPlacedByUserOptions, setOrderPlacedByUserOptions] = useState([]);\n    let [selectedOrderPlacedByUsers, setSelectedOrderPlacedByUsers] = useState([]);\n    const [isOrderPlacedByUsersLoading, setIsOrderPlacedByUsersLoading] = useState(false);\n\n    //Order Placed By Signature Auto Suggestion\n    const [orderPlacedBySignatureOptions, setOrderPlacedBySignatureOptions] =\n        useState([]);\n    let [selectedOrderPlacedBySignatures, setSelectedOrderPlacedBySignatures] =\n        useState([]);\n    const [isOrderPlacedBySignaturesLoading, setIsOrderPlacedBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/purchases\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function getPurchase(id) {\n        console.log(\"inside get Purchase\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/purchase/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let purchase = data.result;\n                formData = {\n                    id: purchase.id,\n                    code: purchase.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    cash_discount: purchase.cash_discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n\n                if (data.result.payments) {\n                    console.log(\"data.result.payments:\", data.result.payments);\n                    formData.payments_input = data.result.payments;\n                    for (var i = 0; i < formData.payments_input?.length; i++) {\n                        formData.payments_input[i].date_str = formData.payments_input[i].date\n                    }\n                }\n\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n\n                selectedProducts = purchase.products;\n                setSelectedProducts([...selectedProducts]);\n\n\n                let selectedStores = [\n                    {\n                        id: purchase.store_id,\n                        name: purchase.store_name,\n                    }\n                ];\n\n                let selectedVendors = [\n                    {\n                        id: purchase.vendor_id,\n                        name: purchase.vendor_name,\n                        search_label: purchase.vendor_name,\n                    }\n                ];\n\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: purchase.order_placed_by,\n                        name: purchase.order_placed_by_name\n                    }\n                ];\n\n                if (purchase.order_placed_by_signature_id) {\n                    let selectedOrderPlacedBySignatures = [\n                        {\n                            id: purchase.order_placed_by_signature_id,\n                            name: purchase.order_placed_by_signature_name,\n                        }\n                    ];\n\n                    setSelectedOrderPlacedBySignatures([...selectedOrderPlacedBySignatures]);\n                }\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n\n                setSelectedStores([...selectedStores]);\n                setSelectedVendors([...selectedVendors]);\n\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=` + encodeURIComponent(object[key]);\n            })\n            .join(\"&\");\n    }\n\n    async function suggestStores(searchTerm) {\n        console.log(\"Inside handle suggestStores\");\n        setStoreOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsStoresLoading(true);\n        let result = await fetch(\n            \"/v1/store?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setStoreOptions(data.result);\n        setIsStoresLoading(false);\n    }\n\n    async function suggestVendors(searchTerm) {\n        console.log(\"Inside handle suggestVendors\");\n        setVendorOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";\n        setIsVendorsLoading(true);\n        let result = await fetch(\n            \"/v1/vendor?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setVendorOptions(data.result);\n        setIsVendorsLoading(false);\n    }\n\n    function GetProductUnitPriceInStore(storeId, productStores) {\n        console.log(\"Inside GetProductUnitPriceInStore\");\n        if (!productStores) {\n            return \"\";\n        }\n        console.log(\"Cool\")\n\n        for (var i = 0; i < productStores.length; i++) {\n            console.log(\"productStores[i]:\", productStores[i]);\n            console.log(\"store_id:\", storeId);\n\n            if (productStores[i].store_id === storeId) {\n                console.log(\"macthed\");\n                console.log(\n                    \"unitPrice.retail_unit_price:\",\n                    productStores[i].purchase_unit_price\n                );\n                return productStores[i];\n            }\n        }\n        console.log(\"not matched\");\n        return \"\";\n    }\n\n    let [openProductSearchResult, setOpenProductSearchResult] = useState(false);\n\n    async function suggestProducts(searchTerm) {\n        console.log(\"Inside handle suggestProducts\");\n        setProductOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n\n        if (cookies.get(\"store_id\")) {\n            params.store_id = cookies.get(\"store_id\");\n        }\n\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,item_code,bar_code,name,product_stores,unit,part_number,name_in_arabic\";\n        setIsProductsLoading(true);\n        let result = await fetch(\n            \"/v1/product?\" + Select + queryString + \"&limit=200\",\n            requestOptions\n        );\n        let data = await result.json();\n\n        let products = data.result;\n        if (!products || products.length === 0) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n\n\n        openProductSearchResult = true;\n        setOpenProductSearchResult(true);\n        setProductOptions(products);\n        setIsProductsLoading(false);\n    }\n\n    async function getProductByBarCode(barcode) {\n        formData.barcode = barcode;\n        setFormData({ ...formData });\n        console.log(\"Inside getProductByBarCode\");\n        errors[\"bar_code\"] = \"\";\n        setErrors({ ...errors });\n\n        console.log(\"barcode:\" + formData.barcode);\n        if (!formData.barcode) {\n            return;\n        }\n\n        if (formData.barcode.length === 13) {\n            formData.barcode = formData.barcode.slice(0, -1);\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n\n        let Select = \"select=id,item_code,bar_code,part_number,name,product_stores,unit,part_number,name_in_arabic\";\n        let result = await fetch(\n            \"/v1/product/barcode/\" + formData.barcode + \"?\" + Select,\n            requestOptions\n        );\n        let data = await result.json();\n\n\n        let product = data.result;\n        if (product) {\n            addProduct(product);\n        } else {\n            errors[\"bar_code\"] = \"Invalid Barcode:\" + formData.barcode\n            setErrors({ ...errors });\n        }\n\n        formData.barcode = \"\";\n        setFormData({ ...formData });\n\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setOrderPlacedByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsOrderPlacedByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setOrderPlacedByUserOptions(data.result);\n        setIsOrderPlacedByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setOrderPlacedBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsOrderPlacedBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setOrderPlacedBySignatureOptions(data.result);\n        setIsOrderPlacedBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        console.log(\"Inside handle Create\");\n        console.log(\"selectedProducts:\", selectedProducts);\n\n        if (!formData.cash_discount) {\n            formData.cash_discount = 0.00;\n        }\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit: selectedProducts[i].unit,\n                purchase_unit_price: parseFloat(selectedProducts[i].purchase_unit_price),\n                retail_unit_price: parseFloat(selectedProducts[i].retail_unit_price),\n                wholesale_unit_price: parseFloat(selectedProducts[i].wholesale_unit_price),\n            });\n        }\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        formData.net_total = parseFloat(netTotal);\n        console.log(\"formData.discount:\", formData.discount);\n        console.log(\"formData.discount_percent:\", formData.discount_percent);\n\n        if (!formData.shipping_handling_fees && formData.shipping_handling_fees !== 0) {\n            errors[\"shipping_handling_fees\"] = \"Invalid shipping / handling fees\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.vat_percent && formData.vat_percent !== 0) {\n            errors[\"vat_percent\"] = \"Invalid vat percent\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (cookies.get('store_id')) {\n            formData.store_id = cookies.get('store_id');\n        }\n\n        let endPoint = \"/v1/purchase\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/purchase/\" + formData.id;\n            method = \"PUT\";\n        }\n\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"Purchase Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n                handleClose();\n                props.openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating Purchase!\", \"danger\");\n            });\n    }\n\n    function isProductAdded(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function addProduct(product) {\n        console.log(\"Inside Add product\");\n        if (!formData.store_id) {\n            errors.product_id = \"Please Select a Store and try again\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        errors.product_id = \"\";\n        if (!product) {\n            errors.product_id = \"Invalid Product\";\n            setErrors({ ...errors });\n            return;\n        }\n        let productStore = {};\n\n        if (product.product_stores) {\n            /*\n            productStore = GetProductUnitPriceInStore(\n                formData.store_id,\n                product.stores\n            );\n            */\n            if (product.product_stores[formData.store_id]) {\n                product.retail_unit_price = product.product_stores[formData.store_id].retail_unit_price;\n            }\n\n            if (product.product_stores[formData.store_id]) {\n                //product.purchase_unit_price = productStore.purchase_unit_price;\n                product.purchase_unit_price = product.product_stores[formData.store_id].purchase_unit_price;\n            }\n\n            if (product.product_stores[formData.store_id]) {\n                // product.wholesale_unit_price = productStore.wholesale_unit_price;\n                product.wholesale_unit_price = product.product_stores[formData.store_id].wholesale_unit_price;\n            }\n        }\n\n\n\n\n        let alreadyAdded = false;\n        let index = -1;\n        let quantity = 0.00;\n        product.quantity = 1.00;\n\n        if (isProductAdded(product.id)) {\n            alreadyAdded = true;\n            index = getProductIndex(product.id);\n            quantity = parseFloat(selectedProducts[index].quantity + product.quantity);\n        } else {\n            quantity = parseFloat(product.quantity);\n        }\n\n        console.log(\"quantity:\", quantity);\n\n        errors.quantity = \"\";\n\n        if (alreadyAdded) {\n            selectedProducts[index].quantity = parseFloat(quantity);\n            // setSelectedProducts([...selectedProducts]);\n        }\n\n        if (!alreadyAdded) {\n            let item = {\n                product_id: product.id,\n                code: product.item_code,\n                part_number: product.part_number,\n                name: product.name,\n                quantity: product.quantity,\n                product_stores: product.product_stores,\n                unit: product.unit,\n            };\n\n            if (product.purchase_unit_price) {\n                item.purchase_unit_price = parseFloat(product.purchase_unit_price).toFixed(2);\n            }\n\n            if (product.retail_unit_price) {\n                item.retail_unit_price = parseFloat(product.retail_unit_price).toFixed(2);\n            }\n\n            if (product.wholesale_unit_price) {\n                item.wholesale_unit_price = parseFloat(product.wholesale_unit_price).toFixed(2);\n            }\n\n            selectedProducts.push(item);\n\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit: selectedProducts[i].unit,\n                purchase_unit_price: parseFloat(selectedProducts[i].purchase_unit_price),\n                retail_unit_price: parseFloat(selectedProducts[i].retail_unit_price),\n                wholesale_unit_price: parseFloat(selectedProducts[i].wholesale_unit_price),\n            });\n        }\n        setFormData({ ...formData });\n    }\n\n    function getProductIndex(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return i;\n            }\n        }\n        return false;\n    }\n\n    function removeProduct(product) {\n        if (product.quantity_returned > 0) {\n            errors[\"product_\" + index] = \"This product cannot be removed as it is returned, Note: Please remove the product from purchase return and try again\"\n            setErrors({ ...errors });\n            return;\n        }\n\n        const index = selectedProducts.indexOf(product);\n        if (index > -1) {\n            selectedProducts.splice(index, 1);\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n    }\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            totalPrice +=\n                parseFloat(selectedProducts[i].purchase_unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n        totalPrice = totalPrice.toFixed(2);\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            vatPrice = (parseFloat((parseFloat(formData.vat_percent) / 100)) * (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount))).toFixed(2);;\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function findNetTotal() {\n        netTotal = 0.00;\n        if (totalPrice > 0) {\n            netTotal = (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount) + parseFloat(vatPrice));\n            netTotal = parseFloat(netTotal);\n        }\n        netTotal = RoundFloat(netTotal, 2);\n        // netTotal = Math.round(netTotal * 100) / 100;\n        setNetTotal(netTotal);\n\n        if (!formData.id) {\n            let method = \"\";\n            if (formData.payments_input[0]) {\n                method = formData.payments_input[0].method;\n            }\n\n            formData.payments_input = [{\n                \"date_str\": formData.date_str,\n                \"amount\": 0.00,\n                \"method\": method,\n                \"deleted\": false,\n            }];\n\n            if (netTotal > 0) {\n                formData.payments_input[0].amount = parseFloat(netTotal.toFixed(2));\n                if (formData.cash_discount) {\n                    formData.payments_input[0].amount = formData.payments_input[0].amount - parseFloat(formData.cash_discount?.toFixed(2));\n                }\n                formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n            }\n        }\n\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n\n    }\n\n    function RoundFloat(val, precision) {\n        var ratio = Math.pow(10, precision);\n        return Math.round(val * ratio) / ratio;\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n            setFormData({ ...formData });\n        }\n    }\n\n\n    function reCalculate() {\n        findTotalPrice();\n\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n    function addNewPayment() {\n        let date = new Date();\n        if (!formData.id) {\n            date = formData.date_str;\n        }\n\n        formData.payments_input.push({\n            \"date_str\": date,\n            // \"amount\": \"\",\n            \"amount\": 0.00,\n            \"method\": \"\",\n            \"deleted\": false,\n        });\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n        //validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n    }\n\n\n    function findTotalPayments() {\n        let totalPayment = 0.00;\n        for (var i = 0; i < formData.payments_input?.length; i++) {\n            if (formData.payments_input[i].amount && !formData.payments_input[i].deleted) {\n                totalPayment += formData.payments_input[i].amount;\n            }\n        }\n\n        totalPaymentAmount = totalPayment;\n        console.log(\"totalPaymentAmount:\", totalPaymentAmount);\n        setTotalPaymentAmount(totalPaymentAmount);\n        console.log(\"totalPayment:\", totalPayment)\n        balanceAmount = (parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))) - parseFloat(totalPayment.toFixed(2));\n        balanceAmount = parseFloat(balanceAmount.toFixed(2));\n        setBalanceAmount(balanceAmount);\n\n        if (balanceAmount === parseFloat((parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))).toFixed(2))) {\n            paymentStatus = \"not_paid\"\n        } else if (balanceAmount <= 0) {\n            paymentStatus = \"paid\"\n        } else if (balanceAmount > 0) {\n            paymentStatus = \"paid_partially\"\n        }\n\n        setPaymentStatus(paymentStatus);\n\n        return totalPayment;\n    }\n\n    let [totalPaymentAmount, setTotalPaymentAmount] = useState(0.00);\n    let [balanceAmount, setBalanceAmount] = useState(0.00);\n    let [paymentStatus, setPaymentStatus] = useState(\"\");\n\n\n\n    function removePayment(key, validatePayments = false) {\n        formData.payments_input.splice(key, 1);\n        //formData.payments_input[key][\"deleted\"] = true;\n        setFormData({ ...formData });\n        if (validatePayments) {\n            validatePaymentAmounts();\n        }\n        findTotalPayments()\n    }\n\n\n    function validatePaymentAmounts() {\n        console.log(\"validatePaymentAmount: netTotal:\", netTotal)\n        errors[\"cash_discount\"] = \"\";\n        setErrors({ ...errors });\n\n        let haveErrors = false;\n        if (!netTotal) {\n            /*\n            removePayment(0, false);\n            totalPaymentAmount = 0.0;\n            setTotalPaymentAmount(0.00);\n            balanceAmount = 0.00;\n            setBalanceAmount(0.00);\n            paymentStatus = \"\";\n            setPaymentStatus(paymentStatus);\n            */\n            return true;\n        }\n\n\n        if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n            errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toFixed(2).toString();\n            setErrors({ ...errors });\n            haveErrors = true\n            return false;\n        }\n\n        let totalPayment = findTotalPayments();\n\n        // errors[\"payment_date\"] = [];\n        //errors[\"payment_method\"] = [];\n        //errors[\"payment_amount\"] = [];\n        for (var key = 0; key < formData.payments_input.length; key++) {\n            errors[\"payment_amount_\" + key] = \"\";\n            errors[\"payment_date_\" + key] = \"\";\n            errors[\"payment_method_\" + key] = \"\";\n            setErrors({ ...errors });\n\n            if (!formData.payments_input[key].amount) {\n                errors[\"payment_amount_\" + key] = \"Payment amount is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if (formData.payments_input[key].amount === 0) {\n                errors[\"payment_amount_\" + key] = \"Amount should be greater than zero\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].date_str) {\n                errors[\"payment_date_\" + key] = \"Payment date is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if ((new Date(formData.payments_input[key].date_str)) < (new Date(formData.date_str))) {\n                errors[\"payment_date_\" + key] = \"Payment date time should be greater than or equal to order date time\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].method) {\n                errors[\"payment_method_\" + key] = \"Payment method is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n\n            if ((formData.payments_input[key].amount || formData.payments_input[key].amount === 0) && !formData.payments_input[key].deleted) {\n                let maxAllowedAmount = (netTotal - formData.cash_discount) - (totalPayment - formData.payments_input[key].amount);\n\n                if (maxAllowedAmount < 0) {\n                    maxAllowedAmount = 0;\n                }\n\n                /*\n                \n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                */\n\n\n            }\n        }\n\n        if (haveErrors) {\n            return false;\n        }\n\n        return true;\n    }\n\n\n    const StoreCreateFormRef = useRef();\n    function openStoreCreateForm() {\n        StoreCreateFormRef.current.open();\n    }\n\n    const ProductCreateFormRef = useRef();\n    function openProductCreateForm() {\n        ProductCreateFormRef.current.open();\n    }\n\n    function openProductUpdateForm(id) {\n        ProductCreateFormRef.current.open(id);\n    }\n\n    const VendorCreateFormRef = useRef();\n    function openVendorCreateForm() {\n        VendorCreateFormRef.current.open();\n    }\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n    return (\n        <>\n            <ProductView ref={ProductDetailsViewRef} openUpdateForm={openProductUpdateForm} openCreateForm={openProductCreateForm} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} openDetailsView={openProductDetailsView} />\n\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n            <VendorCreate ref={VendorCreateFormRef} showToastMessage={props.showToastMessage} />\n            <Modal show={show} size=\"xl\" fullscreen onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Purchase #\" + formData.code : \"Create New Purchase\"}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <PurchasePreview />\n                        {formData.id ? <Button variant=\"primary\" onClick={() => {\n                            handleClose();\n                            props.openDetailsView(formData.id);\n                        }}>\n                            <i className=\"bi bi-eye\"></i> View Detail\n                        </Button> : \"\"}\n                        &nbsp;&nbsp;\n                        <Button variant=\"primary\" onClick={handleCreate} >\n                            {isProcessing ?\n                                <Spinner\n                                    as=\"span\"\n                                    animation=\"border\"\n                                    size=\"sm\"\n                                    role=\"status\"\n                                    aria-hidden={true}\n                                /> + \" Creating...\"\n\n                                : \"\"\n                            }\n                            {formData.id ? \"Update\" : \"Create\"}\n\n                        </Button>\n\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    {Object.keys(errors).length > 0 ?\n                        <div>\n                            <ul>\n\n                                {errors && Object.keys(errors).map((key, index) => {\n                                    return (errors[key] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                })}\n                            </ul></div> : \"\"}\n                    <form className=\"row g-3 needs-validation\" onSubmit={handleCreate}>\n                        {!cookies.get('store_name') ? <div className=\"col-md-6\">\n                            <label className=\"form-label\">Purchase to Store*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"store_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isStoresLoading}\n                                    isInvalid={errors.store_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.store_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.store_id = \"Invalid Store selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedStores([]);\n                                            return;\n                                        }\n                                        formData.store_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedStores(selectedItems);\n                                        //SetPriceOfAllProducts(selectedItems[0].id);\n                                    }}\n                                    options={storeOptions}\n                                    placeholder=\"Select Store\"\n                                    selected={selectedStores}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestStores(searchTerm);\n                                    }}\n                                />\n                                <Button hide={true.toString()} onClick={openStoreCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi x-lg\"> </i>\n                                    {errors.store_id}\n                                </div>\n                                {formData.store_id && !errors.store_id && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Purchase From Vendor*</label>\n                            <Typeahead\n                                id=\"vendor_id\"\n                                labelKey=\"search_label\"\n                                isLoading={isVendorsLoading}\n                                isInvalid={errors.vendor_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    errors.vendor_id = \"\";\n                                    setErrors(errors);\n                                    if (selectedItems.length === 0) {\n                                        errors.vendor_id = \"Invalid Vendor selected\";\n                                        setErrors(errors);\n                                        formData.vendor_id = \"\";\n                                        setFormData({ ...formData });\n                                        setSelectedVendors([]);\n                                        return;\n                                    }\n                                    formData.vendor_id = selectedItems[0].id;\n                                    setFormData({ ...formData });\n                                    setSelectedVendors(selectedItems);\n                                }}\n                                options={vendorOptions}\n                                placeholder=\"Type name or mob\"\n                                selected={selectedVendors}\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestVendors(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openVendorCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.vendor_id && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.vendor_id}\n                                </div>\n                            )}\n                            {formData.vendor_id && !errors.vendor_id && (\n                                <div style={{ color: \"green\" }}>\n                                    <i className=\"bi bi-check-lg\"> </i>\n                                    Looks good!\n                                </div>\n                            )}\n                        </div>\n                        {/*\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Product Barcode Scan</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DebounceInput\n                                    minLength={12}\n                                    debounceTimeout={500}\n                                    placeholder=\"Scan Barcode\"\n                                    className=\"form-control barcode\"\n                                    value={formData.barcode}\n                                    onChange={event => getProductByBarCode(event.target.value)} />\n                                {errors.bar_code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.bar_code}\n                                    </div>\n                                )}\n                                {formData.bar_code && !errors.bar_code && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Vendor Invoice No. (Optional)</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.vendor_invoice_no ? formData.vendor_invoice_no : \"\"}\n                                    type='string'\n                                    onChange={(e) => {\n                                        errors[\"vendor_invoice_no\"] = \"\";\n                                        setErrors({ ...errors });\n                                        formData.vendor_invoice_no = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"vendor_invoice_no\"\n                                    placeholder=\"Vendor Invoice No.\"\n                                />\n                                {errors.vendor_invoice_no && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.vendor_invoice_no}\n                                    </div>\n                                )}\n                                {formData.vendor_invoice_no && !errors.rack && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Date Time*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    selected={formData.date_str ? new Date(formData.date_str) : null}\n                                    value={formData.date_str ? format(\n                                        new Date(formData.date_str),\n                                        \"MMMM d, yyyy h:mm aa\"\n                                    ) : null}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                    showTimeSelect\n                                    timeIntervals=\"1\"\n                                    onChange={(value) => {\n                                        console.log(\"Value\", value);\n                                        formData.date_str = value;\n                                        // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-12\">\n                            <label className=\"form-label\">Product*</label>\n\n\n                            <Typeahead\n                                id=\"product_id\"\n                                size=\"lg\"\n                                labelKey=\"search_label\"\n                                emptyLabel=\"\"\n                                clearButton={true}\n                                open={openProductSearchResult}\n                                isLoading={isProductsLoading}\n                                isInvalid={errors.product_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    if (selectedItems.length === 0) {\n                                        errors[\"product_id\"] = \"Invalid Product selected\";\n                                        setErrors(errors);\n                                        return;\n                                    }\n                                    errors[\"product_id\"] = \"\";\n                                    setErrors({ ...errors });\n\n                                    if (formData.store_id) {\n                                        addProduct(selectedItems[0]);\n\n                                    }\n                                    setOpenProductSearchResult(false);\n                                }}\n                                options={productOptions}\n                                selected={selectedProduct}\n                                placeholder=\"Search By Part No. / Name / Name in Arabic\"\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestProducts(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openProductCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.product_id ? (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.product_id}\n                                </div>\n                            ) : \"\"}\n                            {selectedProduct[0] &&\n                                selectedProduct[0].id &&\n                                !errors.product_id && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n\n                        </div>\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", maxHeight: \"400px\", overflowY: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th style={{ width: \"2%\" }}>Remove</th>\n                                        <th style={{ width: \"5%\" }}>SI No.</th>\n                                        <th style={{ width: \"8%\" }}>Part No.</th>\n                                        <th style={{ width: \"26%\" }} className=\"text-start\">Name</th>\n                                        <th style={{ width: \"11%\" }}>Qty</th>\n                                        <th style={{ width: \"11%\" }}>Purchase Unit Price</th>\n                                        <th style={{ width: \"11%\" }}>Wholesale Unit Price</th>\n                                        <th style={{ width: \"11%\" }}>Retail Unit Price</th>\n                                        <th style={{ width: \"15%\" }}>Purchase Price</th>\n\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr key={index} className=\"text-center\">\n                                            <td>\n                                                <div\n                                                    style={{ color: \"red\", cursor: \"pointer\" }}\n                                                    onClick={() => {\n                                                        removeProduct(product);\n                                                    }}\n                                                >\n                                                    <i className=\"bi bi-x-lg\"> </i>\n                                                </div>\n                                            </td>\n                                            <td>{index + 1}</td>\n                                            <td>{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n                                            }}\n                                                className=\"text-start\"\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                    console.log(\"okk,id:\", product.product_id);\n                                                }}>{product.name}\n                                            </td>\n                                            <td style={{ width: \"155px\" }}>\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.quantity} className=\"form-control\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity should be > 0\";\n                                                                selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            reCalculate();\n\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].quantity:\", selectedProducts[index].quantity);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.purchase_unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Purchase Unit Price\" onChange={(e) => {\n                                                            errors[\"purchase_unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n\n                                                            if (!e.target.value) {\n                                                                errors[\"purchase_unit_price_\" + index] = \"Invalid Purchase Unit Price\";\n                                                                selectedProducts[index].purchase_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"purchase_unit_price_\" + index] = \"Purchase Unit Price should be > 0\";\n                                                                selectedProducts[index].purchase_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].purchase_unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].purchase_unit_price:\", selectedProducts[index].purchase_unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n\n                                                {errors[\"purchase_unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"purchase_unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.wholesale_unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Wholesale Unit Price\" onChange={(e) => {\n                                                            errors[\"wholesale_unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"wholesale_unit_price_\" + index] = \"Invalid Wholesale Unit Price\";\n                                                                selectedProducts[index].wholesale_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"wholesale_unit_price_\" + index] = \"Wholesale Unit Price should be > 0\";\n                                                                selectedProducts[index].wholesale_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].wholesale_unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].wholesale_unit_price:\", selectedProducts[index].wholesale_unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n\n                                                {errors[\"wholesale_unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"wholesale_unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.retail_unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Retail Unit Price\" onChange={(e) => {\n                                                            errors[\"retail_unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"retail_unit_price_\" + index] = \"Invalid Retail Unit Price\";\n                                                                selectedProducts[index].retail_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"retail_unit_price_\" + index] = \"Retail Unit Price should be > 0\";\n                                                                selectedProducts[index].retail_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].retail_unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].retail_unit_price:\", selectedProducts[index].retail_unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n\n                                                {errors[\"retail_unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"retail_unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td className=\"text-end\">\n                                                <NumberFormat\n                                                    value={(product.purchase_unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n\n                                        </tr>\n                                    )).reverse()}\n                                </tbody>\n                            </table>\n                        </div>\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n                                        <th style={{ width: \"90%\" }} colSpan=\"8\" className=\"text-end\">Total</th>\n                                        <td style={{ width: \"10%\" }} className=\"text-end\">\n                                            <NumberFormat\n                                                value={totalPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Shipping & Handling Fees\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.shipping_handling_fees} onChange={(e) => {\n\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"Shipping / Handling Fees should be > 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.shipping_handling_fees = \"\";\n                                                    errors[\"shipping_handling_fees\"] = \"Invalid Shipping / Handling Fees\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"shipping_handling_fees\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.shipping_handling_fees && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.shipping_handling_fees}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\"> VAT  <input type=\"number\" className=\"text-center\" style={{ width: \"50px\" }} value={formData.vat_percent} onChange={(e) => {\n                                            console.log(\"Inside onchange vat percent\");\n                                            if (parseFloat(e.target.value) === 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n                                            if (parseFloat(e.target.value) < 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"Vat percent should be >= 0\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n\n\n                                            if (!e.target.value) {\n                                                formData.vat_percent = \"\";\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                //formData.discount_percent = 0.00;\n                                                errors[\"vat_percent\"] = \"Invalid vat percent\";\n                                                setFormData({ ...formData });\n                                                setErrors({ ...errors });\n                                                return;\n                                            }\n                                            errors[\"vat_percent\"] = \"\";\n                                            setErrors({ ...errors });\n\n                                            formData.vat_percent = e.target.value;\n                                            reCalculate();\n                                            setFormData({ ...formData });\n                                            console.log(formData);\n                                        }} />{\"%\"}\n                                            {errors.vat_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.vat_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Cash discount</label>\n                            <input type='number' value={formData.cash_discount} className=\"form-control \"\n                                onChange={(e) => {\n                                    errors[\"cash_discount\"] = \"\";\n                                    setErrors({ ...errors });\n                                    if (!e.target.value) {\n                                        formData.cash_discount = e.target.value;\n                                        setFormData({ ...formData });\n                                        validatePaymentAmounts();\n                                        return;\n                                    }\n                                    formData.cash_discount = parseFloat(e.target.value);\n                                    if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n                                        errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toString();\n                                        setErrors({ ...errors });\n                                        return;\n                                    }\n\n                                    setFormData({ ...formData });\n                                    validatePaymentAmounts();\n                                    console.log(formData);\n                                }}\n                            />\n                            {errors.cash_discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.cash_discount}\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"col-md-8\">\n                            <label className=\"form-label\">Payments Paid</label>\n\n                            <div class=\"table-responsive\" style={{ maxWidth: \"900px\" }}>\n                                <Button variant=\"secondary\" style={{ alignContent: \"right\", marginBottom: \"10px\" }} onClick={addNewPayment}>\n                                    Create new payment\n                                </Button>\n                                <table class=\"table table-striped table-sm table-bordered\">\n                                    {formData.payments_input && formData.payments_input.length > 0 &&\n                                        <thead>\n                                            <th>\n                                                Date\n                                            </th>\n                                            <th>\n                                                Amount\n                                            </th>\n                                            <th>\n                                                Payment method\n                                            </th>\n                                            <th>\n                                                Action\n                                            </th>\n                                        </thead>}\n                                    <tbody>\n                                        {formData.payments_input &&\n                                            formData.payments_input.filter(payment => !payment.deleted).map((payment, key) => (\n                                                <tr key={key}>\n                                                    <td style={{ minWidth: \"220px\" }}>\n\n                                                        <DatePicker\n                                                            id=\"payment_date_str\"\n                                                            selected={formData.payments_input[key].date_str ? new Date(formData.payments_input[key].date_str) : null}\n                                                            value={formData.payments_input[key].date_str ? format(\n                                                                new Date(formData.payments_input[key].date_str),\n                                                                \"MMMM d, yyyy h:mm aa\"\n                                                            ) : null}\n                                                            className=\"form-control\"\n                                                            dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                                            showTimeSelect\n                                                            timeIntervals=\"1\"\n                                                            onChange={(value) => {\n                                                                console.log(\"Value\", value);\n                                                                formData.payments_input[key].date_str = value;\n                                                                setFormData({ ...formData });\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_date_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_date_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"300px\" }}>\n                                                        <input type='number' value={formData.payments_input[key].amount} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                errors[\"payment_amount_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    formData.payments_input[key].amount = e.target.value;\n                                                                    setFormData({ ...formData });\n                                                                    validatePaymentAmounts();\n                                                                    return;\n                                                                }\n\n                                                                formData.payments_input[key].amount = parseFloat(e.target.value);\n\n                                                                validatePaymentAmounts();\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_amount_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_amount_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <select value={formData.payments_input[key].method} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                // errors[\"payment_method\"] = [];\n                                                                errors[\"payment_method_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    errors[\"payment_method_\" + key] = \"Payment method is required\";\n                                                                    setErrors({ ...errors });\n\n                                                                    formData.payments_input[key].method = \"\";\n                                                                    setFormData({ ...formData });\n                                                                    return;\n                                                                }\n\n                                                                // errors[\"payment_method\"] = \"\";\n                                                                //setErrors({ ...errors });\n\n                                                                formData.payments_input[key].method = e.target.value;\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        >\n                                                            <option value=\"\">Select</option>\n                                                            <option value=\"cash\">Cash</option>\n                                                            <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                                            <option value=\"vendor_account\">Vendor Account</option>\n                                                        </select>\n                                                        {errors[\"payment_method_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_method_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <Button variant=\"danger\" onClick={(event) => {\n                                                            removePayment(key);\n                                                        }}>\n                                                            Remove\n                                                        </Button>\n\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                        <tr>\n                                            <td class=\"text-end\">\n                                                <b>Total</b>\n                                            </td>\n                                            <td><b style={{ marginLeft: \"14px\" }}>{totalPaymentAmount?.toFixed(2)}</b>\n\n                                            </td>\n                                            <td>\n                                                <b style={{ marginLeft: \"12px\", alignSelf: \"end\" }}>Balance: {balanceAmount?.toFixed(2)}</b>\n                                            </td>\n                                            <td colSpan={1}>\n                                                <b>Payment status: </b>\n                                                {paymentStatus == \"paid\" ?\n                                                    <span className=\"badge bg-success\">\n                                                        Paid\n                                                    </span> : \"\"}\n                                                {paymentStatus == \"paid_partially\" ?\n                                                    <span className=\"badge bg-warning\">\n                                                        Paid Partially\n                                                    </span> : \"\"}\n                                                {paymentStatus == \"not_paid\" ?\n                                                    <span className=\"badge bg-danger\">\n                                                        Not Paid\n                                                    </span> : \"\"}\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n\n\n\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate} >\n                                {isProcessing ?\n                                    <Spinner\n                                        as=\"span\"\n                                        animation=\"border\"\n                                        size=\"sm\"\n                                        role=\"status\"\n                                        aria-hidden={true}\n                                    /> + \" Creating...\"\n\n                                    : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>\n                </Modal.Body >\n\n            </Modal >\n\n\n        </>\n    );\n});\n\nexport default PurchaseCreate;\n"]},"metadata":{},"sourceType":"module"}