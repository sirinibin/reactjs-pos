{"ast":null,"code":"var _jsxFileName = \"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/sales_return/create.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport SalesReturnPreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport CustomerCreate from \"./../customer/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport SalesReturnView from \"./view.js\";\nimport ProductView from \"./../product/view.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SalesReturnCreate = /*#__PURE__*/forwardRef(_c = _s((props, ref) => {\n  var _vatPrice, _netTotal, _totalPaymentAmount, _balanceAmount;\n\n  _s();\n\n  useImperativeHandle(ref, () => ({\n    open(id, orderId) {\n      errors = {};\n      setErrors({ ...errors\n      });\n      formData = {\n        order_id: orderId,\n        vat_percent: 15.0,\n        discount: 0.0,\n        discountValue: 0.0,\n        discount_percent: 0.0,\n        is_discount_percent: false,\n        //  date_str: format(new Date(), \"MMM dd yyyy\"),\n        date_str: new Date(),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"received\",\n        payment_status: \"\",\n        payment_method: \"\",\n        price_type: \"retail\"\n      };\n      formData.payments_input = [{\n        \"date_str\": formData.date_str,\n        // \"amount\": \"\",\n        \"amount\": 0.00,\n        \"method\": \"\",\n        \"deleted\": false\n      }];\n      formData.cash_discount = 0.00;\n\n      if (cookies.get(\"user_id\")) {\n        selectedReceivedByUsers = [{\n          id: cookies.get(\"user_id\"),\n          name: cookies.get(\"user_name\")\n        }];\n        formData.received_by = cookies.get(\"user_id\");\n        setFormData({ ...formData\n        });\n        setSelectedReceivedByUsers([...selectedReceivedByUsers]);\n      }\n\n      setFormData({ ...formData\n      });\n\n      if (id) {\n        getSalesReturn(id);\n      }\n\n      if (orderId) {\n        reCalculate();\n        getOrder(orderId);\n      }\n\n      setShow(true);\n    }\n\n  }));\n\n  function getSalesReturn(id) {\n    console.log(\"inside getSalesReturn id:\", id);\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/sales-return/' + id, requestOptions).then(async response => {\n      var _response$headers$get;\n\n      const isJson = (_response$headers$get = response.headers.get('content-type')) === null || _response$headers$get === void 0 ? void 0 : _response$headers$get.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      console.log(\"Response:\");\n      console.log(data);\n      let salesReturn = data.result; // formData = purchaseReturn;\n\n      formData = {\n        id: salesReturn.id,\n        code: salesReturn.code,\n        order_code: salesReturn.order_code,\n        order_id: salesReturn.order_id,\n        store_id: salesReturn.store_id,\n        customer_id: salesReturn.customer_id,\n        date_str: salesReturn.date,\n        payments_input: salesReturn.payments,\n        cash_discount: salesReturn.cash_discount,\n        // date: purchase.date,\n        vat_percent: salesReturn.vat_percent,\n        discount: salesReturn.discount,\n        discount_percent: salesReturn.discount_percent,\n        is_discount_percent: salesReturn.is_discount_percent,\n        payment_status: salesReturn.payment_status // shipping_handling_fees: salesReturn.shipping_handling_fees,\n\n      };\n\n      for (var i = 0; i < formData.payments_input.length; i++) {\n        formData.payments_input[i].date_str = formData.payments_input[i].date;\n      }\n\n      setFormData({ ...formData\n      });\n      console.log(\"formData1.status:\", formData.status);\n      console.log(\"purchaseReturn.products:\", salesReturn.products);\n      let selectedProductsTemp = salesReturn.products;\n      selectedProducts = [];\n\n      for (let i = 0; i < selectedProductsTemp.length; i++) {\n        if (selectedProductsTemp[i].quantity > 0) {\n          selectedProductsTemp[i].selected = true;\n        } else {\n          selectedProductsTemp[i].selected = false;\n        }\n\n        selectedProducts.push(selectedProductsTemp[i]); //selectedProductsTemp[i].purchase_unit_price = selectedProductsTemp[i].purchasereturn_unit_price;\n      }\n\n      setSelectedProducts([...selectedProducts]);\n      setFormData({ ...formData\n      });\n      reCalculate();\n      setFormData({ ...formData\n      });\n    }).catch(error => {\n      setProcessing(false);\n      setErrors(error);\n    });\n  }\n\n  useEffect(() => {\n    const listener = event => {\n      if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n        console.log(\"Enter key was pressed. Run your function.\"); // event.preventDefault();\n\n        var form = event.target.form;\n\n        if (form && event.target) {\n          var index = Array.prototype.indexOf.call(form, event.target);\n\n          if (form && form.elements[index + 1]) {\n            if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n              form.elements[index].focus();\n            } else {\n              form.elements[index + 1].focus();\n            }\n\n            event.preventDefault();\n          }\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", listener);\n    return () => {\n      document.removeEventListener(\"keydown\", listener);\n    };\n  }, []);\n\n  function getOrder(id) {\n    console.log(\"inside get SalesReturn\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/order/' + id, requestOptions).then(async response => {\n      var _response$headers$get2;\n\n      const isJson = (_response$headers$get2 = response.headers.get('content-type')) === null || _response$headers$get2 === void 0 ? void 0 : _response$headers$get2.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      console.log(\"Response:\");\n      console.log(data);\n      let order = data.result;\n      let selectedProductsTemp = order.products;\n      selectedProducts = [];\n\n      for (let i = 0; i < selectedProductsTemp.length; i++) {\n        selectedProductsTemp[i].selected = false;\n        let soldQty = selectedProductsTemp[i].quantity - selectedProductsTemp[i].quantity_returned;\n        selectedProductsTemp[i].quantity = soldQty;\n\n        if (soldQty > 0) {\n          selectedProducts.push(selectedProductsTemp[i]);\n        }\n      } // selectedProducts = selectedProductsTemp\n\n\n      console.log(\"selectedProducts:\", selectedProducts);\n      setSelectedProducts([...selectedProducts]); //formData = order;\n\n      console.log(\"order.id:\", order.id);\n      formData.id = \"\";\n      formData.products = order.products; // formData.order_id = order.id;\n      //console.log(\"formData.order_id:\", formData.order_id);\n\n      formData.order_code = order.code;\n      formData.store_id = order.store_id;\n      /*\n      formData.received_by = order.delivered_by;\n      formData.received_by_signature_id = order.delivered_by_signature_id;\n      */\n\n      formData.customer_id = order.customer_id; // formData.is_discount_percent = order.is_discount_percent;\n\n      formData.is_discount_percent = true;\n      console.log(\"order.discount_percent:\", order.discount_percent);\n      formData.discount_percent = order.discount_percent;\n      formData.cash_discount = parseFloat(order.cash_discount - order.return_cash_discount); // formData.discount = (order.discount - order.return_discount);\n      // formData.discount_percent = order.discount_percent;\n\n      /*\n      if (formData.is_discount_percent) {\n          formData.discountValue = formData.discount_percent;\n      } else {\n          formData.discountValue = formData.discount;\n      }\n      */\n      // setFormData({ ...formData });\n\n      console.log(\"formData:\", formData);\n      selectedStores = [{\n        id: order.store_id,\n        name: order.store_name\n      }];\n      setSelectedStores(selectedStores);\n      console.log(\"selectedStores:\", selectedStores);\n      setFormData({ ...formData\n      });\n      reCalculate();\n      setFormData({ ...formData\n      });\n    }).catch(error => {\n      setProcessing(false);\n      setErrors(error);\n    });\n  }\n  /*\n  let [barcode, setBarcode] = useState(\"\");\n  let [barcodeEnded, setBarcodeEnded] = useState(false);\n  const keyPress = useCallback(\n      (e) => {\n          console.log(\"e.key:\", e.key);\n           if (!barcodeEnded && e.key != \"Enter\") {\n              console.log()\n              barcode += e.key;\n              setBarcode(barcode);\n          }\n           if (e.key === \"Enter\") {\n              document.removeEventListener(\"keydown\", keyPress);\n              console.log(\"barcode:\", barcode);\n              barcodeEnded = true;\n              setBarcodeEnded(true);\n          }\n       },\n      []\n  );\n   function addListener() {\n      //barcode = \"\";\n      //setBarcode(barcode);\n      document.addEventListener(\"keydown\", keyPress);\n      console.log(\"Listener added, barcode:\", barcode);\n  }\n  */\n\n  /*\n  useEffect(() => {\n      document.addEventListener(\"keydown\", keyPress);\n      return () => document.removeEventListener(\"keydown\", keyPress);\n  }, [keyPress]);\n  */\n\n  /*\n  useEffect(() => {\n      document.addEventListener('keydown', handleKeyDown);\n      return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  });\n  let [barcode, setBarcode] = useState(\"\");\n  function handleKeyDown(event) {\n      console.log(\"event.key:\", event.key);\n       /*\n      if (event.key == \"Enter\") {\n          barcode = \"\";\n          setBarcode(barcode);\n      }\n      else if (event.key == \"Shift\") {\n          console.log(\"barcode:\", barcode);\n      } else {\n          barcode += event.key;\n          setBarcode(barcode);\n      }\n      */\n\n  /*\n  if (event.keyCode === KEY_ESCAPE) {\n      /* do your action here */\n  // }  \n  // }\n\n\n  const selectedDate = new Date(); //const history = useHistory();\n\n  let [errors, setErrors] = useState({});\n  const [isProcessing, setProcessing] = useState(false);\n  const cookies = new Cookies(); //fields\n\n  let [formData, setFormData] = useState({\n    order_id: \"\",\n    vat_percent: 15.0,\n    discount: 0.0,\n    date_str: format(new Date(), \"MMM dd yyyy\"),\n    signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n    status: \"received\",\n    payment_status: \"\",\n    payment_method: \"\",\n    price_type: \"retail\"\n  });\n  let [selectedStores, setSelectedStores] = useState([]); //Product Auto Suggestion\n\n  let [selectedProducts, setSelectedProducts] = useState([]); //Received By Auto Suggestion\n\n  const [receivedByUserOptions, setReceivedByUserOptions] = useState([]);\n  let [selectedReceivedByUsers, setSelectedReceivedByUsers] = useState([]);\n  const [isReceivedByUsersLoading, setIsReceivedByUsersLoading] = useState(false); //Received By Signature Auto Suggestion\n\n  const [receivedBySignatureOptions, setReceivedBySignatureOptions] = useState([]);\n  const [selectedReceivedBySignatures, setSelectedReceivedBySignatures] = useState([]);\n  const [isReceivedBySignaturesLoading, setIsReceivedBySignaturesLoading] = useState(false);\n  const [show, setShow] = useState(false);\n\n  function handleClose() {\n    setShow(false);\n  }\n\n  useEffect(() => {\n    let at = cookies.get(\"access_token\");\n\n    if (!at) {\n      // history.push(\"/dashboard/salesreturns\");\n      window.location = \"/\";\n    }\n  });\n\n  function ObjectToSearchQueryParams(object) {\n    return Object.keys(object).map(function (key) {\n      return `search[${key}]=${object[key]}`;\n    }).join(\"&\");\n  }\n\n  async function suggestUsers(searchTerm) {\n    console.log(\"Inside handle suggestUsers\");\n    setReceivedByUserOptions([]);\n    console.log(\"searchTerm:\" + searchTerm);\n\n    if (!searchTerm) {\n      return;\n    }\n\n    var params = {\n      name: searchTerm\n    };\n    var queryString = ObjectToSearchQueryParams(params);\n\n    if (queryString !== \"\") {\n      queryString = \"&\" + queryString;\n    }\n\n    const requestOptions = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: cookies.get(\"access_token\")\n      }\n    };\n    let Select = \"select=id,name\";\n    setIsReceivedByUsersLoading(true);\n    let result = await fetch(\"/v1/user?\" + Select + queryString, requestOptions);\n    let data = await result.json();\n    setReceivedByUserOptions(data.result);\n    setIsReceivedByUsersLoading(false);\n  }\n\n  async function suggestSignatures(searchTerm) {\n    console.log(\"Inside handle suggestSignatures\");\n    setReceivedBySignatureOptions([]);\n    console.log(\"searchTerm:\" + searchTerm);\n\n    if (!searchTerm) {\n      return;\n    }\n\n    var params = {\n      name: searchTerm\n    };\n    var queryString = ObjectToSearchQueryParams(params);\n\n    if (queryString !== \"\") {\n      queryString = \"&\" + queryString;\n    }\n\n    const requestOptions = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: cookies.get(\"access_token\")\n      }\n    };\n    let Select = \"select=id,name\";\n    setIsReceivedBySignaturesLoading(true);\n    let result = await fetch(\"/v1/signature?\" + Select + queryString, requestOptions);\n    let data = await result.json();\n    setReceivedBySignatureOptions(data.result);\n    setIsReceivedBySignaturesLoading(false);\n  }\n\n  function handleCreate(event) {\n    event.preventDefault();\n    console.log(\"Inside handle Create\");\n    console.log(\"selectedProducts:\", selectedProducts);\n    console.log(\"formData.order_id:\", formData.order_id);\n    formData.products = [];\n\n    for (var i = 0; i < selectedProducts.length; i++) {\n      if (!selectedProducts[i].selected) {\n        continue;\n      }\n\n      formData.products.push({\n        product_id: selectedProducts[i].product_id,\n        quantity: parseFloat(selectedProducts[i].quantity),\n        unit_price: parseFloat(selectedProducts[i].unit_price),\n        unit: selectedProducts[i].unit\n      });\n    }\n\n    if (!formData.cash_discount) {\n      formData.cash_discount = 0.00;\n    }\n\n    formData.discount = parseFloat(formData.discount);\n    formData.discount_percent = parseFloat(formData.discount_percent);\n    formData.vat_percent = parseFloat(formData.vat_percent);\n    console.log(\"formData.discount:\", formData.discount);\n    let haveErrors = false;\n    errors[\"products\"] = \"\";\n    setErrors({ ...errors\n    });\n\n    if (formData.products.length === 0) {\n      errors[\"products\"] = \"No products added\";\n      setErrors({ ...errors\n      });\n      haveErrors = true;\n    }\n\n    if (!formData.discount && formData.discount !== 0) {\n      errors[\"discount\"] = \"Invalid discount\";\n      setErrors({ ...errors\n      });\n      haveErrors = true;\n    }\n\n    if (!formData.discount_percent && formData.discount_percent !== 0) {\n      errors[\"discount_percent\"] = \"Invalid discount percent\";\n      setErrors({ ...errors\n      });\n      haveErrors = true;\n    }\n\n    if (parseFloat(formData.discount_percent) > 100) {\n      errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n      setErrors({ ...errors\n      });\n      haveErrors = true;\n    }\n\n    if (!validatePaymentAmounts()) {\n      console.log(\"Errors on payments\");\n      haveErrors = true;\n    }\n\n    if (haveErrors) {\n      console.log(\"Errors: \", errors);\n      return;\n    }\n    /*\n    if (!formData.discountValue && formData.discountValue !== 0) {\n        errors[\"discount\"] = \"Invalid Discount\";\n        setErrors({ ...errors });\n        return;\n    }\n    */\n\n\n    formData.net_total = parseFloat(netTotal);\n    let endPoint = \"/v1/sales-return\";\n    let method = \"POST\";\n\n    if (formData.id) {\n      endPoint = \"/v1/sales-return/\" + formData.id;\n      method = \"PUT\";\n    }\n\n    const requestOptions = {\n      method: method,\n      headers: {\n        'Accept': 'application/json',\n        \"Content-Type\": \"application/json\",\n        Authorization: cookies.get(\"access_token\")\n      },\n      body: JSON.stringify(formData)\n    };\n    console.log(\"formData:\", formData);\n    setProcessing(true);\n    fetch(endPoint, requestOptions).then(async response => {\n      var _response$headers$get3;\n\n      const isJson = (_response$headers$get3 = response.headers.get(\"content-type\")) === null || _response$headers$get3 === void 0 ? void 0 : _response$headers$get3.includes(\"application/json\");\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        // get error message from body or default to response status\n        const error = data && data.errors; //const error = data.errors\n\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      setProcessing(false);\n      console.log(\"Response:\");\n      console.log(data);\n      props.showToastMessage(\"SalesReturn Created Successfully!\", \"success\");\n\n      if (props.refreshList) {\n        props.refreshList();\n      }\n\n      handleClose();\n      openDetailsView(data.result.id);\n    }).catch(error => {\n      setProcessing(false);\n      console.log(\"Inside catch\");\n      console.log(error);\n      setErrors({ ...error\n      });\n      console.error(\"There was an error!\", error);\n      props.showToastMessage(\"Error Creating SalesReturn!\", \"danger\");\n    });\n  }\n\n  let [totalPrice, setTotalPrice] = useState(0.0);\n\n  function findTotalPrice() {\n    totalPrice = 0.00;\n\n    for (var i = 0; i < selectedProducts.length; i++) {\n      if (!selectedProducts[i].selected) {\n        continue;\n      }\n\n      totalPrice += parseFloat(selectedProducts[i].unit_price) * parseFloat(selectedProducts[i].quantity);\n    }\n\n    totalPrice = totalPrice.toFixed(2);\n    setTotalPrice(totalPrice);\n  }\n\n  let [vatPrice, setVatPrice] = useState(0.00);\n  /*\n  function findVatPrice() {\n      vatPrice = ((parseFloat(formData.vat_percent) / 100) * parseFloat(totalPrice - formData.discount)).toFixed(2);;\n      console.log(\"vatPrice:\", vatPrice);\n      setVatPrice(vatPrice);\n  }*/\n\n  function findVatPrice() {\n    vatPrice = 0.00;\n\n    if (totalPrice > 0) {\n      //+ parseFloat(formData.shipping_handling_fees)\n      vatPrice = parseFloat(parseFloat(formData.vat_percent) / 100) * (parseFloat(totalPrice) - parseFloat(formData.discount));\n      console.log(\"vatPrice:\", vatPrice);\n    }\n\n    setVatPrice(vatPrice);\n  }\n\n  let [netTotal, setNetTotal] = useState(0.00);\n\n  function findNetTotal() {\n    if (totalPrice > 0) {\n      netTotal = parseFloat(totalPrice) - parseFloat(formData.discount) + parseFloat(vatPrice);\n      setNetTotal(netTotal);\n    }\n\n    netTotal = Math.round(netTotal * 100) / 100;\n    console.log(\"after rounding netTotal:\", netTotal);\n    setNetTotal(netTotal);\n\n    if (!formData.id) {\n      let method = \"\";\n\n      if (formData.payments_input[0]) {\n        method = formData.payments_input[0].method;\n      }\n\n      formData.payments_input = [{\n        \"date_str\": formData.date_str,\n        \"amount\": 0.00,\n        \"method\": method,\n        \"deleted\": false\n      }];\n\n      if (netTotal > 0) {\n        formData.payments_input[0].amount = parseFloat(netTotal.toFixed(2));\n\n        if (formData.cash_discount) {\n          var _formData$cash_discou;\n\n          formData.payments_input[0].amount = formData.payments_input[0].amount - parseFloat((_formData$cash_discou = formData.cash_discount) === null || _formData$cash_discou === void 0 ? void 0 : _formData$cash_discou.toFixed(2));\n        }\n\n        formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2)); //formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n      }\n    }\n\n    setFormData({ ...formData\n    });\n    validatePaymentAmounts();\n  }\n\n  let [discountPercent, setDiscountPercent] = useState(0.00);\n  /*\n  function findDiscountPercent() {\n      if (formData.discount >= 0 && totalPrice > 0) {\n          discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n          setDiscountPercent(discountPercent);\n          formData.discount_percent = discountPercent;\n          setFormData({ ...formData });\n      }\n  }\n  */\n\n  /*\n  function findDiscountPercent() {\n      if (!formData.discountValue) {\n          formData.discount = 0.00;\n          formData.discount_percent = 0.00;\n          setFormData({ ...formData });\n          return;\n      }\n       formData.discount = formData.discountValue;\n       if (formData.discount > 0 && totalPrice > 0) {\n          discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n          setDiscountPercent(discountPercent);\n          formData.discount_percent = discountPercent;\n          setFormData({ ...formData });\n      }\n   }\n  */\n\n  /*\n  function findDiscount() {\n      if (!formData.discountValue) {\n          formData.discount = 0.00;\n          formData.discount_percent = 0.00;\n          setFormData({ ...formData });\n          return;\n      }\n       formData.discount_percent = formData.discountValue;\n       if (formData.discount_percent > 0 && totalPrice > 0) {\n          formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n      }\n      setFormData({ ...formData });\n  }\n  */\n\n  function findDiscount() {\n    if (formData.discount_percent >= 0 && totalPrice > 0) {\n      formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)); //formData.discount = Math.round(formData.discount * 100) / 100;\n\n      formData.discount = parseFloat(formData.discount.toFixed(2));\n      setFormData({ ...formData\n      });\n    }\n  }\n\n  function findDiscountPercent() {\n    if (formData.discount >= 0 && totalPrice > 0) {\n      discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n      setDiscountPercent(discountPercent);\n      formData.discount_percent = discountPercent; //formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\n\n      setFormData({ ...formData\n      });\n    }\n  }\n\n  function reCalculate() {\n    findTotalPrice(); //findDiscount();\n    //findDiscountPercent();\n\n    if (formData.is_discount_percent) {\n      findDiscount();\n    } else {\n      findDiscountPercent();\n    }\n\n    findVatPrice();\n    findNetTotal();\n  }\n\n  const DetailsViewRef = useRef();\n\n  function openDetailsView(id) {\n    DetailsViewRef.current.open(id);\n  }\n\n  const StoreCreateFormRef = useRef();\n  const CustomerCreateFormRef = useRef();\n  const ProductCreateFormRef = useRef();\n  const UserCreateFormRef = useRef();\n\n  function openUserCreateForm() {\n    UserCreateFormRef.current.open();\n  }\n\n  const SignatureCreateFormRef = useRef();\n\n  function openSignatureCreateForm() {\n    SignatureCreateFormRef.current.open();\n  }\n\n  const ProductDetailsViewRef = useRef();\n\n  function openProductDetailsView(id) {\n    ProductDetailsViewRef.current.open(id);\n  }\n\n  let [totalPaymentAmount, setTotalPaymentAmount] = useState(0.00);\n  let [balanceAmount, setBalanceAmount] = useState(0.00);\n  let [paymentStatus, setPaymentStatus] = useState(\"\");\n\n  function findTotalPayments() {\n    var _parseFloat, _parseFloat2;\n\n    let totalPayment = 0.00;\n\n    for (var i = 0; i < ((_formData$payments_in = formData.payments_input) === null || _formData$payments_in === void 0 ? void 0 : _formData$payments_in.length); i++) {\n      var _formData$payments_in;\n\n      if (formData.payments_input[i].amount && !formData.payments_input[i].deleted) {\n        totalPayment += formData.payments_input[i].amount;\n      }\n    }\n\n    totalPaymentAmount = totalPayment;\n    setTotalPaymentAmount(totalPaymentAmount); // balanceAmount = (netTotal - formData.cash_discount) - totalPayment;\n\n    balanceAmount = parseFloat(netTotal.toFixed(2)) - parseFloat((_parseFloat = parseFloat(formData.cash_discount)) === null || _parseFloat === void 0 ? void 0 : _parseFloat.toFixed(2)) - parseFloat(totalPayment.toFixed(2));\n    balanceAmount = parseFloat(balanceAmount.toFixed(2));\n    setBalanceAmount(balanceAmount);\n\n    if (balanceAmount === parseFloat((parseFloat(netTotal.toFixed(2)) - parseFloat((_parseFloat2 = parseFloat(formData.cash_discount)) === null || _parseFloat2 === void 0 ? void 0 : _parseFloat2.toFixed(2))).toFixed(2))) {\n      paymentStatus = \"not_paid\";\n    } else if (parseFloat(balanceAmount.toFixed(2)) <= 0) {\n      paymentStatus = \"paid\";\n    } else if (parseFloat(balanceAmount.toFixed(2)) > 0) {\n      paymentStatus = \"paid_partially\";\n    }\n\n    setPaymentStatus(paymentStatus);\n    return totalPayment;\n  }\n\n  function validatePaymentAmounts() {\n    errors[\"cash_discount\"] = \"\";\n    setErrors({ ...errors\n    });\n    let haveErrors = false;\n\n    if (!netTotal) {\n      removePayment(0, false);\n      totalPaymentAmount = 0.0;\n      setTotalPaymentAmount(0.00);\n      balanceAmount = 0.00;\n      setBalanceAmount(0.00);\n      paymentStatus = \"\";\n      setPaymentStatus(paymentStatus);\n      return true;\n    }\n\n    if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n      errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toFixed(2).toString();\n      setErrors({ ...errors\n      });\n      haveErrors = true;\n      return false;\n    }\n\n    let totalPayment = findTotalPayments(); // errors[\"payment_date\"] = [];\n    //errors[\"payment_method\"] = [];\n    //errors[\"payment_amount\"] = [];\n\n    for (var key = 0; key < formData.payments_input.length; key++) {\n      errors[\"payment_amount_\" + key] = \"\";\n      errors[\"payment_date_\" + key] = \"\";\n      errors[\"payment_method_\" + key] = \"\";\n      setErrors({ ...errors\n      });\n\n      if (!formData.payments_input[key].amount) {\n        errors[\"payment_amount_\" + key] = \"Payment amount is required\";\n        setErrors({ ...errors\n        });\n        haveErrors = true;\n      } else if (formData.payments_input[key].amount === 0) {\n        errors[\"payment_amount_\" + key] = \"Amount should be greater than zero\";\n        setErrors({ ...errors\n        });\n        haveErrors = true;\n      }\n\n      if (!formData.payments_input[key].date_str) {\n        errors[\"payment_date_\" + key] = \"Payment date is required\";\n        setErrors({ ...errors\n        });\n        haveErrors = true;\n      } else if (new Date(formData.payments_input[key].date_str) < new Date(formData.date_str)) {\n        errors[\"payment_date_\" + key] = \"Payment date time should be greater than or equal to order date time\";\n        setErrors({ ...errors\n        });\n        haveErrors = true;\n      }\n\n      if (!formData.payments_input[key].method) {\n        errors[\"payment_method_\" + key] = \"Payment method is required\";\n        setErrors({ ...errors\n        });\n        haveErrors = true;\n      }\n\n      if ((formData.payments_input[key].amount || formData.payments_input[key].amount === 0) && !formData.payments_input[key].deleted) {\n        let maxAllowedAmount = netTotal - formData.cash_discount - (totalPayment - formData.payments_input[key].amount);\n\n        if (maxAllowedAmount < 0) {\n          maxAllowedAmount = 0;\n        }\n\n        if (maxAllowedAmount === 0) {\n          errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n          setErrors({ ...errors\n          });\n          haveErrors = true;\n        } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n          errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n          setErrors({ ...errors\n          });\n          haveErrors = true;\n        }\n      }\n    }\n\n    if (haveErrors) {\n      return false;\n    }\n\n    return true;\n  }\n\n  function addNewPayment() {\n    let date = new Date();\n\n    if (!formData.id) {\n      date = formData.date_str;\n    }\n\n    formData.payments_input.push({\n      \"date_str\": date,\n      // \"amount\": \"\",\n      \"amount\": 0.00,\n      \"method\": \"\",\n      \"deleted\": false\n    });\n    setFormData({ ...formData\n    });\n    validatePaymentAmounts(); //validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n  }\n\n  function removePayment(key, validatePayments = false) {\n    formData.payments_input.splice(key, 1); //formData.payments_input[key][\"deleted\"] = true;\n\n    setFormData({ ...formData\n    });\n\n    if (validatePayments) {\n      validatePaymentAmounts();\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(SalesReturnView, {\n      ref: DetailsViewRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 991,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ProductView, {\n      ref: ProductDetailsViewRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 992,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(StoreCreate, {\n      ref: StoreCreateFormRef,\n      showToastMessage: props.showToastMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 993,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(CustomerCreate, {\n      ref: CustomerCreateFormRef,\n      showToastMessage: props.showToastMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 994,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ProductCreate, {\n      ref: ProductCreateFormRef,\n      showToastMessage: props.showToastMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 995,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(UserCreate, {\n      ref: UserCreateFormRef,\n      showToastMessage: props.showToastMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 996,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(SignatureCreate, {\n      ref: SignatureCreateFormRef,\n      showToastMessage: props.showToastMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 997,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      show: show,\n      size: \"xl\",\n      fullscreen: true,\n      onHide: handleClose,\n      animation: false,\n      backdrop: \"static\",\n      scrollable: true,\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        children: [/*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: formData.id ? \"Update Sales Return #\" + formData.code + \" for sale #\" + formData.order_code : \"Create Sales Return\" + \" for sale #\" + formData.order_code\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1002,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col align-self-end text-end\",\n          children: [/*#__PURE__*/_jsxDEV(SalesReturnPreview, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1007,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleCreate,\n            children: [isProcessing ? /*#__PURE__*/_jsxDEV(Spinner, {\n              as: \"span\",\n              animation: \"border\",\n              size: \"sm\",\n              role: \"status\",\n              \"aria-hidden\": true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1010,\n              columnNumber: 33\n            }, this) + \" Creating...\" : \"\", formData.id ? \"Update\" : \"Create\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1008,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn-close\",\n            onClick: handleClose,\n            \"aria-label\": \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1023,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1006,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1001,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: [Object.keys(errors).length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"ul\", {\n            children: errors && Object.keys(errors).map((key, index) => {\n              return errors[key] ? /*#__PURE__*/_jsxDEV(\"li\", {\n                style: {\n                  color: \"red\"\n                },\n                children: errors[key]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1037,\n                columnNumber: 59\n              }, this) : \"\";\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1034,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1033,\n          columnNumber: 25\n        }, this) : \"\", selectedProducts.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"form-label\",\n            children: \"Date*\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1041,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"input-group mb-3\",\n            children: /*#__PURE__*/_jsxDEV(DatePicker, {\n              id: \"date_str\",\n              selected: formData.date_str ? new Date(formData.date_str) : null,\n              value: formData.date_str ? format(new Date(formData.date_str), \"MMMM d, yyyy h:mm aa\") : null,\n              className: \"form-control\",\n              dateFormat: \"MMMM d, yyyy h:mm aa\",\n              showTimeSelect: true,\n              timeIntervals: \"1\",\n              onChange: value => {\n                console.log(\"Value\", value);\n                formData.date_str = value; // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n\n                setFormData({ ...formData\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1044,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1043,\n            columnNumber: 25\n          }, this), errors.date_str && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: \"red\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-x-lg\",\n              children: \" \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1065,\n              columnNumber: 33\n            }, this), errors.date_str]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1064,\n            columnNumber: 29\n          }, this), formData.date_str && !errors.date_str && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: \"green\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-check-lg\",\n              children: \" \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1071,\n              columnNumber: 33\n            }, this), \"Looks good!\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1070,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1040,\n          columnNumber: 53\n        }, this), selectedProducts.length === 0 && \"Already returned all products\", selectedProducts.length > 0 && /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"row g-3 needs-validation\",\n          onSubmit: handleCreate,\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Select Products\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1079,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"table-responsive\",\n            style: {\n              overflowX: \"auto\",\n              overflowY: \"scroll\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"table\", {\n              className: \"table table-striped table-sm table-bordered\",\n              children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n                children: /*#__PURE__*/_jsxDEV(\"tr\", {\n                  className: \"text-center\",\n                  children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Select\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1084,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"SI No.\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1085,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Part No.\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1086,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Name\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1087,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Qty\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1088,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Unit Price\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1089,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Price\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1090,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1083,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1082,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n                children: selectedProducts.map((product, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n                  className: \"text-center\",\n                  children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                    children: /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"checkbox\",\n                      checked: selectedProducts[index].selected,\n                      onChange: e => {\n                        console.log(\"e.target.value:\", e.target.value);\n                        selectedProducts[index].selected = !selectedProducts[index].selected;\n                        setSelectedProducts([...selectedProducts]);\n                        reCalculate();\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1097,\n                      columnNumber: 49\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1096,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: index + 1\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1104,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: product.part_number\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1105,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    style: {\n                      textDecoration: \"underline\",\n                      color: \"blue\",\n                      cursor: \"pointer\"\n                    },\n                    onClick: () => {\n                      openProductDetailsView(product.product_id);\n                    },\n                    children: product.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1106,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    style: {\n                      width: \"155px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      class: \"input-group mb-3\",\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"number\",\n                        value: product.quantity,\n                        className: \"form-control\",\n                        placeholder: \"Quantity\",\n                        onChange: e => {\n                          errors[\"quantity_\" + index] = \"\";\n                          setErrors({ ...errors\n                          });\n\n                          if (!e.target.value) {\n                            errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                            selectedProducts[index].quantity = e.target.value;\n                            setSelectedProducts([...selectedProducts]);\n                            setErrors({ ...errors\n                            });\n                            console.log(\"errors:\", errors);\n                            return;\n                          }\n\n                          if (parseFloat(e.target.value) === 0) {\n                            errors[\"quantity_\" + index] = \"Quantity should be >0\";\n                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                            setSelectedProducts([...selectedProducts]);\n                            setErrors({ ...errors\n                            });\n                            console.log(\"errors:\", errors);\n                            return;\n                          }\n\n                          product.quantity = parseFloat(e.target.value);\n                          selectedProducts[index].quantity = parseFloat(e.target.value);\n                          setSelectedProducts([...selectedProducts]);\n                          reCalculate();\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1118,\n                        columnNumber: 53\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        class: \"input-group-text\",\n                        id: \"basic-addon2\",\n                        children: selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1148,\n                        columnNumber: 53\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1117,\n                      columnNumber: 49\n                    }, this), errors[\"quantity_\" + index] && /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        color: \"red\"\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                        className: \"bi bi-x-lg\",\n                        children: \" \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1152,\n                        columnNumber: 57\n                      }, this), errors[\"quantity_\" + index]]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1151,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1115,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    style: {\n                      width: \"180px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      class: \"input-group mb-3\",\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"number\",\n                        value: product.unit_price,\n                        className: \"form-control\",\n                        placeholder: \"Unit Price\",\n                        onChange: e => {\n                          errors[\"unit_price_\" + index] = \"\";\n                          setErrors({ ...errors\n                          });\n\n                          if (!e.target.value) {\n                            errors[\"unit_price_\" + index] = \"Invalid Unit Price\";\n                            selectedProducts[index].unit_price = e.target.value;\n                            setSelectedProducts([...selectedProducts]);\n                            setErrors({ ...errors\n                            });\n                            console.log(\"errors:\", errors);\n                            return;\n                          }\n\n                          if (e.target.value === 0) {\n                            errors[\"unit_price_\" + index] = \"Invalid Unit Price should be > 0\";\n                            selectedProducts[index].unit_price = parseFloat(e.target.value);\n                            setSelectedProducts([...selectedProducts]);\n                            setErrors({ ...errors\n                            });\n                            console.log(\"errors:\", errors);\n                            return;\n                          }\n\n                          selectedProducts[index].unit_price = parseFloat(e.target.value);\n                          console.log(\"selectedProducts[index].unit_price:\", selectedProducts[index].unit_price);\n                          setSelectedProducts([...selectedProducts]);\n                          reCalculate();\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1160,\n                        columnNumber: 53\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        class: \"input-group-text\",\n                        id: \"basic-addon2\",\n                        children: \"SAR\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1190,\n                        columnNumber: 53\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1159,\n                      columnNumber: 49\n                    }, this), errors[\"unit_price_\" + index] && /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        color: \"red\"\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                        className: \"bi bi-x-lg\",\n                        children: \" \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1194,\n                        columnNumber: 57\n                      }, this), errors[\"unit_price_\" + index]]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1193,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1158,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: (product.unit_price * product.quantity).toFixed(2),\n                      displayType: \"text\",\n                      thousandSeparator: true,\n                      suffix: \" SAR\",\n                      renderText: (value, props) => value\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1201,\n                      columnNumber: 49\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1200,\n                    columnNumber: 45\n                  }, this)]\n                }, index, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1095,\n                  columnNumber: 41\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1093,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1081,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1080,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"table-responsive\",\n            style: {\n              overflowX: \"auto\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"table\", {\n              className: \"table table-striped table-sm table-bordered\",\n              children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n                children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                    colSpan: \"4\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1218,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    className: \"text-center\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1219,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    className: \"text-end\",\n                    children: \"Total\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1222,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    className: \"text-end\",\n                    style: {\n                      width: \"180px\"\n                    },\n                    children: /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: totalPrice,\n                      displayType: \"text\",\n                      thousandSeparator: true,\n                      suffix: \" SAR\",\n                      renderText: (value, props) => value\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1224,\n                      columnNumber: 45\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1223,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1217,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                    colSpan: \"6\",\n                    className: \"text-end\",\n                    children: [\"Discount  \", /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"number\",\n                      style: {\n                        width: \"50px\"\n                      },\n                      className: \"text-start\",\n                      value: formData.discount_percent,\n                      onChange: e => {\n                        formData.is_discount_percent = true;\n\n                        if (parseFloat(e.target.value) === 0) {\n                          formData.discount_percent = parseFloat(e.target.value);\n                          setFormData({ ...formData\n                          });\n                          errors[\"discount_percent\"] = \"\";\n                          setErrors({ ...errors\n                          });\n                          reCalculate();\n                          return;\n                        }\n\n                        if (parseFloat(e.target.value) < 0) {\n                          formData.discount_percent = parseFloat(e.target.value);\n                          formData.discount = 0.00;\n                          setFormData({ ...formData\n                          });\n                          errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                          setErrors({ ...errors\n                          });\n                          reCalculate();\n                          return;\n                        }\n\n                        if (!e.target.value) {\n                          formData.discount_percent = \"\";\n                          formData.discount = 0.00;\n                          errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                          setFormData({ ...formData\n                          });\n                          setErrors({ ...errors\n                          });\n                          return;\n                        }\n\n                        errors[\"discount_percent\"] = \"\";\n                        errors[\"discount\"] = \"\";\n                        setErrors({ ...errors\n                        });\n                        formData.discount_percent = parseFloat(e.target.value);\n                        setFormData({ ...formData\n                        });\n                        reCalculate();\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1236,\n                      columnNumber: 55\n                    }, this), \"%\", errors.discount_percent && /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        color: \"red\"\n                      },\n                      children: errors.discount_percent\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1275,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1235,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    className: \"text-end\",\n                    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"number\",\n                      style: {\n                        width: \"150px\"\n                      },\n                      className: \"text-start\",\n                      value: formData.discount,\n                      onChange: e => {\n                        formData.is_discount_percent = false;\n\n                        if (parseFloat(e.target.value) === 0) {\n                          formData.discount = parseFloat(e.target.value);\n                          setFormData({ ...formData\n                          });\n                          errors[\"discount\"] = \"\";\n                          setErrors({ ...errors\n                          });\n                          reCalculate();\n                          return;\n                        }\n\n                        if (parseFloat(e.target.value) < 0) {\n                          formData.discount = parseFloat(e.target.value);\n                          formData.discount_percent = 0.00;\n                          setFormData({ ...formData\n                          });\n                          errors[\"discount\"] = \"Discount should be >= 0\";\n                          setErrors({ ...errors\n                          });\n                          reCalculate();\n                          return;\n                        }\n\n                        if (!e.target.value) {\n                          formData.discount = \"\";\n                          formData.discount_percent = 0.00;\n                          errors[\"discount\"] = \"Invalid Discount\";\n                          setFormData({ ...formData\n                          });\n                          reCalculate();\n                          setErrors({ ...errors\n                          });\n                          return;\n                        }\n\n                        errors[\"discount\"] = \"\";\n                        errors[\"discount_percent\"] = \"\";\n                        setErrors({ ...errors\n                        });\n                        formData.discount = parseFloat(e.target.value);\n                        setFormData({ ...formData\n                        });\n                        reCalculate();\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1284,\n                      columnNumber: 45\n                    }, this), \" SAR\", errors.discount && /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        color: \"red\"\n                      },\n                      children: errors.discount\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1325,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1283,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1234,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                    colSpan: \"5\",\n                    className: \"text-end\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1342,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    className: \"text-end\",\n                    children: [\" VAT: \", formData.vat_percent + \"%\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1345,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    className: \"text-end\",\n                    children: /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: (_vatPrice = vatPrice) === null || _vatPrice === void 0 ? void 0 : _vatPrice.toFixed(2),\n                      displayType: \"text\",\n                      thousandSeparator: true,\n                      suffix: \" SAR\",\n                      renderText: (value, props) => value\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1347,\n                      columnNumber: 45\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1346,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1341,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                    colSpan: \"5\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1357,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    className: \"text-end\",\n                    children: \"Net Total\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1358,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    className: \"text-end\",\n                    children: /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: (_netTotal = netTotal) === null || _netTotal === void 0 ? void 0 : _netTotal.toFixed(2),\n                      displayType: \"text\",\n                      thousandSeparator: true,\n                      suffix: \" SAR\",\n                      renderText: (value, props) => value\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1360,\n                      columnNumber: 45\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1359,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1356,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1216,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1215,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1214,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"form-label\",\n              children: \"Cash discount\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1449,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              value: formData.cash_discount,\n              className: \"form-control \",\n              onChange: e => {\n                errors[\"cash_discount\"] = \"\";\n                setErrors({ ...errors\n                });\n\n                if (!e.target.value) {\n                  formData.cash_discount = e.target.value;\n                  setFormData({ ...formData\n                  });\n                  validatePaymentAmounts();\n                  return;\n                }\n\n                formData.cash_discount = parseFloat(e.target.value);\n\n                if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n                  errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toString();\n                  setErrors({ ...errors\n                  });\n                  return;\n                }\n\n                setFormData({ ...formData\n                });\n                validatePaymentAmounts();\n                console.log(formData);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1450,\n              columnNumber: 29\n            }, this), errors.cash_discount && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                color: \"red\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-x-lg\",\n                children: \" \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1474,\n                columnNumber: 37\n              }, this), errors.cash_discount]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1473,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1448,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-8\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"form-label\",\n              children: \"Payments Received\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1481,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              class: \"table-responsive\",\n              style: {\n                maxWidth: \"900px\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                variant: \"secondary\",\n                style: {\n                  alignContent: \"right\"\n                },\n                onClick: addNewPayment,\n                children: \"Create new payment\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1484,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n                class: \"table table-striped table-sm table-bordered\",\n                children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Date\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1489,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Amount\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1492,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Payment method\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1495,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                    children: \"Action\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1498,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1488,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n                  children: [formData.payments_input && formData.payments_input.filter(payment => !payment.deleted).map((payment, key) => /*#__PURE__*/_jsxDEV(\"tr\", {\n                    children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                      style: {\n                        minWidth: \"220px\"\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(DatePicker, {\n                        id: \"date_str\",\n                        selected: formData.payments_input[key].date_str ? new Date(formData.payments_input[key].date_str) : null,\n                        value: formData.payments_input[key].date_str ? format(new Date(formData.payments_input[key].date_str), \"MMMM d, yyyy h:mm aa\") : null,\n                        className: \"form-control\",\n                        dateFormat: \"MMMM d, yyyy h:mm aa\",\n                        showTimeSelect: true,\n                        timeIntervals: \"1\",\n                        onChange: value => {\n                          console.log(\"Value\", value);\n                          formData.payments_input[key].date_str = value;\n                          let paymentDate = new Date(formData.payments_input[key].date_str);\n                          let orderDate = new Date(formData.date_str);\n                          let paymentYear = paymentDate.getFullYear();\n                          let paymentMonth = paymentDate.getMonth();\n                          let paymentDay = paymentDate.getDate();\n                          let paymentMinutes = paymentDate.getMinutes();\n                          var paymentHours = paymentDate.getHours();\n                          let orderYear = orderDate.getFullYear();\n                          let orderMonth = orderDate.getMonth();\n                          let orderDay = orderDate.getDate();\n                          let orderMinutes = orderDate.getMinutes();\n                          var orderHours = orderDate.getHours();\n\n                          if (paymentYear == orderYear && paymentMonth == orderMonth && paymentDay == orderDay && paymentHours == orderHours && paymentMinutes == orderMinutes) {\n                            formData.date_str = formData.payments_input[key].date_str;\n                          }\n\n                          setFormData({ ...formData\n                          });\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1508,\n                        columnNumber: 57\n                      }, this), errors[\"payment_date_\" + key] && /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          color: \"red\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                          className: \"bi bi-x-lg\",\n                          children: \" \"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1551,\n                          columnNumber: 65\n                        }, this), errors[\"payment_date_\" + key]]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1550,\n                        columnNumber: 61\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1506,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                      style: {\n                        width: \"300px\"\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"number\",\n                        value: formData.payments_input[key].amount,\n                        className: \"form-control \",\n                        onChange: e => {\n                          errors[\"payment_amount_\" + key] = \"\";\n                          setErrors({ ...errors\n                          });\n\n                          if (!e.target.value) {\n                            formData.payments_input[key].amount = e.target.value;\n                            setFormData({ ...formData\n                            });\n                            validatePaymentAmounts();\n                            return;\n                          }\n\n                          formData.payments_input[key].amount = parseFloat(e.target.value);\n                          validatePaymentAmounts();\n                          setFormData({ ...formData\n                          });\n                          console.log(formData);\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1557,\n                        columnNumber: 57\n                      }, this), errors[\"payment_amount_\" + key] && /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          color: \"red\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                          className: \"bi bi-x-lg\",\n                          children: \" \"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1578,\n                          columnNumber: 65\n                        }, this), errors[\"payment_amount_\" + key]]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1577,\n                        columnNumber: 61\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1556,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                      style: {\n                        width: \"200px\"\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"select\", {\n                        value: formData.payments_input[key].method,\n                        className: \"form-control \",\n                        onChange: e => {\n                          // errors[\"payment_method\"] = [];\n                          errors[\"payment_method_\" + key] = \"\";\n                          setErrors({ ...errors\n                          });\n\n                          if (!e.target.value) {\n                            errors[\"payment_method_\" + key] = \"Payment method is required\";\n                            setErrors({ ...errors\n                            });\n                            formData.payments_input[key].method = \"\";\n                            setFormData({ ...formData\n                            });\n                            return;\n                          } // errors[\"payment_method\"] = \"\";\n                          //setErrors({ ...errors });\n\n\n                          formData.payments_input[key].method = e.target.value;\n                          setFormData({ ...formData\n                          });\n                          console.log(formData);\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                          value: \"\",\n                          children: \"Select\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1607,\n                          columnNumber: 61\n                        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                          value: \"cash\",\n                          children: \"Cash\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1608,\n                          columnNumber: 61\n                        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                          value: \"bank_account\",\n                          children: \"Bank Account / Debit / Credit Card\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1609,\n                          columnNumber: 61\n                        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                          value: \"customer_account\",\n                          children: \"Customer Account\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1610,\n                          columnNumber: 61\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1584,\n                        columnNumber: 57\n                      }, this), errors[\"payment_method_\" + key] && /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          color: \"red\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                          className: \"bi bi-x-lg\",\n                          children: \" \"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1614,\n                          columnNumber: 65\n                        }, this), errors[\"payment_method_\" + key]]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1613,\n                        columnNumber: 61\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1583,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                      style: {\n                        width: \"200px\"\n                      },\n                      children: /*#__PURE__*/_jsxDEV(Button, {\n                        variant: \"danger\",\n                        onClick: event => {\n                          removePayment(key);\n                        },\n                        children: \"Remove\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1620,\n                        columnNumber: 57\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1619,\n                      columnNumber: 53\n                    }, this)]\n                  }, key, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1505,\n                    columnNumber: 49\n                  }, this)), /*#__PURE__*/_jsxDEV(\"tr\", {\n                    children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                      class: \"text-end\",\n                      children: /*#__PURE__*/_jsxDEV(\"b\", {\n                        children: \"Total\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1631,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1630,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                      children: /*#__PURE__*/_jsxDEV(\"b\", {\n                        style: {\n                          marginLeft: \"14px\"\n                        },\n                        children: (_totalPaymentAmount = totalPaymentAmount) === null || _totalPaymentAmount === void 0 ? void 0 : _totalPaymentAmount.toFixed(2)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1633,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1633,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                      children: /*#__PURE__*/_jsxDEV(\"b\", {\n                        style: {\n                          marginLeft: \"12px\",\n                          alignSelf: \"end\"\n                        },\n                        children: [\"Balance: \", (_balanceAmount = balanceAmount) === null || _balanceAmount === void 0 ? void 0 : _balanceAmount.toFixed(2)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1637,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1636,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                      colSpan: 1,\n                      children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                        children: \"Payment status: \"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1640,\n                        columnNumber: 49\n                      }, this), paymentStatus == \"paid\" ? /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"badge bg-success\",\n                        children: \"Paid\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1642,\n                        columnNumber: 65\n                      }, this) : \"\", paymentStatus == \"paid_partially\" ? /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"badge bg-warning\",\n                        children: \"Paid Partially\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1646,\n                        columnNumber: 65\n                      }, this) : \"\", paymentStatus == \"not_paid\" ? /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"badge bg-danger\",\n                        children: \"Not Paid\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1650,\n                        columnNumber: 65\n                      }, this) : \"\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1639,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1629,\n                    columnNumber: 40\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1502,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1487,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1483,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1480,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"secondary\",\n              onClick: handleClose,\n              children: \"Close\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1661,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"primary\",\n              onClick: handleCreate,\n              children: isProcessing ? /*#__PURE__*/_jsxDEV(Spinner, {\n                as: \"span\",\n                animation: \"bsalesreturn\",\n                size: \"sm\",\n                role: \"status\",\n                \"aria-hidden\": true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1666,\n                columnNumber: 37\n              }, this) + \" Creating...\" : formData.id ? \"Update\" : \"Create\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1664,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1660,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1078,\n          columnNumber: 53\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1031,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1000,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n}, \"yqo/Xtq4HpLReX+kAwT02tHHrwQ=\", false, function () {\n  return [useImperativeHandle];\n}));\n_c2 = SalesReturnCreate;\nexport default SalesReturnCreate;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"SalesReturnCreate$forwardRef\");\n$RefreshReg$(_c2, \"SalesReturnCreate\");","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/sales_return/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","SalesReturnPreview","Modal","Button","Form","StoreCreate","CustomerCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","SalesReturnView","ProductView","SalesReturnCreate","props","ref","open","id","orderId","errors","setErrors","formData","order_id","vat_percent","discount","discountValue","discount_percent","is_discount_percent","date_str","Date","signature_date_str","status","payment_status","payment_method","price_type","payments_input","cash_discount","cookies","get","selectedReceivedByUsers","name","received_by","setFormData","setSelectedReceivedByUsers","getSalesReturn","reCalculate","getOrder","setShow","console","log","requestOptions","method","headers","fetch","then","response","isJson","includes","data","json","ok","error","Promise","reject","salesReturn","result","code","order_code","store_id","customer_id","date","payments","i","length","products","selectedProductsTemp","selectedProducts","quantity","selected","push","setSelectedProducts","catch","setProcessing","listener","event","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","focus","preventDefault","document","addEventListener","removeEventListener","order","soldQty","quantity_returned","parseFloat","return_cash_discount","selectedStores","store_name","setSelectedStores","selectedDate","isProcessing","receivedByUserOptions","setReceivedByUserOptions","isReceivedByUsersLoading","setIsReceivedByUsersLoading","receivedBySignatureOptions","setReceivedBySignatureOptions","selectedReceivedBySignatures","setSelectedReceivedBySignatures","isReceivedBySignaturesLoading","setIsReceivedBySignaturesLoading","show","handleClose","at","window","location","ObjectToSearchQueryParams","object","Object","keys","map","key","join","suggestUsers","searchTerm","params","queryString","Authorization","Select","suggestSignatures","handleCreate","product_id","unit_price","unit","haveErrors","validatePaymentAmounts","net_total","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","totalPrice","setTotalPrice","findTotalPrice","toFixed","vatPrice","setVatPrice","findVatPrice","setNetTotal","findNetTotal","Math","round","amount","discountPercent","setDiscountPercent","findDiscount","findDiscountPercent","DetailsViewRef","current","StoreCreateFormRef","CustomerCreateFormRef","ProductCreateFormRef","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","totalPaymentAmount","setTotalPaymentAmount","balanceAmount","setBalanceAmount","paymentStatus","setPaymentStatus","findTotalPayments","totalPayment","deleted","removePayment","toString","maxAllowedAmount","addNewPayment","validatePayments","splice","color","value","overflowX","overflowY","product","e","part_number","textDecoration","cursor","width","maxWidth","alignContent","filter","payment","minWidth","paymentDate","orderDate","paymentYear","getFullYear","paymentMonth","getMonth","paymentDay","getDate","paymentMinutes","getMinutes","paymentHours","getHours","orderYear","orderMonth","orderDay","orderMinutes","orderHours","marginLeft","alignSelf"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport SalesReturnPreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport CustomerCreate from \"./../customer/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport SalesReturnView from \"./view.js\";\nimport ProductView from \"./../product/view.js\";\n\nconst SalesReturnCreate = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(id, orderId) {\n\n\n            errors={};\n            setErrors({ ...errors });\n\n            formData = {\n                order_id: orderId,\n                vat_percent: 15.0,\n                discount: 0.0,\n                discountValue: 0.0,\n                discount_percent: 0.0,\n                is_discount_percent: false,\n                //  date_str: format(new Date(), \"MMM dd yyyy\"),\n                date_str: new Date(),\n                signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n                status: \"received\",\n                payment_status: \"\",\n                payment_method: \"\",\n                price_type: \"retail\"\n            };\n            formData.payments_input = [\n                {\n                    \"date_str\": formData.date_str,\n                    // \"amount\": \"\",\n                    \"amount\": 0.00,\n                    \"method\": \"\",\n                    \"deleted\": false,\n                }\n            ];\n            formData.cash_discount = 0.00;\n            if (cookies.get(\"user_id\")) {\n                selectedReceivedByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.received_by = cookies.get(\"user_id\");\n                setFormData({ ...formData });\n                setSelectedReceivedByUsers([...selectedReceivedByUsers]);\n            }\n            setFormData({ ...formData });\n\n            if (id) {\n                getSalesReturn(id);\n            }\n\n            if (orderId) {\n                reCalculate();\n                getOrder(orderId);\n            }\n            setShow(true);\n\n        },\n\n    }));\n\n\n    function getSalesReturn(id) {\n        console.log(\"inside getSalesReturn id:\", id);\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/sales-return/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let salesReturn = data.result;\n                // formData = purchaseReturn;\n\n                formData = {\n                    id: salesReturn.id,\n                    code: salesReturn.code,\n                    order_code: salesReturn.order_code,\n                    order_id: salesReturn.order_id,\n                    store_id: salesReturn.store_id,\n                    customer_id: salesReturn.customer_id,\n                    date_str: salesReturn.date,\n                    payments_input: salesReturn.payments,\n                    cash_discount: salesReturn.cash_discount,\n                    // date: purchase.date,\n                    vat_percent: salesReturn.vat_percent,\n                    discount: salesReturn.discount,\n                    discount_percent: salesReturn.discount_percent,\n                    is_discount_percent: salesReturn.is_discount_percent,\n                    payment_status: salesReturn.payment_status,\n                    // shipping_handling_fees: salesReturn.shipping_handling_fees,\n                };\n\n                for (var i = 0; i < formData.payments_input.length; i++) {\n                    formData.payments_input[i].date_str = formData.payments_input[i].date\n                }\n\n\n                setFormData({ ...formData });\n\n                console.log(\"formData1.status:\", formData.status);\n\n\n                console.log(\"purchaseReturn.products:\", salesReturn.products);\n\n                let selectedProductsTemp = salesReturn.products;\n\n                selectedProducts = [];\n                for (let i = 0; i < selectedProductsTemp.length; i++) {\n                    if (selectedProductsTemp[i].quantity > 0) {\n                        selectedProductsTemp[i].selected = true;\n                    } else {\n                        selectedProductsTemp[i].selected = false;\n                    }\n                    selectedProducts.push(selectedProductsTemp[i]);\n\n                    //selectedProductsTemp[i].purchase_unit_price = selectedProductsTemp[i].purchasereturn_unit_price;\n                }\n\n\n                setSelectedProducts([...selectedProducts]);\n\n                setFormData({ ...formData });\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function.\");\n                // event.preventDefault();\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n    function getOrder(id) {\n        console.log(\"inside get SalesReturn\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/order/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let order = data.result;\n\n                let selectedProductsTemp = order.products;\n                selectedProducts = [];\n                for (let i = 0; i < selectedProductsTemp.length; i++) {\n                    selectedProductsTemp[i].selected = false;\n                    let soldQty = selectedProductsTemp[i].quantity - selectedProductsTemp[i].quantity_returned;\n                    selectedProductsTemp[i].quantity = soldQty;\n\n                    if (soldQty > 0) {\n                        selectedProducts.push(selectedProductsTemp[i]);\n                    }\n                }\n\n                // selectedProducts = selectedProductsTemp\n\n                console.log(\"selectedProducts:\", selectedProducts);\n                setSelectedProducts([...selectedProducts]);\n\n\n\n                //formData = order;\n                console.log(\"order.id:\", order.id);\n                formData.id = \"\";\n                formData.products = order.products;\n                // formData.order_id = order.id;\n                //console.log(\"formData.order_id:\", formData.order_id);\n                formData.order_code = order.code;\n                formData.store_id = order.store_id;\n                /*\n                formData.received_by = order.delivered_by;\n                formData.received_by_signature_id = order.delivered_by_signature_id;\n                */\n                formData.customer_id = order.customer_id;\n\n                // formData.is_discount_percent = order.is_discount_percent;\n                formData.is_discount_percent = true;\n                console.log(\"order.discount_percent:\", order.discount_percent);\n                formData.discount_percent = order.discount_percent;\n                formData.cash_discount = parseFloat(order.cash_discount-order.return_cash_discount);\n                // formData.discount = (order.discount - order.return_discount);\n\n                // formData.discount_percent = order.discount_percent;\n\n                /*\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n                */\n\n                // setFormData({ ...formData });\n                console.log(\"formData:\", formData);\n\n\n                selectedStores = [\n                    {\n                        id: order.store_id,\n                        name: order.store_name,\n                    }\n                ];\n\n                setSelectedStores(selectedStores);\n                console.log(\"selectedStores:\", selectedStores);\n\n                setFormData({ ...formData });\n                reCalculate();\n                setFormData({ ...formData });\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    /*\n    let [barcode, setBarcode] = useState(\"\");\n    let [barcodeEnded, setBarcodeEnded] = useState(false);\n    const keyPress = useCallback(\n        (e) => {\n            console.log(\"e.key:\", e.key);\n\n            if (!barcodeEnded && e.key != \"Enter\") {\n                console.log()\n                barcode += e.key;\n                setBarcode(barcode);\n            }\n\n            if (e.key === \"Enter\") {\n                document.removeEventListener(\"keydown\", keyPress);\n                console.log(\"barcode:\", barcode);\n                barcodeEnded = true;\n                setBarcodeEnded(true);\n            }\n\n        },\n        []\n    );\n\n    function addListener() {\n        //barcode = \"\";\n        //setBarcode(barcode);\n        document.addEventListener(\"keydown\", keyPress);\n        console.log(\"Listener added, barcode:\", barcode);\n    }\n    */\n    /*\n    useEffect(() => {\n        document.addEventListener(\"keydown\", keyPress);\n        return () => document.removeEventListener(\"keydown\", keyPress);\n    }, [keyPress]);\n    */\n    /*\n    useEffect(() => {\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener(\"keydown\", handleKeyDown);\n    });\n    let [barcode, setBarcode] = useState(\"\");\n    function handleKeyDown(event) {\n        console.log(\"event.key:\", event.key);\n\n        /*\n        if (event.key == \"Enter\") {\n            barcode = \"\";\n            setBarcode(barcode);\n        }\n        else if (event.key == \"Shift\") {\n            console.log(\"barcode:\", barcode);\n        } else {\n            barcode += event.key;\n            setBarcode(barcode);\n        }\n        */\n\n    /*\n    if (event.keyCode === KEY_ESCAPE) {\n        /* do your action here */\n    // }  \n    // }\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        order_id: \"\",\n        vat_percent: 15.0,\n        discount: 0.0,\n        date_str: format(new Date(), \"MMM dd yyyy\"),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"received\",\n        payment_status: \"\",\n        payment_method: \"\",\n        price_type: \"retail\",\n    });\n\n    let [selectedStores, setSelectedStores] = useState([]);\n\n\n\n\n    //Product Auto Suggestion\n    let [selectedProducts, setSelectedProducts] = useState([]);\n\n    //Received By Auto Suggestion\n    const [receivedByUserOptions, setReceivedByUserOptions] = useState([]);\n    let [selectedReceivedByUsers, setSelectedReceivedByUsers] = useState([]);\n    const [isReceivedByUsersLoading, setIsReceivedByUsersLoading] =\n        useState(false);\n\n    //Received By Signature Auto Suggestion\n    const [receivedBySignatureOptions, setReceivedBySignatureOptions] =\n        useState([]);\n    const [selectedReceivedBySignatures, setSelectedReceivedBySignatures] =\n        useState([]);\n    const [isReceivedBySignaturesLoading, setIsReceivedBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/salesreturns\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=${object[key]}`;\n            })\n            .join(\"&\");\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setReceivedByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsReceivedByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setReceivedByUserOptions(data.result);\n        setIsReceivedByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setReceivedBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsReceivedBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setReceivedBySignatureOptions(data.result);\n        setIsReceivedBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        console.log(\"Inside handle Create\");\n        console.log(\"selectedProducts:\", selectedProducts);\n        console.log(\"formData.order_id:\", formData.order_id);\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (!selectedProducts[i].selected) {\n                continue;\n            }\n\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit_price: parseFloat(selectedProducts[i].unit_price),\n                unit: selectedProducts[i].unit,\n            });\n        }\n\n        if (!formData.cash_discount) {\n            formData.cash_discount = 0.00;\n        }\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        console.log(\"formData.discount:\", formData.discount);\n\n        let haveErrors = false;\n\n        errors[\"products\"] = \"\";\n        setErrors({ ...errors });\n\n        if (formData.products.length === 0) {\n            errors[\"products\"] = \"No products added\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!validatePaymentAmounts()) {\n            console.log(\"Errors on payments\")\n            haveErrors = true;\n        }\n\n        if (haveErrors) {\n            console.log(\"Errors: \", errors);\n            return;\n        }\n\n\n\n        /*\n        if (!formData.discountValue && formData.discountValue !== 0) {\n            errors[\"discount\"] = \"Invalid Discount\";\n            setErrors({ ...errors });\n            return;\n        }\n        */\n\n        formData.net_total = parseFloat(netTotal);\n\n\n        let endPoint = \"/v1/sales-return\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/sales-return/\" + formData.id;\n            method = \"PUT\";\n        }\n\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"SalesReturn Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n                handleClose();\n\n                openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating SalesReturn!\", \"danger\");\n            });\n    }\n\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (!selectedProducts[i].selected) {\n                continue;\n            }\n            totalPrice +=\n                parseFloat(selectedProducts[i].unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n        totalPrice = totalPrice.toFixed(2);\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    /*\n    function findVatPrice() {\n        vatPrice = ((parseFloat(formData.vat_percent) / 100) * parseFloat(totalPrice - formData.discount)).toFixed(2);;\n        console.log(\"vatPrice:\", vatPrice);\n        setVatPrice(vatPrice);\n    }*/\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            //+ parseFloat(formData.shipping_handling_fees)\n            vatPrice = (parseFloat((parseFloat(formData.vat_percent) / 100)) * (parseFloat(totalPrice) - parseFloat(formData.discount)));\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function findNetTotal() {\n        if (totalPrice > 0) {\n            netTotal = (parseFloat(totalPrice) - parseFloat(formData.discount) + parseFloat(vatPrice));\n            setNetTotal(netTotal);\n        }\n\n        netTotal = Math.round(netTotal * 100) / 100;\n        console.log(\"after rounding netTotal:\", netTotal);\n        setNetTotal(netTotal);\n\n        if (!formData.id) {\n            let method=\"\";\n            if(formData.payments_input[0]){\n              method = formData.payments_input[0].method;\n            }\n\n            formData.payments_input = [{\n                \"date_str\": formData.date_str,\n                \"amount\": 0.00,\n                \"method\": method,\n                \"deleted\": false,\n            }];\n\n            if(netTotal>0){\n                formData.payments_input[0].amount = parseFloat(netTotal.toFixed(2));\n\n                if(formData.cash_discount){\n                    formData.payments_input[0].amount =  formData.payments_input[0].amount - parseFloat(formData.cash_discount?.toFixed(2));\n                }\n                formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n                //formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n            }\n          \n        }\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    /*\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n    }\n    */\n\n\n\n    /*\n    function findDiscountPercent() {\n        if (!formData.discountValue) {\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            setFormData({ ...formData });\n            return;\n        }\n\n        formData.discount = formData.discountValue;\n\n        if (formData.discount > 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n\n    }\n    */\n\n    /*\n    function findDiscount() {\n        if (!formData.discountValue) {\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            setFormData({ ...formData });\n            return;\n        }\n\n        formData.discount_percent = formData.discountValue;\n\n        if (formData.discount_percent > 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n        }\n        setFormData({ ...formData });\n    }\n    */\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100));\n            //formData.discount = Math.round(formData.discount * 100) / 100;\n            formData.discount = parseFloat(formData.discount.toFixed(2));\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            //formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\n            setFormData({ ...formData });\n        }\n    }\n\n    function reCalculate() {\n        findTotalPrice();\n        //findDiscount();\n        //findDiscountPercent();\n\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n\n\n\n    const DetailsViewRef = useRef();\n    function openDetailsView(id) {\n        DetailsViewRef.current.open(id);\n    }\n\n    const StoreCreateFormRef = useRef();\n\n    const CustomerCreateFormRef = useRef();\n    const ProductCreateFormRef = useRef();\n\n\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n\n    let [totalPaymentAmount, setTotalPaymentAmount] = useState(0.00);\n    let [balanceAmount, setBalanceAmount] = useState(0.00);\n    let [paymentStatus, setPaymentStatus] = useState(\"\");\n\n    function findTotalPayments() {\n        let totalPayment = 0.00;\n        for (var i = 0; i < formData.payments_input?.length; i++) {\n            if (formData.payments_input[i].amount && !formData.payments_input[i].deleted) {\n                totalPayment += formData.payments_input[i].amount;\n            }\n        }\n\n        totalPaymentAmount = totalPayment;\n        setTotalPaymentAmount(totalPaymentAmount);\n       // balanceAmount = (netTotal - formData.cash_discount) - totalPayment;\n        balanceAmount = (parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))) - parseFloat(totalPayment.toFixed(2));\n        balanceAmount = parseFloat(balanceAmount.toFixed(2));\n        setBalanceAmount(balanceAmount);\n\n        if (balanceAmount === parseFloat((parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))).toFixed(2))) {\n            paymentStatus = \"not_paid\"\n        } else if (parseFloat(balanceAmount.toFixed(2)) <= 0) {\n            paymentStatus = \"paid\"\n        } else if (parseFloat(balanceAmount.toFixed(2)) > 0) {\n            paymentStatus = \"paid_partially\"\n        }\n\n        setPaymentStatus(paymentStatus);\n\n        return totalPayment;\n    }\n\n    function validatePaymentAmounts() {\n        errors[\"cash_discount\"] = \"\";\n        setErrors({ ...errors });\n        let haveErrors = false;\n        if (!netTotal) {\n            removePayment(0,false);\n            totalPaymentAmount=0.0;\n            setTotalPaymentAmount(0.00);\n            balanceAmount=0.00;\n            setBalanceAmount(0.00);\n            paymentStatus=\"\";\n            setPaymentStatus(paymentStatus);\n            return true;\n        }\n\n  \n\n        if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n            errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toFixed(2).toString();\n            setErrors({ ...errors });\n            haveErrors = true\n            return false;\n        }\n\n        let totalPayment = findTotalPayments();\n        // errors[\"payment_date\"] = [];\n        //errors[\"payment_method\"] = [];\n        //errors[\"payment_amount\"] = [];\n        for (var key = 0; key < formData.payments_input.length; key++) {\n            errors[\"payment_amount_\" + key] = \"\";\n            errors[\"payment_date_\" + key] = \"\";\n            errors[\"payment_method_\" + key] = \"\";\n            setErrors({ ...errors });\n\n            if (!formData.payments_input[key].amount) {\n                errors[\"payment_amount_\" + key] = \"Payment amount is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if (formData.payments_input[key].amount === 0) {\n                errors[\"payment_amount_\" + key] = \"Amount should be greater than zero\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].date_str) {\n                errors[\"payment_date_\" + key] = \"Payment date is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if ((new Date(formData.payments_input[key].date_str)) < (new Date(formData.date_str))) {\n                errors[\"payment_date_\" + key] = \"Payment date time should be greater than or equal to order date time\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].method) {\n                errors[\"payment_method_\" + key] = \"Payment method is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n\n            if ((formData.payments_input[key].amount || formData.payments_input[key].amount === 0) && !formData.payments_input[key].deleted) {\n                let maxAllowedAmount = (netTotal - formData.cash_discount) - (totalPayment - formData.payments_input[key].amount);\n\n                if (maxAllowedAmount < 0) {\n                    maxAllowedAmount = 0;\n                }\n\n                \n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                \n            }\n        }\n\n        if (haveErrors) {\n            return false;\n        }\n\n        return true;\n    }\n\n    function addNewPayment() {\n        let date = new Date();\n        if (!formData.id) {\n            date = formData.date_str;\n        }\n\n        formData.payments_input.push({\n            \"date_str\": date,\n            // \"amount\": \"\",\n            \"amount\": 0.00,\n            \"method\": \"\",\n            \"deleted\": false,\n        });\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n        //validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n    }\n\n    function removePayment(key,validatePayments=false) {\n        formData.payments_input.splice(key, 1);\n        //formData.payments_input[key][\"deleted\"] = true;\n        setFormData({ ...formData });\n        if(validatePayments){\n            validatePaymentAmounts();\n        }\n    }\n\n\n    return (\n        <>\n            <SalesReturnView ref={DetailsViewRef} />\n            <ProductView ref={ProductDetailsViewRef} />\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n            <CustomerCreate ref={CustomerCreateFormRef} showToastMessage={props.showToastMessage} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} />\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n\n\n            <Modal show={show} size=\"xl\" fullscreen onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Sales Return #\" + formData.code + \" for sale #\" + formData.order_code : \"Create Sales Return\" + \" for sale #\" + formData.order_code}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <SalesReturnPreview />\n                        <Button variant=\"primary\" onClick={handleCreate} >\n                            {isProcessing ?\n                                <Spinner\n                                    as=\"span\"\n                                    animation=\"border\"\n                                    size=\"sm\"\n                                    role=\"status\"\n                                    aria-hidden={true}\n                                /> + \" Creating...\"\n\n                                : \"\"\n                            }\n                            {formData.id ? \"Update\" : \"Create\"}\n\n                        </Button>\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    {Object.keys(errors).length > 0 ?\n                        <div>\n                            <ul>\n\n                                {errors && Object.keys(errors).map((key, index) => {\n                                    return (errors[key] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                })}\n                            </ul></div> : \"\"}\n                    {selectedProducts.length > 0 && <div className=\"col-md-3\">\n                        <label className=\"form-label\">Date*</label>\n\n                        <div className=\"input-group mb-3\">\n                            <DatePicker\n                                id=\"date_str\"\n                                selected={formData.date_str ? new Date(formData.date_str) : null}\n                                value={formData.date_str ? format(\n                                    new Date(formData.date_str),\n                                    \"MMMM d, yyyy h:mm aa\"\n                                ) : null}\n                                className=\"form-control\"\n                                dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                showTimeSelect\n                                timeIntervals=\"1\"\n                                onChange={(value) => {\n                                    console.log(\"Value\", value);\n                                    formData.date_str = value;\n                                    // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                    setFormData({ ...formData });\n                                }}\n                            />\n                        </div>\n                        {errors.date_str && (\n                            <div style={{ color: \"red\" }}>\n                                <i className=\"bi bi-x-lg\"> </i>\n                                {errors.date_str}\n                            </div>\n                        )}\n                        {formData.date_str && !errors.date_str && (\n                            <div style={{ color: \"green\" }}>\n                                <i className=\"bi bi-check-lg\"> </i>\n                                Looks good!\n                            </div>\n                        )}\n                    </div>}\n\n                    {selectedProducts.length === 0 && \"Already returned all products\"}\n                    {selectedProducts.length > 0 && <form className=\"row g-3 needs-validation\" onSubmit={handleCreate}>\n                        <h2>Select Products</h2>\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", overflowY: \"scroll\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th>Select</th>\n                                        <th>SI No.</th>\n                                        <th>Part No.</th>\n                                        <th>Name</th>\n                                        <th>Qty</th>\n                                        <th>Unit Price</th>\n                                        <th>Price</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr key={index} className=\"text-center\">\n                                            <td>\n                                                <input type=\"checkbox\" checked={selectedProducts[index].selected} onChange={(e) => {\n                                                    console.log(\"e.target.value:\", e.target.value)\n                                                    selectedProducts[index].selected = !selectedProducts[index].selected;\n                                                    setSelectedProducts([...selectedProducts]);\n                                                    reCalculate();\n                                                }} />\n                                            </td>\n                                            <td>{index + 1}</td>\n                                            <td>{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n                                            }}\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                }}>{product.name}\n                                            </td>\n                                            <td style={{ width: \"155px\" }}>\n\n                                                <div class=\"input-group mb-3\">\n                                                    <input type=\"number\" value={(product.quantity)} className=\"form-control\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (parseFloat(e.target.value) === 0) {\n                                                                errors[\"quantity_\" + index] = \"Quantity should be >0\";\n                                                                selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span class=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div class=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Unit Price\" onChange={(e) => {\n                                                            errors[\"unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price\";\n                                                                selectedProducts[index].unit_price = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price should be > 0\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].unit_price:\", selectedProducts[index].unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span class=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n                                                {errors[\"unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td>\n                                                <NumberFormat\n                                                    value={(product.unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n                                        <td colSpan=\"4\"></td>\n                                        <td className=\"text-center\">\n\n                                        </td>\n                                        <th className=\"text-end\">Total</th>\n                                        <td className=\"text-end\" style={{ width: \"180px\" }}>\n                                            <NumberFormat\n                                                value={totalPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n\n                                    <tr>\n                                        <th colSpan=\"6\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                            {/*\n                                            Discount(  {formData.discount_percent + \"%\"})\n                                                */}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n\n                                            {/*\n                                            <NumberFormat\n                                                value={formData.discount}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                            */}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"5\" className=\"text-end\">\n\n                                        </th>\n                                        <th className=\"text-end\"> VAT: {formData.vat_percent + \"%\"}</th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td colSpan=\"5\"></td>\n                                        <th className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n\n\n\n\n\n\n                        {/*\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Discount*</label>\n\n                            <div className=\"input-group mb-3\" >\n                                <input\n                                    value={formData.discountValue}\n                                    style={{ marginRight: \"10px\" }}\n                                    type='number'\n                                    onChange={(e) => {\n                                        if (parseFloat(e.target.value) === 0) {\n                                            formData.discountValue = parseFloat(e.target.value);\n                                            setFormData({ ...formData });\n                                            errors[\"discount\"] = \"\";\n                                            setErrors({ ...errors });\n                                            reCalculate();\n                                            return;\n                                        }\n\n                                        if (!e.target.value) {\n                                            formData.discountValue = \"\";\n                                            errors[\"discount\"] = \"Invalid Discount\";\n                                            setFormData({ ...formData });\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"discount\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.discountValue = e.target.value;\n                                        setFormData({ ...formData });\n                                        reCalculate();\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Discount\"\n                                />\n                                <Form.Check\n                                    type=\"switch\"\n                                    id=\"custom-switch\"\n                                    label=\"%\"\n                                    value={formData.is_discount_percent}\n                                    checked={formData.is_discount_percent ? \"checked\" : null}\n                                    onChange={(e) => {\n                                        formData.is_discount_percent = !formData.is_discount_percent;\n                                        console.log(\"e.target.value:\", formData.is_discount_percent);\n                                        setFormData({ ...formData });\n                                        reCalculate();\n                                    }}\n                                />\n\n                            </div>\n                            {errors.discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.discount}\n                                </div>\n                            )}\n                            {!errors.discount && (\n                                <div style={{ color: \"green\" }}>\n                                    <i className=\"bi bi-check-lg\"> </i>\n                                    Looks good!\n                                </div>\n                            )}\n                        </div>\n                            */}\n\n\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Cash discount</label>\n                            <input type='number' value={formData.cash_discount} className=\"form-control \"\n                                onChange={(e) => {\n                                    errors[\"cash_discount\"] = \"\";\n                                    setErrors({ ...errors });\n                                    if (!e.target.value) {\n                                        formData.cash_discount = e.target.value;\n                                        setFormData({ ...formData });\n                                        validatePaymentAmounts();\n                                        return;\n                                    }\n                                    formData.cash_discount = parseFloat(e.target.value);\n                                    if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n                                        errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toString();\n                                        setErrors({ ...errors });\n                                        return;\n                                    }\n\n                                    setFormData({ ...formData });\n                                    validatePaymentAmounts();\n                                    console.log(formData);\n                                }}\n                            />\n                            {errors.cash_discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.cash_discount}\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"col-md-8\">\n                            <label className=\"form-label\">Payments Received</label>\n\n                            <div class=\"table-responsive\" style={{ maxWidth: \"900px\" }}>\n                                <Button variant=\"secondary\" style={{ alignContent: \"right\" }} onClick={addNewPayment}>\n                                    Create new payment\n                                </Button>\n                                <table class=\"table table-striped table-sm table-bordered\">\n                                    <thead>\n                                        <th>\n                                            Date\n                                        </th>\n                                        <th>\n                                            Amount\n                                        </th>\n                                        <th>\n                                            Payment method\n                                        </th>\n                                        <th>\n                                            Action\n                                        </th>\n                                    </thead>\n                                    <tbody>\n                                        {formData.payments_input &&\n                                            formData.payments_input.filter(payment => !payment.deleted).map((payment, key) => (\n                                                <tr key={key}>\n                                                    <td style={{ minWidth: \"220px\" }}>\n\n                                                        <DatePicker\n                                                            id=\"date_str\"\n                                                            selected={formData.payments_input[key].date_str ? new Date(formData.payments_input[key].date_str) : null}\n                                                            value={formData.payments_input[key].date_str ? format(\n                                                                new Date(formData.payments_input[key].date_str),\n                                                                \"MMMM d, yyyy h:mm aa\"\n                                                            ) : null}\n                                                            className=\"form-control\"\n                                                            dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                                            showTimeSelect\n                                                            timeIntervals=\"1\"\n                                                            onChange={(value) => {\n                                                                console.log(\"Value\", value);\n                                                                formData.payments_input[key].date_str = value;\n                                                                let paymentDate = new Date(formData.payments_input[key].date_str)\n                                                                let orderDate = new Date(formData.date_str)\n\n\n                                                                let paymentYear = paymentDate.getFullYear();\n                                                                let paymentMonth = paymentDate.getMonth();\n                                                                let paymentDay = paymentDate.getDate();\n                                                                let paymentMinutes = paymentDate.getMinutes();\n                                                                var paymentHours = paymentDate.getHours();\n\n                                                                let orderYear = orderDate.getFullYear();\n                                                                let orderMonth = orderDate.getMonth();\n                                                                let orderDay = orderDate.getDate();\n                                                                let orderMinutes = orderDate.getMinutes();\n                                                                var orderHours = orderDate.getHours();\n\n                                                                if (paymentYear == orderYear\n                                                                    && paymentMonth == orderMonth\n                                                                    && paymentDay == orderDay\n                                                                    && paymentHours == orderHours\n                                                                    && paymentMinutes == orderMinutes) {\n                                                                    formData.date_str = formData.payments_input[key].date_str;\n\n                                                                }\n                                                                setFormData({ ...formData });\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_date_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_date_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"300px\" }}>\n                                                        <input type='number' value={formData.payments_input[key].amount} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                errors[\"payment_amount_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    formData.payments_input[key].amount = e.target.value;\n                                                                    setFormData({ ...formData });\n                                                                    validatePaymentAmounts();\n                                                                    return;\n                                                                }\n\n                                                                formData.payments_input[key].amount = parseFloat(e.target.value);\n\n                                                                validatePaymentAmounts();\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_amount_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_amount_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <select value={formData.payments_input[key].method} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                // errors[\"payment_method\"] = [];\n                                                                errors[\"payment_method_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    errors[\"payment_method_\" + key] = \"Payment method is required\";\n                                                                    setErrors({ ...errors });\n\n                                                                    formData.payments_input[key].method = \"\";\n                                                                    setFormData({ ...formData });\n                                                                    return;\n                                                                }\n\n                                                                // errors[\"payment_method\"] = \"\";\n                                                                //setErrors({ ...errors });\n\n                                                                formData.payments_input[key].method = e.target.value;\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        >\n                                                            <option value=\"\">Select</option>\n                                                            <option value=\"cash\">Cash</option>\n                                                            <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                                            <option value=\"customer_account\">Customer Account</option>\n                                                        </select>\n                                                        {errors[\"payment_method_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_method_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <Button variant=\"danger\" onClick={(event) => {\n                                                            removePayment(key);\n                                                        }}>\n                                                            Remove\n                                                        </Button>\n\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                       <tr>\n                                            <td class=\"text-end\">\n                                                <b>Total</b>\n                                            </td>\n                                            <td><b style={{ marginLeft: \"14px\" }}>{totalPaymentAmount?.toFixed(2)}</b>\n\n                                            </td>\n                                            <td>\n                                                <b style={{ marginLeft: \"12px\", alignSelf: \"end\" }}>Balance: {balanceAmount?.toFixed(2)}</b>\n                                            </td>\n                                            <td colSpan={1}>\n                                                <b>Payment status: </b> \n                                                {paymentStatus == \"paid\" ?\n                                                                <span className=\"badge bg-success\">\n                                                                    Paid\n                                                                </span> : \"\"}\n                                                            {paymentStatus == \"paid_partially\" ?\n                                                                <span className=\"badge bg-warning\">\n                                                                    Paid Partially\n                                                                </span> : \"\"}\n                                                            {paymentStatus == \"not_paid\" ?\n                                                                <span className=\"badge bg-danger\">\n                                                                    Not Paid\n                                                                </span> : \"\"}\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate} >\n                                {isProcessing ?\n                                    <Spinner\n                                        as=\"span\"\n                                        animation=\"bsalesreturn\"\n                                        size=\"sm\"\n                                        role=\"status\"\n                                        aria-hidden={true}\n                                    /> + \" Creating...\"\n\n                                    : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>}\n                </Modal.Body>\n\n            </Modal>\n\n\n        </>\n    );\n});\n\nexport default SalesReturnCreate;\n"]},"metadata":{},"sourceType":"module"}