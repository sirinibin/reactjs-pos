{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from\"react\";import PurchasePreview from\"./preview.js\";import{Modal,Button,Form}from\"react-bootstrap\";import StoreCreate from\"../store/create.js\";import VendorCreate from\"./../vendor/create.js\";import ProductCreate from\"./../product/create.js\";import UserCreate from\"./../user/create.js\";import SignatureCreate from\"./../signature/create.js\";import Cookies from\"universal-cookie\";import{Typeahead}from\"react-bootstrap-typeahead\";import NumberFormat from\"react-number-format\";import DatePicker from\"react-datepicker\";import{format}from\"date-fns\";import{Spinner}from\"react-bootstrap\";import PurchaseView from\"./view.js\";import ProductView from\"./../product/view.js\";import{DebounceInput}from'react-debounce-input';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PurchaseCreate=/*#__PURE__*/forwardRef(function(props,ref){useImperativeHandle(ref,function(){return{open:function open(id){selectedProducts=[];setSelectedProducts([]);selectedStores=[];setSelectedStores([]);selectedVendors=[];setSelectedVendors([]);selectedOrderPlacedByUsers=[];setSelectedOrderPlacedByUsers([]);selectedOrderPlacedBySignatures=[];setSelectedOrderPlacedBySignatures([]);formData={vat_percent:15.0,discount:0.0,discountValue:0.0,discount_percent:0.0,shipping_handling_fees:0.00,partial_payment_amount:0.00,is_discount_percent:false,date_str:new Date(),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"delivered\",payment_method:\"\",payment_status:\"paid\"};if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');formData.store_name=cookies.get('store_name');}if(cookies.get(\"user_id\")){selectedOrderPlacedByUsers=[{id:cookies.get(\"user_id\"),name:cookies.get(\"user_name\")}];formData.order_placed_by=cookies.get(\"user_id\");formData.vat_percent=parseFloat(cookies.get('vat_percent'));setFormData(_objectSpread({},formData));setSelectedOrderPlacedByUsers(_toConsumableArray(selectedOrderPlacedByUsers));}setFormData(_objectSpread({},formData));if(id){getPurchase(id);}reCalculate();setShow(true);}};});useEffect(function(){var listener=function listener(event){if(event.code===\"Enter\"||event.code===\"NumpadEnter\"){console.log(\"Enter key was pressed. Run your function-purchase.\");// event.preventDefault();\nvar form=event.target.form;if(form&&event.target){var index=Array.prototype.indexOf.call(form,event.target);if(form&&form.elements[index+1]){if(event.target.getAttribute(\"class\").includes(\"barcode\")){form.elements[index].focus();}else{form.elements[index+1].focus();}event.preventDefault();}}}};document.addEventListener(\"keydown\",listener);return function(){document.removeEventListener(\"keydown\",listener);};},[]);useEffect(function(){console.log(\"inside change on formData:\",formData);// localStorage\n});var selectedDate=new Date();//const history = useHistory();\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();//fields\nvar _useState5=useState({vat_percent:10.0,discount:0.0,discountValue:0.0,discount_percent:0.0,is_discount_percent:false,date_str:format(new Date(),\"MMM dd yyyy\"),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"created\"}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];//Store Auto Suggestion\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),storeOptions=_useState8[0],setStoreOptions=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedStores=_useState10[0],setSelectedStores=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isStoresLoading=_useState12[0],setIsStoresLoading=_useState12[1];//Vendor Auto Suggestion\nvar _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),vendorOptions=_useState14[0],setVendorOptions=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedVendors=_useState16[0],setSelectedVendors=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isVendorsLoading=_useState18[0],setIsVendorsLoading=_useState18[1];//Product Auto Suggestion\nvar _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),productOptions=_useState20[0],setProductOptions=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),selectedProduct=_useState22[0],setSelectedProduct=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),selectedProducts=_useState24[0],setSelectedProducts=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isProductsLoading=_useState26[0],setIsProductsLoading=_useState26[1];//Order Placed By Auto Suggestion\nvar _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),orderPlacedByUserOptions=_useState28[0],setOrderPlacedByUserOptions=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),selectedOrderPlacedByUsers=_useState30[0],setSelectedOrderPlacedByUsers=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isOrderPlacedByUsersLoading=_useState32[0],setIsOrderPlacedByUsersLoading=_useState32[1];//Order Placed By Signature Auto Suggestion\nvar _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),orderPlacedBySignatureOptions=_useState34[0],setOrderPlacedBySignatureOptions=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),selectedOrderPlacedBySignatures=_useState36[0],setSelectedOrderPlacedBySignatures=_useState36[1];var _useState37=useState(false),_useState38=_slicedToArray(_useState37,2),isOrderPlacedBySignaturesLoading=_useState38[0],setIsOrderPlacedBySignaturesLoading=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),show=_useState40[0],setShow=_useState40[1];function handleClose(){setShow(false);}useEffect(function(){var at=cookies.get(\"access_token\");if(!at){// history.push(\"/dashboard/purchases\");\nwindow.location=\"/\";}});function getPurchase(id){console.log(\"inside get Purchase\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/purchase/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,purchase,selectedStores,selectedVendors,selectedOrderPlacedByUsers,_selectedOrderPlacedBySignatures;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);purchase=data.result;formData={id:purchase.id,code:purchase.code,store_id:purchase.store_id,vendor_id:purchase.vendor_id,date_str:purchase.date,// date: purchase.date,\nvat_percent:purchase.vat_percent,discount:purchase.discount,discount_percent:purchase.discount_percent,status:purchase.status,order_placed_by:purchase.order_placed_by,order_placed_by_signature_id:purchase.order_placed_by_signature_id,is_discount_percent:purchase.is_discount_percent,partial_payment_amount:purchase.partial_payment_amount,payment_method:purchase.payment_method,payment_status:purchase.payment_status,shipping_handling_fees:purchase.shipping_handling_fees};if(formData.is_discount_percent){formData.discountValue=formData.discount_percent;}else{formData.discountValue=formData.discount;}selectedProducts=purchase.products;setSelectedProducts(_toConsumableArray(selectedProducts));selectedStores=[{id:purchase.store_id,name:purchase.store_name}];selectedVendors=[{id:purchase.vendor_id,name:purchase.vendor_name,search_label:purchase.vendor_name}];selectedOrderPlacedByUsers=[{id:purchase.order_placed_by,name:purchase.order_placed_by_name}];if(purchase.order_placed_by_signature_id){_selectedOrderPlacedBySignatures=[{id:purchase.order_placed_by_signature_id,name:purchase.order_placed_by_signature_name}];setSelectedOrderPlacedBySignatures([].concat(_selectedOrderPlacedBySignatures));}setSelectedOrderPlacedByUsers([].concat(selectedOrderPlacedByUsers));setSelectedStores([].concat(selectedStores));setSelectedVendors([].concat(selectedVendors));reCalculate();setFormData(_objectSpread({},formData));case 27:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}function ObjectToSearchQueryParams(object){return Object.keys(object).map(function(key){return\"search[\".concat(key,\"]=\")+encodeURIComponent(object[key]);}).join(\"&\");}function suggestStores(_x2){return _suggestStores.apply(this,arguments);}function _suggestStores(){_suggestStores=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"Inside handle suggestStores\");setStoreOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsStoresLoading(true);_context3.next=13;return fetch(\"/v1/store?\"+Select+queryString,requestOptions);case 13:result=_context3.sent;_context3.next=16;return result.json();case 16:data=_context3.sent;setStoreOptions(data.result);setIsStoresLoading(false);case 19:case\"end\":return _context3.stop();}}},_callee3);}));return _suggestStores.apply(this,arguments);}function suggestVendors(_x3){return _suggestVendors.apply(this,arguments);}function _suggestVendors(){_suggestVendors=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"Inside handle suggestVendors\");setVendorOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";setIsVendorsLoading(true);_context4.next=13;return fetch(\"/v1/vendor?\"+Select+queryString,requestOptions);case 13:result=_context4.sent;_context4.next=16;return result.json();case 16:data=_context4.sent;setVendorOptions(data.result);setIsVendorsLoading(false);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return _suggestVendors.apply(this,arguments);}function GetProductUnitPriceInStore(storeId,productStores){console.log(\"Inside GetProductUnitPriceInStore\");if(!productStores){return\"\";}console.log(\"Cool\");for(var i=0;i<productStores.length;i++){console.log(\"productStores[i]:\",productStores[i]);console.log(\"store_id:\",storeId);if(productStores[i].store_id===storeId){console.log(\"macthed\");console.log(\"unitPrice.retail_unit_price:\",productStores[i].purchase_unit_price);return productStores[i];}}console.log(\"not matched\");return\"\";}var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),openProductSearchResult=_useState42[0],setOpenProductSearchResult=_useState42[1];function suggestProducts(_x4){return _suggestProducts.apply(this,arguments);}function _suggestProducts(){_suggestProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(searchTerm){var params,queryString,requestOptions,Select,result,data,products;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"Inside handle suggestProducts\");setProductOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context5.next=8;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 8:params={name:searchTerm};if(cookies.get(\"store_id\")){params.store_id=cookies.get(\"store_id\");}queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,name,stores,unit,part_number,name_in_arabic\";setIsProductsLoading(true);_context5.next=17;return fetch(\"/v1/product?\"+Select+queryString+\"&limit=200\",requestOptions);case 17:result=_context5.sent;_context5.next=20;return result.json();case 20:data=_context5.sent;products=data.result;if(!(!products||products.length===0)){_context5.next=27;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 27:openProductSearchResult=true;setOpenProductSearchResult(true);setProductOptions(products);setIsProductsLoading(false);case 31:case\"end\":return _context5.stop();}}},_callee5);}));return _suggestProducts.apply(this,arguments);}function getProductByBarCode(_x5){return _getProductByBarCode.apply(this,arguments);}function _getProductByBarCode(){_getProductByBarCode=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(barcode){var requestOptions,Select,result,data,product;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:formData.barcode=barcode;setFormData(_objectSpread({},formData));console.log(\"Inside getProductByBarCode\");errors[\"bar_code\"]=\"\";setErrors(_objectSpread({},errors));console.log(\"barcode:\"+formData.barcode);if(formData.barcode){_context6.next=8;break;}return _context6.abrupt(\"return\");case 8:if(formData.barcode.length===13){formData.barcode=formData.barcode.slice(0,-1);}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,part_number,name,stores,unit,part_number,name_in_arabic\";_context6.next=13;return fetch(\"/v1/product/barcode/\"+formData.barcode+\"?\"+Select,requestOptions);case 13:result=_context6.sent;_context6.next=16;return result.json();case 16:data=_context6.sent;product=data.result;if(product){addProduct(product);}else{errors[\"bar_code\"]=\"Invalid Barcode:\"+formData.barcode;setErrors(_objectSpread({},errors));}formData.barcode=\"\";setFormData(_objectSpread({},formData));case 21:case\"end\":return _context6.stop();}}},_callee6);}));return _getProductByBarCode.apply(this,arguments);}function suggestUsers(_x6){return _suggestUsers.apply(this,arguments);}function _suggestUsers(){_suggestUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:console.log(\"Inside handle suggestUsers\");setOrderPlacedByUserOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context7.next=5;break;}return _context7.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsOrderPlacedByUsersLoading(true);_context7.next=13;return fetch(\"/v1/user?\"+Select+queryString,requestOptions);case 13:result=_context7.sent;_context7.next=16;return result.json();case 16:data=_context7.sent;setOrderPlacedByUserOptions(data.result);setIsOrderPlacedByUsersLoading(false);case 19:case\"end\":return _context7.stop();}}},_callee7);}));return _suggestUsers.apply(this,arguments);}function suggestSignatures(_x7){return _suggestSignatures.apply(this,arguments);}function _suggestSignatures(){_suggestSignatures=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(\"Inside handle suggestSignatures\");setOrderPlacedBySignatureOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context8.next=5;break;}return _context8.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsOrderPlacedBySignaturesLoading(true);_context8.next=13;return fetch(\"/v1/signature?\"+Select+queryString,requestOptions);case 13:result=_context8.sent;_context8.next=16;return result.json();case 16:data=_context8.sent;setOrderPlacedBySignatureOptions(data.result);setIsOrderPlacedBySignaturesLoading(false);case 19:case\"end\":return _context8.stop();}}},_callee8);}));return _suggestSignatures.apply(this,arguments);}function handleCreate(event){event.preventDefault();console.log(\"Inside handle Create\");console.log(\"selectedProducts:\",selectedProducts);formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit:selectedProducts[i].unit,purchase_unit_price:parseFloat(selectedProducts[i].purchase_unit_price),retail_unit_price:parseFloat(selectedProducts[i].retail_unit_price),wholesale_unit_price:parseFloat(selectedProducts[i].wholesale_unit_price)});}formData.discount=parseFloat(formData.discount);formData.discount_percent=parseFloat(formData.discount_percent);formData.vat_percent=parseFloat(formData.vat_percent);console.log(\"formData.discount:\",formData.discount);console.log(\"formData.discount_percent:\",formData.discount_percent);if(!formData.shipping_handling_fees&&formData.shipping_handling_fees!==0){errors[\"shipping_handling_fees\"]=\"Invalid shipping / handling fees\";setErrors(_objectSpread({},errors));return;}if(formData.payment_status===\"paid_partially\"&&!formData.partial_payment_amount&&formData.partial_payment_amount!==0){errors[\"partial_payment_amount\"]=\"Invalid partial payment amount\";setErrors(_objectSpread({},errors));return;}if(formData.payment_status===\"paid_partially\"&&formData.partial_payment_amount<=0){errors[\"partial_payment_amount\"]=\"Partial payment should be > 0 \";setErrors(_objectSpread({},errors));return;}if(formData.payment_status===\"paid_partially\"&&formData.partial_payment_amount>=netTotal){errors[\"partial_payment_amount\"]=\"Partial payment cannot be >= \"+netTotal;setErrors(_objectSpread({},errors));return;}errors[\"payment_method\"]=\"\";setErrors(_objectSpread({},errors));if(formData.payment_status!=\"not_paid\"&&!formData.payment_method){errors[\"payment_method\"]=\"Payment method is required\";setErrors(_objectSpread({},errors));return;}if(!formData.discount&&formData.discount!==0){errors[\"discount\"]=\"Invalid discount\";setErrors(_objectSpread({},errors));return;}if(!formData.discount_percent&&formData.discount_percent!==0){errors[\"discount_percent\"]=\"Invalid discount percent\";setErrors(_objectSpread({},errors));return;}if(parseFloat(formData.discount_percent)>100){errors[\"discount_percent\"]=\"Discount percent cannot be > 100\";setErrors(_objectSpread({},errors));return;}if(!formData.vat_percent&&formData.vat_percent!==0){errors[\"vat_percent\"]=\"Invalid vat percent\";setErrors(_objectSpread({},errors));return;}if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');}var endPoint=\"/v1/purchase\";var method=\"POST\";if(formData.id){endPoint=\"/v1/purchase/\"+formData.id;method=\"PUT\";}var requestOptions={method:method,headers:{'Accept':'application/json',\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")},body:JSON.stringify(formData)};console.log(\"formData:\",formData);setProcessing(true);fetch(endPoint,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get(\"content-type\"))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes(\"application/json\");_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});setProcessing(false);console.log(\"Response:\");console.log(data);props.showToastMessage(\"Purchase Created Successfully!\",\"success\");if(props.refreshList){props.refreshList();}handleClose();props.openDetailsView(data.result.id);case 18:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x8){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(_objectSpread({},error));console.error(\"There was an error!\",error);props.showToastMessage(\"Error Creating Purchase!\",\"danger\");});}function isProductAdded(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return true;}}return false;}function addProduct(product){console.log(\"Inside Add product\");if(!formData.store_id){errors.product_id=\"Please Select a Store and try again\";setErrors(_objectSpread({},errors));return;}errors.product_id=\"\";if(!product){errors.product_id=\"Invalid Product\";setErrors(_objectSpread({},errors));return;}var productStore={};if(product.stores){productStore=GetProductUnitPriceInStore(formData.store_id,product.stores);if(productStore&&productStore.retail_unit_price){product.retail_unit_price=productStore.retail_unit_price;}if(productStore&&productStore.purchase_unit_price){product.purchase_unit_price=productStore.purchase_unit_price;}if(productStore&&productStore.wholesale_unit_price){product.wholesale_unit_price=productStore.wholesale_unit_price;}}var alreadyAdded=false;var index=-1;var quantity=0.00;product.quantity=1.00;if(isProductAdded(product.id)){alreadyAdded=true;index=getProductIndex(product.id);quantity=parseFloat(selectedProducts[index].quantity+product.quantity);}else{quantity=parseFloat(product.quantity);}console.log(\"quantity:\",quantity);errors.quantity=\"\";if(alreadyAdded){selectedProducts[index].quantity=parseFloat(quantity);// setSelectedProducts([...selectedProducts]);\n}if(!alreadyAdded){var item={product_id:product.id,code:product.item_code,part_number:product.part_number,name:product.name,quantity:product.quantity,stores:product.stores,unit:product.unit};if(product.purchase_unit_price){item.purchase_unit_price=parseFloat(product.purchase_unit_price).toFixed(2);}if(product.retail_unit_price){item.retail_unit_price=parseFloat(product.retail_unit_price).toFixed(2);}if(product.wholesale_unit_price){item.wholesale_unit_price=parseFloat(product.wholesale_unit_price).toFixed(2);}selectedProducts.push(item);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit:selectedProducts[i].unit,purchase_unit_price:parseFloat(selectedProducts[i].purchase_unit_price),retail_unit_price:parseFloat(selectedProducts[i].retail_unit_price),wholesale_unit_price:parseFloat(selectedProducts[i].wholesale_unit_price)});}setFormData(_objectSpread({},formData));}function getProductIndex(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return i;}}return false;}function removeProduct(product){var index=selectedProducts.indexOf(product);if(index>-1){selectedProducts.splice(index,1);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}var _useState43=useState(0.0),_useState44=_slicedToArray(_useState43,2),totalPrice=_useState44[0],setTotalPrice=_useState44[1];function findTotalPrice(){totalPrice=0.00;for(var i=0;i<selectedProducts.length;i++){totalPrice+=parseFloat(selectedProducts[i].purchase_unit_price)*parseFloat(selectedProducts[i].quantity);}totalPrice=totalPrice.toFixed(2);setTotalPrice(totalPrice);}var _useState45=useState(0.00),_useState46=_slicedToArray(_useState45,2),vatPrice=_useState46[0],setVatPrice=_useState46[1];function findVatPrice(){vatPrice=0.00;if(totalPrice>0){vatPrice=(parseFloat(parseFloat(formData.vat_percent)/100)*(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount))).toFixed(2);;console.log(\"vatPrice:\",vatPrice);}setVatPrice(vatPrice);}var _useState47=useState(0.00),_useState48=_slicedToArray(_useState47,2),netTotal=_useState48[0],setNetTotal=_useState48[1];function findNetTotal(){netTotal=0.00;if(totalPrice>0){netTotal=(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount)+parseFloat(vatPrice)).toFixed(2);}setNetTotal(netTotal);}var _useState49=useState(0.00),_useState50=_slicedToArray(_useState49,2),discountPercent=_useState50[0],setDiscountPercent=_useState50[1];function findDiscountPercent(){if(formData.discount>=0&&totalPrice>0){discountPercent=parseFloat(parseFloat(formData.discount/totalPrice)*100).toFixed(2);setDiscountPercent(discountPercent);formData.discount_percent=discountPercent;setFormData(_objectSpread({},formData));}}function findDiscount(){if(formData.discount_percent>=0&&totalPrice>0){formData.discount=parseFloat(totalPrice*parseFloat(formData.discount_percent/100)).toFixed(2);setFormData(_objectSpread({},formData));}}function reCalculate(){findTotalPrice();if(formData.is_discount_percent){findDiscount();}else{findDiscountPercent();}findVatPrice();findNetTotal();}var StoreCreateFormRef=useRef();function openStoreCreateForm(){StoreCreateFormRef.current.open();}var ProductCreateFormRef=useRef();function openProductCreateForm(){ProductCreateFormRef.current.open();}function openProductUpdateForm(id){ProductCreateFormRef.current.open(id);}var VendorCreateFormRef=useRef();function openVendorCreateForm(){VendorCreateFormRef.current.open();}var UserCreateFormRef=useRef();function openUserCreateForm(){UserCreateFormRef.current.open();}var SignatureCreateFormRef=useRef();function openSignatureCreateForm(){SignatureCreateFormRef.current.open();}var ProductDetailsViewRef=useRef();function openProductDetailsView(id){ProductDetailsViewRef.current.open(id);}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ProductView,{ref:ProductDetailsViewRef,openUpdateForm:openProductUpdateForm,openCreateForm:openProductCreateForm}),/*#__PURE__*/_jsx(ProductCreate,{ref:ProductCreateFormRef,showToastMessage:props.showToastMessage,openDetailsView:openProductDetailsView}),/*#__PURE__*/_jsx(StoreCreate,{ref:StoreCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(UserCreate,{ref:UserCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(SignatureCreate,{ref:SignatureCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(VendorCreate,{ref:VendorCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsxs(Modal,{show:show,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,backdrop:\"static\",scrollable:true,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:formData.id?\"Update Purchase #\"+formData.code:\"Create New Purchase\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsx(PurchasePreview,{}),formData.id?/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:function onClick(){handleClose();props.openDetailsView(formData.id);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-eye\"}),\" View Detail\"]}):\"\",\"\\xA0\\xA0\",/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:handleCreate,children:[isProcessing?/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"border\",size:\"sm\",role:\"status\",\"aria-hidden\":true})+\" Creating...\":\"\",formData.id?\"Update\":\"Create\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(\"form\",{className:\"row g-3 needs-validation\",onSubmit:handleCreate,children:[!cookies.get('store_name')?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Purchase to Store*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"store_id\",labelKey:\"name\",isLoading:isStoresLoading,isInvalid:errors.store_id?true:false,onChange:function onChange(selectedItems){errors.store_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.store_id=\"Invalid Store selected\";setErrors(errors);setFormData(_objectSpread({},formData));setSelectedStores([]);return;}formData.store_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedStores(selectedItems);//SetPriceOfAllProducts(selectedItems[0].id);\n},options:storeOptions,placeholder:\"Select Store\",selected:selectedStores,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestStores(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openStoreCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi x-lg\",children:\" \"}),errors.store_id]}),formData.store_id&&!errors.store_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Purchase From Vendor*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"vendor_id\",labelKey:\"search_label\",isLoading:isVendorsLoading,isInvalid:errors.vendor_id?true:false,onChange:function onChange(selectedItems){errors.vendor_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.vendor_id=\"Invalid Vendor selected\";setErrors(errors);formData.vendor_id=\"\";setFormData(_objectSpread({},formData));setSelectedVendors([]);return;}formData.vendor_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedVendors(selectedItems);},options:vendorOptions,placeholder:\"Type name or mob\",selected:selectedVendors,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestVendors(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openVendorCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.vendor_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.vendor_id]}),formData.vendor_id&&!errors.vendor_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Vendor Invoice No. (Optional)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{value:formData.vendor_invoice_no?formData.vendor_invoice_no:\"\",type:\"string\",onChange:function onChange(e){errors[\"vendor_invoice_no\"]=\"\";setErrors(_objectSpread({},errors));formData.vendor_invoice_no=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",id:\"vendor_invoice_no\",placeholder:\"Vendor Invoice No.\"}),errors.vendor_invoice_no&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.vendor_invoice_no]}),formData.vendor_invoice_no&&!errors.rack&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"product_id\",size:\"lg\",labelKey:\"search_label\",emptyLabel:\"\",clearButton:true,open:openProductSearchResult,isLoading:isProductsLoading,isInvalid:errors.product_id?true:false,onChange:function onChange(selectedItems){if(selectedItems.length===0){errors[\"product_id\"]=\"Invalid Product selected\";setErrors(errors);return;}errors[\"product_id\"]=\"\";setErrors(_objectSpread({},errors));if(formData.store_id){addProduct(selectedItems[0]);}setOpenProductSearchResult(false);},options:productOptions,selected:selectedProduct,placeholder:\"Search By Part No. / Name / Name in Arabic\",highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestProducts(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openProductCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.product_id?/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.product_id]}):\"\",selectedProduct[0]&&selectedProduct[0].id&&!errors.product_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\",maxHeight:\"400px\",overflowY:\"auto\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"2%\"},children:\"Remove\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"5%\"},children:\"SI No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"8%\"},children:\"Part No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"26%\"},className:\"text-start\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Purchase Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Wholesale Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"11%\"},children:\"Retail Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"15%\"},children:\"Purchase Price\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedProducts.map(function(product,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\",cursor:\"pointer\"},onClick:function onClick(){removeProduct(product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"})})}),/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:product.part_number}),/*#__PURE__*/_jsx(\"td\",{style:{textDecoration:\"underline\",color:\"blue\",cursor:\"pointer\"},className:\"text-start\",onClick:function onClick(){openProductDetailsView(product.product_id);console.log(\"okk,id:\",product.product_id);},children:product.name}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"155px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.quantity,className:\"form-control\",placeholder:\"Quantity\",onChange:function onChange(e){errors[\"quantity_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"quantity_\"+index]=\"Invalid Quantity\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"quantity_\"+index]=\"Invalid Quantity should be > 0\";selectedProducts[index].quantity=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}product.quantity=parseFloat(e.target.value);reCalculate();selectedProducts[index].quantity=parseFloat(e.target.value);console.log(\"selectedProducts[index].quantity:\",selectedProducts[index].quantity);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:selectedProducts[index].unit?selectedProducts[index].unit:\"Units\"})]}),errors[\"quantity_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"quantity_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.purchase_unit_price,className:\"form-control\",placeholder:\"Purchase Unit Price\",onChange:function onChange(e){errors[\"purchase_unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"purchase_unit_price_\"+index]=\"Invalid Purchase Unit Price\";selectedProducts[index].purchase_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"purchase_unit_price_\"+index]=\"Purchase Unit Price should be > 0\";selectedProducts[index].purchase_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].purchase_unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].purchase_unit_price:\",selectedProducts[index].purchase_unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"purchase_unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"purchase_unit_price_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.wholesale_unit_price,className:\"form-control\",placeholder:\"Wholesale Unit Price\",onChange:function onChange(e){errors[\"wholesale_unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"wholesale_unit_price_\"+index]=\"Invalid Wholesale Unit Price\";selectedProducts[index].wholesale_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"wholesale_unit_price_\"+index]=\"Wholesale Unit Price should be > 0\";selectedProducts[index].wholesale_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].wholesale_unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].wholesale_unit_price:\",selectedProducts[index].wholesale_unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"wholesale_unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"wholesale_unit_price_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.retail_unit_price,className:\"form-control\",placeholder:\"Retail Unit Price\",onChange:function onChange(e){errors[\"retail_unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"retail_unit_price_\"+index]=\"Invalid Retail Unit Price\";selectedProducts[index].retail_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"retail_unit_price_\"+index]=\"Retail Unit Price should be > 0\";selectedProducts[index].retail_unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].retail_unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].retail_unit_price:\",selectedProducts[index].retail_unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"retail_unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"retail_unit_price_\"+index]]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(product.purchase_unit_price*product.quantity).toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]},index);}).reverse()})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\"},children:/*#__PURE__*/_jsx(\"table\",{className:\"table table-striped table-sm table-bordered\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"90%\"},colSpan:\"8\",className:\"text-end\",children:\"Total\"}),/*#__PURE__*/_jsx(\"td\",{style:{width:\"10%\"},className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:totalPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Shipping & Handling Fees\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.shipping_handling_fees,onChange:function onChange(e){if(parseFloat(e.target.value)===0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"Shipping / Handling Fees should be > 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.shipping_handling_fees=\"\";errors[\"shipping_handling_fees\"]=\"Invalid Shipping / Handling Fees\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.shipping_handling_fees&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.shipping_handling_fees})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\"Discount  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"50px\"},className:\"text-start\",value:formData.discount_percent,onChange:function onChange(e){formData.is_discount_percent=true;if(parseFloat(e.target.value)===0){formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount_percent=parseFloat(e.target.value);formData.discount=0.00;setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"Discount percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount_percent=\"\";formData.discount=0.00;errors[\"discount_percent\"]=\"Invalid Discount Percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"discount_percent\"]=\"\";errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\"%\",errors.discount_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount_percent})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.discount,onChange:function onChange(e){formData.is_discount_percent=false;if(parseFloat(e.target.value)===0){formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount=parseFloat(e.target.value);formData.discount_percent=0.00;setFormData(_objectSpread({},formData));errors[\"discount\"]=\"Discount should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount=\"\";formData.discount_percent=0.00;errors[\"discount\"]=\"Invalid Discount\";setFormData(_objectSpread({},formData));reCalculate();setErrors(_objectSpread({},errors));return;}errors[\"discount\"]=\"\";errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.discount&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\" VAT  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"text-center\",style:{width:\"50px\"},value:formData.vat_percent,onChange:function onChange(e){console.log(\"Inside onchange vat percent\");if(parseFloat(e.target.value)===0){formData.vat_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.vat_percent=parseFloat(e.target.value);vatPrice=0.00;setVatPrice(vatPrice);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"Vat percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.vat_percent=\"\";vatPrice=0.00;setVatPrice(vatPrice);//formData.discount_percent = 0.00;\nerrors[\"vat_percent\"]=\"Invalid vat percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.vat_percent=e.target.value;reCalculate();setFormData(_objectSpread({},formData));console.log(formData);}}),\"%\",errors.vat_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.vat_percent})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:vatPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Net Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:netTotal,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]})]})})}),!formData.id?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payment method*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payment_method,onChange:function onChange(e){console.log(\"Inside onchange payment method\");if(!e.target.value){errors[\"status\"]=\"Payment Method is required\";setErrors(_objectSpread({},errors));formData.payment_method=\"\";setFormData(_objectSpread({},formData));return;}errors[\"payment_method\"]=\"\";setErrors(_objectSpread({},errors));formData.payment_method=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_account\",children:\"Bank Account  / Debit / Credit Card\"})]}),errors.payment_method&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.payment_method]})]})]}):\"\",!formData.id?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payment Status*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payment_status,onChange:function onChange(e){console.log(\"Inside onchange payment Status\");if(!e.target.value){errors[\"status\"]=\"Invalid Payment Status\";setErrors(_objectSpread({},errors));return;}errors[\"payment_status\"]=\"\";setErrors(_objectSpread({},errors));formData.payment_status=e.target.value;if(formData.payment_status!==\"paid_partially\"){formData.partial_payment_amount=0.00;}setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"paid\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"not_paid\",children:\"Not Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"paid_partially\",children:\"Paid Partially\"})]}),errors.payment_status&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.payment_status]})]})]}):\"\",!formData.id&&formData.payment_status===\"paid_partially\"?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Patial Payment Amount*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.partial_payment_amount,onChange:function onChange(e){console.log(\"Inside onchange vat discount\");if(!e.target.value){formData.partial_payment_amount=e.target.value;errors[\"partial_payment_amount\"]=\"Invalid partial payment amount\";setErrors(_objectSpread({},errors));return;}formData.partial_payment_amount=parseFloat(e.target.value);errors[\"partial_payment_amount\"]=\"\";if(formData.partial_payment_amount>=netTotal){errors[\"partial_payment_amount\"]=\"Partial payment cannot be >= \"+netTotal;setErrors(_objectSpread({},errors));return;}setErrors(_objectSpread({},errors));setFormData(_objectSpread({},formData));console.log(formData);},className:\"form-control\",id:\"validationCustom02\",placeholder:\"Amount\"}),errors.partial_payment_amount&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.partial_payment_amount]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date Time*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.date_str?new Date(formData.date_str):null,value:formData.date_str?format(new Date(formData.date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.date_str=value;// formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\nsetFormData(_objectSpread({},formData));}}),errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.date_str]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"border\",size:\"sm\",role:\"status\",\"aria-hidden\":true})+\" Creating...\":formData.id?\"Update\":\"Create\"})]})]})})]})]});});export default PurchaseCreate;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/purchase/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","PurchasePreview","Modal","Button","Form","StoreCreate","VendorCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","PurchaseView","ProductView","DebounceInput","PurchaseCreate","props","ref","open","id","selectedProducts","setSelectedProducts","selectedStores","setSelectedStores","selectedVendors","setSelectedVendors","selectedOrderPlacedByUsers","setSelectedOrderPlacedByUsers","selectedOrderPlacedBySignatures","setSelectedOrderPlacedBySignatures","formData","vat_percent","discount","discountValue","discount_percent","shipping_handling_fees","partial_payment_amount","is_discount_percent","date_str","Date","signature_date_str","status","payment_method","payment_status","cookies","get","store_id","store_name","name","order_placed_by","parseFloat","setFormData","getPurchase","reCalculate","setShow","listener","event","code","console","log","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","includes","focus","preventDefault","document","addEventListener","removeEventListener","selectedDate","errors","setErrors","isProcessing","setProcessing","storeOptions","setStoreOptions","isStoresLoading","setIsStoresLoading","vendorOptions","setVendorOptions","isVendorsLoading","setIsVendorsLoading","productOptions","setProductOptions","selectedProduct","setSelectedProduct","isProductsLoading","setIsProductsLoading","orderPlacedByUserOptions","setOrderPlacedByUserOptions","isOrderPlacedByUsersLoading","setIsOrderPlacedByUsersLoading","orderPlacedBySignatureOptions","setOrderPlacedBySignatureOptions","isOrderPlacedBySignaturesLoading","setIsOrderPlacedBySignaturesLoading","show","handleClose","at","window","location","requestOptions","method","headers","fetch","then","response","isJson","json","data","ok","error","Promise","reject","purchase","result","vendor_id","date","order_placed_by_signature_id","products","vendor_name","search_label","order_placed_by_name","order_placed_by_signature_name","catch","ObjectToSearchQueryParams","object","Object","keys","map","key","encodeURIComponent","join","suggestStores","searchTerm","params","queryString","Authorization","Select","suggestVendors","GetProductUnitPriceInStore","storeId","productStores","i","length","purchase_unit_price","openProductSearchResult","setOpenProductSearchResult","suggestProducts","getProductByBarCode","barcode","slice","product","addProduct","suggestUsers","suggestSignatures","handleCreate","push","product_id","quantity","unit","retail_unit_price","wholesale_unit_price","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","isProductAdded","productID","productStore","stores","alreadyAdded","getProductIndex","item","item_code","part_number","toFixed","removeProduct","splice","totalPrice","setTotalPrice","findTotalPrice","vatPrice","setVatPrice","findVatPrice","setNetTotal","findNetTotal","discountPercent","setDiscountPercent","findDiscountPercent","findDiscount","StoreCreateFormRef","openStoreCreateForm","current","ProductCreateFormRef","openProductCreateForm","openProductUpdateForm","VendorCreateFormRef","openVendorCreateForm","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","selectedItems","e","toString","color","vendor_invoice_no","value","rack","overflowX","maxHeight","overflowY","width","cursor","textDecoration","reverse"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport PurchasePreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport VendorCreate from \"./../vendor/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport PurchaseView from \"./view.js\";\nimport ProductView from \"./../product/view.js\";\nimport { DebounceInput } from 'react-debounce-input';\n\n\nconst PurchaseCreate = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(id) {\n\n            selectedProducts = [];\n            setSelectedProducts([]);\n\n            selectedStores = [];\n            setSelectedStores([]);\n\n            selectedVendors = [];\n            setSelectedVendors([]);\n\n            selectedOrderPlacedByUsers = [];\n            setSelectedOrderPlacedByUsers([]);\n\n            selectedOrderPlacedBySignatures = [];\n            setSelectedOrderPlacedBySignatures([]);\n\n\n            formData = {\n                vat_percent: 15.0,\n                discount: 0.0,\n                discountValue: 0.0,\n                discount_percent: 0.0,\n                shipping_handling_fees: 0.00,\n                partial_payment_amount: 0.00,\n                is_discount_percent: false,\n                date_str: new Date(),\n                signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n                status: \"delivered\",\n                payment_method: \"\",\n                payment_status: \"paid\",\n\n            };\n\n\n            if (cookies.get('store_id')) {\n                formData.store_id = cookies.get('store_id');\n                formData.store_name = cookies.get('store_name');\n            }\n\n            if (cookies.get(\"user_id\")) {\n                selectedOrderPlacedByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.order_placed_by = cookies.get(\"user_id\");\n                formData.vat_percent = parseFloat(cookies.get('vat_percent'));\n                setFormData({ ...formData });\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n            }\n\n            setFormData({ ...formData });\n\n            if (id) {\n                getPurchase(id);\n            }\n            reCalculate();\n            setShow(true);\n        },\n\n    }));\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function-purchase.\");\n                // event.preventDefault();\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n\n    useEffect(() => {\n        console.log(\"inside change on formData:\", formData);\n        // localStorage\n\n    });\n\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        vat_percent: 10.0,\n        discount: 0.0,\n        discountValue: 0.0,\n        discount_percent: 0.0,\n        is_discount_percent: false,\n        date_str: format(new Date(), \"MMM dd yyyy\"),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"created\",\n    });\n\n    //Store Auto Suggestion\n    const [storeOptions, setStoreOptions] = useState([]);\n    let [selectedStores, setSelectedStores] = useState([]);\n    const [isStoresLoading, setIsStoresLoading] = useState(false);\n\n    //Vendor Auto Suggestion\n    const [vendorOptions, setVendorOptions] = useState([]);\n    let [selectedVendors, setSelectedVendors] = useState([]);\n    const [isVendorsLoading, setIsVendorsLoading] = useState(false);\n\n    //Product Auto Suggestion\n    const [productOptions, setProductOptions] = useState([]);\n    let [selectedProduct, setSelectedProduct] = useState([]);\n    let [selectedProducts, setSelectedProducts] = useState([]);\n    const [isProductsLoading, setIsProductsLoading] = useState(false);\n\n    //Order Placed By Auto Suggestion\n    const [orderPlacedByUserOptions, setOrderPlacedByUserOptions] = useState([]);\n    let [selectedOrderPlacedByUsers, setSelectedOrderPlacedByUsers] = useState([]);\n    const [isOrderPlacedByUsersLoading, setIsOrderPlacedByUsersLoading] = useState(false);\n\n    //Order Placed By Signature Auto Suggestion\n    const [orderPlacedBySignatureOptions, setOrderPlacedBySignatureOptions] =\n        useState([]);\n    let [selectedOrderPlacedBySignatures, setSelectedOrderPlacedBySignatures] =\n        useState([]);\n    const [isOrderPlacedBySignaturesLoading, setIsOrderPlacedBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/purchases\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function getPurchase(id) {\n        console.log(\"inside get Purchase\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/purchase/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let purchase = data.result;\n                formData = {\n                    id: purchase.id,\n                    code: purchase.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n\n                selectedProducts = purchase.products;\n                setSelectedProducts([...selectedProducts]);\n\n\n                let selectedStores = [\n                    {\n                        id: purchase.store_id,\n                        name: purchase.store_name,\n                    }\n                ];\n\n                let selectedVendors = [\n                    {\n                        id: purchase.vendor_id,\n                        name: purchase.vendor_name,\n                        search_label: purchase.vendor_name,\n                    }\n                ];\n\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: purchase.order_placed_by,\n                        name: purchase.order_placed_by_name\n                    }\n                ];\n\n                if (purchase.order_placed_by_signature_id) {\n                    let selectedOrderPlacedBySignatures = [\n                        {\n                            id: purchase.order_placed_by_signature_id,\n                            name: purchase.order_placed_by_signature_name,\n                        }\n                    ];\n\n                    setSelectedOrderPlacedBySignatures([...selectedOrderPlacedBySignatures]);\n                }\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n\n                setSelectedStores([...selectedStores]);\n                setSelectedVendors([...selectedVendors]);\n\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=` + encodeURIComponent(object[key]);\n            })\n            .join(\"&\");\n    }\n\n    async function suggestStores(searchTerm) {\n        console.log(\"Inside handle suggestStores\");\n        setStoreOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsStoresLoading(true);\n        let result = await fetch(\n            \"/v1/store?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setStoreOptions(data.result);\n        setIsStoresLoading(false);\n    }\n\n    async function suggestVendors(searchTerm) {\n        console.log(\"Inside handle suggestVendors\");\n        setVendorOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";\n        setIsVendorsLoading(true);\n        let result = await fetch(\n            \"/v1/vendor?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setVendorOptions(data.result);\n        setIsVendorsLoading(false);\n    }\n\n    function GetProductUnitPriceInStore(storeId, productStores) {\n        console.log(\"Inside GetProductUnitPriceInStore\");\n        if (!productStores) {\n            return \"\";\n        }\n        console.log(\"Cool\")\n\n        for (var i = 0; i < productStores.length; i++) {\n            console.log(\"productStores[i]:\", productStores[i]);\n            console.log(\"store_id:\", storeId);\n\n            if (productStores[i].store_id === storeId) {\n                console.log(\"macthed\");\n                console.log(\n                    \"unitPrice.retail_unit_price:\",\n                    productStores[i].purchase_unit_price\n                );\n                return productStores[i];\n            }\n        }\n        console.log(\"not matched\");\n        return \"\";\n    }\n\n    let [openProductSearchResult, setOpenProductSearchResult] = useState(false);\n\n    async function suggestProducts(searchTerm) {\n        console.log(\"Inside handle suggestProducts\");\n        setProductOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n\n        if (cookies.get(\"store_id\")) {\n            params.store_id = cookies.get(\"store_id\");\n        }\n\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,item_code,bar_code,name,stores,unit,part_number,name_in_arabic\";\n        setIsProductsLoading(true);\n        let result = await fetch(\n            \"/v1/product?\" + Select + queryString + \"&limit=200\",\n            requestOptions\n        );\n        let data = await result.json();\n\n        let products = data.result;\n        if (!products || products.length === 0) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n\n\n        openProductSearchResult = true;\n        setOpenProductSearchResult(true);\n        setProductOptions(products);\n        setIsProductsLoading(false);\n    }\n\n    async function getProductByBarCode(barcode) {\n        formData.barcode = barcode;\n        setFormData({ ...formData });\n        console.log(\"Inside getProductByBarCode\");\n        errors[\"bar_code\"] = \"\";\n        setErrors({ ...errors });\n\n        console.log(\"barcode:\" + formData.barcode);\n        if (!formData.barcode) {\n            return;\n        }\n\n        if (formData.barcode.length === 13) {\n            formData.barcode = formData.barcode.slice(0, -1);\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n\n        let Select = \"select=id,item_code,bar_code,part_number,name,stores,unit,part_number,name_in_arabic\";\n        let result = await fetch(\n            \"/v1/product/barcode/\" + formData.barcode + \"?\" + Select,\n            requestOptions\n        );\n        let data = await result.json();\n\n\n        let product = data.result;\n        if (product) {\n            addProduct(product);\n        } else {\n            errors[\"bar_code\"] = \"Invalid Barcode:\" + formData.barcode\n            setErrors({ ...errors });\n        }\n\n        formData.barcode = \"\";\n        setFormData({ ...formData });\n\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setOrderPlacedByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsOrderPlacedByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setOrderPlacedByUserOptions(data.result);\n        setIsOrderPlacedByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setOrderPlacedBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsOrderPlacedBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setOrderPlacedBySignatureOptions(data.result);\n        setIsOrderPlacedBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        console.log(\"Inside handle Create\");\n        console.log(\"selectedProducts:\", selectedProducts);\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit: selectedProducts[i].unit,\n                purchase_unit_price: parseFloat(selectedProducts[i].purchase_unit_price),\n                retail_unit_price: parseFloat(selectedProducts[i].retail_unit_price),\n                wholesale_unit_price: parseFloat(selectedProducts[i].wholesale_unit_price),\n            });\n        }\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        console.log(\"formData.discount:\", formData.discount);\n        console.log(\"formData.discount_percent:\", formData.discount_percent);\n\n        if (!formData.shipping_handling_fees && formData.shipping_handling_fees !== 0) {\n            errors[\"shipping_handling_fees\"] = \"Invalid shipping / handling fees\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && !formData.partial_payment_amount && formData.partial_payment_amount !== 0) {\n            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount <= 0) {\n            errors[\"partial_payment_amount\"] = \"Partial payment should be > 0 \";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount >= netTotal) {\n            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n            setErrors({ ...errors });\n            return;\n        }\n\n        \n        errors[\"payment_method\"] = \"\";\n        setErrors({ ...errors });\n        if (formData.payment_status != \"not_paid\" && !formData.payment_method) {\n            errors[\"payment_method\"] = \"Payment method is required\";\n            setErrors({ ...errors });\n            return;\n        }\n        \n\n\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.vat_percent && formData.vat_percent !== 0) {\n            errors[\"vat_percent\"] = \"Invalid vat percent\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        if (cookies.get('store_id')) {\n            formData.store_id = cookies.get('store_id');\n        }\n\n        let endPoint = \"/v1/purchase\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/purchase/\" + formData.id;\n            method = \"PUT\";\n        }\n\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"Purchase Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n                handleClose();\n                props.openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating Purchase!\", \"danger\");\n            });\n    }\n\n    function isProductAdded(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function addProduct(product) {\n        console.log(\"Inside Add product\");\n        if (!formData.store_id) {\n            errors.product_id = \"Please Select a Store and try again\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        errors.product_id = \"\";\n        if (!product) {\n            errors.product_id = \"Invalid Product\";\n            setErrors({ ...errors });\n            return;\n        }\n        let productStore = {};\n\n        if (product.stores) {\n            productStore = GetProductUnitPriceInStore(\n                formData.store_id,\n                product.stores\n            );\n            if (productStore && productStore.retail_unit_price) {\n                product.retail_unit_price = productStore.retail_unit_price;\n            }\n\n            if (productStore && productStore.purchase_unit_price) {\n                product.purchase_unit_price = productStore.purchase_unit_price;\n            }\n\n            if (productStore && productStore.wholesale_unit_price) {\n                product.wholesale_unit_price = productStore.wholesale_unit_price;\n            }\n        }\n\n\n\n\n        let alreadyAdded = false;\n        let index = -1;\n        let quantity = 0.00;\n        product.quantity = 1.00;\n\n        if (isProductAdded(product.id)) {\n            alreadyAdded = true;\n            index = getProductIndex(product.id);\n            quantity = parseFloat(selectedProducts[index].quantity + product.quantity);\n        } else {\n            quantity = parseFloat(product.quantity);\n        }\n\n        console.log(\"quantity:\", quantity);\n\n        errors.quantity = \"\";\n\n        if (alreadyAdded) {\n            selectedProducts[index].quantity = parseFloat(quantity);\n            // setSelectedProducts([...selectedProducts]);\n        }\n\n        if (!alreadyAdded) {\n            let item = {\n                product_id: product.id,\n                code: product.item_code,\n                part_number: product.part_number,\n                name: product.name,\n                quantity: product.quantity,\n                stores: product.stores,\n                unit: product.unit,\n            };\n\n            if (product.purchase_unit_price) {\n                item.purchase_unit_price = parseFloat(product.purchase_unit_price).toFixed(2);\n            }\n\n            if (product.retail_unit_price) {\n                item.retail_unit_price = parseFloat(product.retail_unit_price).toFixed(2);\n            }\n\n            if (product.wholesale_unit_price) {\n                item.wholesale_unit_price = parseFloat(product.wholesale_unit_price).toFixed(2);\n            }\n\n            selectedProducts.push(item);\n\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit: selectedProducts[i].unit,\n                purchase_unit_price: parseFloat(selectedProducts[i].purchase_unit_price),\n                retail_unit_price: parseFloat(selectedProducts[i].retail_unit_price),\n                wholesale_unit_price: parseFloat(selectedProducts[i].wholesale_unit_price),\n            });\n        }\n        setFormData({ ...formData });\n    }\n\n    function getProductIndex(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return i;\n            }\n        }\n        return false;\n    }\n\n    function removeProduct(product) {\n        const index = selectedProducts.indexOf(product);\n        if (index > -1) {\n            selectedProducts.splice(index, 1);\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n    }\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            totalPrice +=\n                parseFloat(selectedProducts[i].purchase_unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n        totalPrice = totalPrice.toFixed(2);\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            vatPrice = (parseFloat((parseFloat(formData.vat_percent) / 100)) * (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount))).toFixed(2);;\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function findNetTotal() {\n        netTotal = 0.00;\n        if (totalPrice > 0) {\n            netTotal = (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount) + parseFloat(vatPrice)).toFixed(2);\n        }\n        setNetTotal(netTotal);\n\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n            setFormData({ ...formData });\n        }\n    }\n\n\n    function reCalculate() {\n        findTotalPrice();\n\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n\n    const StoreCreateFormRef = useRef();\n    function openStoreCreateForm() {\n        StoreCreateFormRef.current.open();\n    }\n\n    const ProductCreateFormRef = useRef();\n    function openProductCreateForm() {\n        ProductCreateFormRef.current.open();\n    }\n\n    function openProductUpdateForm(id) {\n        ProductCreateFormRef.current.open(id);\n    }\n\n    const VendorCreateFormRef = useRef();\n    function openVendorCreateForm() {\n        VendorCreateFormRef.current.open();\n    }\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n    return (\n        <>\n            <ProductView ref={ProductDetailsViewRef} openUpdateForm={openProductUpdateForm} openCreateForm={openProductCreateForm} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} openDetailsView={openProductDetailsView} />\n\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n            <VendorCreate ref={VendorCreateFormRef} showToastMessage={props.showToastMessage} />\n            <Modal show={show} size=\"xl\" fullscreen onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Purchase #\" + formData.code : \"Create New Purchase\"}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <PurchasePreview />\n                        {formData.id ? <Button variant=\"primary\" onClick={() => {\n                            handleClose();\n                            props.openDetailsView(formData.id);\n                        }}>\n                            <i className=\"bi bi-eye\"></i> View Detail\n                        </Button> : \"\"}\n                        &nbsp;&nbsp;\n                        <Button variant=\"primary\" onClick={handleCreate} >\n                            {isProcessing ?\n                                <Spinner\n                                    as=\"span\"\n                                    animation=\"border\"\n                                    size=\"sm\"\n                                    role=\"status\"\n                                    aria-hidden={true}\n                                /> + \" Creating...\"\n\n                                : \"\"\n                            }\n                            {formData.id ? \"Update\" : \"Create\"}\n\n                        </Button>\n\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    <form className=\"row g-3 needs-validation\" onSubmit={handleCreate}>\n                        {!cookies.get('store_name') ? <div className=\"col-md-6\">\n                            <label className=\"form-label\">Purchase to Store*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"store_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isStoresLoading}\n                                    isInvalid={errors.store_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.store_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.store_id = \"Invalid Store selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedStores([]);\n                                            return;\n                                        }\n                                        formData.store_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedStores(selectedItems);\n                                        //SetPriceOfAllProducts(selectedItems[0].id);\n                                    }}\n                                    options={storeOptions}\n                                    placeholder=\"Select Store\"\n                                    selected={selectedStores}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestStores(searchTerm);\n                                    }}\n                                />\n                                <Button hide={true.toString()} onClick={openStoreCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi x-lg\"> </i>\n                                    {errors.store_id}\n                                </div>\n                                {formData.store_id && !errors.store_id && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Purchase From Vendor*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"vendor_id\"\n                                    labelKey=\"search_label\"\n                                    isLoading={isVendorsLoading}\n                                    isInvalid={errors.vendor_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.vendor_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.vendor_id = \"Invalid Vendor selected\";\n                                            setErrors(errors);\n                                            formData.vendor_id = \"\";\n                                            setFormData({ ...formData });\n                                            setSelectedVendors([]);\n                                            return;\n                                        }\n                                        formData.vendor_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedVendors(selectedItems);\n                                    }}\n                                    options={vendorOptions}\n                                    placeholder=\"Type name or mob\"\n                                    selected={selectedVendors}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestVendors(searchTerm);\n                                    }}\n                                />\n                                <Button hide={true.toString()} onClick={openVendorCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.vendor_id && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.vendor_id}\n                                    </div>\n                                )}\n                                {formData.vendor_id && !errors.vendor_id && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                        {/*\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Product Barcode Scan</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DebounceInput\n                                    minLength={12}\n                                    debounceTimeout={500}\n                                    placeholder=\"Scan Barcode\"\n                                    className=\"form-control barcode\"\n                                    value={formData.barcode}\n                                    onChange={event => getProductByBarCode(event.target.value)} />\n                                {errors.bar_code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.bar_code}\n                                    </div>\n                                )}\n                                {formData.bar_code && !errors.bar_code && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Vendor Invoice No. (Optional)</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.vendor_invoice_no ? formData.vendor_invoice_no : \"\"}\n                                    type='string'\n                                    onChange={(e) => {\n                                        errors[\"vendor_invoice_no\"] = \"\";\n                                        setErrors({ ...errors });\n                                        formData.vendor_invoice_no = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"vendor_invoice_no\"\n                                    placeholder=\"Vendor Invoice No.\"\n                                />\n                                {errors.vendor_invoice_no && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.vendor_invoice_no}\n                                    </div>\n                                )}\n                                {formData.vendor_invoice_no && !errors.rack && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-12\">\n                            <label className=\"form-label\">Product*</label>\n\n\n                            <Typeahead\n                                id=\"product_id\"\n                                size=\"lg\"\n                                labelKey=\"search_label\"\n                                emptyLabel=\"\"\n                                clearButton={true}\n                                open={openProductSearchResult}\n                                isLoading={isProductsLoading}\n                                isInvalid={errors.product_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    if (selectedItems.length === 0) {\n                                        errors[\"product_id\"] = \"Invalid Product selected\";\n                                        setErrors(errors);\n                                        return;\n                                    }\n                                    errors[\"product_id\"] = \"\";\n                                    setErrors({ ...errors });\n\n                                    if (formData.store_id) {\n                                        addProduct(selectedItems[0]);\n\n                                    }\n                                    setOpenProductSearchResult(false);\n                                }}\n                                options={productOptions}\n                                selected={selectedProduct}\n                                placeholder=\"Search By Part No. / Name / Name in Arabic\"\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestProducts(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openProductCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.product_id ? (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.product_id}\n                                </div>\n                            ) : \"\"}\n                            {selectedProduct[0] &&\n                                selectedProduct[0].id &&\n                                !errors.product_id && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n\n                        </div>\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", maxHeight: \"400px\", overflowY: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th style={{ width: \"2%\" }}>Remove</th>\n                                        <th style={{ width: \"5%\" }}>SI No.</th>\n                                        <th style={{ width: \"8%\" }}>Part No.</th>\n                                        <th style={{ width: \"26%\" }} className=\"text-start\">Name</th>\n                                        <th style={{ width: \"11%\" }}>Qty</th>\n                                        <th style={{ width: \"11%\" }}>Purchase Unit Price</th>\n                                        <th style={{ width: \"11%\" }}>Wholesale Unit Price</th>\n                                        <th style={{ width: \"11%\" }}>Retail Unit Price</th>\n                                        <th style={{ width: \"15%\" }}>Purchase Price</th>\n\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr key={index} className=\"text-center\">\n                                            <td>\n                                                <div\n                                                    style={{ color: \"red\", cursor: \"pointer\" }}\n                                                    onClick={() => {\n                                                        removeProduct(product);\n                                                    }}\n                                                >\n                                                    <i className=\"bi bi-x-lg\"> </i>\n                                                </div>\n                                            </td>\n                                            <td>{index + 1}</td>\n                                            <td>{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n                                            }}\n                                                className=\"text-start\"\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                    console.log(\"okk,id:\", product.product_id);\n                                                }}>{product.name}\n                                            </td>\n                                            <td style={{ width: \"155px\" }}>\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.quantity} className=\"form-control\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity should be > 0\";\n                                                                selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            reCalculate();\n\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].quantity:\", selectedProducts[index].quantity);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.purchase_unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Purchase Unit Price\" onChange={(e) => {\n                                                            errors[\"purchase_unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n\n                                                            if (!e.target.value) {\n                                                                errors[\"purchase_unit_price_\" + index] = \"Invalid Purchase Unit Price\";\n                                                                selectedProducts[index].purchase_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"purchase_unit_price_\" + index] = \"Purchase Unit Price should be > 0\";\n                                                                selectedProducts[index].purchase_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].purchase_unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].purchase_unit_price:\", selectedProducts[index].purchase_unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n\n                                                {errors[\"purchase_unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"purchase_unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.wholesale_unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Wholesale Unit Price\" onChange={(e) => {\n                                                            errors[\"wholesale_unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"wholesale_unit_price_\" + index] = \"Invalid Wholesale Unit Price\";\n                                                                selectedProducts[index].wholesale_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"wholesale_unit_price_\" + index] = \"Wholesale Unit Price should be > 0\";\n                                                                selectedProducts[index].wholesale_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].wholesale_unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].wholesale_unit_price:\", selectedProducts[index].wholesale_unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n\n                                                {errors[\"wholesale_unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"wholesale_unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.retail_unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Retail Unit Price\" onChange={(e) => {\n                                                            errors[\"retail_unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"retail_unit_price_\" + index] = \"Invalid Retail Unit Price\";\n                                                                selectedProducts[index].retail_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"retail_unit_price_\" + index] = \"Retail Unit Price should be > 0\";\n                                                                selectedProducts[index].retail_unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].retail_unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].retail_unit_price:\", selectedProducts[index].retail_unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n\n                                                {errors[\"retail_unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"retail_unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td className=\"text-end\">\n                                                <NumberFormat\n                                                    value={(product.purchase_unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n\n                                        </tr>\n                                    )).reverse()}\n                                </tbody>\n                            </table>\n                        </div>\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n                                        <th style={{ width: \"90%\" }} colSpan=\"8\" className=\"text-end\">Total</th>\n                                        <td style={{ width: \"10%\" }} className=\"text-end\">\n                                            <NumberFormat\n                                                value={totalPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Shipping & Handling Fees\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.shipping_handling_fees} onChange={(e) => {\n\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"Shipping / Handling Fees should be > 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.shipping_handling_fees = \"\";\n                                                    errors[\"shipping_handling_fees\"] = \"Invalid Shipping / Handling Fees\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"shipping_handling_fees\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.shipping_handling_fees && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.shipping_handling_fees}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\"> VAT  <input type=\"number\" className=\"text-center\" style={{ width: \"50px\" }} value={formData.vat_percent} onChange={(e) => {\n                                            console.log(\"Inside onchange vat percent\");\n                                            if (parseFloat(e.target.value) === 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n                                            if (parseFloat(e.target.value) < 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"Vat percent should be >= 0\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n\n\n                                            if (!e.target.value) {\n                                                formData.vat_percent = \"\";\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                //formData.discount_percent = 0.00;\n                                                errors[\"vat_percent\"] = \"Invalid vat percent\";\n                                                setFormData({ ...formData });\n                                                setErrors({ ...errors });\n                                                return;\n                                            }\n                                            errors[\"vat_percent\"] = \"\";\n                                            setErrors({ ...errors });\n\n                                            formData.vat_percent = e.target.value;\n                                            reCalculate();\n                                            setFormData({ ...formData });\n                                            console.log(formData);\n                                        }} />{\"%\"}\n                                            {errors.vat_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.vat_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n                        {!formData.id ? <div className=\"col-md-2\">\n                            <label className=\"form-label\">Payment method*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <select\n                                    value={formData.payment_method}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange payment method\");\n                                        if (!e.target.value) {\n                                            errors[\"status\"] = \"Payment Method is required\";\n                                            setErrors({ ...errors });\n                                            formData.payment_method = \"\";\n                                            setFormData({ ...formData });\n                                            return;\n                                        }\n\n                                        errors[\"payment_method\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.payment_method = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                >\n                                    <option value=\"\">Select</option>\n                                    <option value=\"cash\">Cash</option>\n                                    <option value=\"bank_account\">Bank Account  / Debit / Credit Card</option>\n                                </select>\n                                {errors.payment_method && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.payment_method}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n                        {!formData.id ? <div className=\"col-md-2\">\n                            <label className=\"form-label\">Payment Status*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <select\n                                    value={formData.payment_status}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange payment Status\");\n                                        if (!e.target.value) {\n                                            errors[\"status\"] = \"Invalid Payment Status\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"payment_status\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.payment_status = e.target.value;\n                                        if (formData.payment_status !== \"paid_partially\") {\n                                            formData.partial_payment_amount = 0.00;\n                                        }\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                >\n                                    <option value=\"paid\">Paid</option>\n                                    <option value=\"not_paid\">Not Paid</option>\n                                    <option value=\"paid_partially\">Paid Partially</option>\n                                </select>\n                                {errors.payment_status && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.payment_status}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n\n                        {!formData.id && formData.payment_status === \"paid_partially\" ? <div className=\"col-md-3\">\n                            <label className=\"form-label\">Patial Payment Amount*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    type='number'\n                                    value={formData.partial_payment_amount}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange vat discount\");\n                                        if (!e.target.value) {\n                                            formData.partial_payment_amount = e.target.value;\n                                            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        formData.partial_payment_amount = parseFloat(e.target.value);\n                                        errors[\"partial_payment_amount\"] = \"\";\n\n                                        if (formData.partial_payment_amount >= netTotal) {\n                                            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        setErrors({ ...errors });\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Amount\"\n                                />\n                                {errors.partial_payment_amount && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.partial_payment_amount}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Date Time*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    selected={formData.date_str ? new Date(formData.date_str) : null}\n                                    value={formData.date_str ? format(\n                                        new Date(formData.date_str),\n                                        \"MMMM d, yyyy h:mm aa\"\n                                    ) : null}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                    showTimeSelect\n                                    timeIntervals=\"1\"\n                                    onChange={(value) => {\n                                        console.log(\"Value\", value);\n                                        formData.date_str = value;\n                                        // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate} >\n                                {isProcessing ?\n                                    <Spinner\n                                        as=\"span\"\n                                        animation=\"border\"\n                                        size=\"sm\"\n                                        role=\"status\"\n                                        aria-hidden={true}\n                                    /> + \" Creating...\"\n\n                                    : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>\n                </Modal.Body >\n\n            </Modal >\n\n\n        </>\n    );\n});\n\nexport default PurchaseCreate;\n"]},"metadata":{},"sourceType":"module"}