{"ast":null,"code":"import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from\"react\";import SalesReturnPreview from\"./preview.js\";import{Modal,Button,Form}from\"react-bootstrap\";import StoreCreate from\"../store/create.js\";import CustomerCreate from\"./../customer/create.js\";import ProductCreate from\"./../product/create.js\";import UserCreate from\"./../user/create.js\";import SignatureCreate from\"./../signature/create.js\";import Cookies from\"universal-cookie\";import{Typeahead}from\"react-bootstrap-typeahead\";import NumberFormat from\"react-number-format\";import DatePicker from\"react-datepicker\";import{format}from\"date-fns\";import{Spinner}from\"react-bootstrap\";import SalesReturnView from\"./view.js\";import ProductView from\"./../product/view.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SalesReturnCreate=/*#__PURE__*/forwardRef(function(props,ref){var _vatPrice,_netTotal,_totalPaymentAmount,_balanceAmount;useImperativeHandle(ref,function(){return{open:function open(id,orderId){errors={};setErrors(_objectSpread({},errors));formData={order_id:orderId,vat_percent:15.0,discount:0.0,discountValue:0.0,discount_percent:0.0,is_discount_percent:false,//  date_str: format(new Date(), \"MMM dd yyyy\"),\ndate_str:new Date(),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"received\",payment_status:\"\",payment_method:\"\",price_type:\"retail\"};formData.payments_input=[{\"date_str\":formData.date_str,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false}];formData.cash_discount=0.00;if(cookies.get(\"user_id\")){selectedReceivedByUsers=[{id:cookies.get(\"user_id\"),name:cookies.get(\"user_name\")}];formData.received_by=cookies.get(\"user_id\");setFormData(_objectSpread({},formData));setSelectedReceivedByUsers(_toConsumableArray(selectedReceivedByUsers));}setFormData(_objectSpread({},formData));if(id){getSalesReturn(id);}if(orderId){reCalculate();getOrder(orderId);}setShow(true);}};});function getSalesReturn(id){console.log(\"inside getSalesReturn id:\",id);var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/sales-return/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,salesReturn,i,selectedProductsTemp,_i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);salesReturn=data.result;// formData = purchaseReturn;\nformData={id:salesReturn.id,code:salesReturn.code,order_code:salesReturn.order_code,order_id:salesReturn.order_id,store_id:salesReturn.store_id,customer_id:salesReturn.customer_id,date_str:salesReturn.date,payments_input:salesReturn.payments,cash_discount:salesReturn.cash_discount,// date: purchase.date,\nvat_percent:salesReturn.vat_percent,discount:salesReturn.discount,discount_percent:salesReturn.discount_percent,is_discount_percent:salesReturn.is_discount_percent,payment_status:salesReturn.payment_status// shipping_handling_fees: salesReturn.shipping_handling_fees,\n};for(i=0;i<formData.payments_input.length;i++){formData.payments_input[i].date_str=formData.payments_input[i].date;}setFormData(_objectSpread({},formData));console.log(\"formData1.status:\",formData.status);console.log(\"purchaseReturn.products:\",salesReturn.products);selectedProductsTemp=salesReturn.products;selectedProducts=[];for(_i=0;_i<selectedProductsTemp.length;_i++){if(selectedProductsTemp[_i].quantity>0){selectedProductsTemp[_i].selected=true;}else{selectedProductsTemp[_i].selected=false;}selectedProducts.push(selectedProductsTemp[_i]);//selectedProductsTemp[i].purchase_unit_price = selectedProductsTemp[i].purchasereturn_unit_price;\n}setSelectedProducts(_toConsumableArray(selectedProducts));setFormData(_objectSpread({},formData));reCalculate();setFormData(_objectSpread({},formData));case 26:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}useEffect(function(){var listener=function listener(event){if(event.code===\"Enter\"||event.code===\"NumpadEnter\"){console.log(\"Enter key was pressed. Run your function.\");// event.preventDefault();\nvar form=event.target.form;if(form&&event.target){var index=Array.prototype.indexOf.call(form,event.target);if(form&&form.elements[index+1]){if(event.target.getAttribute(\"class\").includes(\"barcode\")){form.elements[index].focus();}else{form.elements[index+1].focus();}event.preventDefault();}}}};document.addEventListener(\"keydown\",listener);return function(){document.removeEventListener(\"keydown\",listener);};},[]);function getOrder(id){console.log(\"inside get SalesReturn\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/order/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error,order,selectedProductsTemp,i,soldQty;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get('content-type'))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes('application/json');_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}error=data&&data.errors;return _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);order=data.result;selectedProductsTemp=order.products;selectedProducts=[];for(i=0;i<selectedProductsTemp.length;i++){selectedProductsTemp[i].selected=false;soldQty=selectedProductsTemp[i].quantity-selectedProductsTemp[i].quantity_returned;selectedProductsTemp[i].quantity=soldQty;if(soldQty>0){selectedProducts.push(selectedProductsTemp[i]);}}// selectedProducts = selectedProductsTemp\nconsole.log(\"selectedProducts:\",selectedProducts);setSelectedProducts(_toConsumableArray(selectedProducts));//formData = order;\nconsole.log(\"order.id:\",order.id);formData.id=\"\";formData.products=order.products;// formData.order_id = order.id;\n//console.log(\"formData.order_id:\", formData.order_id);\nformData.order_code=order.code;formData.store_id=order.store_id;/*\n                formData.received_by = order.delivered_by;\n                formData.received_by_signature_id = order.delivered_by_signature_id;\n                */formData.customer_id=order.customer_id;// formData.is_discount_percent = order.is_discount_percent;\nformData.is_discount_percent=true;console.log(\"order.discount_percent:\",order.discount_percent);formData.discount_percent=order.discount_percent;formData.cash_discount=parseFloat(order.cash_discount-order.return_cash_discount);// formData.discount = (order.discount - order.return_discount);\n// formData.discount_percent = order.discount_percent;\n/*\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n                */ // setFormData({ ...formData });\nconsole.log(\"formData:\",formData);selectedStores=[{id:order.store_id,name:order.store_name}];setSelectedStores(selectedStores);console.log(\"selectedStores:\",selectedStores);setFormData(_objectSpread({},formData));reCalculate();setFormData(_objectSpread({},formData));case 36:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}/*\n    let [barcode, setBarcode] = useState(\"\");\n    let [barcodeEnded, setBarcodeEnded] = useState(false);\n    const keyPress = useCallback(\n        (e) => {\n            console.log(\"e.key:\", e.key);\n\n            if (!barcodeEnded && e.key != \"Enter\") {\n                console.log()\n                barcode += e.key;\n                setBarcode(barcode);\n            }\n\n            if (e.key === \"Enter\") {\n                document.removeEventListener(\"keydown\", keyPress);\n                console.log(\"barcode:\", barcode);\n                barcodeEnded = true;\n                setBarcodeEnded(true);\n            }\n\n        },\n        []\n    );\n\n    function addListener() {\n        //barcode = \"\";\n        //setBarcode(barcode);\n        document.addEventListener(\"keydown\", keyPress);\n        console.log(\"Listener added, barcode:\", barcode);\n    }\n    */ /*\n    useEffect(() => {\n        document.addEventListener(\"keydown\", keyPress);\n        return () => document.removeEventListener(\"keydown\", keyPress);\n    }, [keyPress]);\n    */ /*\n    useEffect(() => {\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener(\"keydown\", handleKeyDown);\n    });\n    let [barcode, setBarcode] = useState(\"\");\n    function handleKeyDown(event) {\n        console.log(\"event.key:\", event.key);\n\n        /*\n        if (event.key == \"Enter\") {\n            barcode = \"\";\n            setBarcode(barcode);\n        }\n        else if (event.key == \"Shift\") {\n            console.log(\"barcode:\", barcode);\n        } else {\n            barcode += event.key;\n            setBarcode(barcode);\n        }\n        */ /*\n    if (event.keyCode === KEY_ESCAPE) {\n        /* do your action here */ // }  \n// }\nvar selectedDate=new Date();//const history = useHistory();\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();//fields\nvar _useState5=useState({order_id:\"\",vat_percent:15.0,discount:0.0,date_str:format(new Date(),\"MMM dd yyyy\"),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"received\",payment_status:\"\",payment_method:\"\",price_type:\"retail\"}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),selectedStores=_useState8[0],setSelectedStores=_useState8[1];//Product Auto Suggestion\nvar _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedProducts=_useState10[0],setSelectedProducts=_useState10[1];//Received By Auto Suggestion\nvar _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),receivedByUserOptions=_useState12[0],setReceivedByUserOptions=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),selectedReceivedByUsers=_useState14[0],setSelectedReceivedByUsers=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isReceivedByUsersLoading=_useState16[0],setIsReceivedByUsersLoading=_useState16[1];//Received By Signature Auto Suggestion\nvar _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),receivedBySignatureOptions=_useState18[0],setReceivedBySignatureOptions=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),selectedReceivedBySignatures=_useState20[0],setSelectedReceivedBySignatures=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isReceivedBySignaturesLoading=_useState22[0],setIsReceivedBySignaturesLoading=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),show=_useState24[0],setShow=_useState24[1];function handleClose(){setShow(false);}useEffect(function(){var at=cookies.get(\"access_token\");if(!at){// history.push(\"/dashboard/salesreturns\");\nwindow.location=\"/\";}});function ObjectToSearchQueryParams(object){return Object.keys(object).map(function(key){return\"search[\".concat(key,\"]=\").concat(object[key]);}).join(\"&\");}function suggestUsers(_x3){return _suggestUsers.apply(this,arguments);}function _suggestUsers(){_suggestUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"Inside handle suggestUsers\");setReceivedByUserOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsReceivedByUsersLoading(true);_context4.next=13;return fetch(\"/v1/user?\"+Select+queryString,requestOptions);case 13:result=_context4.sent;_context4.next=16;return result.json();case 16:data=_context4.sent;setReceivedByUserOptions(data.result);setIsReceivedByUsersLoading(false);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return _suggestUsers.apply(this,arguments);}function suggestSignatures(_x4){return _suggestSignatures.apply(this,arguments);}function _suggestSignatures(){_suggestSignatures=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"Inside handle suggestSignatures\");setReceivedBySignatureOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context5.next=5;break;}return _context5.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsReceivedBySignaturesLoading(true);_context5.next=13;return fetch(\"/v1/signature?\"+Select+queryString,requestOptions);case 13:result=_context5.sent;_context5.next=16;return result.json();case 16:data=_context5.sent;setReceivedBySignatureOptions(data.result);setIsReceivedBySignaturesLoading(false);case 19:case\"end\":return _context5.stop();}}},_callee5);}));return _suggestSignatures.apply(this,arguments);}function handleCreate(event){event.preventDefault();console.log(\"Inside handle Create\");console.log(\"selectedProducts:\",selectedProducts);console.log(\"formData.order_id:\",formData.order_id);formData.products=[];for(var i=0;i<selectedProducts.length;i++){if(!selectedProducts[i].selected){continue;}formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit_price:parseFloat(selectedProducts[i].unit_price),unit:selectedProducts[i].unit});}if(!formData.cash_discount){formData.cash_discount=0.00;}formData.discount=parseFloat(formData.discount);formData.discount_percent=parseFloat(formData.discount_percent);formData.vat_percent=parseFloat(formData.vat_percent);console.log(\"formData.discount:\",formData.discount);var haveErrors=false;errors[\"products\"]=\"\";setErrors(_objectSpread({},errors));if(formData.products.length===0){errors[\"products\"]=\"No products added\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.discount&&formData.discount!==0){errors[\"discount\"]=\"Invalid discount\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.discount_percent&&formData.discount_percent!==0){errors[\"discount_percent\"]=\"Invalid discount percent\";setErrors(_objectSpread({},errors));haveErrors=true;}if(parseFloat(formData.discount_percent)>100){errors[\"discount_percent\"]=\"Discount percent cannot be > 100\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!validatePaymentAmounts()){console.log(\"Errors on payments\");haveErrors=true;}if(haveErrors){console.log(\"Errors: \",errors);return;}/*\n        if (!formData.discountValue && formData.discountValue !== 0) {\n            errors[\"discount\"] = \"Invalid Discount\";\n            setErrors({ ...errors });\n            return;\n        }\n        */formData.net_total=parseFloat(netTotal);var endPoint=\"/v1/sales-return\";var method=\"POST\";if(formData.id){endPoint=\"/v1/sales-return/\"+formData.id;method=\"PUT\";}var requestOptions={method:method,headers:{'Accept':'application/json',\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")},body:JSON.stringify(formData)};console.log(\"formData:\",formData);setProcessing(true);fetch(endPoint,requestOptions).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(response){var _response$headers$get3;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isJson=(_response$headers$get3=response.headers.get(\"content-type\"))===null||_response$headers$get3===void 0?void 0:_response$headers$get3.includes(\"application/json\");_context3.t0=isJson;if(!_context3.t0){_context3.next=6;break;}_context3.next=5;return response.json();case 5:_context3.t0=_context3.sent;case 6:data=_context3.t0;if(response.ok){_context3.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context3.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});setProcessing(false);console.log(\"Response:\");console.log(data);props.showToastMessage(\"SalesReturn Created Successfully!\",\"success\");if(props.refreshList){props.refreshList();}handleClose();openDetailsView(data.result.id);case 18:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x5){return _ref3.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(_objectSpread({},error));console.error(\"There was an error!\",error);props.showToastMessage(\"Error Creating SalesReturn!\",\"danger\");});}var _useState25=useState(0.0),_useState26=_slicedToArray(_useState25,2),totalPrice=_useState26[0],setTotalPrice=_useState26[1];function findTotalPrice(){totalPrice=0.00;for(var i=0;i<selectedProducts.length;i++){if(!selectedProducts[i].selected){continue;}totalPrice+=parseFloat(selectedProducts[i].unit_price)*parseFloat(selectedProducts[i].quantity);}totalPrice=totalPrice.toFixed(2);setTotalPrice(totalPrice);}var _useState27=useState(0.00),_useState28=_slicedToArray(_useState27,2),vatPrice=_useState28[0],setVatPrice=_useState28[1];/*\n    function findVatPrice() {\n        vatPrice = ((parseFloat(formData.vat_percent) / 100) * parseFloat(totalPrice - formData.discount)).toFixed(2);;\n        console.log(\"vatPrice:\", vatPrice);\n        setVatPrice(vatPrice);\n    }*/function findVatPrice(){vatPrice=0.00;if(totalPrice>0){//+ parseFloat(formData.shipping_handling_fees)\nvatPrice=parseFloat(parseFloat(formData.vat_percent)/100)*(parseFloat(totalPrice)-parseFloat(formData.discount));console.log(\"vatPrice:\",vatPrice);}setVatPrice(vatPrice);}var _useState29=useState(0.00),_useState30=_slicedToArray(_useState29,2),netTotal=_useState30[0],setNetTotal=_useState30[1];function findNetTotal(){if(totalPrice>0){netTotal=parseFloat(totalPrice)-parseFloat(formData.discount)+parseFloat(vatPrice);setNetTotal(netTotal);}netTotal=Math.round(netTotal*100)/100;console.log(\"after rounding netTotal:\",netTotal);setNetTotal(netTotal);if(!formData.id){var method=\"\";if(formData.payments_input[0]){method=formData.payments_input[0].method;}formData.payments_input=[{\"date_str\":formData.date_str,\"amount\":0.00,\"method\":method,\"deleted\":false}];if(netTotal>0){formData.payments_input[0].amount=parseFloat(netTotal.toFixed(2));if(formData.cash_discount){var _formData$cash_discou;formData.payments_input[0].amount=formData.payments_input[0].amount-parseFloat((_formData$cash_discou=formData.cash_discount)===null||_formData$cash_discou===void 0?void 0:_formData$cash_discou.toFixed(2));}formData.payments_input[0].amount=parseFloat(formData.payments_input[0].amount.toFixed(2));//formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n}}setFormData(_objectSpread({},formData));validatePaymentAmounts();}var _useState31=useState(0.00),_useState32=_slicedToArray(_useState31,2),discountPercent=_useState32[0],setDiscountPercent=_useState32[1];/*\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n    }\n    */ /*\n    function findDiscountPercent() {\n        if (!formData.discountValue) {\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            setFormData({ ...formData });\n            return;\n        }\n\n        formData.discount = formData.discountValue;\n\n        if (formData.discount > 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n\n    }\n    */ /*\n    function findDiscount() {\n        if (!formData.discountValue) {\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            setFormData({ ...formData });\n            return;\n        }\n\n        formData.discount_percent = formData.discountValue;\n\n        if (formData.discount_percent > 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n        }\n        setFormData({ ...formData });\n    }\n    */function findDiscount(){if(formData.discount_percent>=0&&totalPrice>0){formData.discount=parseFloat(totalPrice*parseFloat(formData.discount_percent/100));//formData.discount = Math.round(formData.discount * 100) / 100;\nformData.discount=parseFloat(formData.discount.toFixed(2));setFormData(_objectSpread({},formData));}}function findDiscountPercent(){if(formData.discount>=0&&totalPrice>0){discountPercent=parseFloat(parseFloat(formData.discount/totalPrice)*100);setDiscountPercent(discountPercent);formData.discount_percent=discountPercent;//formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\nsetFormData(_objectSpread({},formData));}}function reCalculate(){findTotalPrice();//findDiscount();\n//findDiscountPercent();\nif(formData.is_discount_percent){findDiscount();}else{findDiscountPercent();}findVatPrice();findNetTotal();}var DetailsViewRef=useRef();function openDetailsView(id){DetailsViewRef.current.open(id);}var StoreCreateFormRef=useRef();var CustomerCreateFormRef=useRef();var ProductCreateFormRef=useRef();var UserCreateFormRef=useRef();function openUserCreateForm(){UserCreateFormRef.current.open();}var SignatureCreateFormRef=useRef();function openSignatureCreateForm(){SignatureCreateFormRef.current.open();}var ProductDetailsViewRef=useRef();function openProductDetailsView(id){ProductDetailsViewRef.current.open(id);}var _useState33=useState(0.00),_useState34=_slicedToArray(_useState33,2),totalPaymentAmount=_useState34[0],setTotalPaymentAmount=_useState34[1];var _useState35=useState(0.00),_useState36=_slicedToArray(_useState35,2),balanceAmount=_useState36[0],setBalanceAmount=_useState36[1];var _useState37=useState(\"\"),_useState38=_slicedToArray(_useState37,2),paymentStatus=_useState38[0],setPaymentStatus=_useState38[1];function findTotalPayments(){var _parseFloat;var totalPayment=0.00;for(var i=0;i<((_formData$payments_in=formData.payments_input)===null||_formData$payments_in===void 0?void 0:_formData$payments_in.length);i++){var _formData$payments_in;if(formData.payments_input[i].amount&&!formData.payments_input[i].deleted){totalPayment+=formData.payments_input[i].amount;}}totalPaymentAmount=totalPayment;setTotalPaymentAmount(totalPaymentAmount);// balanceAmount = (netTotal - formData.cash_discount) - totalPayment;\nbalanceAmount=parseFloat(netTotal.toFixed(2))-parseFloat((_parseFloat=parseFloat(formData.cash_discount))===null||_parseFloat===void 0?void 0:_parseFloat.toFixed(2))-parseFloat(totalPayment.toFixed(2));setBalanceAmount(balanceAmount);if(parseFloat(balanceAmount.toFixed(2))===parseFloat(netTotal.toFixed(2))-parseFloat(parseFloat(formData.cash_discount).toFixed(2))){paymentStatus=\"not_paid\";}else if(parseFloat(balanceAmount.toFixed(2))===0){paymentStatus=\"paid\";}else if(parseFloat(balanceAmount.toFixed(2))>0){paymentStatus=\"paid_partially\";}setPaymentStatus(paymentStatus);return totalPayment;}function validatePaymentAmounts(){var haveErrors=false;if(!netTotal){removePayment(0,false);totalPaymentAmount=0.0;setTotalPaymentAmount(0.00);balanceAmount=0.00;setBalanceAmount(0.00);paymentStatus=\"\";setPaymentStatus(paymentStatus);return true;}if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toFixed(2).toString();setErrors(_objectSpread({},errors));haveErrors=true;return false;}var totalPayment=findTotalPayments();// errors[\"payment_date\"] = [];\n//errors[\"payment_method\"] = [];\n//errors[\"payment_amount\"] = [];\nfor(var key=0;key<formData.payments_input.length;key++){errors[\"payment_amount_\"+key]=\"\";errors[\"payment_date_\"+key]=\"\";errors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!formData.payments_input[key].amount){errors[\"payment_amount_\"+key]=\"Payment amount is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(formData.payments_input[key].amount===0){errors[\"payment_amount_\"+key]=\"Amount should be greater than zero\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].date_str){errors[\"payment_date_\"+key]=\"Payment date is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(new Date(formData.payments_input[key].date_str)<new Date(formData.date_str)){errors[\"payment_date_\"+key]=\"Payment date time should be greater than or equal to order date time\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].method){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));haveErrors=true;}if((formData.payments_input[key].amount||formData.payments_input[key].amount===0)&&!formData.payments_input[key].deleted){var maxAllowedAmount=netTotal-formData.cash_discount-(totalPayment-formData.payments_input[key].amount);if(maxAllowedAmount<0){maxAllowedAmount=0;}if(maxAllowedAmount===0){errors[\"payment_amount_\"+key]=\"Total amount should not exceed \"+(netTotal-formData.cash_discount).toFixed(2).toString()+\", Please delete this payment\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(formData.payments_input[key].amount>parseFloat(maxAllowedAmount.toFixed(2))){errors[\"payment_amount_\"+key]=\"Amount should not be greater than \"+maxAllowedAmount.toFixed(2);setErrors(_objectSpread({},errors));haveErrors=true;}}}if(haveErrors){return false;}return true;}function addNewPayment(){var date=new Date();if(!formData.id){date=formData.date_str;}formData.payments_input.push({\"date_str\":date,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false});setFormData(_objectSpread({},formData));validatePaymentAmounts();//validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n}function removePayment(key){var validatePayments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;formData.payments_input.splice(key,1);//formData.payments_input[key][\"deleted\"] = true;\nsetFormData(_objectSpread({},formData));if(validatePayments){validatePaymentAmounts();}}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(SalesReturnView,{ref:DetailsViewRef}),/*#__PURE__*/_jsx(ProductView,{ref:ProductDetailsViewRef}),/*#__PURE__*/_jsx(StoreCreate,{ref:StoreCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(CustomerCreate,{ref:CustomerCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(ProductCreate,{ref:ProductCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(UserCreate,{ref:UserCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(SignatureCreate,{ref:SignatureCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsxs(Modal,{show:show,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,backdrop:\"static\",scrollable:true,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:formData.id?\"Update Sales Return #\"+formData.code+\" for sale #\"+formData.order_code:\"Create Sales Return\"+\" for sale #\"+formData.order_code}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsx(SalesReturnPreview,{}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:handleCreate,children:[isProcessing?/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"border\",size:\"sm\",role:\"status\",\"aria-hidden\":true})+\" Creating...\":\"\",formData.id?\"Update\":\"Create\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsxs(Modal.Body,{children:[Object.keys(errors).length>0?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"ul\",{children:errors&&Object.keys(errors).map(function(key,index){return errors[key]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";})})}):\"\",selectedProducts.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date*\"}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group mb-3\",children:/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.date_str?new Date(formData.date_str):null,value:formData.date_str?format(new Date(formData.date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.date_str=value;// formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\nsetFormData(_objectSpread({},formData));}})}),errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.date_str]}),formData.date_str&&!errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-lg\",children:\" \"}),\"Looks good!\"]})]}),selectedProducts.length===0&&\"Already returned all products\",selectedProducts.length>0&&/*#__PURE__*/_jsxs(\"form\",{className:\"row g-3 needs-validation\",onSubmit:handleCreate,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Select Products\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\",overflowY:\"scroll\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"th\",{children:\"Select\"}),/*#__PURE__*/_jsx(\"th\",{children:\"SI No.\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Part No.\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Price\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedProducts.map(function(product,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedProducts[index].selected,onChange:function onChange(e){console.log(\"e.target.value:\",e.target.value);selectedProducts[index].selected=!selectedProducts[index].selected;setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}})}),/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:product.part_number}),/*#__PURE__*/_jsx(\"td\",{style:{textDecoration:\"underline\",color:\"blue\",cursor:\"pointer\"},onClick:function onClick(){openProductDetailsView(product.product_id);},children:product.name}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"155px\"},children:[/*#__PURE__*/_jsxs(\"div\",{class:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.quantity,className:\"form-control\",placeholder:\"Quantity\",onChange:function onChange(e){errors[\"quantity_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"quantity_\"+index]=\"Invalid Quantity\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(parseFloat(e.target.value)===0){errors[\"quantity_\"+index]=\"Quantity should be >0\";selectedProducts[index].quantity=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}product.quantity=parseFloat(e.target.value);selectedProducts[index].quantity=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{class:\"input-group-text\",id:\"basic-addon2\",children:selectedProducts[index].unit?selectedProducts[index].unit:\"Units\"})]}),errors[\"quantity_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"quantity_\"+index]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"180px\"},children:[/*#__PURE__*/_jsxs(\"div\",{class:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.unit_price,className:\"form-control\",placeholder:\"Unit Price\",onChange:function onChange(e){errors[\"unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"unit_price_\"+index]=\"Invalid Unit Price\";selectedProducts[index].unit_price=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"unit_price_\"+index]=\"Invalid Unit Price should be > 0\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].unit_price:\",selectedProducts[index].unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{class:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"unit_price_\"+index]]})]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(NumberFormat,{value:(product.unit_price*product.quantity).toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]},index);})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\"},children:/*#__PURE__*/_jsx(\"table\",{className:\"table table-striped table-sm table-bordered\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{colSpan:\"4\"}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:\"Total\"}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",style:{width:\"180px\"},children:/*#__PURE__*/_jsx(NumberFormat,{value:totalPrice,displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"6\",className:\"text-end\",children:[\"Discount  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"50px\"},className:\"text-start\",value:formData.discount_percent,onChange:function onChange(e){formData.is_discount_percent=true;if(parseFloat(e.target.value)===0){formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount_percent=parseFloat(e.target.value);formData.discount=0.00;setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"Discount percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount_percent=\"\";formData.discount=0.00;errors[\"discount_percent\"]=\"Invalid Discount Percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"discount_percent\"]=\"\";errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\"%\",errors.discount_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount_percent})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.discount,onChange:function onChange(e){formData.is_discount_percent=false;if(parseFloat(e.target.value)===0){formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount=parseFloat(e.target.value);formData.discount_percent=0.00;setFormData(_objectSpread({},formData));errors[\"discount\"]=\"Discount should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount=\"\";formData.discount_percent=0.00;errors[\"discount\"]=\"Invalid Discount\";setFormData(_objectSpread({},formData));reCalculate();setErrors(_objectSpread({},errors));return;}errors[\"discount\"]=\"\";errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.discount&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"5\",className:\"text-end\"}),/*#__PURE__*/_jsxs(\"th\",{className:\"text-end\",children:[\" VAT: \",formData.vat_percent+\"%\"]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(_vatPrice=vatPrice)===null||_vatPrice===void 0?void 0:_vatPrice.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{colSpan:\"5\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:\"Net Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(_netTotal=netTotal)===null||_netTotal===void 0?void 0:_netTotal.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Cash discount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.cash_discount,className:\"form-control \",onChange:function onChange(e){errors[\"cash_discount\"]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.cash_discount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.cash_discount=parseFloat(e.target.value);if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toString();setErrors(_objectSpread({},errors));return;}setFormData(_objectSpread({},formData));validatePaymentAmounts();console.log(formData);}}),errors.cash_discount&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.cash_discount]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payments Received\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"table-responsive\",style:{maxWidth:\"900px\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",style:{alignContent:\"right\"},onClick:addNewPayment,children:\"Create new payment\"}),/*#__PURE__*/_jsxs(\"table\",{class:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsxs(\"thead\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Payment method\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]}),/*#__PURE__*/_jsxs(\"tbody\",{children:[formData.payments_input&&formData.payments_input.filter(function(payment){return!payment.deleted;}).map(function(payment,key){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{style:{minWidth:\"220px\"},children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.payments_input[key].date_str?new Date(formData.payments_input[key].date_str):null,value:formData.payments_input[key].date_str?format(new Date(formData.payments_input[key].date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.payments_input[key].date_str=value;var paymentDate=new Date(formData.payments_input[key].date_str);var orderDate=new Date(formData.date_str);var paymentYear=paymentDate.getFullYear();var paymentMonth=paymentDate.getMonth();var paymentDay=paymentDate.getDate();var paymentMinutes=paymentDate.getMinutes();var paymentHours=paymentDate.getHours();var orderYear=orderDate.getFullYear();var orderMonth=orderDate.getMonth();var orderDay=orderDate.getDate();var orderMinutes=orderDate.getMinutes();var orderHours=orderDate.getHours();if(paymentYear==orderYear&&paymentMonth==orderMonth&&paymentDay==orderDay&&paymentHours==orderHours&&paymentMinutes==orderMinutes){formData.date_str=formData.payments_input[key].date_str;}setFormData(_objectSpread({},formData));}}),errors[\"payment_date_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_date_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"300px\"},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.payments_input[key].amount,className:\"form-control \",onChange:function onChange(e){errors[\"payment_amount_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.payments_input[key].amount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.payments_input[key].amount=parseFloat(e.target.value);validatePaymentAmounts();setFormData(_objectSpread({},formData));console.log(formData);}}),errors[\"payment_amount_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_amount_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"200px\"},children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payments_input[key].method,className:\"form-control \",onChange:function onChange(e){// errors[\"payment_method\"] = [];\nerrors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));formData.payments_input[key].method=\"\";setFormData(_objectSpread({},formData));return;}// errors[\"payment_method\"] = \"\";\n//setErrors({ ...errors });\nformData.payments_input[key].method=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_account\",children:\"Bank Account / Debit / Credit Card\"}),/*#__PURE__*/_jsx(\"option\",{value:\"customer_account\",children:\"Customer Account\"})]}),errors[\"payment_method_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_method_\"+key]]})]}),/*#__PURE__*/_jsx(\"td\",{style:{width:\"200px\"},children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:function onClick(event){removePayment(key);},children:\"Remove\"})})]},key);}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{class:\"text-end\",children:/*#__PURE__*/_jsx(\"b\",{children:\"Total\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"b\",{style:{marginLeft:\"14px\"},children:(_totalPaymentAmount=totalPaymentAmount)===null||_totalPaymentAmount===void 0?void 0:_totalPaymentAmount.toFixed(2)})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"b\",{style:{marginLeft:\"12px\",alignSelf:\"end\"},children:[\"Balance: \",(_balanceAmount=balanceAmount)===null||_balanceAmount===void 0?void 0:_balanceAmount.toFixed(2)]})}),/*#__PURE__*/_jsxs(\"td\",{colSpan:1,children:[/*#__PURE__*/_jsx(\"b\",{children:\"Payment status: \"}),paymentStatus==\"paid\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success\",children:\"Paid\"}):\"\",paymentStatus==\"paid_partially\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-warning\",children:\"Paid Partially\"}):\"\",paymentStatus==\"not_paid\"?/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-danger\",children:\"Not Paid\"}):\"\"]})]})]})]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?/*#__PURE__*/_jsx(Spinner,{as:\"span\",animation:\"bsalesreturn\",size:\"sm\",role:\"status\",\"aria-hidden\":true})+\" Creating...\":formData.id?\"Update\":\"Create\"})]})]})]})]})]});});export default SalesReturnCreate;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/sales_return/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","SalesReturnPreview","Modal","Button","Form","StoreCreate","CustomerCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","SalesReturnView","ProductView","SalesReturnCreate","props","ref","open","id","orderId","errors","setErrors","formData","order_id","vat_percent","discount","discountValue","discount_percent","is_discount_percent","date_str","Date","signature_date_str","status","payment_status","payment_method","price_type","payments_input","cash_discount","cookies","get","selectedReceivedByUsers","name","received_by","setFormData","setSelectedReceivedByUsers","getSalesReturn","reCalculate","getOrder","setShow","console","log","requestOptions","method","headers","fetch","then","response","isJson","includes","json","data","ok","error","Promise","reject","salesReturn","result","code","order_code","store_id","customer_id","date","payments","i","length","products","selectedProductsTemp","selectedProducts","quantity","selected","push","setSelectedProducts","catch","setProcessing","listener","event","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","focus","preventDefault","document","addEventListener","removeEventListener","order","soldQty","quantity_returned","parseFloat","return_cash_discount","selectedStores","store_name","setSelectedStores","selectedDate","isProcessing","receivedByUserOptions","setReceivedByUserOptions","isReceivedByUsersLoading","setIsReceivedByUsersLoading","receivedBySignatureOptions","setReceivedBySignatureOptions","selectedReceivedBySignatures","setSelectedReceivedBySignatures","isReceivedBySignaturesLoading","setIsReceivedBySignaturesLoading","show","handleClose","at","window","location","ObjectToSearchQueryParams","object","Object","keys","map","key","join","suggestUsers","searchTerm","params","queryString","Authorization","Select","suggestSignatures","handleCreate","product_id","unit_price","unit","haveErrors","validatePaymentAmounts","net_total","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","totalPrice","setTotalPrice","findTotalPrice","toFixed","vatPrice","setVatPrice","findVatPrice","setNetTotal","findNetTotal","Math","round","amount","discountPercent","setDiscountPercent","findDiscount","findDiscountPercent","DetailsViewRef","current","StoreCreateFormRef","CustomerCreateFormRef","ProductCreateFormRef","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","totalPaymentAmount","setTotalPaymentAmount","balanceAmount","setBalanceAmount","paymentStatus","setPaymentStatus","findTotalPayments","totalPayment","deleted","removePayment","toString","maxAllowedAmount","addNewPayment","validatePayments","splice","color","value","overflowX","overflowY","product","e","part_number","textDecoration","cursor","width","maxWidth","alignContent","filter","payment","minWidth","paymentDate","orderDate","paymentYear","getFullYear","paymentMonth","getMonth","paymentDay","getDate","paymentMinutes","getMinutes","paymentHours","getHours","orderYear","orderMonth","orderDay","orderMinutes","orderHours","marginLeft","alignSelf"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport SalesReturnPreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport CustomerCreate from \"./../customer/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport SalesReturnView from \"./view.js\";\nimport ProductView from \"./../product/view.js\";\n\nconst SalesReturnCreate = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(id, orderId) {\n\n\n            errors={};\n            setErrors({ ...errors });\n\n            formData = {\n                order_id: orderId,\n                vat_percent: 15.0,\n                discount: 0.0,\n                discountValue: 0.0,\n                discount_percent: 0.0,\n                is_discount_percent: false,\n                //  date_str: format(new Date(), \"MMM dd yyyy\"),\n                date_str: new Date(),\n                signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n                status: \"received\",\n                payment_status: \"\",\n                payment_method: \"\",\n                price_type: \"retail\"\n            };\n            formData.payments_input = [\n                {\n                    \"date_str\": formData.date_str,\n                    // \"amount\": \"\",\n                    \"amount\": 0.00,\n                    \"method\": \"\",\n                    \"deleted\": false,\n                }\n            ];\n            formData.cash_discount = 0.00;\n            if (cookies.get(\"user_id\")) {\n                selectedReceivedByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.received_by = cookies.get(\"user_id\");\n                setFormData({ ...formData });\n                setSelectedReceivedByUsers([...selectedReceivedByUsers]);\n            }\n            setFormData({ ...formData });\n\n            if (id) {\n                getSalesReturn(id);\n            }\n\n            if (orderId) {\n                reCalculate();\n                getOrder(orderId);\n            }\n            setShow(true);\n\n        },\n\n    }));\n\n\n    function getSalesReturn(id) {\n        console.log(\"inside getSalesReturn id:\", id);\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/sales-return/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let salesReturn = data.result;\n                // formData = purchaseReturn;\n\n                formData = {\n                    id: salesReturn.id,\n                    code: salesReturn.code,\n                    order_code: salesReturn.order_code,\n                    order_id: salesReturn.order_id,\n                    store_id: salesReturn.store_id,\n                    customer_id: salesReturn.customer_id,\n                    date_str: salesReturn.date,\n                    payments_input: salesReturn.payments,\n                    cash_discount: salesReturn.cash_discount,\n                    // date: purchase.date,\n                    vat_percent: salesReturn.vat_percent,\n                    discount: salesReturn.discount,\n                    discount_percent: salesReturn.discount_percent,\n                    is_discount_percent: salesReturn.is_discount_percent,\n                    payment_status: salesReturn.payment_status,\n                    // shipping_handling_fees: salesReturn.shipping_handling_fees,\n                };\n\n                for (var i = 0; i < formData.payments_input.length; i++) {\n                    formData.payments_input[i].date_str = formData.payments_input[i].date\n                }\n\n\n                setFormData({ ...formData });\n\n                console.log(\"formData1.status:\", formData.status);\n\n\n                console.log(\"purchaseReturn.products:\", salesReturn.products);\n\n                let selectedProductsTemp = salesReturn.products;\n\n                selectedProducts = [];\n                for (let i = 0; i < selectedProductsTemp.length; i++) {\n                    if (selectedProductsTemp[i].quantity > 0) {\n                        selectedProductsTemp[i].selected = true;\n                    } else {\n                        selectedProductsTemp[i].selected = false;\n                    }\n                    selectedProducts.push(selectedProductsTemp[i]);\n\n                    //selectedProductsTemp[i].purchase_unit_price = selectedProductsTemp[i].purchasereturn_unit_price;\n                }\n\n\n                setSelectedProducts([...selectedProducts]);\n\n                setFormData({ ...formData });\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function.\");\n                // event.preventDefault();\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n    function getOrder(id) {\n        console.log(\"inside get SalesReturn\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/order/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                let order = data.result;\n\n                let selectedProductsTemp = order.products;\n                selectedProducts = [];\n                for (let i = 0; i < selectedProductsTemp.length; i++) {\n                    selectedProductsTemp[i].selected = false;\n                    let soldQty = selectedProductsTemp[i].quantity - selectedProductsTemp[i].quantity_returned;\n                    selectedProductsTemp[i].quantity = soldQty;\n\n                    if (soldQty > 0) {\n                        selectedProducts.push(selectedProductsTemp[i]);\n                    }\n                }\n\n                // selectedProducts = selectedProductsTemp\n\n                console.log(\"selectedProducts:\", selectedProducts);\n                setSelectedProducts([...selectedProducts]);\n\n\n\n                //formData = order;\n                console.log(\"order.id:\", order.id);\n                formData.id = \"\";\n                formData.products = order.products;\n                // formData.order_id = order.id;\n                //console.log(\"formData.order_id:\", formData.order_id);\n                formData.order_code = order.code;\n                formData.store_id = order.store_id;\n                /*\n                formData.received_by = order.delivered_by;\n                formData.received_by_signature_id = order.delivered_by_signature_id;\n                */\n                formData.customer_id = order.customer_id;\n\n                // formData.is_discount_percent = order.is_discount_percent;\n                formData.is_discount_percent = true;\n                console.log(\"order.discount_percent:\", order.discount_percent);\n                formData.discount_percent = order.discount_percent;\n                formData.cash_discount = parseFloat(order.cash_discount-order.return_cash_discount);\n                // formData.discount = (order.discount - order.return_discount);\n\n                // formData.discount_percent = order.discount_percent;\n\n                /*\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n                */\n\n                // setFormData({ ...formData });\n                console.log(\"formData:\", formData);\n\n\n                selectedStores = [\n                    {\n                        id: order.store_id,\n                        name: order.store_name,\n                    }\n                ];\n\n                setSelectedStores(selectedStores);\n                console.log(\"selectedStores:\", selectedStores);\n\n                setFormData({ ...formData });\n                reCalculate();\n                setFormData({ ...formData });\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    /*\n    let [barcode, setBarcode] = useState(\"\");\n    let [barcodeEnded, setBarcodeEnded] = useState(false);\n    const keyPress = useCallback(\n        (e) => {\n            console.log(\"e.key:\", e.key);\n\n            if (!barcodeEnded && e.key != \"Enter\") {\n                console.log()\n                barcode += e.key;\n                setBarcode(barcode);\n            }\n\n            if (e.key === \"Enter\") {\n                document.removeEventListener(\"keydown\", keyPress);\n                console.log(\"barcode:\", barcode);\n                barcodeEnded = true;\n                setBarcodeEnded(true);\n            }\n\n        },\n        []\n    );\n\n    function addListener() {\n        //barcode = \"\";\n        //setBarcode(barcode);\n        document.addEventListener(\"keydown\", keyPress);\n        console.log(\"Listener added, barcode:\", barcode);\n    }\n    */\n    /*\n    useEffect(() => {\n        document.addEventListener(\"keydown\", keyPress);\n        return () => document.removeEventListener(\"keydown\", keyPress);\n    }, [keyPress]);\n    */\n    /*\n    useEffect(() => {\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener(\"keydown\", handleKeyDown);\n    });\n    let [barcode, setBarcode] = useState(\"\");\n    function handleKeyDown(event) {\n        console.log(\"event.key:\", event.key);\n\n        /*\n        if (event.key == \"Enter\") {\n            barcode = \"\";\n            setBarcode(barcode);\n        }\n        else if (event.key == \"Shift\") {\n            console.log(\"barcode:\", barcode);\n        } else {\n            barcode += event.key;\n            setBarcode(barcode);\n        }\n        */\n\n    /*\n    if (event.keyCode === KEY_ESCAPE) {\n        /* do your action here */\n    // }  \n    // }\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        order_id: \"\",\n        vat_percent: 15.0,\n        discount: 0.0,\n        date_str: format(new Date(), \"MMM dd yyyy\"),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"received\",\n        payment_status: \"\",\n        payment_method: \"\",\n        price_type: \"retail\",\n    });\n\n    let [selectedStores, setSelectedStores] = useState([]);\n\n\n\n\n    //Product Auto Suggestion\n    let [selectedProducts, setSelectedProducts] = useState([]);\n\n    //Received By Auto Suggestion\n    const [receivedByUserOptions, setReceivedByUserOptions] = useState([]);\n    let [selectedReceivedByUsers, setSelectedReceivedByUsers] = useState([]);\n    const [isReceivedByUsersLoading, setIsReceivedByUsersLoading] =\n        useState(false);\n\n    //Received By Signature Auto Suggestion\n    const [receivedBySignatureOptions, setReceivedBySignatureOptions] =\n        useState([]);\n    const [selectedReceivedBySignatures, setSelectedReceivedBySignatures] =\n        useState([]);\n    const [isReceivedBySignaturesLoading, setIsReceivedBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/salesreturns\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=${object[key]}`;\n            })\n            .join(\"&\");\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setReceivedByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsReceivedByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setReceivedByUserOptions(data.result);\n        setIsReceivedByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setReceivedBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsReceivedBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setReceivedBySignatureOptions(data.result);\n        setIsReceivedBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        console.log(\"Inside handle Create\");\n        console.log(\"selectedProducts:\", selectedProducts);\n        console.log(\"formData.order_id:\", formData.order_id);\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (!selectedProducts[i].selected) {\n                continue;\n            }\n\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit_price: parseFloat(selectedProducts[i].unit_price),\n                unit: selectedProducts[i].unit,\n            });\n        }\n\n        if (!formData.cash_discount) {\n            formData.cash_discount = 0.00;\n        }\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        console.log(\"formData.discount:\", formData.discount);\n\n        let haveErrors = false;\n\n        errors[\"products\"] = \"\";\n        setErrors({ ...errors });\n\n        if (formData.products.length === 0) {\n            errors[\"products\"] = \"No products added\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!validatePaymentAmounts()) {\n            console.log(\"Errors on payments\")\n            haveErrors = true;\n        }\n\n        if (haveErrors) {\n            console.log(\"Errors: \", errors);\n            return;\n        }\n\n\n\n        /*\n        if (!formData.discountValue && formData.discountValue !== 0) {\n            errors[\"discount\"] = \"Invalid Discount\";\n            setErrors({ ...errors });\n            return;\n        }\n        */\n\n        formData.net_total = parseFloat(netTotal);\n\n\n        let endPoint = \"/v1/sales-return\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/sales-return/\" + formData.id;\n            method = \"PUT\";\n        }\n\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"SalesReturn Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n                handleClose();\n\n                openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating SalesReturn!\", \"danger\");\n            });\n    }\n\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (!selectedProducts[i].selected) {\n                continue;\n            }\n            totalPrice +=\n                parseFloat(selectedProducts[i].unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n        totalPrice = totalPrice.toFixed(2);\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    /*\n    function findVatPrice() {\n        vatPrice = ((parseFloat(formData.vat_percent) / 100) * parseFloat(totalPrice - formData.discount)).toFixed(2);;\n        console.log(\"vatPrice:\", vatPrice);\n        setVatPrice(vatPrice);\n    }*/\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            //+ parseFloat(formData.shipping_handling_fees)\n            vatPrice = (parseFloat((parseFloat(formData.vat_percent) / 100)) * (parseFloat(totalPrice) - parseFloat(formData.discount)));\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function findNetTotal() {\n        if (totalPrice > 0) {\n            netTotal = (parseFloat(totalPrice) - parseFloat(formData.discount) + parseFloat(vatPrice));\n            setNetTotal(netTotal);\n        }\n\n        netTotal = Math.round(netTotal * 100) / 100;\n        console.log(\"after rounding netTotal:\", netTotal);\n        setNetTotal(netTotal);\n\n        if (!formData.id) {\n            let method=\"\";\n            if(formData.payments_input[0]){\n              method = formData.payments_input[0].method;\n            }\n\n            formData.payments_input = [{\n                \"date_str\": formData.date_str,\n                \"amount\": 0.00,\n                \"method\": method,\n                \"deleted\": false,\n            }];\n\n            if(netTotal>0){\n                formData.payments_input[0].amount = parseFloat(netTotal.toFixed(2));\n\n                if(formData.cash_discount){\n                    formData.payments_input[0].amount =  formData.payments_input[0].amount - parseFloat(formData.cash_discount?.toFixed(2));\n                }\n                formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n                //formData.payments_input[0].amount = parseFloat(formData.payments_input[0].amount.toFixed(2));\n            }\n          \n        }\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    /*\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n    }\n    */\n\n\n\n    /*\n    function findDiscountPercent() {\n        if (!formData.discountValue) {\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            setFormData({ ...formData });\n            return;\n        }\n\n        formData.discount = formData.discountValue;\n\n        if (formData.discount > 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100).toFixed(2);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            setFormData({ ...formData });\n        }\n\n    }\n    */\n\n    /*\n    function findDiscount() {\n        if (!formData.discountValue) {\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            setFormData({ ...formData });\n            return;\n        }\n\n        formData.discount_percent = formData.discountValue;\n\n        if (formData.discount_percent > 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100)).toFixed(2);\n        }\n        setFormData({ ...formData });\n    }\n    */\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100));\n            //formData.discount = Math.round(formData.discount * 100) / 100;\n            formData.discount = parseFloat(formData.discount.toFixed(2));\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            //formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\n            setFormData({ ...formData });\n        }\n    }\n\n    function reCalculate() {\n        findTotalPrice();\n        //findDiscount();\n        //findDiscountPercent();\n\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n\n\n\n    const DetailsViewRef = useRef();\n    function openDetailsView(id) {\n        DetailsViewRef.current.open(id);\n    }\n\n    const StoreCreateFormRef = useRef();\n\n    const CustomerCreateFormRef = useRef();\n    const ProductCreateFormRef = useRef();\n\n\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n\n    let [totalPaymentAmount, setTotalPaymentAmount] = useState(0.00);\n    let [balanceAmount, setBalanceAmount] = useState(0.00);\n    let [paymentStatus, setPaymentStatus] = useState(\"\");\n\n    function findTotalPayments() {\n        let totalPayment = 0.00;\n        for (var i = 0; i < formData.payments_input?.length; i++) {\n            if (formData.payments_input[i].amount && !formData.payments_input[i].deleted) {\n                totalPayment += formData.payments_input[i].amount;\n            }\n        }\n\n        totalPaymentAmount = totalPayment;\n        setTotalPaymentAmount(totalPaymentAmount);\n       // balanceAmount = (netTotal - formData.cash_discount) - totalPayment;\n        balanceAmount = (parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount)?.toFixed(2))) - parseFloat(totalPayment.toFixed(2));\n\n        setBalanceAmount(balanceAmount);\n\n        if (parseFloat(balanceAmount.toFixed(2)) === (parseFloat(netTotal.toFixed(2)) - parseFloat(parseFloat(formData.cash_discount).toFixed(2)))) {\n            paymentStatus = \"not_paid\"\n        } else if (parseFloat(balanceAmount.toFixed(2)) === 0) {\n            paymentStatus = \"paid\"\n        } else if (parseFloat(balanceAmount.toFixed(2)) > 0) {\n            paymentStatus = \"paid_partially\"\n        }\n\n        setPaymentStatus(paymentStatus);\n\n        return totalPayment;\n    }\n\n    function validatePaymentAmounts() {\n        let haveErrors = false;\n        if (!netTotal) {\n            removePayment(0,false);\n            totalPaymentAmount=0.0;\n            setTotalPaymentAmount(0.00);\n            balanceAmount=0.00;\n            setBalanceAmount(0.00);\n            paymentStatus=\"\";\n            setPaymentStatus(paymentStatus);\n            return true;\n        }\n\n        if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n            errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toFixed(2).toString();\n            setErrors({ ...errors });\n            haveErrors = true\n            return false;\n        }\n\n        let totalPayment = findTotalPayments();\n        // errors[\"payment_date\"] = [];\n        //errors[\"payment_method\"] = [];\n        //errors[\"payment_amount\"] = [];\n        for (var key = 0; key < formData.payments_input.length; key++) {\n            errors[\"payment_amount_\" + key] = \"\";\n            errors[\"payment_date_\" + key] = \"\";\n            errors[\"payment_method_\" + key] = \"\";\n            setErrors({ ...errors });\n\n            if (!formData.payments_input[key].amount) {\n                errors[\"payment_amount_\" + key] = \"Payment amount is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if (formData.payments_input[key].amount === 0) {\n                errors[\"payment_amount_\" + key] = \"Amount should be greater than zero\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].date_str) {\n                errors[\"payment_date_\" + key] = \"Payment date is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if ((new Date(formData.payments_input[key].date_str)) < (new Date(formData.date_str))) {\n                errors[\"payment_date_\" + key] = \"Payment date time should be greater than or equal to order date time\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].method) {\n                errors[\"payment_method_\" + key] = \"Payment method is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n\n            if ((formData.payments_input[key].amount || formData.payments_input[key].amount === 0) && !formData.payments_input[key].deleted) {\n                let maxAllowedAmount = (netTotal - formData.cash_discount) - (totalPayment - formData.payments_input[key].amount);\n\n                if (maxAllowedAmount < 0) {\n                    maxAllowedAmount = 0;\n                }\n\n                \n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                \n            }\n        }\n\n        if (haveErrors) {\n            return false;\n        }\n\n        return true;\n    }\n\n    function addNewPayment() {\n        let date = new Date();\n        if (!formData.id) {\n            date = formData.date_str;\n        }\n\n        formData.payments_input.push({\n            \"date_str\": date,\n            // \"amount\": \"\",\n            \"amount\": 0.00,\n            \"method\": \"\",\n            \"deleted\": false,\n        });\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n        //validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n    }\n\n    function removePayment(key,validatePayments=false) {\n        formData.payments_input.splice(key, 1);\n        //formData.payments_input[key][\"deleted\"] = true;\n        setFormData({ ...formData });\n        if(validatePayments){\n            validatePaymentAmounts();\n        }\n    }\n\n\n    return (\n        <>\n            <SalesReturnView ref={DetailsViewRef} />\n            <ProductView ref={ProductDetailsViewRef} />\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n            <CustomerCreate ref={CustomerCreateFormRef} showToastMessage={props.showToastMessage} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} />\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n\n\n            <Modal show={show} size=\"xl\" fullscreen onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Sales Return #\" + formData.code + \" for sale #\" + formData.order_code : \"Create Sales Return\" + \" for sale #\" + formData.order_code}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <SalesReturnPreview />\n                        <Button variant=\"primary\" onClick={handleCreate} >\n                            {isProcessing ?\n                                <Spinner\n                                    as=\"span\"\n                                    animation=\"border\"\n                                    size=\"sm\"\n                                    role=\"status\"\n                                    aria-hidden={true}\n                                /> + \" Creating...\"\n\n                                : \"\"\n                            }\n                            {formData.id ? \"Update\" : \"Create\"}\n\n                        </Button>\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    {Object.keys(errors).length > 0 ?\n                        <div>\n                            <ul>\n\n                                {errors && Object.keys(errors).map((key, index) => {\n                                    return (errors[key] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                })}\n                            </ul></div> : \"\"}\n                    {selectedProducts.length > 0 && <div className=\"col-md-3\">\n                        <label className=\"form-label\">Date*</label>\n\n                        <div className=\"input-group mb-3\">\n                            <DatePicker\n                                id=\"date_str\"\n                                selected={formData.date_str ? new Date(formData.date_str) : null}\n                                value={formData.date_str ? format(\n                                    new Date(formData.date_str),\n                                    \"MMMM d, yyyy h:mm aa\"\n                                ) : null}\n                                className=\"form-control\"\n                                dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                showTimeSelect\n                                timeIntervals=\"1\"\n                                onChange={(value) => {\n                                    console.log(\"Value\", value);\n                                    formData.date_str = value;\n                                    // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                    setFormData({ ...formData });\n                                }}\n                            />\n                        </div>\n                        {errors.date_str && (\n                            <div style={{ color: \"red\" }}>\n                                <i className=\"bi bi-x-lg\"> </i>\n                                {errors.date_str}\n                            </div>\n                        )}\n                        {formData.date_str && !errors.date_str && (\n                            <div style={{ color: \"green\" }}>\n                                <i className=\"bi bi-check-lg\"> </i>\n                                Looks good!\n                            </div>\n                        )}\n                    </div>}\n\n                    {selectedProducts.length === 0 && \"Already returned all products\"}\n                    {selectedProducts.length > 0 && <form className=\"row g-3 needs-validation\" onSubmit={handleCreate}>\n                        <h2>Select Products</h2>\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", overflowY: \"scroll\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th>Select</th>\n                                        <th>SI No.</th>\n                                        <th>Part No.</th>\n                                        <th>Name</th>\n                                        <th>Qty</th>\n                                        <th>Unit Price</th>\n                                        <th>Price</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr key={index} className=\"text-center\">\n                                            <td>\n                                                <input type=\"checkbox\" checked={selectedProducts[index].selected} onChange={(e) => {\n                                                    console.log(\"e.target.value:\", e.target.value)\n                                                    selectedProducts[index].selected = !selectedProducts[index].selected;\n                                                    setSelectedProducts([...selectedProducts]);\n                                                    reCalculate();\n                                                }} />\n                                            </td>\n                                            <td>{index + 1}</td>\n                                            <td>{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n                                            }}\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                }}>{product.name}\n                                            </td>\n                                            <td style={{ width: \"155px\" }}>\n\n                                                <div class=\"input-group mb-3\">\n                                                    <input type=\"number\" value={(product.quantity)} className=\"form-control\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (parseFloat(e.target.value) === 0) {\n                                                                errors[\"quantity_\" + index] = \"Quantity should be >0\";\n                                                                selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span class=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td style={{ width: \"180px\" }}>\n                                                <div class=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.unit_price} className=\"form-control\"\n\n                                                        placeholder=\"Unit Price\" onChange={(e) => {\n                                                            errors[\"unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price\";\n                                                                selectedProducts[index].unit_price = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price should be > 0\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].unit_price:\", selectedProducts[index].unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span class=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n                                                {errors[\"unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td>\n                                                <NumberFormat\n                                                    value={(product.unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n                                        <td colSpan=\"4\"></td>\n                                        <td className=\"text-center\">\n\n                                        </td>\n                                        <th className=\"text-end\">Total</th>\n                                        <td className=\"text-end\" style={{ width: \"180px\" }}>\n                                            <NumberFormat\n                                                value={totalPrice}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n\n                                    <tr>\n                                        <th colSpan=\"6\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                            {/*\n                                            Discount(  {formData.discount_percent + \"%\"})\n                                                */}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n\n                                            {/*\n                                            <NumberFormat\n                                                value={formData.discount}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                            */}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"5\" className=\"text-end\">\n\n                                        </th>\n                                        <th className=\"text-end\"> VAT: {formData.vat_percent + \"%\"}</th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td colSpan=\"5\"></td>\n                                        <th className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n\n\n\n\n\n\n                        {/*\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Discount*</label>\n\n                            <div className=\"input-group mb-3\" >\n                                <input\n                                    value={formData.discountValue}\n                                    style={{ marginRight: \"10px\" }}\n                                    type='number'\n                                    onChange={(e) => {\n                                        if (parseFloat(e.target.value) === 0) {\n                                            formData.discountValue = parseFloat(e.target.value);\n                                            setFormData({ ...formData });\n                                            errors[\"discount\"] = \"\";\n                                            setErrors({ ...errors });\n                                            reCalculate();\n                                            return;\n                                        }\n\n                                        if (!e.target.value) {\n                                            formData.discountValue = \"\";\n                                            errors[\"discount\"] = \"Invalid Discount\";\n                                            setFormData({ ...formData });\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"discount\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.discountValue = e.target.value;\n                                        setFormData({ ...formData });\n                                        reCalculate();\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Discount\"\n                                />\n                                <Form.Check\n                                    type=\"switch\"\n                                    id=\"custom-switch\"\n                                    label=\"%\"\n                                    value={formData.is_discount_percent}\n                                    checked={formData.is_discount_percent ? \"checked\" : null}\n                                    onChange={(e) => {\n                                        formData.is_discount_percent = !formData.is_discount_percent;\n                                        console.log(\"e.target.value:\", formData.is_discount_percent);\n                                        setFormData({ ...formData });\n                                        reCalculate();\n                                    }}\n                                />\n\n                            </div>\n                            {errors.discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.discount}\n                                </div>\n                            )}\n                            {!errors.discount && (\n                                <div style={{ color: \"green\" }}>\n                                    <i className=\"bi bi-check-lg\"> </i>\n                                    Looks good!\n                                </div>\n                            )}\n                        </div>\n                            */}\n\n\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Cash discount</label>\n                            <input type='number' value={formData.cash_discount} className=\"form-control \"\n                                onChange={(e) => {\n                                    errors[\"cash_discount\"] = \"\";\n                                    setErrors({ ...errors });\n                                    if (!e.target.value) {\n                                        formData.cash_discount = e.target.value;\n                                        setFormData({ ...formData });\n                                        validatePaymentAmounts();\n                                        return;\n                                    }\n                                    formData.cash_discount = parseFloat(e.target.value);\n                                    if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n                                        errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toString();\n                                        setErrors({ ...errors });\n                                        return;\n                                    }\n\n                                    setFormData({ ...formData });\n                                    validatePaymentAmounts();\n                                    console.log(formData);\n                                }}\n                            />\n                            {errors.cash_discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.cash_discount}\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"col-md-8\">\n                            <label className=\"form-label\">Payments Received</label>\n\n                            <div class=\"table-responsive\" style={{ maxWidth: \"900px\" }}>\n                                <Button variant=\"secondary\" style={{ alignContent: \"right\" }} onClick={addNewPayment}>\n                                    Create new payment\n                                </Button>\n                                <table class=\"table table-striped table-sm table-bordered\">\n                                    <thead>\n                                        <th>\n                                            Date\n                                        </th>\n                                        <th>\n                                            Amount\n                                        </th>\n                                        <th>\n                                            Payment method\n                                        </th>\n                                        <th>\n                                            Action\n                                        </th>\n                                    </thead>\n                                    <tbody>\n                                        {formData.payments_input &&\n                                            formData.payments_input.filter(payment => !payment.deleted).map((payment, key) => (\n                                                <tr key={key}>\n                                                    <td style={{ minWidth: \"220px\" }}>\n\n                                                        <DatePicker\n                                                            id=\"date_str\"\n                                                            selected={formData.payments_input[key].date_str ? new Date(formData.payments_input[key].date_str) : null}\n                                                            value={formData.payments_input[key].date_str ? format(\n                                                                new Date(formData.payments_input[key].date_str),\n                                                                \"MMMM d, yyyy h:mm aa\"\n                                                            ) : null}\n                                                            className=\"form-control\"\n                                                            dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                                            showTimeSelect\n                                                            timeIntervals=\"1\"\n                                                            onChange={(value) => {\n                                                                console.log(\"Value\", value);\n                                                                formData.payments_input[key].date_str = value;\n                                                                let paymentDate = new Date(formData.payments_input[key].date_str)\n                                                                let orderDate = new Date(formData.date_str)\n\n\n                                                                let paymentYear = paymentDate.getFullYear();\n                                                                let paymentMonth = paymentDate.getMonth();\n                                                                let paymentDay = paymentDate.getDate();\n                                                                let paymentMinutes = paymentDate.getMinutes();\n                                                                var paymentHours = paymentDate.getHours();\n\n                                                                let orderYear = orderDate.getFullYear();\n                                                                let orderMonth = orderDate.getMonth();\n                                                                let orderDay = orderDate.getDate();\n                                                                let orderMinutes = orderDate.getMinutes();\n                                                                var orderHours = orderDate.getHours();\n\n                                                                if (paymentYear == orderYear\n                                                                    && paymentMonth == orderMonth\n                                                                    && paymentDay == orderDay\n                                                                    && paymentHours == orderHours\n                                                                    && paymentMinutes == orderMinutes) {\n                                                                    formData.date_str = formData.payments_input[key].date_str;\n\n                                                                }\n                                                                setFormData({ ...formData });\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_date_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_date_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"300px\" }}>\n                                                        <input type='number' value={formData.payments_input[key].amount} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                errors[\"payment_amount_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    formData.payments_input[key].amount = e.target.value;\n                                                                    setFormData({ ...formData });\n                                                                    validatePaymentAmounts();\n                                                                    return;\n                                                                }\n\n                                                                formData.payments_input[key].amount = parseFloat(e.target.value);\n\n                                                                validatePaymentAmounts();\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_amount_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_amount_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <select value={formData.payments_input[key].method} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                // errors[\"payment_method\"] = [];\n                                                                errors[\"payment_method_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    errors[\"payment_method_\" + key] = \"Payment method is required\";\n                                                                    setErrors({ ...errors });\n\n                                                                    formData.payments_input[key].method = \"\";\n                                                                    setFormData({ ...formData });\n                                                                    return;\n                                                                }\n\n                                                                // errors[\"payment_method\"] = \"\";\n                                                                //setErrors({ ...errors });\n\n                                                                formData.payments_input[key].method = e.target.value;\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        >\n                                                            <option value=\"\">Select</option>\n                                                            <option value=\"cash\">Cash</option>\n                                                            <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                                            <option value=\"customer_account\">Customer Account</option>\n                                                        </select>\n                                                        {errors[\"payment_method_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_method_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <Button variant=\"danger\" onClick={(event) => {\n                                                            removePayment(key);\n                                                        }}>\n                                                            Remove\n                                                        </Button>\n\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                       <tr>\n                                            <td class=\"text-end\">\n                                                <b>Total</b>\n                                            </td>\n                                            <td><b style={{ marginLeft: \"14px\" }}>{totalPaymentAmount?.toFixed(2)}</b>\n\n                                            </td>\n                                            <td>\n                                                <b style={{ marginLeft: \"12px\", alignSelf: \"end\" }}>Balance: {balanceAmount?.toFixed(2)}</b>\n                                            </td>\n                                            <td colSpan={1}>\n                                                <b>Payment status: </b> \n                                                {paymentStatus == \"paid\" ?\n                                                                <span className=\"badge bg-success\">\n                                                                    Paid\n                                                                </span> : \"\"}\n                                                            {paymentStatus == \"paid_partially\" ?\n                                                                <span className=\"badge bg-warning\">\n                                                                    Paid Partially\n                                                                </span> : \"\"}\n                                                            {paymentStatus == \"not_paid\" ?\n                                                                <span className=\"badge bg-danger\">\n                                                                    Not Paid\n                                                                </span> : \"\"}\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate} >\n                                {isProcessing ?\n                                    <Spinner\n                                        as=\"span\"\n                                        animation=\"bsalesreturn\"\n                                        size=\"sm\"\n                                        role=\"status\"\n                                        aria-hidden={true}\n                                    /> + \" Creating...\"\n\n                                    : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>}\n                </Modal.Body>\n\n            </Modal>\n\n\n        </>\n    );\n});\n\nexport default SalesReturnCreate;\n"]},"metadata":{},"sourceType":"module"}