{"ast":null,"code":"var _jsxFileName = \"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/order/print.js\",\n    _s = $RefreshSig$();\n\nimport { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport OrderPrintContent from './printContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\nimport { format } from \"date-fns\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst OrderPrint = /*#__PURE__*/forwardRef(_c = _s((props, ref) => {\n  _s();\n\n  useImperativeHandle(ref, () => ({\n    open(modelObj) {\n      if (modelObj) {\n        model = modelObj;\n        setModel({ ...model\n        });\n\n        if (model.store_id) {\n          getStore(model.store_id);\n        }\n\n        if (model.customer_id) {\n          getCustomer(model.customer_id);\n        }\n\n        if (model.delivered_by) {\n          getUser(model.delivered_by);\n        }\n\n        if (model.delivered_by_signature_id) {\n          getSignature(model.delivered_by_signature_id);\n        }\n\n        let pageSize = 15;\n        model.pageSize = pageSize;\n        let totalProducts = model.products.length;\n        let top = 0;\n        let totalPagesInt = parseInt(totalProducts / pageSize);\n        let totalPagesFloat = parseFloat(totalProducts / pageSize);\n        let totalPages = totalPagesInt;\n\n        if (totalPagesFloat - totalPagesInt > 0) {\n          totalPages++;\n        }\n\n        model.total_pages = totalPages;\n        model.pages = [];\n        let offset = 0;\n\n        for (let i = 0; i < totalPages; i++) {\n          model.pages.push({\n            top: top,\n            products: [],\n            lastPage: false\n          });\n\n          for (let j = offset; j < totalProducts; j++) {\n            model.pages[i].products.push(model.products[j]);\n\n            if (model.pages[i].products.length === pageSize) {\n              break;\n            }\n          }\n\n          top += 1066;\n          offset += pageSize;\n\n          if (i + 1 === totalPages) {\n            model.pages[i].lastPage = true;\n          }\n        }\n\n        console.log(\"model.pages:\", model.pages);\n        console.log(\"model.products:\", model.products);\n        getQRCodeContents(); //model.qr_content = getQRCodeContents();\n        //setModel({ ...model });\n\n        setShow(true);\n        console.log(\"model:\", model);\n      }\n    }\n\n  }));\n  const cookies = new Cookies();\n  let [model, setModel] = useState({});\n  const [show, setShow] = useState(props.show);\n\n  function handleClose() {\n    setShow(false);\n  }\n\n  let [qrContent, setQrContent] = useState(\"\");\n\n  function getQRCodeContents() {\n    qrContent = \"\";\n\n    if (model.code) {\n      qrContent += \"Sales Invoice #: \" + model.code + \"<br />\";\n    }\n\n    if (model.store) {\n      qrContent += \"Store: \" + model.store.name + \"<br />\";\n    }\n\n    if (model.customer) {\n      qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n    }\n\n    if (model.net_total) {\n      qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n    }\n\n    qrContent += \"Store: Test <br />\";\n    setQrContent(qrContent);\n    model.qr_content = qrContent;\n    setModel({ ...model\n    });\n    console.log(\"QR content:\", model.qr_content);\n    return model.qr_content;\n  }\n\n  function getStore(id) {\n    console.log(\"inside get Store\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/store/' + id, requestOptions).then(async response => {\n      var _response$headers$get;\n\n      const isJson = (_response$headers$get = response.headers.get('content-type')) === null || _response$headers$get === void 0 ? void 0 : _response$headers$get.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let storeData = data.result;\n      model.store = storeData;\n      var d = new Date(model.date);\n      console.log(\"d:\", d);\n      let d2 = format(new Date(d), \"yyyy-MM-dd h:m:mma\");\n      console.log(\"d2:\", d2);\n      const invoice = new Invoice({\n        sellerName: model.store_name,\n        vatRegistrationNumber: model.store.vat_no,\n        invoiceTimestamp: d2,\n        invoiceTotal: model.net_total,\n        invoiceVatTotal: model.vat_price\n      });\n      model.QRImageData = await invoice.render();\n      console.log(\"model.QRImageData:\", model.QRImageData);\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n\n  function getCustomer(id) {\n    console.log(\"inside get Customer\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/customer/' + id, requestOptions).then(async response => {\n      var _response$headers$get2;\n\n      const isJson = (_response$headers$get2 = response.headers.get('content-type')) === null || _response$headers$get2 === void 0 ? void 0 : _response$headers$get2.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let customerData = data.result;\n      model.customer = customerData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n\n  function getUser(id) {\n    console.log(\"inside get User(Delivered by)\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/user/' + id, requestOptions).then(async response => {\n      var _response$headers$get3;\n\n      const isJson = (_response$headers$get3 = response.headers.get('content-type')) === null || _response$headers$get3 === void 0 ? void 0 : _response$headers$get3.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let userData = data.result;\n      model.delivered_by_user = userData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n\n  function getSignature(id) {\n    console.log(\"inside get Signature\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/signature/' + id, requestOptions).then(async response => {\n      var _response$headers$get4;\n\n      const isJson = (_response$headers$get4 = response.headers.get('content-type')) === null || _response$headers$get4 === void 0 ? void 0 : _response$headers$get4.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let signatureData = data.result;\n      model.delivered_by_signature = signatureData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n  /*\n  function print() {\n      console.log(\"Print\");\n  }\n  */\n\n\n  const printAreaRef = useRef();\n\n  function getFileName() {\n    let filename = \"Sales_Invoice\";\n\n    if (model.id) {\n      filename += \"_#\" + model.code;\n    }\n\n    return filename;\n  }\n\n  const handlePrint = useReactToPrint({\n    content: () => printAreaRef.current,\n    documentTitle: getFileName()\n  });\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      show: show,\n      scrollable: true,\n      size: \"xl\",\n      onHide: handleClose,\n      animation: false,\n      style: {\n        overflowY: \"auto\",\n        height: \"auto\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        children: [/*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: \"Invoice Preview123\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col align-self-end text-end\",\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            className: \"btn btn-primary mb-3\",\n            onClick: handlePrint,\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-printer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 25\n            }, this), \" Print\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn-close\",\n            onClick: handleClose,\n            \"aria-label\": \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: printAreaRef,\n          children: /*#__PURE__*/_jsxDEV(OrderPrintContent, {\n            model: model\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n}, \"VzECNTOygkavqg0guOdvIcQjIBo=\", false, function () {\n  return [useImperativeHandle, useReactToPrint];\n}));\n_c2 = OrderPrint;\nexport default OrderPrint;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"OrderPrint$forwardRef\");\n$RefreshReg$(_c2, \"OrderPrint\");","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/order/print.js"],"names":["React","useState","useRef","forwardRef","useImperativeHandle","Modal","Button","OrderPrintContent","Cookies","useReactToPrint","Invoice","format","OrderPrint","props","ref","open","modelObj","model","setModel","store_id","getStore","customer_id","getCustomer","delivered_by","getUser","delivered_by_signature_id","getSignature","pageSize","totalProducts","products","length","top","totalPagesInt","parseInt","totalPagesFloat","parseFloat","totalPages","total_pages","pages","offset","i","push","lastPage","j","console","log","getQRCodeContents","setShow","cookies","show","handleClose","qrContent","setQrContent","code","store","name","customer","net_total","qr_content","id","requestOptions","method","headers","get","fetch","then","response","isJson","includes","data","json","ok","error","errors","Promise","reject","storeData","result","d","Date","date","d2","invoice","sellerName","store_name","vatRegistrationNumber","vat_no","invoiceTimestamp","invoiceTotal","invoiceVatTotal","vat_price","QRImageData","render","catch","customerData","userData","delivered_by_user","signatureData","delivered_by_signature","printAreaRef","getFileName","filename","handlePrint","content","current","documentTitle","overflowY","height"],"mappings":"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","sourcesContent":["import { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport OrderPrintContent from './printContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\nimport { format } from \"date-fns\";\n\nconst OrderPrint = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(modelObj) {\n            if (modelObj) {\n                model = modelObj;\n                setModel({ ...model })\n\n                if (model.store_id) {\n                    getStore(model.store_id);\n                }\n\n                if (model.customer_id) {\n                    getCustomer(model.customer_id);\n                }\n\n                if (model.delivered_by) {\n                    getUser(model.delivered_by);\n                }\n\n                if (model.delivered_by_signature_id) {\n                    getSignature(model.delivered_by_signature_id);\n                }\n\n                let pageSize = 15;\n                model.pageSize = pageSize;\n                let totalProducts = model.products.length;\n                let top = 0;\n                let totalPagesInt = parseInt(totalProducts / pageSize);\n                let totalPagesFloat = parseFloat(totalProducts / pageSize);\n\n                let totalPages = totalPagesInt;\n                if ((totalPagesFloat - totalPagesInt) > 0) {\n                    totalPages++;\n                }\n\n                model.total_pages = totalPages;\n\n\n                model.pages = [];\n\n\n                let offset = 0;\n\n                for (let i = 0; i < totalPages; i++) {\n                    model.pages.push({\n                        top: top,\n                        products: [],\n                        lastPage: false,\n                    });\n\n                    for (let j = offset; j < totalProducts; j++) {\n                        model.pages[i].products.push(model.products[j]);\n\n                        if (model.pages[i].products.length === pageSize) {\n                            break;\n                        }\n                    }\n\n                    top += 1066;\n                    offset += pageSize;\n                    if ((i + 1) === totalPages) {\n                        model.pages[i].lastPage = true;\n                    }\n                }\n\n                console.log(\"model.pages:\", model.pages);\n\n                console.log(\"model.products:\", model.products);\n                getQRCodeContents();\n                //model.qr_content = getQRCodeContents();\n                //setModel({ ...model });\n\n                setShow(true);\n                console.log(\"model:\", model);\n            }\n\n        },\n\n    }));\n\n    const cookies = new Cookies();\n\n    let [model, setModel] = useState({});\n\n    const [show, setShow] = useState(props.show);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n\n    let [qrContent, setQrContent] = useState(\"\");\n\n    function getQRCodeContents() {\n        qrContent = \"\";\n\n        if (model.code) {\n            qrContent += \"Sales Invoice #: \" + model.code + \"<br />\";\n        }\n\n        if (model.store) {\n            qrContent += \"Store: \" + model.store.name + \"<br />\";\n        }\n\n        if (model.customer) {\n            qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n        }\n\n\n        if (model.net_total) {\n            qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n        }\n        qrContent += \"Store: Test <br />\";\n\n        setQrContent(qrContent);\n        model.qr_content = qrContent;\n        setModel({ ...model });\n        console.log(\"QR content:\", model.qr_content);\n\n        return model.qr_content;\n    }\n\n    function getStore(id) {\n        console.log(\"inside get Store\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/store/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let storeData = data.result;\n                model.store = storeData;\n\n                var d = new Date(model.date);\n                console.log(\"d:\", d);\n\n\n                let d2 = format(\n                    new Date(d),\n                    \"yyyy-MM-dd h:m:mma\"\n                );\n                console.log(\"d2:\", d2);\n                const invoice = new Invoice({\n                    sellerName: model.store_name,\n                    vatRegistrationNumber: model.store.vat_no,\n                    invoiceTimestamp: d2,\n                    invoiceTotal: model.net_total,\n                    invoiceVatTotal: model.vat_price,\n                });\n\n                model.QRImageData = await invoice.render();\n                console.log(\"model.QRImageData:\", model.QRImageData);\n\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n\n\n    function getCustomer(id) {\n        console.log(\"inside get Customer\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/customer/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let customerData = data.result;\n                model.customer = customerData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getUser(id) {\n        console.log(\"inside get User(Delivered by)\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/user/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n\n                console.log(\"Response:\");\n                console.log(data);\n                let userData = data.result;\n                model.delivered_by_user = userData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getSignature(id) {\n        console.log(\"inside get Signature\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/signature/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let signatureData = data.result;\n                model.delivered_by_signature = signatureData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n            });\n    }\n\n\n\n    /*\n    function print() {\n        console.log(\"Print\");\n    }\n    */\n\n    const printAreaRef = useRef();\n\n    function getFileName() {\n        let filename = \"Sales_Invoice\";\n\n        if (model.id) {\n            filename += \"_#\" + model.code;\n        }\n\n        return filename;\n    }\n\n    const handlePrint = useReactToPrint({\n        content: () => printAreaRef.current,\n        documentTitle: getFileName(),\n    });\n\n\n    return (<>\n        <Modal show={show} scrollable={true} size=\"xl\" onHide={handleClose} animation={false} style={{ overflowY: \"auto\", height: \"auto\" }}>\n            <Modal.Header>\n                <Modal.Title>Invoice Preview123</Modal.Title>\n                <div className=\"col align-self-end text-end\">\n                    <Button variant=\"primary\" className=\"btn btn-primary mb-3\" onClick={handlePrint}>\n                        <i className=\"bi bi-printer\"></i> Print\n                    </Button>\n                    <button\n                        type=\"button\"\n                        className=\"btn-close\"\n                        onClick={handleClose}\n                        aria-label=\"Close\"\n                    ></button>\n\n                </div>\n\n            </Modal.Header>\n            <Modal.Body>\n                <div ref={printAreaRef} >\n                    <OrderPrintContent model={model} />\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n                {/*\n                <Button variant=\"secondary\" onClick={handleClose}>\n                    Close\n                </Button>\n                <Button variant=\"primary\" onClick={handleClose}>\n                    Save Changes\n                </Button>\n                */}\n            </Modal.Footer>\n        </Modal>\n    </>);\n\n});\n\nexport default OrderPrint;"]},"metadata":{},"sourceType":"module"}