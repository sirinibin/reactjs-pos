{"ast":null,"code":"var _jsxFileName = \"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/user/login.js\",\n    _s = $RefreshSig$();\n\nimport avatar from './../avatar.jpg';\nimport React, { useState, useEffect } from \"react\";\nimport Footer from './../Footer.js';\nimport Cookies from 'universal-cookie';\nimport { useHistory } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Login() {\n  _s();\n\n  const history = useHistory();\n  const [errors, setErrors] = useState({});\n  const [isProcessing, setProcessing] = useState(false);\n  const cookies = new Cookies();\n  useEffect(() => {\n    let at = cookies.get(\"access_token\");\n\n    if (at) {\n      // history.push(\"/dashboard/quotations\");\n      window.location = \"/dashboard/analytics\";\n    }\n  }, [cookies.get(\"user_name\")]);\n\n  function me() {\n    console.log(\"inside me\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/me', requestOptions).then(async response => {\n      var _response$headers$get;\n\n      const isJson = (_response$headers$get = response.headers.get('content-type')) === null || _response$headers$get === void 0 ? void 0 : _response$headers$get.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      console.log(\"Response:\");\n      console.log(data);\n      cookies.set('user_name', data.result.name, {\n        path: '/',\n        expires: new Date(Date.now() + 3600 * 1000 * 24 * 365)\n      });\n      cookies.set('user_id', data.result.id, {\n        path: '/',\n        expires: new Date(Date.now() + 3600 * 1000 * 24 * 365)\n      });\n\n      if (data.result.admin === true) {\n        cookies.set('admin', true, {\n          path: '/',\n          expires: new Date(Date.now() + 3600 * 1000 * 24 * 365)\n        });\n      } else {\n        cookies.set('admin', false, {\n          path: '/',\n          expires: new Date(Date.now() + 3600 * 1000 * 24 * 365)\n        });\n      }\n\n      if (data.result.photo) {\n        cookies.set('user_photo', data.result.photo, {\n          path: '/',\n          expires: new Date(Date.now() + 3600 * 1000 * 24 * 365)\n        });\n      }\n\n      history.push(\"/dashboard/analytics\");\n    }).catch(error => {\n      setProcessing(false);\n      setErrors(error);\n    });\n  }\n\n  function getAccessToken(authCode) {\n    console.log(\"inside access token\");\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': authCode\n      }\n    };\n    fetch('/v1/accesstoken', requestOptions).then(async response => {\n      var _response$headers$get2;\n\n      const isJson = (_response$headers$get2 = response.headers.get('content-type')) === null || _response$headers$get2 === void 0 ? void 0 : _response$headers$get2.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      console.log(\"Response:\");\n      console.log(data);\n      const cookies = new Cookies();\n      var d = new Date(0); // The 0 there is the key, which sets the date to the epoch\n\n      d.setUTCSeconds(data.result.expires_at);\n      cookies.set('access_token', data.result.access_token, {\n        path: '/',\n        expires: d\n      });\n      me();\n    }).catch(error => {\n      setProcessing(false);\n      setErrors(error);\n    });\n  }\n\n  function handleSubmit(event) {\n    console.log(\"Inside handle Submit\");\n    event.preventDefault();\n    var data = {\n      email: event.target[0].value,\n      password: event.target[1].value\n    };\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    };\n    setProcessing(true);\n    fetch('/v1/authorize', requestOptions).then(async response => {\n      var _response$headers$get3;\n\n      const isJson = (_response$headers$get3 = response.headers.get('content-type')) === null || _response$headers$get3 === void 0 ? void 0 : _response$headers$get3.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        // get error message from body or default to response status\n        const error = data && data.errors; //const error = data.errors\n\n        return Promise.reject(error);\n      }\n\n      setErrors({});\n      console.log(\"Response:\");\n      console.log(data);\n      getAccessToken(data.result.code);\n    }).catch(error => {\n      setProcessing(false);\n      console.log(\"Inside catch\");\n      console.log(error);\n      setErrors(error);\n      console.error('There was an error!', error);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main\",\n      children: [/*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"d-flex w-100\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container d-flex flex-column\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row vh-100\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"d-table-cell align-middle\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-center mt-4\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                    className: \"h2\",\n                    children: \"Start POS\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 166,\n                    columnNumber: 37\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"lead\",\n                    children: \"Sign in to your account to continue\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 167,\n                    columnNumber: 37\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 165,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"card\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"card-body\",\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"m-sm-4\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"text-center\",\n                        children: /*#__PURE__*/_jsxDEV(\"img\", {\n                          src: avatar,\n                          alt: \"Charles Hall\",\n                          className: \"img-fluid rounded-circle\",\n                          width: \"132\",\n                          height: \"132\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 174,\n                          columnNumber: 49\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 173,\n                        columnNumber: 45\n                      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n                        onSubmit: handleSubmit,\n                        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"mb-3\",\n                          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                            className: \"form-label\",\n                            children: \"Email\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 184,\n                            columnNumber: 53\n                          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                            className: \"form-control form-control-lg\",\n                            type: \"email\",\n                            name: \"email\",\n                            placeholder: \"Enter your email\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 185,\n                            columnNumber: 53\n                          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              color: \"red\"\n                            },\n                            children: errors.email\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 191,\n                            columnNumber: 53\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 183,\n                          columnNumber: 49\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"mb-3\",\n                          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                            className: \"form-label\",\n                            children: [\"Password \", isProcessing]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 194,\n                            columnNumber: 53\n                          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                            className: \"form-control form-control-lg\",\n                            type: \"password\",\n                            name: \"password\",\n                            placeholder: \"Enter your password\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 195,\n                            columnNumber: 53\n                          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                            style: {\n                              color: \"red\"\n                            },\n                            children: errors.password\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 201,\n                            columnNumber: 53\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 193,\n                          columnNumber: 49\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          children: /*#__PURE__*/_jsxDEV(\"label\", {\n                            className: \"form-check\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 211,\n                            columnNumber: 53\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 210,\n                          columnNumber: 49\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"text-center mt-3\",\n                          children: [isProcessing ? /*#__PURE__*/_jsxDEV(\"button\", {\n                            className: \"btn btn-lg btn-primary\",\n                            type: \"button\",\n                            disabled: true,\n                            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                              className: \"spinner-border spinner-border-sm\",\n                              role: \"status\",\n                              \"aria-hidden\": true\n                            }, void 0, false, {\n                              fileName: _jsxFileName,\n                              lineNumber: 230,\n                              columnNumber: 61\n                            }, this), \"Logging In...\"]\n                          }, void 0, true, {\n                            fileName: _jsxFileName,\n                            lineNumber: 229,\n                            columnNumber: 57\n                          }, this) : null, !isProcessing ? /*#__PURE__*/_jsxDEV(\"button\", {\n                            className: \"btn btn-lg btn-primary\",\n                            type: \"submit\",\n                            children: \"Login\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 235,\n                            columnNumber: 57\n                          }, this) : null]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 226,\n                          columnNumber: 49\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 182,\n                        columnNumber: 45\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 172,\n                      columnNumber: 41\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 171,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 170,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 164,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 13\n      }, this), \"  \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 9\n    }, this), \"   \"]\n  }, void 0, true);\n}\n\n_s(Login, \"kwyEPFeKzPbfp5Rs1ylAdowoeCQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/user/login.js"],"names":["avatar","React","useState","useEffect","Footer","Cookies","useHistory","Login","history","errors","setErrors","isProcessing","setProcessing","cookies","at","get","window","location","me","console","log","requestOptions","method","headers","fetch","then","response","isJson","includes","data","json","ok","error","Promise","reject","set","result","name","path","expires","Date","now","id","admin","photo","push","catch","getAccessToken","authCode","d","setUTCSeconds","expires_at","access_token","handleSubmit","event","preventDefault","email","target","value","password","body","JSON","stringify","code","color"],"mappings":"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","sourcesContent":["\nimport avatar from './../avatar.jpg';\nimport React, { useState, useEffect } from \"react\";\nimport Footer from './../Footer.js';\nimport Cookies from 'universal-cookie';\nimport { useHistory } from \"react-router-dom\";\n\nfunction Login() {\n\n    const history = useHistory();\n    const [errors, setErrors] = useState({});\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (at) {\n            // history.push(\"/dashboard/quotations\");\n            window.location = \"/dashboard/analytics\";\n        }\n    },[cookies.get(\"user_name\")]);\n\n\n    function me() {\n        console.log(\"inside me\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/me', requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n\n                cookies.set('user_name', data.result.name, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                cookies.set('user_id', data.result.id, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n\n                if (data.result.admin === true) {\n                    cookies.set('admin', true, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                } else {\n                    cookies.set('admin', false, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                }\n\n                if (data.result.photo) {\n                    cookies.set('user_photo', data.result.photo, { path: '/', expires: new Date(Date.now() + (3600 * 1000 * 24 * 365)) });\n                }\n\n                history.push(\"/dashboard/analytics\");\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    function getAccessToken(authCode) {\n        console.log(\"inside access token\");\n        const requestOptions = {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': authCode,\n            },\n        };\n\n        fetch('/v1/accesstoken', requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                const cookies = new Cookies();\n                var d = new Date(0); // The 0 there is the key, which sets the date to the epoch\n                d.setUTCSeconds(data.result.expires_at);\n                cookies.set('access_token', data.result.access_token, { path: '/', expires: d });\n                me();\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n\n    function handleSubmit(event) {\n        console.log(\"Inside handle Submit\");\n        event.preventDefault();\n        var data = {\n            email: event.target[0].value,\n            password: event.target[1].value,\n        };\n\n        const requestOptions = {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(data)\n        };\n\n        setProcessing(true);\n        fetch('/v1/authorize', requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = (data && data.errors);\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                getAccessToken(data.result.code);\n            })\n            .catch(error => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors(error);\n                console.error('There was an error!', error);\n            });\n\n\n    }\n\n    return (<>\n        <div className=\"main\">\n            <main className=\"d-flex w-100\" >\n\n                <div className=\"container d-flex flex-column\">\n                    <div className=\"row vh-100\">\n                        <div className=\"col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100\">\n                            <div className=\"d-table-cell align-middle\">\n                                <div className=\"text-center mt-4\">\n                                    <h1 className=\"h2\">Start POS</h1>\n                                    <p className=\"lead\">Sign in to your account to continue</p>\n                                </div>\n\n                                <div className=\"card\">\n                                    <div className=\"card-body\">\n                                        <div className=\"m-sm-4\">\n                                            <div className=\"text-center\">\n                                                <img\n                                                    src={avatar}\n                                                    alt=\"Charles Hall\"\n                                                    className=\"img-fluid rounded-circle\"\n                                                    width=\"132\"\n                                                    height=\"132\"\n                                                />\n                                            </div>\n                                            <form onSubmit={handleSubmit}>\n                                                <div className=\"mb-3\">\n                                                    <label className=\"form-label\">Email</label>\n                                                    <input\n                                                        className=\"form-control form-control-lg\"\n                                                        type=\"email\"\n                                                        name=\"email\"\n                                                        placeholder=\"Enter your email\"\n                                                    />\n                                                    <span style={{ color: \"red\" }} >{errors.email}</span>\n                                                </div>\n                                                <div className=\"mb-3\">\n                                                    <label className=\"form-label\">Password {isProcessing}</label>\n                                                    <input\n                                                        className=\"form-control form-control-lg\"\n                                                        type=\"password\"\n                                                        name=\"password\"\n                                                        placeholder=\"Enter your password\"\n                                                    />\n                                                    <span style={{ color: \"red\" }} >{errors.password}</span>\n                                                    {/*\n                                                <small>\n                                                    <a href=\"/\"\n                                                    >Forgot password?</a\n                                                    >\n                                                </small>\n                                                */}\n                                                </div>\n                                                <div>\n                                                    <label className=\"form-check\">\n                                                        {/*\n                                                    <input\n                                                        className=\"form-check-input\"\n                                                        type=\"checkbox\"\n                                                        value=\"remember-me\"\n                                                        name=\"remember-me\"\n                                                        checked\n                                                        readOnly\n                                                    />\n                                                    <span className=\"form-check-label\">\n                                                        Remember me next time\n                                                    </span> */}\n                                                    </label>\n                                                </div>\n                                                <div className=\"text-center mt-3\">\n\n                                                    {isProcessing ?\n                                                        <button className=\"btn btn-lg btn-primary\" type=\"button\" disabled>\n                                                            <span className=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden={true}></span>\n                                                            Logging In...\n                                                        </button> : null}\n\n                                                    {!isProcessing ?\n                                                        <button className=\"btn btn-lg btn-primary\" type=\"submit\">Login</button>\n                                                        : null}\n\n                                                </div>\n                                            </form>\n                                        </div>\n\n                                    </div>\n\n                                </div>\n                                <Footer />\n                            </div>\n\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </main >  </div>   </>);\n}\n\nexport default Login;"]},"metadata":{},"sourceType":"module"}