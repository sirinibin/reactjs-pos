{"ast":null,"code":"import _slicedToArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from\"react\";import OrderPreview from\"./preview.js\";import{Modal,Button,Form}from\"react-bootstrap\";import StoreCreate from\"../store/create.js\";import CustomerCreate from\"./../customer/create.js\";import ProductCreate from\"./../product/create.js\";import UserCreate from\"./../user/create.js\";import SignatureCreate from\"./../signature/create.js\";import Cookies from\"universal-cookie\";import{Typeahead}from\"react-bootstrap-typeahead\";import NumberFormat from\"react-number-format\";import DatePicker from\"react-datepicker\";import{format}from\"date-fns\";import{Spinner}from\"react-bootstrap\";import OrderView from\"./view.js\";import\"./style.css\";import{DebounceInput}from'react-debounce-input';//import BarcodeScannerComponent from \"react-qr-barcode-scanner\";\n//import Quagga from 'quagga';\nimport ProductView from\"./../product/view.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrderCreate=/*#__PURE__*/forwardRef(function(props,ref){var _totalPrice,_vatPrice,_netTotal;useImperativeHandle(ref,function(){return{open:function open(id){selectedProducts=[];setSelectedProducts([]);selectedStores=[];setSelectedStores([]);selectedCustomers=[];setSelectedCustomers([]);if(cookies.get(\"user_id\")){selectedDeliveredByUsers=[{id:cookies.get(\"user_id\"),name:cookies.get(\"user_name\")}];formData.delivered_by=cookies.get(\"user_id\");setFormData(_objectSpread({},formData));setSelectedDeliveredByUsers(_toConsumableArray(selectedDeliveredByUsers));}if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');formData.store_name=cookies.get('store_name');formData.vat_percent=parseFloat(cookies.get('vat_percent'));console.log(\"formData.store_id:\",formData.store_id);}formData.id=undefined;formData.discount=0.00;formData.discount_percent=0.00;formData.shipping_handling_fees=0.00;formData.partial_payment_amount=0.00;formData.cash_discount=0.00;formData.payment_method=\"\";formData.payment_status=\"\";formData.code=\"\";formData.net_total=0.00;formData.date_str=new Date();formData.payments_input=[{\"date_str\":formData.date_str,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false}];formData.cash_discount=0.00;if(id){getOrder(id);}setFormData(_objectSpread({},formData));reCalculate();setShow(true);}};});function getOrder(id){console.log(\"inside get Order\");var requestOptions={method:'GET',headers:{'Content-Type':'application/json','Authorization':cookies.get('access_token')}};fetch('/v1/order/'+id,requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var _response$headers$get;var isJson,data,error,i,selectedStores,searchLabel,selectedCustomers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isJson=(_response$headers$get=response.headers.get('content-type'))===null||_response$headers$get===void 0?void 0:_response$headers$get.includes('application/json');_context.t0=isJson;if(!_context.t0){_context.next=6;break;}_context.next=5;return response.json();case 5:_context.t0=_context.sent;case 6:data=_context.t0;if(response.ok){_context.next=10;break;}error=data&&data.errors;return _context.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});console.log(\"Response:\");console.log(data);formData=data.result;formData.date_str=data.result.date;if(data.result.payments){console.log(\"data.result.payments:\",data.result.payments);formData.payments_input=data.result.payments;for(i=0;i<formData.payments_input.length;i++){formData.payments_input[i].date_str=formData.payments_input[i].date;}}/*\n                let order = data.result;\n                formData = {\n                    id: order.id,\n                    code: order.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n                */if(formData.is_discount_percent){formData.discountValue=formData.discount_percent;}else{formData.discountValue=formData.discount;}selectedProducts=formData.products;setSelectedProducts(_toConsumableArray(selectedProducts));selectedStores=[{id:formData.store_id,name:formData.store_name}];searchLabel=formData.customer_name;selectedCustomers=[{id:formData.customer_id,name:formData.customer_name,search_label:searchLabel}];/*\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: formData.created_by,\n                        name: formData.created_by_name\n                    }\n                ];\n\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n                */setSelectedStores([].concat(selectedStores));setSelectedCustomers([].concat(selectedCustomers));reCalculate();setFormData(_objectSpread({},formData));case 26:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){setProcessing(false);setErrors(error);});}useEffect(function(){var listener=function listener(event){if(event.code===\"Enter\"||event.code===\"NumpadEnter\"){console.log(\"Enter key was pressed. Run your function-order.123\");// event.preventDefault();\nvar form=event.target.form;if(form&&event.target){var index=Array.prototype.indexOf.call(form,event.target);if(form&&form.elements[index+1]){if(event.target.getAttribute(\"class\").includes(\"barcode\")){form.elements[index].focus();}else{form.elements[index+1].focus();}event.preventDefault();}}}};document.addEventListener(\"keydown\",listener);return function(){document.removeEventListener(\"keydown\",listener);};},[]);var selectedDate=new Date();//const history = useHistory();\nvar _useState=useState({\"payment_amount\":[]}),_useState2=_slicedToArray(_useState,2),errors=_useState2[0],setErrors=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessing=_useState4[1];var cookies=new Cookies();//fields\nvar _useState5=useState({vat_percent:15.0,discountValue:0.00,discount:0.00,discount_percent:0.0,cash_discount:0.00,is_discount_percent:false,date_str:new Date(),signature_date_str:format(new Date(),\"MMM dd yyyy\"),status:\"delivered\",payment_status:\"\",payment_method:\"\",price_type:\"retail\",useLaserScanner:false,store_id:\"\"}),_useState6=_slicedToArray(_useState5,2),formData=_useState6[0],setFormData=_useState6[1];//Store Auto Suggestion\nvar _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),storeOptions=_useState8[0],setStoreOptions=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedStores=_useState10[0],setSelectedStores=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isStoresLoading=_useState12[0],setIsStoresLoading=_useState12[1];//Customer Auto Suggestion\nvar _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),customerOptions=_useState14[0],setCustomerOptions=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedCustomers=_useState16[0],setSelectedCustomers=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isCustomersLoading=_useState18[0],setIsCustomersLoading=_useState18[1];//Product Auto Suggestion\nvar _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),productOptions=_useState20[0],setProductOptions=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),selectedProduct=_useState22[0],setSelectedProduct=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),selectedProducts=_useState24[0],setSelectedProducts=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isProductsLoading=_useState26[0],setIsProductsLoading=_useState26[1];//Delivered By Auto Suggestion\nvar _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),deliveredByUserOptions=_useState28[0],setDeliveredByUserOptions=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),selectedDeliveredByUsers=_useState30[0],setSelectedDeliveredByUsers=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isDeliveredByUsersLoading=_useState32[0],setIsDeliveredByUsersLoading=_useState32[1];//Delivered By Signature Auto Suggestion\nvar _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),deliveredBySignatureOptions=_useState34[0],setDeliveredBySignatureOptions=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),selectedDeliveredBySignatures=_useState36[0],setSelectedDeliveredBySignatures=_useState36[1];var _useState37=useState(false),_useState38=_slicedToArray(_useState37,2),isDeliveredBySignaturesLoading=_useState38[0],setIsDeliveredBySignaturesLoading=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),show=_useState40[0],setShow=_useState40[1];function handleClose(){setShow(false);}useEffect(function(){var at=cookies.get(\"access_token\");if(!at){// history.push(\"/dashboard/orders\");\nwindow.location=\"/\";}});function ObjectToSearchQueryParams(object){return Object.keys(object).map(function(key){return\"search[\".concat(key,\"]=\")+encodeURIComponent(object[key]);}).join(\"&\");}function suggestStores(_x2){return _suggestStores.apply(this,arguments);}function _suggestStores(){_suggestStores=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(\"Inside handle suggestStores\");setStoreOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsStoresLoading(true);_context3.next=13;return fetch(\"/v1/store?\"+Select+queryString,requestOptions);case 13:result=_context3.sent;_context3.next=16;return result.json();case 16:data=_context3.sent;setStoreOptions(data.result);setIsStoresLoading(false);case 19:case\"end\":return _context3.stop();}}},_callee3);}));return _suggestStores.apply(this,arguments);}function suggestCustomers(_x3){return _suggestCustomers.apply(this,arguments);}function _suggestCustomers(){_suggestCustomers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"Inside handle suggestCustomers\");setCustomerOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";setIsCustomersLoading(true);_context4.next=13;return fetch(\"/v1/customer?\"+Select+queryString,requestOptions);case 13:result=_context4.sent;_context4.next=16;return result.json();case 16:data=_context4.sent;setCustomerOptions(data.result);setIsCustomersLoading(false);case 19:case\"end\":return _context4.stop();}}},_callee4);}));return _suggestCustomers.apply(this,arguments);}function GetProductUnitPriceInStore(storeId,productStores){if(!productStores){return\"\";}for(var i=0;i<productStores.length;i++){console.log(\"productStores[i]:\",productStores[i]);console.log(\"store_id:\",storeId);if(productStores[i].store_id===storeId){console.log(\"macthed\");console.log(\"productStores[i].retail_unit_price:\",productStores[i].retail_unit_price);return productStores[i];/*\n                if (formData.price_type === \"retail\") {\n                    return unitPriceListArray[i].retail_unit_price;\n                } else if (formData.price_type === \"wholesale\") {\n                    return unitPriceListArray[i].wholesale_unit_price;\n                } else if (formData.price_type === \"purchase\") {\n                    return unitPriceListArray[i].purchase_unit_price;\n                }\n                */}else{console.log(\"not matched\");}}return\"\";}var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),openProductSearchResult=_useState42[0],setOpenProductSearchResult=_useState42[1];function suggestProducts(_x4){return _suggestProducts.apply(this,arguments);}function _suggestProducts(){_suggestProducts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(searchTerm){var params,queryString,requestOptions,Select,result,data,products;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"Inside handle suggestProducts\");setProductOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context5.next=7;break;}openProductSearchResult=false;setOpenProductSearchResult(false);return _context5.abrupt(\"return\");case 7:params={name:searchTerm};if(cookies.get(\"store_id\")){params.store_id=cookies.get(\"store_id\");}queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,part_number,name,unit,part_number,name_in_arabic,product_stores\";setIsProductsLoading(true);_context5.next=16;return fetch(\"/v1/product?\"+Select+queryString+\"&limit=200\",requestOptions);case 16:result=_context5.sent;_context5.next=19;return result.json();case 19:data=_context5.sent;products=data.result;if(!(!products||products.length===0)){_context5.next=26;break;}openProductSearchResult=false;setOpenProductSearchResult(false);setIsProductsLoading(false);return _context5.abrupt(\"return\");case 26:openProductSearchResult=true;setOpenProductSearchResult(true);setProductOptions(products);setIsProductsLoading(false);case 30:case\"end\":return _context5.stop();}}},_callee5);}));return _suggestProducts.apply(this,arguments);}function getProductByBarCode(_x5){return _getProductByBarCode.apply(this,arguments);}function _getProductByBarCode(){_getProductByBarCode=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(barcode){var requestOptions,Select,result,data,product;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:formData.barcode=barcode;setFormData(_objectSpread({},formData));console.log(\"Inside getProductByBarCode\");errors[\"bar_code\"]=\"\";setErrors(_objectSpread({},errors));console.log(\"barcode:\"+formData.barcode);if(formData.barcode){_context6.next=8;break;}return _context6.abrupt(\"return\");case 8:if(formData.barcode.length===13){formData.barcode=formData.barcode.slice(0,-1);}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,item_code,bar_code,ean_12,part_number,name,product_stores,unit,part_number,name_in_arabic\";_context6.next=13;return fetch(\"/v1/product/barcode/\"+formData.barcode+\"?\"+Select,requestOptions);case 13:result=_context6.sent;_context6.next=16;return result.json();case 16:data=_context6.sent;product=data.result;if(product){addProduct(product);}else{errors[\"bar_code\"]=\"Invalid Barcode:\"+formData.barcode;setErrors(_objectSpread({},errors));}formData.barcode=\"\";setFormData(_objectSpread({},formData));case 21:case\"end\":return _context6.stop();}}},_callee6);}));return _getProductByBarCode.apply(this,arguments);}function suggestUsers(_x6){return _suggestUsers.apply(this,arguments);}function _suggestUsers(){_suggestUsers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:console.log(\"Inside handle suggestUsers\");setDeliveredByUserOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context7.next=5;break;}return _context7.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsDeliveredByUsersLoading(true);_context7.next=13;return fetch(\"/v1/user?\"+Select+queryString,requestOptions);case 13:result=_context7.sent;_context7.next=16;return result.json();case 16:data=_context7.sent;setDeliveredByUserOptions(data.result);setIsDeliveredByUsersLoading(false);case 19:case\"end\":return _context7.stop();}}},_callee7);}));return _suggestUsers.apply(this,arguments);}function suggestSignatures(_x7){return _suggestSignatures.apply(this,arguments);}function _suggestSignatures(){_suggestSignatures=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(searchTerm){var params,queryString,requestOptions,Select,result,data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(\"Inside handle suggestSignatures\");setDeliveredBySignatureOptions([]);console.log(\"searchTerm:\"+searchTerm);if(searchTerm){_context8.next=5;break;}return _context8.abrupt(\"return\");case 5:params={name:searchTerm};queryString=ObjectToSearchQueryParams(params);if(queryString!==\"\"){queryString=\"&\"+queryString;}requestOptions={method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")}};Select=\"select=id,name\";setIsDeliveredBySignaturesLoading(true);_context8.next=13;return fetch(\"/v1/signature?\"+Select+queryString,requestOptions);case 13:result=_context8.sent;_context8.next=16;return result.json();case 16:data=_context8.sent;setDeliveredBySignatureOptions(data.result);setIsDeliveredBySignaturesLoading(false);case 19:case\"end\":return _context8.stop();}}},_callee8);}));return _suggestSignatures.apply(this,arguments);}function handleCreate(event){event.preventDefault();var haveErrors=false;if(!formData.cash_discount){formData.cash_discount=0.00;}formData.products=[];for(var i=0;i<selectedProducts.length;i++){formData.products.push({product_id:selectedProducts[i].product_id,quantity:parseFloat(selectedProducts[i].quantity),unit_price:parseFloat(selectedProducts[i].unit_price),unit:selectedProducts[i].unit});}errors[\"products\"]=\"\";setErrors(_objectSpread({},errors));if(formData.products.length===0){errors[\"products\"]=\"No products added\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!validatePaymentAmounts()){console.log(\"Errors on payments\");haveErrors=true;}if(!formData.shipping_handling_fees&&formData.shipping_handling_fees!==0){errors[\"shipping_handling_fees\"]=\"Invalid shipping / handling fees\";setErrors(_objectSpread({},errors));haveErrors=true;}/*\n        if (formData.payment_status === \"paid_partially\" && !formData.partial_payment_amount && formData.partial_payment_amount !== 0) {\n            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount <= 0) {\n            errors[\"partial_payment_amount\"] = \"Partial payment should be > 0 \";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.id && formData.payment_status === \"paid_partially\" && formData.partial_payment_amount >= netTotal) {\n            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n            setErrors({ ...errors });\n            return;\n        }\n        \n\n        errors[\"payment_method\"] = \"\";\n        setErrors({ ...errors });\n        if (!formData.id && formData.payment_status != \"not_paid\" && !formData.payment_method) {\n            errors[\"payment_method\"] = \"Payment method is required\";\n            setErrors({ ...errors });\n            return;\n        }\n        */if(!formData.discount&&formData.discount!==0){errors[\"discount\"]=\"Invalid discount\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.discount_percent&&formData.discount_percent!==0){errors[\"discount_percent\"]=\"Invalid discount percent\";setErrors(_objectSpread({},errors));haveErrors=true;}if(parseFloat(formData.discount_percent)>100){errors[\"discount_percent\"]=\"Discount percent cannot be > 100\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.vat_percent&&formData.vat_percent!==0){errors[\"vat_percent\"]=\"Invalid vat percent\";setErrors(_objectSpread({},errors));haveErrors=true;}if(haveErrors){console.log(\"Errors: \",errors);return;}formData.discount=parseFloat(formData.discount);formData.discount_percent=parseFloat(formData.discount_percent);formData.vat_percent=parseFloat(formData.vat_percent);formData.partial_payment_amount=parseFloat(formData.partial_payment_amount);formData.net_total=parseFloat(netTotal);if(cookies.get('store_id')){formData.store_id=cookies.get('store_id');}var endPoint=\"/v1/order\";var method=\"POST\";if(formData.id){endPoint=\"/v1/order/\"+formData.id;method=\"PUT\";}var requestOptions={method:method,headers:{'Accept':'application/json',\"Content-Type\":\"application/json\",Authorization:cookies.get(\"access_token\")},body:JSON.stringify(formData)};console.log(\"formData:\",formData);setProcessing(true);fetch(endPoint,requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var _response$headers$get2;var isJson,data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isJson=(_response$headers$get2=response.headers.get(\"content-type\"))===null||_response$headers$get2===void 0?void 0:_response$headers$get2.includes(\"application/json\");_context2.t0=isJson;if(!_context2.t0){_context2.next=6;break;}_context2.next=5;return response.json();case 5:_context2.t0=_context2.sent;case 6:data=_context2.t0;if(response.ok){_context2.next=10;break;}// get error message from body or default to response status\nerror=data&&data.errors;//const error = data.errors\nreturn _context2.abrupt(\"return\",Promise.reject(error));case 10:setErrors({});setProcessing(false);console.log(\"Response:\");console.log(data);props.showToastMessage(\"Order Created Successfully!\",\"success\");if(props.refreshList){props.refreshList();}handleClose();formData.products=[];selectedProducts=[];setSelectedProducts([]);formData.customer_id=\"\";setSelectedCustomers([]);setFormData(_objectSpread({},formData));reCalculate();openDetailsView(data.result.id);case 25:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x8){return _ref2.apply(this,arguments);};}()).catch(function(error){setProcessing(false);console.log(\"Inside catch\");console.log(error);setErrors(_objectSpread({},error));console.error(\"There was an error!\",error);props.showToastMessage(\"Error Creating Order!\",\"danger\");});}function getProductIndex(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return i;}}return false;}function isProductAdded(productID){for(var i=0;i<selectedProducts.length;i++){if(selectedProducts[i].product_id===productID){return true;}}return false;}function GetProductStockInStore(storeId,productStores){if(!productStores){return 0.0;}for(var i=0;i<productStores.length;i++){if(productStores[i].store_id===storeId){return productStores[i].stock;}}return 0.0;}function addProduct(product){console.log(\"Inside Add product\");if(!formData.store_id){errors.product_id=\"Please Select a Store and try again\";setErrors(_objectSpread({},errors));return;}errors.product_id=\"\";if(!product){errors.product_id=\"Invalid Product\";setErrors(_objectSpread({},errors));return;}/*\n        let productStore = GetProductUnitPriceInStore(\n            formData.store_id,\n            product.stores\n        );\n        */ // product.unit_price = productStore.retail_unit_price;\nif(product.product_stores[formData.store_id]){product.unit_price=product.product_stores[formData.store_id].retail_unit_price;}errors.unit_price=\"\";if(!product.unit_price){errors.unit_price=\"Invalid Unit Price\";setErrors(_objectSpread({},errors));return;}var alreadyAdded=false;var index=false;var quantity=0.00;product.quantity=1.00;if(isProductAdded(product.id)){alreadyAdded=true;index=getProductIndex(product.id);quantity=parseFloat(selectedProducts[index].quantity+product.quantity);}else{quantity=parseFloat(product.quantity);}console.log(\"quantity:\",quantity);errors.quantity=\"\";//let stock = GetProductStockInStore(formData.store_id, product.stores);\nvar stock=0;if(product.product_stores[formData.store_id]){stock=product.product_stores[formData.store_id].stock;}if(stock<quantity){if(index===false){index=selectedProducts.length;}// errors[\"quantity_\" + index] = \"Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for product: \" + product.name;\nerrors[\"quantity_\"+index]=\"Warning: Available stock is \"+stock;console.log(\"errors:\",errors);setErrors(_objectSpread({},errors));}if(alreadyAdded){selectedProducts[index].quantity=parseFloat(quantity);}if(!alreadyAdded){selectedProducts.push({product_id:product.id,code:product.item_code,part_number:product.part_number,name:product.name,quantity:product.quantity,product_stores:product.product_stores,unit_price:parseFloat(product.unit_price).toFixed(2),unit:product.unit});}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}function removeProduct(product){var index=selectedProducts.indexOf(product);if(index>-1){selectedProducts.splice(index,1);}setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}var _useState43=useState(0.0),_useState44=_slicedToArray(_useState43,2),totalPrice=_useState44[0],setTotalPrice=_useState44[1];function findTotalPrice(){totalPrice=0.00;for(var i=0;i<selectedProducts.length;i++){totalPrice+=parseFloat(selectedProducts[i].unit_price)*parseFloat(selectedProducts[i].quantity);}// totalPrice = totalPrice.toFixed(2);\n// totalPrice = Math.round(totalPrice * 100) / 100;\nsetTotalPrice(totalPrice);}var _useState45=useState(0.00),_useState46=_slicedToArray(_useState45,2),vatPrice=_useState46[0],setVatPrice=_useState46[1];function findVatPrice(){vatPrice=0.00;if(totalPrice>0){console.log(\"formData.vat_percent:\",formData.vat_percent);//(35.8 / 100) * 10000;\nvatPrice=parseFloat(formData.vat_percent)/100*(parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount));console.log(\"vatPrice:\",vatPrice);}setVatPrice(vatPrice);}var _useState47=useState(0.00),_useState48=_slicedToArray(_useState47,2),netTotal=_useState48[0],setNetTotal=_useState48[1];function RoundFloat(val,precision){var ratio=Math.pow(10,precision);return Math.round(val*ratio)/ratio;}function findNetTotal(){netTotal=0.00;if(totalPrice>0){console.log(\"totalPrice:\",totalPrice);console.log(\"formData.discount:\",formData.discount);console.log(\"vatPrice:\",vatPrice);netTotal=parseFloat(totalPrice)+parseFloat(formData.shipping_handling_fees)-parseFloat(formData.discount)+parseFloat(vatPrice);netTotal=parseFloat(netTotal);}console.log(\"before rounding netTotal:\",netTotal);// netTotal = RoundFloat(netTotal,2);\n// netTotal = Math.round(netTotal * 100) / 100;\nconsole.log(\"after rounding netTotal:\",netTotal);setNetTotal(netTotal);if(!formData.id){formData.payments_input=[{\"date_str\":formData.date_str,\"amount\":0.00,\"method\":\"\",\"deleted\":false}];formData.payments_input[0].amount=parseFloat(netTotal);}/*\n        if (formData.payments_input[0].amount === 0) {\n            formData.payments_input[0].amount = \"\";\n        }\n        */setFormData(_objectSpread({},formData));validatePaymentAmounts();}var _useState49=useState(0.00),_useState50=_slicedToArray(_useState49,2),discountPercent=_useState50[0],setDiscountPercent=_useState50[1];function findDiscountPercent(){if(formData.discount>=0&&totalPrice>0){discountPercent=parseFloat(parseFloat(formData.discount/totalPrice)*100);setDiscountPercent(discountPercent);formData.discount_percent=discountPercent;//formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\nsetFormData(_objectSpread({},formData));}}function findDiscount(){if(formData.discount_percent>=0&&totalPrice>0){formData.discount=parseFloat(totalPrice*parseFloat(formData.discount_percent/100));// formData.discount = parseFloat(formData.discount.toFixed(2));\nsetFormData(_objectSpread({},formData));}}function reCalculate(){findTotalPrice();if(formData.is_discount_percent){findDiscount();}else{findDiscountPercent();}findVatPrice();findNetTotal();}var DetailsViewRef=useRef();function openDetailsView(id){DetailsViewRef.current.open(id);}var StoreCreateFormRef=useRef();function openStoreCreateForm(){StoreCreateFormRef.current.open();}var CustomerCreateFormRef=useRef();function openCustomerCreateForm(){CustomerCreateFormRef.current.open();}var ProductCreateFormRef=useRef();function openProductCreateForm(){ProductCreateFormRef.current.open();}var UserCreateFormRef=useRef();function openUserCreateForm(){UserCreateFormRef.current.open();}var SignatureCreateFormRef=useRef();function openSignatureCreateForm(){SignatureCreateFormRef.current.open();}var ProductDetailsViewRef=useRef();function openProductDetailsView(id){ProductDetailsViewRef.current.open(id);}function addNewPayment(){var date=new Date();if(!formData.id){date=formData.date_str;}formData.payments_input.push({\"date_str\":date,// \"amount\": \"\",\n\"amount\":0.00,\"method\":\"\",\"deleted\":false});setFormData(_objectSpread({},formData));validatePaymentAmounts();//validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n}function getTotalPayments(){var totalPayment=0.00;for(var i=0;i<((_formData$payments_in=formData.payments_input)===null||_formData$payments_in===void 0?void 0:_formData$payments_in.length);i++){var _formData$payments_in;if(formData.payments_input[i].amount&&!formData.payments_input[i].deleted){totalPayment+=formData.payments_input[i].amount;}}return totalPayment;}function removePayment(key){formData.payments_input.splice(key,1);//formData.payments_input[key][\"deleted\"] = true;\nsetFormData(_objectSpread({},formData));validatePaymentAmounts();}function validatePaymentAmounts(){console.log(\"validatePaymentAmount: netTotal:\",netTotal);var haveErrors=false;if(!netTotal){return true;}if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toFixed(2).toString();setErrors(_objectSpread({},errors));haveErrors=true;return false;}var totalPayment=getTotalPayments();// errors[\"payment_date\"] = [];\n//errors[\"payment_method\"] = [];\n//errors[\"payment_amount\"] = [];\nfor(var key=0;key<formData.payments_input.length;key++){errors[\"payment_amount_\"+key]=\"\";errors[\"payment_date_\"+key]=\"\";errors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!formData.payments_input[key].amount){errors[\"payment_amount_\"+key]=\"Payment amount is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(formData.payments_input[key].amount===0){errors[\"payment_amount_\"+key]=\"Amount should be greater than zero\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].date_str){errors[\"payment_date_\"+key]=\"Payment date is required\";setErrors(_objectSpread({},errors));haveErrors=true;}else if(new Date(formData.payments_input[key].date_str)<new Date(formData.date_str)){errors[\"payment_date_\"+key]=\"Payment date time should be greater than or equal to order date time\";setErrors(_objectSpread({},errors));haveErrors=true;}if(!formData.payments_input[key].method){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));haveErrors=true;}if((formData.payments_input[key].amount||formData.payments_input[key].amount===0)&&!formData.payments_input[key].deleted){var maxAllowedAmount=netTotal-formData.cash_discount-(totalPayment-formData.payments_input[key].amount);if(maxAllowedAmount<0){maxAllowedAmount=0;}/*\n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                */}}if(haveErrors){return false;}return true;}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(OrderView,{ref:DetailsViewRef,openCreateForm:props.openCreateForm}),/*#__PURE__*/_jsx(ProductView,{ref:ProductDetailsViewRef}),/*#__PURE__*/_jsx(StoreCreate,{ref:StoreCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(CustomerCreate,{ref:CustomerCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(ProductCreate,{ref:ProductCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(UserCreate,{ref:UserCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsx(SignatureCreate,{ref:SignatureCreateFormRef,showToastMessage:props.showToastMessage}),/*#__PURE__*/_jsxs(Modal,{show:show,size:\"xl\",fullscreen:true,onHide:handleClose,animation:false,backdrop:\"static\",scrollable:true,children:[/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Modal.Title,{children:formData.id?\"Update Sales Order #\"+formData.code:\"Create New Sales Order\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"col align-self-end text-end\",children:[/*#__PURE__*/_jsx(OrderPreview,{}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?formData.id?\"Updating....\":\"Creating..\":formData.id?\"Update\":\"Create\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:handleClose,\"aria-label\":\"Close\"})]})]}),/*#__PURE__*/_jsxs(Modal.Body,{children:[Object.keys(errors).length>0?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"ul\",{children:errors&&Object.keys(errors).map(function(key,index){if(Array.isArray(errors[key])){return errors[key][0]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";}else{return errors[key]?/*#__PURE__*/_jsx(\"li\",{style:{color:\"red\"},children:errors[key]}):\"\";}})})}):\"\",/*#__PURE__*/_jsxs(\"form\",{className:\"row g-3 needs-validation\",onSubmit:function onSubmit(e){e.preventDefault();handleCreate(e);},children:[!cookies.get('store_name')?/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Store*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(Typeahead,{id:\"store_id\",labelKey:\"name\",isLoading:isStoresLoading,isInvalid:errors.store_id?true:false,onChange:function onChange(selectedItems){errors.store_id=\"\";errors[\"product_id\"]=\"\";setErrors(errors);if(selectedItems.length===0){errors.store_id=\"Invalid Store selected\";setErrors(errors);setFormData(_objectSpread({},formData));setSelectedStores([]);return;}formData.store_id=selectedItems[0].id;setFormData(_objectSpread({},formData));console.log(\"formData.store_id:\",formData.store_id);selectedStores=selectedItems;setSelectedStores(_toConsumableArray(selectedItems));if(formData.store_id){if(selectedProduct[0]&&selectedProduct[0].product_stores&&selectedProduct[0].quantity){var stock=0;if(selectedProduct[0].product_stores){//stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\nif(selectedProduct[0].product_stores[formData.store_id]){stock=selectedProduct[0].product_stores[formData.store_id].stock;}}if(stock<parseFloat(selectedProduct[0].quantity)){if(selectedStores[0]){errors.product_id=\"Stock is only \"+stock+\" in Store: \"+selectedStores[0].name+\" for this product\";}else{errors.product_id=\"Stock is only \"+stock+\" in Selected Store for this product\";}setErrors(_objectSpread({},errors));}}else if(selectedProduct[0]&&selectedProduct[0].product_stores){var _stock=0;//stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\nif(selectedProduct[0].product_stores[formData.store_id]){_stock=selectedProduct[0].product_stores[formData.store_id].stock;}if(_stock===0){if(selectedStores[0]){errors[\"product_id\"]=\"This product is not available in store: \"+selectedStores[0].name;}else{errors[\"product_id\"]=\"This product is not available in selected store.\";}setErrors(_objectSpread({},errors));}}if(selectedProduct[0]){/*\n                                                selectedProduct[0].unit_price = GetProductUnitPriceInStore(\n                                                    formData.store_id,\n                                                    selectedProduct[0].stores\n                                                );\n                                                */if(selectedProduct[0].product_stores[formData.store_id]){selectedProduct[0].unit_price=selectedProduct[0].product_stores[formData.store_id].retail_unit_price;}if(!selectedProduct[0].quantity){selectedProduct[0].quantity=1;}setSelectedProduct(_toConsumableArray(selectedProduct));}}},options:storeOptions,placeholder:\"Select Store\",selected:selectedStores,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestStores(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openStoreCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi x-lg\",children:\" \"}),errors.store_id]})]})]}):\"\",/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",style:{border:\"solid 0px\"},children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Customer*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"customer_id\",labelKey:\"search_label\",isLoading:isCustomersLoading,isInvalid:errors.customer_id?true:false,onChange:function onChange(selectedItems){errors.customer_id=\"\";setErrors(errors);if(selectedItems.length===0){errors.customer_id=\"Invalid Customer selected\";setErrors(errors);formData.customer_id=\"\";setFormData(_objectSpread({},formData));setSelectedCustomers([]);return;}formData.customer_id=selectedItems[0].id;setFormData(_objectSpread({},formData));setSelectedCustomers(selectedItems);},options:customerOptions,placeholder:\"Type name or mob\",selected:selectedCustomers,highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestCustomers(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openCustomerCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.customer_id&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.customer_id]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product Barcode Scan\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DebounceInput,{minLength:3,debounceTimeout:100,placeholder:\"Scan Barcode\",className:\"form-control barcode\",value:formData.barcode,onChange:function onChange(event){return getProductByBarCode(event.target.value);}}),errors.bar_code&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.bar_code]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Date*\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.date_str?new Date(formData.date_str):null,value:formData.date_str?format(new Date(formData.date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.date_str=value;// formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\nsetFormData(_objectSpread({},formData));}}),errors.date_str&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.date_str]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Product Search*\"}),/*#__PURE__*/_jsx(Typeahead,{id:\"product_id\",size:\"lg\",labelKey:\"search_label\",emptyLabel:\"\",clearButton:true,open:openProductSearchResult,isLoading:isProductsLoading,isInvalid:errors.product_id?true:false,onChange:function onChange(selectedItems){if(selectedItems.length===0){errors[\"product_id\"]=\"Invalid Product selected\";setErrors(errors);return;}errors[\"product_id\"]=\"\";setErrors(_objectSpread({},errors));if(formData.store_id){addProduct(selectedItems[0]);}setOpenProductSearchResult(false);},options:productOptions,selected:selectedProduct,placeholder:\"Search By Part No. / Name / Name in Arabic\",highlightOnlyResult:true,onInputChange:function onInputChange(searchTerm,e){suggestProducts(searchTerm);}}),/*#__PURE__*/_jsxs(Button,{hide:true.toString(),onClick:openProductCreateForm,className:\"btn btn-outline-secondary btn-primary btn-sm\",type:\"button\",id:\"button-addon1\",children:[\" \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-lg\"}),\" New\"]}),errors.product_id?/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.product_id]}):\"\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{overflowX:\"auto\",maxHeight:\"400px\",overflowY:\"auto\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"th\",{style:{width:\"3%\"},children:\"Remove\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"5%\"},children:\"SI No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"10%\"},children:\"Part No.\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"30%\"},className:\"text-start\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"15%\"},children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"18%\"},children:\"Unit Price\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:\"32%\"},children:\"Price\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:selectedProducts.map(function(product,index){return/*#__PURE__*/_jsxs(\"tr\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\",cursor:\"pointer\"},onClick:function onClick(){removeProduct(product);},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"})})}),/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{children:product.part_number}),/*#__PURE__*/_jsx(\"td\",{style:{textDecoration:\"underline\",color:\"blue\",cursor:\"pointer\"},className:\"text-start\",onClick:function onClick(){openProductDetailsView(product.product_id);},children:product.name}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.quantity,className:\"form-control text-end\",placeholder:\"Quantity\",onChange:function onChange(e){errors[\"quantity_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"quantity_\"+index]=\"Invalid Quantity\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"quantity_\"+index]=\"Quantity should be > 0\";selectedProducts[index].quantity=e.target.value;setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}product.quantity=parseFloat(e.target.value);selectedProducts[index].quantity=parseFloat(e.target.value);reCalculate();var stock=0;if(selectedProducts[index].product_stores){var _selectedProducts$ind;stock=(_selectedProducts$ind=selectedProducts[index].product_stores[formData.store_id])===null||_selectedProducts$ind===void 0?void 0:_selectedProducts$ind.stock;// stock = GetProductStockInStore(formData.store_id, selectedProducts[index].stores);\n}if(stock<parseFloat(e.target.value)&&selectedProducts[index].product_stores){// errors[\"quantity_\" + index] = \" Warning: Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for this product\";\nerrors[\"quantity_\"+index]=\" Warning: Available stock is \"+stock;setErrors(_objectSpread({},errors));return;}selectedProducts[index].quantity=parseFloat(e.target.value);console.log(\"selectedProducts[index].quantity:\",selectedProducts[index].quantity);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:selectedProducts[index].unit?selectedProducts[index].unit:\"Units\"})]}),errors[\"quantity_\"+index]&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors[\"quantity_\"+index]})]}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group mb-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:product.unit_price,className:\"form-control text-end\",placeholder:\"Unit Price\",onChange:function onChange(e){errors[\"unit_price_\"+index]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"unit_price_\"+index]=\"Invalid Unit Price\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}if(e.target.value===0){errors[\"unit_price_\"+index]=\"Unit Price should be > 0\";selectedProducts[index].unit_price=parseFloat(e.target.value);setSelectedProducts(_toConsumableArray(selectedProducts));setErrors(_objectSpread({},errors));console.log(\"errors:\",errors);return;}selectedProducts[index].unit_price=parseFloat(e.target.value);console.log(\"selectedProducts[index].unit_price:\",selectedProducts[index].unit_price);setSelectedProducts(_toConsumableArray(selectedProducts));reCalculate();}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-text\",id:\"basic-addon2\",children:\"SAR\"})]}),errors[\"unit_price_\"+index]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"unit_price_\"+index]]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(product.unit_price*product.quantity).toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]},index);}).reverse()})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsx(\"table\",{className:\"table table-striped table-sm table-bordered\",children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Total\"}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",style:{width:\"200px\"},children:/*#__PURE__*/_jsx(NumberFormat,{value:(_totalPrice=totalPrice)===null||_totalPrice===void 0?void 0:_totalPrice.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Shipping & Handling Fees\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.shipping_handling_fees,onChange:function onChange(e){if(parseFloat(e.target.value)===0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"shipping_handling_fees\"]=\"Shipping / Handling Fees should be > 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.shipping_handling_fees=\"\";errors[\"shipping_handling_fees\"]=\"Invalid Shipping / Handling Fees\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"shipping_handling_fees\"]=\"\";setErrors(_objectSpread({},errors));formData.shipping_handling_fees=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.shipping_handling_fees&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.shipping_handling_fees})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\"Discount  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"50px\"},className:\"text-start\",value:formData.discount_percent,onChange:function onChange(e){formData.is_discount_percent=true;if(parseFloat(e.target.value)===0){formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount_percent=parseFloat(e.target.value);formData.discount=0.00;setFormData(_objectSpread({},formData));errors[\"discount_percent\"]=\"Discount percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount_percent=\"\";formData.discount=0.00;errors[\"discount_percent\"]=\"Invalid Discount Percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"discount_percent\"]=\"\";errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));formData.discount_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\"%\",errors.discount_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount_percent})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"text-end\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:\"150px\"},className:\"text-start\",value:formData.discount,onChange:function onChange(e){formData.is_discount_percent=false;if(parseFloat(e.target.value)===0){formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"discount\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.discount=parseFloat(e.target.value);formData.discount_percent=0.00;setFormData(_objectSpread({},formData));errors[\"discount\"]=\"Discount should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.discount=\"\";formData.discount_percent=0.00;errors[\"discount\"]=\"Invalid Discount\";setFormData(_objectSpread({},formData));reCalculate();setErrors(_objectSpread({},errors));return;}errors[\"discount\"]=\"\";errors[\"discount_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.discount=parseFloat(e.target.value);setFormData(_objectSpread({},formData));reCalculate();}}),\" SAR\",errors.discount&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.discount})]})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{colSpan:\"8\",className:\"text-end\",children:[\" VAT  \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"text-center\",style:{width:\"50px\"},value:formData.vat_percent,onChange:function onChange(e){console.log(\"Inside onchange vat percent\");if(parseFloat(e.target.value)===0){formData.vat_percent=parseFloat(e.target.value);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));reCalculate();return;}if(parseFloat(e.target.value)<0){formData.vat_percent=parseFloat(e.target.value);vatPrice=0.00;setVatPrice(vatPrice);setFormData(_objectSpread({},formData));errors[\"vat_percent\"]=\"Vat percent should be >= 0\";setErrors(_objectSpread({},errors));reCalculate();return;}if(!e.target.value){formData.vat_percent=\"\";vatPrice=0.00;setVatPrice(vatPrice);//formData.discount_percent = 0.00;\nerrors[\"vat_percent\"]=\"Invalid vat percent\";setFormData(_objectSpread({},formData));setErrors(_objectSpread({},errors));return;}errors[\"vat_percent\"]=\"\";setErrors(_objectSpread({},errors));formData.vat_percent=e.target.value;reCalculate();setFormData(_objectSpread({},formData));console.log(formData);}}),\"%\",errors.vat_percent&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:errors.vat_percent})]}),/*#__PURE__*/_jsx(\"td\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(_vatPrice=vatPrice)===null||_vatPrice===void 0?void 0:_vatPrice.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{colSpan:\"8\",className:\"text-end\",children:\"Net Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-end\",children:/*#__PURE__*/_jsx(NumberFormat,{value:(_netTotal=netTotal)===null||_netTotal===void 0?void 0:_netTotal.toFixed(2),displayType:\"text\",thousandSeparator:true,suffix:\" SAR\",renderText:function renderText(value,props){return value;}})})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Cash discount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.cash_discount,className:\"form-control \",onChange:function onChange(e){errors[\"cash_discount\"]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.cash_discount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.cash_discount=parseFloat(e.target.value);if(formData.cash_discount>0&&formData.cash_discount>=netTotal){errors[\"cash_discount\"]=\"Cash discount should not be >= \"+netTotal.toString();setErrors(_objectSpread({},errors));return;}setFormData(_objectSpread({},formData));validatePaymentAmounts();console.log(formData);}}),errors.cash_discount&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors.cash_discount]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Payments Received\"}),/*#__PURE__*/_jsxs(\"div\",{class:\"table-responsive\",style:{maxWidth:\"900px\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",style:{alignContent:\"right\"},onClick:addNewPayment,children:\"Create new payment\"}),/*#__PURE__*/_jsxs(\"table\",{class:\"table table-striped table-sm table-bordered\",children:[/*#__PURE__*/_jsxs(\"thead\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Payment method\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]}),/*#__PURE__*/_jsxs(\"tbody\",{children:[formData.payments_input&&formData.payments_input.filter(function(payment){return!payment.deleted;}).map(function(payment,key){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{style:{minWidth:\"220px\"},children:[/*#__PURE__*/_jsx(DatePicker,{id:\"date_str\",selected:formData.payments_input[key].date_str?new Date(formData.payments_input[key].date_str):null,value:formData.payments_input[key].date_str?format(new Date(formData.payments_input[key].date_str),\"MMMM d, yyyy h:mm aa\"):null,className:\"form-control\",dateFormat:\"MMMM d, yyyy h:mm aa\",showTimeSelect:true,timeIntervals:\"1\",onChange:function onChange(value){console.log(\"Value\",value);formData.payments_input[key].date_str=value;var paymentDate=new Date(formData.payments_input[key].date_str);var orderDate=new Date(formData.date_str);var paymentYear=paymentDate.getFullYear();var paymentMonth=paymentDate.getMonth();var paymentDay=paymentDate.getDate();var paymentMinutes=paymentDate.getMinutes();var paymentHours=paymentDate.getHours();var orderYear=orderDate.getFullYear();var orderMonth=orderDate.getMonth();var orderDay=orderDate.getDate();var orderMinutes=orderDate.getMinutes();var orderHours=orderDate.getHours();if(paymentYear==orderYear&&paymentMonth==orderMonth&&paymentDay==orderDay&&paymentHours==orderHours&&paymentMinutes==orderMinutes){formData.date_str=formData.payments_input[key].date_str;}setFormData(_objectSpread({},formData));}}),errors[\"payment_date_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_date_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"300px\"},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.payments_input[key].amount,className:\"form-control \",onChange:function onChange(e){errors[\"payment_amount_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){formData.payments_input[key].amount=e.target.value;setFormData(_objectSpread({},formData));validatePaymentAmounts();return;}formData.payments_input[key].amount=parseFloat(e.target.value);validatePaymentAmounts();setFormData(_objectSpread({},formData));console.log(formData);}}),errors[\"payment_amount_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_amount_\"+key]]})]}),/*#__PURE__*/_jsxs(\"td\",{style:{width:\"200px\"},children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.payments_input[key].method,className:\"form-control \",onChange:function onChange(e){// errors[\"payment_method\"] = [];\nerrors[\"payment_method_\"+key]=\"\";setErrors(_objectSpread({},errors));if(!e.target.value){errors[\"payment_method_\"+key]=\"Payment method is required\";setErrors(_objectSpread({},errors));formData.payments_input[key].method=\"\";setFormData(_objectSpread({},formData));return;}// errors[\"payment_method\"] = \"\";\n//setErrors({ ...errors });\nformData.payments_input[key].method=e.target.value;setFormData(_objectSpread({},formData));console.log(formData);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_account\",children:\"Bank Account / Debit / Credit Card\"}),/*#__PURE__*/_jsx(\"option\",{value:\"customer_account\",children:\"Customer Account\"})]}),errors[\"payment_method_\"+key]&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-lg\",children:\" \"}),errors[\"payment_method_\"+key]]})]}),/*#__PURE__*/_jsx(\"td\",{style:{width:\"200px\"},children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:function onClick(event){removePayment(key);},children:\"Remove\"})})]},key);}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{class:\"text-end\",children:/*#__PURE__*/_jsx(\"b\",{children:\"Total\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"b\",{children:getTotalPayments()})}),/*#__PURE__*/_jsx(\"td\",{colSpan:2})]})]})]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:handleCreate,children:isProcessing?formData.id?\"Updating....\":\"Creating..\":formData.id?\"Update\":\"Create\"})]})]})]})]})]});});export default OrderCreate;","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/order/create.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","OrderPreview","Modal","Button","Form","StoreCreate","CustomerCreate","ProductCreate","UserCreate","SignatureCreate","Cookies","Typeahead","NumberFormat","DatePicker","format","Spinner","OrderView","DebounceInput","ProductView","OrderCreate","props","ref","open","id","selectedProducts","setSelectedProducts","selectedStores","setSelectedStores","selectedCustomers","setSelectedCustomers","cookies","get","selectedDeliveredByUsers","name","formData","delivered_by","setFormData","setSelectedDeliveredByUsers","store_id","store_name","vat_percent","parseFloat","console","log","undefined","discount","discount_percent","shipping_handling_fees","partial_payment_amount","cash_discount","payment_method","payment_status","code","net_total","date_str","Date","payments_input","getOrder","reCalculate","setShow","requestOptions","method","headers","fetch","then","response","isJson","includes","json","data","ok","error","errors","Promise","reject","setErrors","result","date","payments","i","length","is_discount_percent","discountValue","products","searchLabel","customer_name","customer_id","search_label","catch","setProcessing","listener","event","form","target","index","Array","prototype","indexOf","call","elements","getAttribute","focus","preventDefault","document","addEventListener","removeEventListener","selectedDate","isProcessing","signature_date_str","status","price_type","useLaserScanner","storeOptions","setStoreOptions","isStoresLoading","setIsStoresLoading","customerOptions","setCustomerOptions","isCustomersLoading","setIsCustomersLoading","productOptions","setProductOptions","selectedProduct","setSelectedProduct","isProductsLoading","setIsProductsLoading","deliveredByUserOptions","setDeliveredByUserOptions","isDeliveredByUsersLoading","setIsDeliveredByUsersLoading","deliveredBySignatureOptions","setDeliveredBySignatureOptions","selectedDeliveredBySignatures","setSelectedDeliveredBySignatures","isDeliveredBySignaturesLoading","setIsDeliveredBySignaturesLoading","show","handleClose","at","window","location","ObjectToSearchQueryParams","object","Object","keys","map","key","encodeURIComponent","join","suggestStores","searchTerm","params","queryString","Authorization","Select","suggestCustomers","GetProductUnitPriceInStore","storeId","productStores","retail_unit_price","openProductSearchResult","setOpenProductSearchResult","suggestProducts","getProductByBarCode","barcode","slice","product","addProduct","suggestUsers","suggestSignatures","handleCreate","haveErrors","push","product_id","quantity","unit_price","unit","validatePaymentAmounts","netTotal","endPoint","body","JSON","stringify","showToastMessage","refreshList","openDetailsView","getProductIndex","productID","isProductAdded","GetProductStockInStore","stock","product_stores","alreadyAdded","item_code","part_number","toFixed","removeProduct","splice","totalPrice","setTotalPrice","findTotalPrice","vatPrice","setVatPrice","findVatPrice","setNetTotal","RoundFloat","val","precision","ratio","Math","pow","round","findNetTotal","amount","discountPercent","setDiscountPercent","findDiscountPercent","findDiscount","DetailsViewRef","current","StoreCreateFormRef","openStoreCreateForm","CustomerCreateFormRef","openCustomerCreateForm","ProductCreateFormRef","openProductCreateForm","UserCreateFormRef","openUserCreateForm","SignatureCreateFormRef","openSignatureCreateForm","ProductDetailsViewRef","openProductDetailsView","addNewPayment","getTotalPayments","totalPayment","deleted","removePayment","toString","maxAllowedAmount","openCreateForm","isArray","color","e","selectedItems","border","value","bar_code","overflowX","maxHeight","overflowY","width","cursor","textDecoration","reverse","maxWidth","alignContent","filter","payment","minWidth","paymentDate","orderDate","paymentYear","getFullYear","paymentMonth","getMonth","paymentDay","getDate","paymentMinutes","getMinutes","paymentHours","getHours","orderYear","orderMonth","orderDay","orderMinutes","orderHours"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport OrderPreview from \"./preview.js\";\nimport { Modal, Button, Form } from \"react-bootstrap\";\nimport StoreCreate from \"../store/create.js\";\nimport CustomerCreate from \"./../customer/create.js\";\nimport ProductCreate from \"./../product/create.js\";\nimport UserCreate from \"./../user/create.js\";\nimport SignatureCreate from \"./../signature/create.js\";\nimport Cookies from \"universal-cookie\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\nimport NumberFormat from \"react-number-format\";\nimport DatePicker from \"react-datepicker\";\nimport { format } from \"date-fns\";\nimport { Spinner } from \"react-bootstrap\";\nimport OrderView from \"./view.js\";\nimport \"./style.css\";\nimport { DebounceInput } from 'react-debounce-input';\n//import BarcodeScannerComponent from \"react-qr-barcode-scanner\";\n//import Quagga from 'quagga';\nimport ProductView from \"./../product/view.js\";\n\nconst OrderCreate = forwardRef((props, ref) => {\n\n\n    useImperativeHandle(ref, () => ({\n        open(id) {\n            selectedProducts = [];\n            setSelectedProducts([]);\n\n            selectedStores = [];\n            setSelectedStores([]);\n\n            selectedCustomers = [];\n            setSelectedCustomers([]);\n\n\n\n            if (cookies.get(\"user_id\")) {\n                selectedDeliveredByUsers = [{\n                    id: cookies.get(\"user_id\"),\n                    name: cookies.get(\"user_name\"),\n                }];\n                formData.delivered_by = cookies.get(\"user_id\");\n                setFormData({ ...formData });\n                setSelectedDeliveredByUsers([...selectedDeliveredByUsers]);\n            }\n\n            if (cookies.get('store_id')) {\n                formData.store_id = cookies.get('store_id');\n                formData.store_name = cookies.get('store_name');\n                formData.vat_percent = parseFloat(cookies.get('vat_percent'));\n                console.log(\"formData.store_id:\", formData.store_id);\n            }\n\n            formData.id = undefined;\n            formData.discount = 0.00;\n            formData.discount_percent = 0.00;\n            formData.shipping_handling_fees = 0.00;\n            formData.partial_payment_amount = 0.00;\n            formData.cash_discount = 0.00;\n            formData.payment_method = \"\";\n            formData.payment_status = \"\";\n            formData.code = \"\";\n            formData.net_total = 0.00;\n            formData.date_str = new Date();\n            formData.payments_input = [\n                {\n                    \"date_str\": formData.date_str,\n                    // \"amount\": \"\",\n                    \"amount\": 0.00,\n                    \"method\": \"\",\n                    \"deleted\": false,\n                }\n            ];\n            formData.cash_discount = 0.00;\n\n            if (id) {\n                getOrder(id);\n            }\n            setFormData({ ...formData });\n            reCalculate();\n            setShow(true);\n\n        },\n    }));\n\n\n    function getOrder(id) {\n        console.log(\"inside get Order\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/order/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n\n                console.log(\"Response:\");\n                console.log(data);\n\n                formData = data.result;\n                formData.date_str = data.result.date;\n                if (data.result.payments) {\n                    console.log(\"data.result.payments:\", data.result.payments);\n                    formData.payments_input = data.result.payments;\n                    for (var i = 0; i < formData.payments_input.length; i++) {\n                        formData.payments_input[i].date_str = formData.payments_input[i].date\n                    }\n                }\n\n                /*\n                let order = data.result;\n                formData = {\n                    id: order.id,\n                    code: order.code,\n                    store_id: purchase.store_id,\n                    vendor_id: purchase.vendor_id,\n                    date_str: purchase.date,\n                    // date: purchase.date,\n                    vat_percent: purchase.vat_percent,\n                    discount: purchase.discount,\n                    discount_percent: purchase.discount_percent,\n                    status: purchase.status,\n                    order_placed_by: purchase.order_placed_by,\n                    order_placed_by_signature_id: purchase.order_placed_by_signature_id,\n                    is_discount_percent: purchase.is_discount_percent,\n                    partial_payment_amount: purchase.partial_payment_amount,\n                    payment_method: purchase.payment_method,\n                    payment_status: purchase.payment_status,\n                    shipping_handling_fees: purchase.shipping_handling_fees,\n                };\n                */\n\n                if (formData.is_discount_percent) {\n                    formData.discountValue = formData.discount_percent;\n                } else {\n                    formData.discountValue = formData.discount;\n                }\n\n                selectedProducts = formData.products;\n                setSelectedProducts([...selectedProducts]);\n\n\n                let selectedStores = [\n                    {\n                        id: formData.store_id,\n                        name: formData.store_name,\n                    }\n                ];\n\n\n                let searchLabel = formData.customer_name;\n\n                let selectedCustomers = [\n                    {\n                        id: formData.customer_id,\n                        name: formData.customer_name,\n                        search_label: searchLabel,\n                    }\n                ];\n\n                /*\n                let selectedOrderPlacedByUsers = [\n                    {\n                        id: formData.created_by,\n                        name: formData.created_by_name\n                    }\n                ];\n\n\n                setSelectedOrderPlacedByUsers([...selectedOrderPlacedByUsers]);\n                */\n\n                setSelectedStores([...selectedStores]);\n                setSelectedCustomers([...selectedCustomers]);\n\n                reCalculate();\n                setFormData({ ...formData });\n\n\n            })\n            .catch(error => {\n                setProcessing(false);\n                setErrors(error);\n            });\n    }\n\n    useEffect(() => {\n        const listener = event => {\n            if (event.code === \"Enter\" || event.code === \"NumpadEnter\") {\n                console.log(\"Enter key was pressed. Run your function-order.123\");\n                // event.preventDefault();\n\n\n\n                var form = event.target.form;\n                if (form && event.target) {\n                    var index = Array.prototype.indexOf.call(form, event.target);\n                    if (form && form.elements[index + 1]) {\n                        if (event.target.getAttribute(\"class\").includes(\"barcode\")) {\n                            form.elements[index].focus();\n                        } else {\n                            form.elements[index + 1].focus();\n                        }\n                        event.preventDefault();\n                    }\n                }\n            }\n        };\n        document.addEventListener(\"keydown\", listener);\n        return () => {\n            document.removeEventListener(\"keydown\", listener);\n        };\n    }, []);\n\n\n    const selectedDate = new Date();\n\n    //const history = useHistory();\n    let [errors, setErrors] = useState({\n        \"payment_amount\": [],\n    });\n    const [isProcessing, setProcessing] = useState(false);\n    const cookies = new Cookies();\n\n    //fields\n    let [formData, setFormData] = useState({\n        vat_percent: 15.0,\n        discountValue: 0.00,\n        discount: 0.00,\n        discount_percent: 0.0,\n        cash_discount: 0.00,\n        is_discount_percent: false,\n        date_str: new Date(),\n        signature_date_str: format(new Date(), \"MMM dd yyyy\"),\n        status: \"delivered\",\n        payment_status: \"\",\n        payment_method: \"\",\n        price_type: \"retail\",\n        useLaserScanner: false,\n        store_id: \"\",\n    });\n\n    //Store Auto Suggestion\n    const [storeOptions, setStoreOptions] = useState([]);\n    let [selectedStores, setSelectedStores] = useState([]);\n    const [isStoresLoading, setIsStoresLoading] = useState(false);\n\n    //Customer Auto Suggestion\n    const [customerOptions, setCustomerOptions] = useState([]);\n    let [selectedCustomers, setSelectedCustomers] = useState([]);\n    const [isCustomersLoading, setIsCustomersLoading] = useState(false);\n\n    //Product Auto Suggestion\n    const [productOptions, setProductOptions] = useState([]);\n    let [selectedProduct, setSelectedProduct] = useState([]);\n    let [selectedProducts, setSelectedProducts] = useState([]);\n    const [isProductsLoading, setIsProductsLoading] = useState(false);\n\n    //Delivered By Auto Suggestion\n    let [deliveredByUserOptions, setDeliveredByUserOptions] = useState([]);\n    let [selectedDeliveredByUsers, setSelectedDeliveredByUsers] = useState([]);\n    const [isDeliveredByUsersLoading, setIsDeliveredByUsersLoading] =\n        useState(false);\n\n    //Delivered By Signature Auto Suggestion\n    const [deliveredBySignatureOptions, setDeliveredBySignatureOptions] =\n        useState([]);\n    const [selectedDeliveredBySignatures, setSelectedDeliveredBySignatures] =\n        useState([]);\n    const [isDeliveredBySignaturesLoading, setIsDeliveredBySignaturesLoading] =\n        useState(false);\n\n    const [show, setShow] = useState(false);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        let at = cookies.get(\"access_token\");\n        if (!at) {\n            // history.push(\"/dashboard/orders\");\n            window.location = \"/\";\n        }\n    });\n\n\n    function ObjectToSearchQueryParams(object) {\n        return Object.keys(object)\n            .map(function (key) {\n                return `search[${key}]=` + encodeURIComponent(object[key]);\n            })\n            .join(\"&\");\n    }\n\n    async function suggestStores(searchTerm) {\n        console.log(\"Inside handle suggestStores\");\n        setStoreOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsStoresLoading(true);\n        let result = await fetch(\n            \"/v1/store?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setStoreOptions(data.result);\n        setIsStoresLoading(false);\n    }\n\n    async function suggestCustomers(searchTerm) {\n        console.log(\"Inside handle suggestCustomers\");\n        setCustomerOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name,phone,name_in_arabic,phone_in_arabic,search_label\";\n        setIsCustomersLoading(true);\n        let result = await fetch(\n            \"/v1/customer?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setCustomerOptions(data.result);\n        setIsCustomersLoading(false);\n    }\n\n    function GetProductUnitPriceInStore(storeId, productStores) {\n        if (!productStores) {\n            return \"\";\n        }\n\n        for (var i = 0; i < productStores.length; i++) {\n            console.log(\"productStores[i]:\", productStores[i]);\n            console.log(\"store_id:\", storeId);\n\n            if (productStores[i].store_id === storeId) {\n                console.log(\"macthed\");\n                console.log(\n                    \"productStores[i].retail_unit_price:\",\n                    productStores[i].retail_unit_price\n                );\n                return productStores[i];\n                /*\n                if (formData.price_type === \"retail\") {\n                    return unitPriceListArray[i].retail_unit_price;\n                } else if (formData.price_type === \"wholesale\") {\n                    return unitPriceListArray[i].wholesale_unit_price;\n                } else if (formData.price_type === \"purchase\") {\n                    return unitPriceListArray[i].purchase_unit_price;\n                }\n                */\n\n            } else {\n                console.log(\"not matched\");\n            }\n        }\n        return \"\";\n    }\n\n\n\n    let [openProductSearchResult, setOpenProductSearchResult] = useState(false);\n\n    async function suggestProducts(searchTerm) {\n        console.log(\"Inside handle suggestProducts\");\n        setProductOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n\n        if (cookies.get(\"store_id\")) {\n            params.store_id = cookies.get(\"store_id\");\n        }\n\n\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,item_code,bar_code,part_number,name,unit,part_number,name_in_arabic,product_stores\";\n        setIsProductsLoading(true);\n        let result = await fetch(\n            \"/v1/product?\" + Select + queryString + \"&limit=200\",\n            requestOptions\n        );\n        let data = await result.json();\n\n        let products = data.result;\n        if (!products || products.length === 0) {\n            openProductSearchResult = false;\n            setOpenProductSearchResult(false);\n            setIsProductsLoading(false);\n            return;\n        }\n\n        openProductSearchResult = true;\n        setOpenProductSearchResult(true);\n        setProductOptions(products);\n        setIsProductsLoading(false);\n\n    }\n\n    async function getProductByBarCode(barcode) {\n        formData.barcode = barcode;\n        setFormData({ ...formData });\n        console.log(\"Inside getProductByBarCode\");\n        errors[\"bar_code\"] = \"\";\n        setErrors({ ...errors });\n\n        console.log(\"barcode:\" + formData.barcode);\n        if (!formData.barcode) {\n            return;\n        }\n\n        if (formData.barcode.length === 13) {\n            formData.barcode = formData.barcode.slice(0, -1);\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n\n        let Select = \"select=id,item_code,bar_code,ean_12,part_number,name,product_stores,unit,part_number,name_in_arabic\";\n        let result = await fetch(\n            \"/v1/product/barcode/\" + formData.barcode + \"?\" + Select,\n            requestOptions\n        );\n        let data = await result.json();\n\n\n        let product = data.result;\n        if (product) {\n            addProduct(product);\n        } else {\n            errors[\"bar_code\"] = \"Invalid Barcode:\" + formData.barcode\n            setErrors({ ...errors });\n        }\n\n        formData.barcode = \"\";\n        setFormData({ ...formData });\n\n    }\n\n    async function suggestUsers(searchTerm) {\n        console.log(\"Inside handle suggestUsers\");\n        setDeliveredByUserOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsDeliveredByUsersLoading(true);\n        let result = await fetch(\n            \"/v1/user?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setDeliveredByUserOptions(data.result);\n        setIsDeliveredByUsersLoading(false);\n    }\n\n    async function suggestSignatures(searchTerm) {\n        console.log(\"Inside handle suggestSignatures\");\n        setDeliveredBySignatureOptions([]);\n\n        console.log(\"searchTerm:\" + searchTerm);\n        if (!searchTerm) {\n            return;\n        }\n\n        var params = {\n            name: searchTerm,\n        };\n        var queryString = ObjectToSearchQueryParams(params);\n        if (queryString !== \"\") {\n            queryString = \"&\" + queryString;\n        }\n\n        const requestOptions = {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n        };\n\n        let Select = \"select=id,name\";\n        setIsDeliveredBySignaturesLoading(true);\n        let result = await fetch(\n            \"/v1/signature?\" + Select + queryString,\n            requestOptions\n        );\n        let data = await result.json();\n\n        setDeliveredBySignatureOptions(data.result);\n        setIsDeliveredBySignaturesLoading(false);\n    }\n\n    function handleCreate(event) {\n        event.preventDefault();\n        let haveErrors = false;\n\n        if(!formData.cash_discount){\n            formData.cash_discount = 0.00;\n        }\n\n        formData.products = [];\n        for (var i = 0; i < selectedProducts.length; i++) {\n            formData.products.push({\n                product_id: selectedProducts[i].product_id,\n                quantity: parseFloat(selectedProducts[i].quantity),\n                unit_price: parseFloat(selectedProducts[i].unit_price),\n                unit: selectedProducts[i].unit,\n            });\n        }\n\n        errors[\"products\"] = \"\";\n        setErrors({ ...errors });\n\n        if (formData.products.length === 0) {\n            errors[\"products\"] = \"No products added\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n\n\n        if (!validatePaymentAmounts()) {\n            console.log(\"Errors on payments\")\n            haveErrors = true;\n        }\n\n\n\n\n        if (!formData.shipping_handling_fees && formData.shipping_handling_fees !== 0) {\n            errors[\"shipping_handling_fees\"] = \"Invalid shipping / handling fees\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        /*\n        if (formData.payment_status === \"paid_partially\" && !formData.partial_payment_amount && formData.partial_payment_amount !== 0) {\n            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (formData.payment_status === \"paid_partially\" && formData.partial_payment_amount <= 0) {\n            errors[\"partial_payment_amount\"] = \"Partial payment should be > 0 \";\n            setErrors({ ...errors });\n            return;\n        }\n\n        if (!formData.id && formData.payment_status === \"paid_partially\" && formData.partial_payment_amount >= netTotal) {\n            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n            setErrors({ ...errors });\n            return;\n        }\n        \n\n        errors[\"payment_method\"] = \"\";\n        setErrors({ ...errors });\n        if (!formData.id && formData.payment_status != \"not_paid\" && !formData.payment_method) {\n            errors[\"payment_method\"] = \"Payment method is required\";\n            setErrors({ ...errors });\n            return;\n        }\n        */\n\n\n        if (!formData.discount && formData.discount !== 0) {\n            errors[\"discount\"] = \"Invalid discount\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.discount_percent && formData.discount_percent !== 0) {\n            errors[\"discount_percent\"] = \"Invalid discount percent\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (parseFloat(formData.discount_percent) > 100) {\n            errors[\"discount_percent\"] = \"Discount percent cannot be > 100\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (!formData.vat_percent && formData.vat_percent !== 0) {\n            errors[\"vat_percent\"] = \"Invalid vat percent\";\n            setErrors({ ...errors });\n            haveErrors = true;\n        }\n\n        if (haveErrors) {\n            console.log(\"Errors: \", errors);\n            return;\n        }\n\n\n\n        formData.discount = parseFloat(formData.discount);\n        formData.discount_percent = parseFloat(formData.discount_percent);\n        formData.vat_percent = parseFloat(formData.vat_percent);\n        formData.partial_payment_amount = parseFloat(formData.partial_payment_amount);\n        formData.net_total = parseFloat(netTotal);\n\n        if (cookies.get('store_id')) {\n            formData.store_id = cookies.get('store_id');\n        }\n\n\n        let endPoint = \"/v1/order\";\n        let method = \"POST\";\n        if (formData.id) {\n            endPoint = \"/v1/order/\" + formData.id;\n            method = \"PUT\";\n        }\n\n        const requestOptions = {\n            method: method,\n            headers: {\n                'Accept': 'application/json',\n                \"Content-Type\": \"application/json\",\n                Authorization: cookies.get(\"access_token\"),\n            },\n            body: JSON.stringify(formData),\n        };\n\n        console.log(\"formData:\", formData);\n\n        setProcessing(true);\n        fetch(endPoint, requestOptions)\n            .then(async (response) => {\n                const isJson = response.headers\n                    .get(\"content-type\")\n                    ?.includes(\"application/json\");\n                const data = isJson && (await response.json());\n\n                // check for error response\n                if (!response.ok) {\n                    // get error message from body or default to response status\n                    const error = data && data.errors;\n                    //const error = data.errors\n                    return Promise.reject(error);\n                }\n\n                setErrors({});\n                setProcessing(false);\n\n                console.log(\"Response:\");\n                console.log(data);\n                props.showToastMessage(\"Order Created Successfully!\", \"success\");\n                if (props.refreshList) {\n                    props.refreshList();\n                }\n\n                handleClose();\n                formData.products = [];\n                selectedProducts = [];\n                setSelectedProducts([]);\n                formData.customer_id = \"\";\n                setSelectedCustomers([]);\n                setFormData({ ...formData });\n                reCalculate();\n\n                openDetailsView(data.result.id);\n            })\n            .catch((error) => {\n                setProcessing(false);\n                console.log(\"Inside catch\");\n                console.log(error);\n                setErrors({ ...error });\n                console.error(\"There was an error!\", error);\n                props.showToastMessage(\"Error Creating Order!\", \"danger\");\n            });\n    }\n\n    function getProductIndex(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return i;\n            }\n        }\n        return false;\n    }\n\n\n    function isProductAdded(productID) {\n        for (var i = 0; i < selectedProducts.length; i++) {\n            if (selectedProducts[i].product_id === productID) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function GetProductStockInStore(storeId, productStores) {\n        if (!productStores) {\n            return 0.0;\n        }\n\n        for (var i = 0; i < productStores.length; i++) {\n            if (productStores[i].store_id === storeId) {\n                return productStores[i].stock;\n            }\n        }\n        return 0.0;\n    }\n\n    function addProduct(product) {\n        console.log(\"Inside Add product\");\n        if (!formData.store_id) {\n            errors.product_id = \"Please Select a Store and try again\";\n            setErrors({ ...errors });\n            return;\n        }\n\n\n        errors.product_id = \"\";\n        if (!product) {\n            errors.product_id = \"Invalid Product\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        /*\n        let productStore = GetProductUnitPriceInStore(\n            formData.store_id,\n            product.stores\n        );\n        */\n        // product.unit_price = productStore.retail_unit_price;\n\n        if (product.product_stores[formData.store_id]) {\n            product.unit_price = product.product_stores[formData.store_id].retail_unit_price;\n        }\n\n\n        errors.unit_price = \"\";\n        if (!product.unit_price) {\n            errors.unit_price = \"Invalid Unit Price\";\n            setErrors({ ...errors });\n            return;\n        }\n\n        let alreadyAdded = false;\n        let index = false;\n        let quantity = 0.00;\n        product.quantity = 1.00;\n\n\n        if (isProductAdded(product.id)) {\n            alreadyAdded = true;\n            index = getProductIndex(product.id);\n            quantity = parseFloat(selectedProducts[index].quantity + product.quantity);\n        } else {\n            quantity = parseFloat(product.quantity);\n        }\n\n        console.log(\"quantity:\", quantity);\n\n        errors.quantity = \"\";\n\n        //let stock = GetProductStockInStore(formData.store_id, product.stores);\n        let stock = 0;\n\n        if (product.product_stores[formData.store_id]) {\n            stock = product.product_stores[formData.store_id].stock;\n        }\n\n        if (stock < quantity) {\n            if (index === false) {\n                index = selectedProducts.length;\n            }\n            // errors[\"quantity_\" + index] = \"Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for product: \" + product.name;\n            errors[\"quantity_\" + index] = \"Warning: Available stock is \" + stock\n            console.log(\"errors:\", errors);\n            setErrors({ ...errors });\n        }\n\n        if (alreadyAdded) {\n            selectedProducts[index].quantity = parseFloat(quantity);\n        }\n\n        if (!alreadyAdded) {\n            selectedProducts.push({\n                product_id: product.id,\n                code: product.item_code,\n                part_number: product.part_number,\n                name: product.name,\n                quantity: product.quantity,\n                product_stores: product.product_stores,\n                unit_price: parseFloat(product.unit_price).toFixed(2),\n                unit: product.unit,\n            });\n        }\n        setSelectedProducts([...selectedProducts]);\n        reCalculate();\n    }\n\n    function removeProduct(product) {\n        const index = selectedProducts.indexOf(product);\n        if (index > -1) {\n            selectedProducts.splice(index, 1);\n        }\n        setSelectedProducts([...selectedProducts]);\n\n        reCalculate();\n    }\n\n    let [totalPrice, setTotalPrice] = useState(0.0);\n\n    function findTotalPrice() {\n        totalPrice = 0.00;\n        for (var i = 0; i < selectedProducts.length; i++) {\n            totalPrice +=\n                parseFloat(selectedProducts[i].unit_price) *\n                parseFloat(selectedProducts[i].quantity);\n        }\n       // totalPrice = totalPrice.toFixed(2);\n       // totalPrice = Math.round(totalPrice * 100) / 100;\n        setTotalPrice(totalPrice);\n    }\n\n    let [vatPrice, setVatPrice] = useState(0.00);\n\n    function findVatPrice() {\n        vatPrice = 0.00;\n        if (totalPrice > 0) {\n            console.log(\"formData.vat_percent:\",formData.vat_percent);\n            //(35.8 / 100) * 10000;\n             \n             vatPrice = (parseFloat(formData.vat_percent) / 100) * (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount));\n            console.log(\"vatPrice:\", vatPrice);\n        }\n        setVatPrice(vatPrice);\n    }\n\n    let [netTotal, setNetTotal] = useState(0.00);\n\n    function RoundFloat(val, precision) {\n        var ratio = Math.pow(10, precision);\n        return Math.round(val * ratio) / ratio;\n    }\n\n    function findNetTotal() {\n        netTotal = 0.00;\n        if (totalPrice > 0) {\n            console.log(\"totalPrice:\",totalPrice)\n            console.log(\"formData.discount:\",formData.discount)\n            console.log(\"vatPrice:\",vatPrice);\n\n            netTotal = (parseFloat(totalPrice) + parseFloat(formData.shipping_handling_fees) - parseFloat(formData.discount) + parseFloat(vatPrice));\n            netTotal = parseFloat(netTotal);\n        }\n        console.log(\"before rounding netTotal:\", netTotal);\n       // netTotal = RoundFloat(netTotal,2);\n       // netTotal = Math.round(netTotal * 100) / 100;\n        console.log(\"after rounding netTotal:\", netTotal);\n        setNetTotal(netTotal);\n\n        if (!formData.id) {\n            formData.payments_input = [{\n                \"date_str\": formData.date_str,\n                \"amount\": 0.00,\n                \"method\": \"\",\n                \"deleted\": false,\n            }];\n            formData.payments_input[0].amount = parseFloat(netTotal);\n        }\n\n        /*\n        if (formData.payments_input[0].amount === 0) {\n            formData.payments_input[0].amount = \"\";\n        }\n        */\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n    }\n\n    let [discountPercent, setDiscountPercent] = useState(0.00);\n\n    function findDiscountPercent() {\n        if (formData.discount >= 0 && totalPrice > 0) {\n            discountPercent = parseFloat(parseFloat(formData.discount / totalPrice) * 100);\n            setDiscountPercent(discountPercent);\n            formData.discount_percent = discountPercent;\n            //formData.discount_percent = Math.round(formData.discount_percent * 100) / 100;\n            setFormData({ ...formData });\n        }\n    }\n\n    function findDiscount() {\n        if (formData.discount_percent >= 0 && totalPrice > 0) {\n            formData.discount = parseFloat(totalPrice * parseFloat(formData.discount_percent / 100));\n           // formData.discount = parseFloat(formData.discount.toFixed(2));\n            setFormData({ ...formData });\n        }\n    }\n\n\n    function reCalculate() {\n        findTotalPrice();\n        if (formData.is_discount_percent) {\n            findDiscount();\n        } else {\n            findDiscountPercent();\n        }\n        findVatPrice();\n        findNetTotal();\n    }\n\n    const DetailsViewRef = useRef();\n    function openDetailsView(id) {\n        DetailsViewRef.current.open(id);\n    }\n\n    const StoreCreateFormRef = useRef();\n    function openStoreCreateForm() {\n        StoreCreateFormRef.current.open();\n    }\n\n    const CustomerCreateFormRef = useRef();\n    function openCustomerCreateForm() {\n        CustomerCreateFormRef.current.open();\n    }\n\n    const ProductCreateFormRef = useRef();\n    function openProductCreateForm() {\n        ProductCreateFormRef.current.open();\n    }\n\n\n    const UserCreateFormRef = useRef();\n    function openUserCreateForm() {\n        UserCreateFormRef.current.open();\n    }\n\n\n    const SignatureCreateFormRef = useRef();\n    function openSignatureCreateForm() {\n        SignatureCreateFormRef.current.open();\n    }\n\n\n    const ProductDetailsViewRef = useRef();\n    function openProductDetailsView(id) {\n        ProductDetailsViewRef.current.open(id);\n    }\n\n    function addNewPayment() {\n        let date = new Date();\n        if (!formData.id) {\n            date = formData.date_str;\n        }\n\n        formData.payments_input.push({\n            \"date_str\": date,\n            // \"amount\": \"\",\n            \"amount\": 0.00,\n            \"method\": \"\",\n            \"deleted\": false,\n        });\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n        //validatePaymentAmounts((formData.payments_input.filter(payment => !payment.deleted).length - 1));\n    }\n\n    function getTotalPayments() {\n        let totalPayment = 0.00;\n        for (var i = 0; i < formData.payments_input?.length; i++) {\n            if (formData.payments_input[i].amount && !formData.payments_input[i].deleted) {\n                totalPayment += formData.payments_input[i].amount;\n            }\n        }\n        return totalPayment;\n    }\n\n    function removePayment(key) {\n        formData.payments_input.splice(key, 1);\n        //formData.payments_input[key][\"deleted\"] = true;\n        setFormData({ ...formData });\n        validatePaymentAmounts();\n    }\n\n\n    function validatePaymentAmounts() {\n        console.log(\"validatePaymentAmount: netTotal:\",netTotal)\n        let haveErrors = false;\n        if (!netTotal) {\n            return true;\n        }\n\n        if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n            errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toFixed(2).toString();\n            setErrors({ ...errors });\n            haveErrors = true\n            return false;\n        }\n\n        let totalPayment = getTotalPayments();\n        // errors[\"payment_date\"] = [];\n        //errors[\"payment_method\"] = [];\n        //errors[\"payment_amount\"] = [];\n        for (var key = 0; key < formData.payments_input.length; key++) {\n            errors[\"payment_amount_\" + key] = \"\";\n            errors[\"payment_date_\" + key] = \"\";\n            errors[\"payment_method_\" + key] = \"\";\n            setErrors({ ...errors });\n\n            if (!formData.payments_input[key].amount) {\n                errors[\"payment_amount_\" + key] = \"Payment amount is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if (formData.payments_input[key].amount === 0) {\n                errors[\"payment_amount_\" + key] = \"Amount should be greater than zero\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].date_str) {\n                errors[\"payment_date_\" + key] = \"Payment date is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            } else if ((new Date(formData.payments_input[key].date_str)) < (new Date(formData.date_str))) {\n                errors[\"payment_date_\" + key] = \"Payment date time should be greater than or equal to order date time\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n            if (!formData.payments_input[key].method) {\n                errors[\"payment_method_\" + key] = \"Payment method is required\";\n                setErrors({ ...errors });\n                haveErrors = true;\n            }\n\n\n            if ((formData.payments_input[key].amount || formData.payments_input[key].amount === 0) && !formData.payments_input[key].deleted) {\n                let maxAllowedAmount = (netTotal - formData.cash_discount) - (totalPayment - formData.payments_input[key].amount);\n\n                if (maxAllowedAmount < 0) {\n                    maxAllowedAmount = 0;\n                }\n\n                /*\n                if (maxAllowedAmount === 0) {\n                    errors[\"payment_amount_\" + key] = \"Total amount should not exceed \" + (netTotal - formData.cash_discount).toFixed(2).toString() + \", Please delete this payment\";\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                } else if (formData.payments_input[key].amount > parseFloat(maxAllowedAmount.toFixed(2))) {\n                    errors[\"payment_amount_\" + key] = \"Amount should not be greater than \" + maxAllowedAmount.toFixed(2);\n                    setErrors({ ...errors });\n                    haveErrors = true;\n                }\n                */\n            }\n        }\n\n        if (haveErrors) {\n            return false;\n        }\n\n        return true;\n    }\n\n    return (\n        <>\n            {/*\n            <div ref={camref}></div>\n        */}\n\n            {/*\n            <BarcodeScannerComponent\n                width={500}\n                height={500}\n                onUpdate={(err, result) => {\n                    console.log(\"Result:\", result);\n                }}\n            />\n            */}\n\n            <OrderView ref={DetailsViewRef} openCreateForm={props.openCreateForm} />\n            <ProductView ref={ProductDetailsViewRef} />\n            <StoreCreate ref={StoreCreateFormRef} showToastMessage={props.showToastMessage} />\n            <CustomerCreate ref={CustomerCreateFormRef} showToastMessage={props.showToastMessage} />\n            <ProductCreate ref={ProductCreateFormRef} showToastMessage={props.showToastMessage} />\n            <UserCreate ref={UserCreateFormRef} showToastMessage={props.showToastMessage} />\n            <SignatureCreate ref={SignatureCreateFormRef} showToastMessage={props.showToastMessage} />\n\n\n            <Modal show={show} size=\"xl\" fullscreen\n                onHide={handleClose} animation={false} backdrop=\"static\" scrollable={true}>\n                <Modal.Header>\n                    <Modal.Title>\n                        {formData.id ? \"Update Sales Order #\" + formData.code : \"Create New Sales Order\"}\n                    </Modal.Title>\n\n                    <div className=\"col align-self-end text-end\">\n                        <OrderPreview />\n                        <Button variant=\"primary\" onClick={handleCreate}>\n                            {isProcessing ? formData.id ? \"Updating....\" : \"Creating..\" : formData.id ? \"Update\" : \"Create\"\n                            }\n                        </Button>\n\n                        <button\n                            type=\"button\"\n                            className=\"btn-close\"\n                            onClick={handleClose}\n                            aria-label=\"Close\"\n                        ></button>\n                    </div>\n                </Modal.Header>\n                <Modal.Body>\n                    {Object.keys(errors).length > 0 ?\n                        <div>\n                            <ul>\n\n                                {errors && Object.keys(errors).map((key, index) => {\n                                    if (Array.isArray(errors[key])) {\n                                        return (errors[key][0] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                    } else {\n                                        return (errors[key] ? <li style={{ color: \"red\" }}>{errors[key]}</li> : \"\");\n                                    }\n\n                                })}\n                            </ul></div> : \"\"}\n\n                    <form className=\"row g-3 needs-validation\" onSubmit={e => { e.preventDefault(); handleCreate(e); }} >\n                        {!cookies.get('store_name') ? <div className=\"col-md-6\">\n                            <label className=\"form-label\">Store*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"store_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isStoresLoading}\n                                    isInvalid={errors.store_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.store_id = \"\";\n                                        errors[\"product_id\"] = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.store_id = \"Invalid Store selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedStores([]);\n                                            return;\n                                        }\n                                        formData.store_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        console.log(\"formData.store_id:\", formData.store_id);\n                                        selectedStores = selectedItems;\n                                        setSelectedStores([...selectedItems]);\n\n                                        if (formData.store_id) {\n                                            if (selectedProduct[0] && selectedProduct[0].product_stores && selectedProduct[0].quantity) {\n                                                let stock = 0;\n                                                if (selectedProduct[0].product_stores) {\n                                                    //stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\n                                                    if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                        stock = selectedProduct[0].product_stores[formData.store_id].stock\n                                                    }\n                                                }\n\n                                                if (stock < parseFloat(selectedProduct[0].quantity)) {\n                                                    if (selectedStores[0]) {\n                                                        errors.product_id = \"Stock is only \" + stock + \" in Store: \" + selectedStores[0].name + \" for this product\";\n                                                    } else {\n                                                        errors.product_id = \"Stock is only \" + stock + \" in Selected Store for this product\";\n                                                    }\n\n                                                    setErrors({ ...errors });\n                                                }\n                                            } else if (selectedProduct[0] && selectedProduct[0].product_stores) {\n                                                let stock = 0;\n                                                //stock = GetProductStockInStore(formData.store_id, selectedProduct[0].stores);\n                                                if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                    stock = selectedProduct[0].product_stores[formData.store_id].stock\n                                                }\n\n                                                if (stock === 0) {\n                                                    if (selectedStores[0]) {\n                                                        errors[\"product_id\"] = \"This product is not available in store: \" + selectedStores[0].name;\n                                                    } else {\n                                                        errors[\"product_id\"] = \"This product is not available in selected store.\"\n                                                    }\n                                                    setErrors({ ...errors });\n                                                }\n                                            }\n\n                                            if (selectedProduct[0]) {\n                                                /*\n                                                selectedProduct[0].unit_price = GetProductUnitPriceInStore(\n                                                    formData.store_id,\n                                                    selectedProduct[0].stores\n                                                );\n                                                */\n                                                if (selectedProduct[0].product_stores[formData.store_id]) {\n                                                    selectedProduct[0].unit_price = selectedProduct[0].product_stores[formData.store_id].retail_unit_price;\n                                                }\n\n\n                                                if (!selectedProduct[0].quantity) {\n                                                    selectedProduct[0].quantity = 1;\n                                                }\n                                                setSelectedProduct([...selectedProduct]);\n                                            }\n\n                                        }\n\n                                    }\n                                    }\n                                    options={storeOptions}\n                                    placeholder=\"Select Store\"\n                                    selected={selectedStores}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestStores(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openStoreCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi x-lg\"> </i>\n                                    {errors.store_id}\n                                </div>\n                            </div>\n                        </div> : \"\"}\n\n                        <div className=\"col-md-6\" style={{ border: \"solid 0px\" }}>\n                            <label className=\"form-label\">Customer*</label>\n                            <Typeahead\n                                id=\"customer_id\"\n                                labelKey=\"search_label\"\n                                isLoading={isCustomersLoading}\n                                isInvalid={errors.customer_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    errors.customer_id = \"\";\n                                    setErrors(errors);\n                                    if (selectedItems.length === 0) {\n                                        errors.customer_id = \"Invalid Customer selected\";\n                                        setErrors(errors);\n                                        formData.customer_id = \"\";\n                                        setFormData({ ...formData });\n                                        setSelectedCustomers([]);\n                                        return;\n                                    }\n                                    formData.customer_id = selectedItems[0].id;\n                                    setFormData({ ...formData });\n                                    setSelectedCustomers(selectedItems);\n                                }}\n                                options={customerOptions}\n                                placeholder=\"Type name or mob\"\n                                selected={selectedCustomers}\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestCustomers(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openCustomerCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.customer_id && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.customer_id}\n                                </div>\n                            )}\n\n                        </div>\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Product Barcode Scan</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DebounceInput\n                                    minLength={3}\n                                    debounceTimeout={100}\n                                    placeholder=\"Scan Barcode\"\n                                    className=\"form-control barcode\"\n                                    value={formData.barcode}\n                                    onChange={event => getProductByBarCode(event.target.value)} />\n                                {errors.bar_code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.bar_code}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-3\">\n                            <label className=\"form-label\">Date*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    selected={formData.date_str ? new Date(formData.date_str) : null}\n                                    value={formData.date_str ? format(\n                                        new Date(formData.date_str),\n                                        \"MMMM d, yyyy h:mm aa\"\n                                    ) : null}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                    showTimeSelect\n                                    timeIntervals=\"1\"\n                                    onChange={(value) => {\n                                        console.log(\"Value\", value);\n                                        formData.date_str = value;\n                                        // formData.date_str = format(new Date(value), \"MMMM d yyyy h:mm aa\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n\n\n                        <div className=\"col-md-12\">\n                            <label className=\"form-label\">Product Search*</label>\n                            {/*  \n                            <Form.Check\n                                type=\"switch\"\n                                as=\"input\"\n                                id=\"use_laser_scanner\"\n                                label=\"Use Laser Scanner to Read Barcode\"\n                                onChange={(e) => {\n\n                                    formData.useLaserScanner = !formData.useLaserScanner;\n\n                                    if (formData.useLaserScanner) {\n                                        console.log(\"adding keydown event\");\n                                        document.addEventListener(\"keydown\", keyPress);\n                                    } else {\n                                        console.log(\"removing keydown event\");\n                                        document.removeEventListener(\"keydown\", keyPress);\n                                    }\n\n                                    console.log(\"e.target.value:\", formData.useLaserScanner);\n\n                                    setFormData({ ...formData });\n\n                                }}\n                            />\n                            */}\n\n                            <Typeahead\n                                id=\"product_id\"\n                                size=\"lg\"\n                                labelKey=\"search_label\"\n                                emptyLabel=\"\"\n                                clearButton={true}\n                                open={openProductSearchResult}\n                                isLoading={isProductsLoading}\n                                isInvalid={errors.product_id ? true : false}\n                                onChange={(selectedItems) => {\n                                    if (selectedItems.length === 0) {\n                                        errors[\"product_id\"] = \"Invalid Product selected\";\n                                        setErrors(errors);\n                                        return;\n                                    }\n                                    errors[\"product_id\"] = \"\";\n                                    setErrors({ ...errors });\n\n                                    if (formData.store_id) {\n                                        addProduct(selectedItems[0]);\n\n                                    }\n                                    setOpenProductSearchResult(false);\n                                }}\n                                options={productOptions}\n                                selected={selectedProduct}\n                                placeholder=\"Search By Part No. / Name / Name in Arabic\"\n                                highlightOnlyResult={true}\n                                onInputChange={(searchTerm, e) => {\n                                    suggestProducts(searchTerm);\n                                }}\n                            />\n                            <Button hide={true.toString()} onClick={openProductCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                            {errors.product_id ? (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.product_id}\n                                </div>\n                            ) : \"\"}\n                        </div>\n\n\n\n                        <div className=\"table-responsive\" style={{ overflowX: \"auto\", maxHeight: \"400px\", overflowY: \"auto\" }}>\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <thead>\n                                    <tr className=\"text-center\">\n                                        <th style={{ width: \"3%\" }}>Remove</th>\n                                        <th style={{ width: \"5%\" }}>SI No.</th>\n                                        <th style={{ width: \"10%\" }}>Part No.</th>\n                                        <th style={{ width: \"30%\" }} className=\"text-start\">Name</th>\n                                        <th style={{ width: \"15%\" }} >Qty</th>\n                                        <th style={{ width: \"18%\" }}>Unit Price</th>\n                                        <th style={{ width: \"32%\" }}>Price</th>\n\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {selectedProducts.map((product, index) => (\n                                        <tr className=\"text-center\" key={index}>\n                                            <td>\n                                                <div\n                                                    style={{ color: \"red\", cursor: \"pointer\" }}\n                                                    onClick={() => {\n                                                        removeProduct(product);\n                                                    }}\n                                                >\n                                                    <i className=\"bi bi-x-lg\"> </i>\n                                                </div>\n                                            </td>\n                                            <td >{index + 1}</td>\n                                            <td  >{product.part_number}</td>\n                                            <td style={{\n                                                textDecoration: \"underline\",\n                                                color: \"blue\",\n                                                cursor: \"pointer\",\n\n                                            }}\n                                                className=\"text-start\"\n                                                onClick={() => {\n                                                    openProductDetailsView(product.product_id);\n                                                }}>{product.name}\n                                            </td>\n                                            <td >\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.quantity} className=\"form-control text-end\"\n\n                                                        placeholder=\"Quantity\" onChange={(e) => {\n                                                            errors[\"quantity_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"quantity_\" + index] = \"Invalid Quantity\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"quantity_\" + index] = \"Quantity should be > 0\";\n                                                                selectedProducts[index].quantity = e.target.value;\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            product.quantity = parseFloat(e.target.value);\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            reCalculate();\n\n                                                            let stock = 0;\n                                                            if (selectedProducts[index].product_stores) {\n                                                                stock = selectedProducts[index].product_stores[formData.store_id]?.stock;\n                                                                // stock = GetProductStockInStore(formData.store_id, selectedProducts[index].stores);\n                                                            }\n\n                                                            if (stock < parseFloat(e.target.value) && selectedProducts[index].product_stores) {\n                                                                // errors[\"quantity_\" + index] = \" Warning: Stock is only \" + stock + \" in Store: \" + formData.store_name + \" for this product\";\n                                                                errors[\"quantity_\" + index] = \" Warning: Available stock is \" + stock;\n                                                                setErrors({ ...errors });\n                                                                return;\n                                                            }\n\n                                                            selectedProducts[index].quantity = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].quantity:\", selectedProducts[index].quantity);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">{selectedProducts[index].unit ? selectedProducts[index].unit : \"Units\"}</span>\n                                                </div>\n                                                {errors[\"quantity_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        {errors[\"quantity_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td>\n\n                                                <div className=\"input-group mb-3\">\n                                                    <input type=\"number\" value={product.unit_price} className=\"form-control text-end\"\n\n                                                        placeholder=\"Unit Price\" onChange={(e) => {\n                                                            errors[\"unit_price_\" + index] = \"\";\n                                                            setErrors({ ...errors });\n                                                            if (!e.target.value) {\n                                                                errors[\"unit_price_\" + index] = \"Invalid Unit Price\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n                                                            if (e.target.value === 0) {\n                                                                errors[\"unit_price_\" + index] = \"Unit Price should be > 0\";\n                                                                selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                                setSelectedProducts([...selectedProducts]);\n                                                                setErrors({ ...errors });\n                                                                console.log(\"errors:\", errors);\n                                                                return;\n                                                            }\n\n\n                                                            selectedProducts[index].unit_price = parseFloat(e.target.value);\n                                                            console.log(\"selectedProducts[index].unit_price:\", selectedProducts[index].unit_price);\n                                                            setSelectedProducts([...selectedProducts]);\n                                                            reCalculate();\n\n                                                        }} />\n                                                    <span className=\"input-group-text\" id=\"basic-addon2\">SAR</span>\n                                                </div>\n                                                {errors[\"unit_price_\" + index] && (\n                                                    <div style={{ color: \"red\" }}>\n                                                        <i className=\"bi bi-x-lg\"> </i>\n                                                        {errors[\"unit_price_\" + index]}\n                                                    </div>\n                                                )}\n\n                                            </td>\n                                            <td className=\"text-end\" >\n                                                <NumberFormat\n                                                    value={(product.unit_price * product.quantity).toFixed(2)}\n                                                    displayType={\"text\"}\n                                                    thousandSeparator={true}\n                                                    suffix={\" SAR\"}\n                                                    renderText={(value, props) => value}\n                                                />\n                                            </td>\n                                        </tr>\n                                    )).reverse()}\n                                </tbody>\n                            </table>\n                        </div>\n                        <div className=\"table-responsive\">\n                            <table className=\"table table-striped table-sm table-bordered\">\n                                <tbody>\n                                    <tr>\n\n\n                                        <th colSpan=\"8\" className=\"text-end\">Total</th>\n                                        <td className=\"text-end\" style={{ width: \"200px\" }} >\n                                            <NumberFormat\n                                                value={totalPrice?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Shipping & Handling Fees\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.shipping_handling_fees} onChange={(e) => {\n\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"shipping_handling_fees\"] = \"Shipping / Handling Fees should be > 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.shipping_handling_fees = \"\";\n                                                    errors[\"shipping_handling_fees\"] = \"Invalid Shipping / Handling Fees\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"shipping_handling_fees\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.shipping_handling_fees = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.shipping_handling_fees && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.shipping_handling_fees}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <th colSpan=\"8\" className=\"text-end\">\n                                            Discount  <input type=\"number\" style={{ width: \"50px\" }} className=\"text-start\" value={formData.discount_percent} onChange={(e) => {\n                                                formData.is_discount_percent = true;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount_percent = parseFloat(e.target.value);\n                                                    formData.discount = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount_percent\"] = \"Discount percent should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount_percent = \"\";\n                                                    formData.discount = 0.00;\n                                                    errors[\"discount_percent\"] = \"Invalid Discount Percent\";\n                                                    setFormData({ ...formData });\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount_percent\"] = \"\";\n                                                errors[\"discount\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />{\"%\"}\n                                            {errors.discount_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <input type=\"number\" style={{ width: \"150px\" }} className=\"text-start\" value={formData.discount} onChange={(e) => {\n                                                formData.is_discount_percent = false;\n                                                if (parseFloat(e.target.value) === 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (parseFloat(e.target.value) < 0) {\n                                                    formData.discount = parseFloat(e.target.value);\n                                                    formData.discount_percent = 0.00;\n                                                    setFormData({ ...formData });\n                                                    errors[\"discount\"] = \"Discount should be >= 0\";\n                                                    setErrors({ ...errors });\n                                                    reCalculate();\n                                                    return;\n                                                }\n\n                                                if (!e.target.value) {\n                                                    formData.discount = \"\";\n                                                    formData.discount_percent = 0.00;\n                                                    errors[\"discount\"] = \"Invalid Discount\";\n                                                    setFormData({ ...formData });\n                                                    reCalculate();\n                                                    setErrors({ ...errors });\n                                                    return;\n                                                }\n\n                                                errors[\"discount\"] = \"\";\n                                                errors[\"discount_percent\"] = \"\";\n                                                setErrors({ ...errors });\n\n                                                formData.discount = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                reCalculate();\n                                            }} />\n                                            {\" SAR\"}\n                                            {errors.discount && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.discount}\n                                                </div>\n                                            )}\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\"> VAT  <input type=\"number\" className=\"text-center\" style={{ width: \"50px\" }} value={formData.vat_percent} onChange={(e) => {\n                                            console.log(\"Inside onchange vat percent\");\n                                            if (parseFloat(e.target.value) === 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n                                            if (parseFloat(e.target.value) < 0) {\n                                                formData.vat_percent = parseFloat(e.target.value);\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                setFormData({ ...formData });\n                                                errors[\"vat_percent\"] = \"Vat percent should be >= 0\";\n                                                setErrors({ ...errors });\n                                                reCalculate();\n                                                return;\n                                            }\n\n\n                                            if (!e.target.value) {\n                                                formData.vat_percent = \"\";\n                                                vatPrice = 0.00;\n                                                setVatPrice(vatPrice);\n                                                //formData.discount_percent = 0.00;\n                                                errors[\"vat_percent\"] = \"Invalid vat percent\";\n                                                setFormData({ ...formData });\n                                                setErrors({ ...errors });\n                                                return;\n                                            }\n                                            errors[\"vat_percent\"] = \"\";\n                                            setErrors({ ...errors });\n\n                                            formData.vat_percent = e.target.value;\n                                            reCalculate();\n                                            setFormData({ ...formData });\n                                            console.log(formData);\n                                        }} />{\"%\"}\n                                            {errors.vat_percent && (\n                                                <div style={{ color: \"red\" }}>\n                                                    {errors.vat_percent}\n                                                </div>\n                                            )}\n                                        </th>\n                                        <td className=\"text-end\">\n                                            <NumberFormat\n                                                value={vatPrice?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </td>\n                                    </tr>\n                                    <tr>\n\n                                        <th colSpan=\"8\" className=\"text-end\">Net Total</th>\n                                        <th className=\"text-end\">\n                                            <NumberFormat\n                                                value={netTotal?.toFixed(2)}\n                                                displayType={\"text\"}\n                                                thousandSeparator={true}\n                                                suffix={\" SAR\"}\n                                                renderText={(value, props) => value}\n                                            />\n                                        </th>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n                        {/*  \n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Date*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"date_str\"\n                                    value={formData.date_str}\n                                    selected={selectedDate}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMM dd yyyy\"\n                                    onChange={(value) => {\n                                        formData.date_str = format(new Date(value), \"MMM dd yyyy\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">VAT %*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.vat_percent}\n                                    type='number'\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange vat percent\");\n                                        if (isNaN(e.target.value)) {\n                                            errors[\"vat_percent\"] = \"Invalid VAT percentage\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"vat_percent\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.vat_percent = e.target.value;\n                                        findVatPrice();\n                                        findNetTotal();\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom01\"\n                                    placeholder=\"VAT %\"\n                                    aria-label=\"Select Store\"\n                                    aria-describedby=\"button-addon1\"\n                                />\n                                {errors.vat_percent && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.vat_percent}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Discount*</label>\n                            <Form.Check\n                                type=\"switch\"\n                                id=\"custom-switch\"\n                                label=\"%\"\n                                value={formData.is_discount_percent}\n                                onChange={(e) => {\n                                    formData.is_discount_percent = !formData.is_discount_percent;\n                                    console.log(\"e.target.value:\", formData.is_discount_percent);\n                                    setFormData({ ...formData });\n                                    reCalculate();\n                                }}\n                            />\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.discountValue}\n                                    type='number'\n                                    onChange={(e) => {\n\n                                        if (parseFloat(e.target.value) === 0) {\n                                            formData.discountValue = parseFloat(e.target.value);\n                                            setFormData({ ...formData });\n                                            errors[\"discount\"] = \"\";\n                                            setErrors({ ...errors });\n                                            reCalculate();\n                                            return;\n                                        }\n\n                                        if (!e.target.value) {\n                                            formData.discountValue = \"\";\n                                            errors[\"discount\"] = \"Invalid Discount\";\n                                            setFormData({ ...formData });\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"discount\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.discountValue = e.target.value;\n                                        setFormData({ ...formData });\n                                        reCalculate();\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Discount\"\n                                    aria-label=\"Select Customer\"\n                                    aria-describedby=\"button-addon2\"\n                                />\n                                {errors.discount && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.discount}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n\n                        {/*  \n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Delivered By*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"delivered_by\"\n                                    labelKey=\"name\"\n                                    isLoading={isDeliveredByUsersLoading}\n                                    isInvalid={errors.delivered_by ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.delivered_by = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.delivered_by = \"Invalid User Selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedDeliveredByUsers([]);\n                                            return;\n                                        }\n                                        formData.delivered_by = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedDeliveredByUsers(selectedItems);\n                                    }}\n                                    options={deliveredByUserOptions}\n                                    placeholder=\"Select User\"\n                                    selected={selectedDeliveredByUsers}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestUsers(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openUserCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.delivered_by ? (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i> {errors.delivered_by}\n                                    </div>\n                                ) : \"\"}\n                            </div>\n                        </div>\n                                */}\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">\n                                Delivered By Signature(Optional)\n                            </label>\n\n                            <div className=\"input-group mb-3\">\n                                <Typeahead\n                                    id=\"delivered_by_signature_id\"\n                                    labelKey=\"name\"\n                                    isLoading={isDeliveredBySignaturesLoading}\n                                    isInvalid={errors.delivered_by_signature_id ? true : false}\n                                    onChange={(selectedItems) => {\n                                        errors.delivered_by_signature_id = \"\";\n                                        setErrors(errors);\n                                        if (selectedItems.length === 0) {\n                                            errors.delivered_by_signature_id =\n                                                \"Invalid Signature Selected\";\n                                            setErrors(errors);\n                                            setFormData({ ...formData });\n                                            setSelectedDeliveredBySignatures([]);\n                                            return;\n                                        }\n                                        formData.delivered_by_signature_id = selectedItems[0].id;\n                                        setFormData({ ...formData });\n                                        setSelectedDeliveredBySignatures(selectedItems);\n                                    }}\n                                    options={deliveredBySignatureOptions}\n                                    placeholder=\"Select Signature\"\n                                    selected={selectedDeliveredBySignatures}\n                                    highlightOnlyResult={true}\n                                    onInputChange={(searchTerm, e) => {\n                                        suggestSignatures(searchTerm);\n                                    }}\n                                />\n\n                                <Button hide={true.toString()} onClick={openSignatureCreateForm} className=\"btn btn-outline-secondary btn-primary btn-sm\" type=\"button\" id=\"button-addon1\"> <i className=\"bi bi-plus-lg\"></i> New</Button>\n                                {errors.delivered_by_signature_id ? (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>{\" \"}\n                                        {errors.delivered_by_signature_id}\n                                    </div>\n                                ) : \"\"}\n                            </div>\n                        </div>\n\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">Signature Date(Optional)</label>\n\n                            <div className=\"input-group mb-3\">\n                                <DatePicker\n                                    id=\"signature_date_str\"\n                                    value={formData.signature_date_str}\n                                    selected={selectedDate}\n                                    className=\"form-control\"\n                                    dateFormat=\"MMM dd yyyy\"\n                                    onChange={(value) => {\n                                        formData.signature_date_str = format(new Date(value), \"MMM dd yyyy\");\n                                        setFormData({ ...formData });\n                                    }}\n                                />\n\n                                {errors.signature_date_str && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.signature_date_str}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n                        <div className=\"col-md-2\">\n                            <label className=\"form-label\">Cash discount</label>\n                            <input type='number' value={formData.cash_discount} className=\"form-control \"\n                                onChange={(e) => {\n                                    errors[\"cash_discount\"] = \"\";\n                                    setErrors({ ...errors });\n                                    if (!e.target.value) {\n                                        formData.cash_discount = e.target.value;\n                                        setFormData({ ...formData });\n                                        validatePaymentAmounts();\n                                        return;\n                                    }\n                                    formData.cash_discount = parseFloat(e.target.value);\n                                    if (formData.cash_discount > 0 && formData.cash_discount >= netTotal) {\n                                        errors[\"cash_discount\"] = \"Cash discount should not be >= \" + netTotal.toString();\n                                        setErrors({ ...errors });\n                                        return;\n                                    }\n\n                                    setFormData({ ...formData });\n                                    validatePaymentAmounts();\n                                    console.log(formData);\n                                }}\n                            />\n                            {errors.cash_discount && (\n                                <div style={{ color: \"red\" }}>\n                                    <i className=\"bi bi-x-lg\"> </i>\n                                    {errors.cash_discount}\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"col-md-8\">\n                            <label className=\"form-label\">Payments Received</label>\n\n                            <div class=\"table-responsive\" style={{ maxWidth: \"900px\" }}>\n                                <Button variant=\"secondary\" style={{ alignContent: \"right\" }} onClick={addNewPayment}>\n                                    Create new payment\n                                </Button>\n                                <table class=\"table table-striped table-sm table-bordered\">\n                                    <thead>\n                                        <th>\n                                            Date\n                                        </th>\n                                        <th>\n                                            Amount\n                                        </th>\n                                        <th>\n                                            Payment method\n                                        </th>\n                                        <th>\n                                            Action\n                                        </th>\n                                    </thead>\n                                    <tbody>\n                                        {formData.payments_input &&\n                                            formData.payments_input.filter(payment => !payment.deleted).map((payment, key) => (\n                                                <tr key={key}>\n                                                    <td style={{ minWidth: \"220px\" }}>\n\n                                                        <DatePicker\n                                                            id=\"date_str\"\n                                                            selected={formData.payments_input[key].date_str ? new Date(formData.payments_input[key].date_str) : null}\n                                                            value={formData.payments_input[key].date_str ? format(\n                                                                new Date(formData.payments_input[key].date_str),\n                                                                \"MMMM d, yyyy h:mm aa\"\n                                                            ) : null}\n                                                            className=\"form-control\"\n                                                            dateFormat=\"MMMM d, yyyy h:mm aa\"\n                                                            showTimeSelect\n                                                            timeIntervals=\"1\"\n                                                            onChange={(value) => {\n                                                                console.log(\"Value\", value);\n                                                                formData.payments_input[key].date_str = value;\n                                                                let paymentDate = new Date(formData.payments_input[key].date_str)\n                                                                let orderDate = new Date(formData.date_str)\n\n\n                                                                let paymentYear = paymentDate.getFullYear();\n                                                                let paymentMonth = paymentDate.getMonth();\n                                                                let paymentDay = paymentDate.getDate();\n                                                                let paymentMinutes = paymentDate.getMinutes();\n                                                                var paymentHours = paymentDate.getHours();\n\n                                                                let orderYear = orderDate.getFullYear();\n                                                                let orderMonth = orderDate.getMonth();\n                                                                let orderDay = orderDate.getDate();\n                                                                let orderMinutes = orderDate.getMinutes();\n                                                                var orderHours = orderDate.getHours();\n\n                                                                if (paymentYear == orderYear\n                                                                    && paymentMonth == orderMonth\n                                                                    && paymentDay == orderDay\n                                                                    && paymentHours == orderHours\n                                                                    && paymentMinutes == orderMinutes) {\n                                                                    formData.date_str = formData.payments_input[key].date_str;\n\n                                                                }\n                                                                setFormData({ ...formData });\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_date_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_date_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"300px\" }}>\n                                                        <input type='number' value={formData.payments_input[key].amount} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                errors[\"payment_amount_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    formData.payments_input[key].amount = e.target.value;\n                                                                    setFormData({ ...formData });\n                                                                    validatePaymentAmounts();\n                                                                    return;\n                                                                }\n\n                                                                formData.payments_input[key].amount = parseFloat(e.target.value);\n\n                                                                validatePaymentAmounts();\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        />\n                                                        {errors[\"payment_amount_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_amount_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <select value={formData.payments_input[key].method} className=\"form-control \"\n                                                            onChange={(e) => {\n                                                                // errors[\"payment_method\"] = [];\n                                                                errors[\"payment_method_\" + key] = \"\";\n                                                                setErrors({ ...errors });\n\n                                                                if (!e.target.value) {\n                                                                    errors[\"payment_method_\" + key] = \"Payment method is required\";\n                                                                    setErrors({ ...errors });\n\n                                                                    formData.payments_input[key].method = \"\";\n                                                                    setFormData({ ...formData });\n                                                                    return;\n                                                                }\n\n                                                                // errors[\"payment_method\"] = \"\";\n                                                                //setErrors({ ...errors });\n\n                                                                formData.payments_input[key].method = e.target.value;\n                                                                setFormData({ ...formData });\n                                                                console.log(formData);\n                                                            }}\n                                                        >\n                                                            <option value=\"\">Select</option>\n                                                            <option value=\"cash\">Cash</option>\n                                                            <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                                            <option value=\"customer_account\">Customer Account</option>\n                                                        </select>\n                                                        {errors[\"payment_method_\" + key] && (\n                                                            <div style={{ color: \"red\" }}>\n                                                                <i className=\"bi bi-x-lg\"> </i>\n                                                                {errors[\"payment_method_\" + key]}\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                    <td style={{ width: \"200px\" }}>\n                                                        <Button variant=\"danger\" onClick={(event) => {\n                                                            removePayment(key);\n                                                        }}>\n                                                            Remove\n                                                        </Button>\n\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                        <tr>\n                                            <td class=\"text-end\">\n                                                <b>Total</b>\n                                            </td>\n                                            <td><b>{getTotalPayments()}</b></td>\n                                            <td colSpan={2}></td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n\n                        {/*\n                        {!formData.id ? <div className=\"col-md-2\">\n                            <label className=\"form-label\">Payment method*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <select\n                                    value={formData.payment_method}\n                                    disabled={formData.payment_status == \"not_paid\" ? \"disabled\" : \"\"}\n                                    onChange={(e) => {\n                                        if (!e.target.value) {\n                                            errors[\"payment_method\"] = \"Payment method is required\";\n                                            setErrors({ ...errors });\n                                            formData.payment_method = \"\";\n                                            setFormData({ ...formData });\n                                            return;\n                                        }\n\n                                        errors[\"payment_method\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.payment_method = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                >\n                                    <option value=\"\">Select</option>\n                                    <option value=\"cash\">Cash</option>\n                                    <option value=\"bank_account\">Bank Account / Debit / Credit Card</option>\n                                    <option value=\"customer_account\">Customer Account</option>\n                                </select>\n                                {errors.payment_method && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.payment_method}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n                        {!formData.id ? <div className=\"col-md-2\">\n                            <label className=\"form-label\">Payment Status*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <select\n                                    value={formData.payment_status}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange payment Status\");\n                                        if (!e.target.value) {\n                                            errors[\"payment_status\"] = \"Payment status is required\";\n                                            formData.payment_status = \"\";\n                                            setFormData({ ...formData });\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n\n                                        errors[\"payment_status\"] = \"\";\n                                        setErrors({ ...errors });\n\n                                        formData.payment_status = e.target.value;\n                                        if (formData.payment_status !== \"paid_partially\") {\n                                            formData.partial_payment_amount = 0.00;\n                                        }\n                                        setFormData({ ...formData });\n\n                                        if (formData.payment_status == \"not_paid\") {\n                                            formData.payment_method = \"\";\n                                            setFormData({ ...formData });\n                                        }\n\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                >\n                                    <option value=\"\">Select</option>\n                                    <option value=\"paid\">Paid</option>\n                                    <option value=\"not_paid\">Not Paid</option>\n                                    <option value=\"paid_partially\">Paid Partially</option>\n                                </select>\n                                {errors.payment_status && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.payment_status}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n\n\n                        {!formData.id && formData.payment_status === \"paid_partially\" ? <div className=\"col-md-3\">\n                            <label className=\"form-label\">Patial Payment Amount*</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    type='number'\n                                    value={formData.partial_payment_amount}\n                                    onChange={(e) => {\n                                        console.log(\"Inside onchange vat discount\");\n                                        if (!e.target.value) {\n                                            formData.partial_payment_amount = e.target.value;\n                                            errors[\"partial_payment_amount\"] = \"Invalid partial payment amount\";\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        formData.partial_payment_amount = parseFloat(e.target.value);\n                                        errors[\"partial_payment_amount\"] = \"\";\n\n                                        if (!formData.id && formData.partial_payment_amount >= netTotal) {\n                                            errors[\"partial_payment_amount\"] = \"Partial payment cannot be >= \" + netTotal;\n                                            setErrors({ ...errors });\n                                            return;\n                                        }\n                                        setErrors({ ...errors });\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"validationCustom02\"\n                                    placeholder=\"Amount\"\n                                />\n                                {errors.partial_payment_amount && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.partial_payment_amount}\n                                    </div>\n                                )}\n                            </div>\n                        </div> : \"\"}\n                                */}\n\n\n\n                        {/*\n                        <div className=\"col-md-6\">\n                            <label className=\"form-label\">ID</label>\n\n                            <div className=\"input-group mb-3\">\n                                <input\n                                    value={formData.code ? formData.code : \"\"}\n                                    type='string'\n                                    onChange={(e) => {\n                                        errors[\"code\"] = \"\";\n                                        setErrors({ ...errors });\n                                        formData.code = e.target.value;\n                                        setFormData({ ...formData });\n                                        console.log(formData);\n                                    }}\n                                    className=\"form-control\"\n                                    id=\"code\"\n                                    placeholder=\"Code\"\n                                />\n                                {errors.code && (\n                                    <div style={{ color: \"red\" }}>\n                                        <i className=\"bi bi-x-lg\"> </i>\n                                        {errors.code}\n                                    </div>\n                                )}\n                                {formData.code && !errors.code && (\n                                    <div style={{ color: \"green\" }}>\n                                        <i className=\"bi bi-check-lg\"> </i>\n                                        Looks good!\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                                */}\n\n                        <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={handleClose}>\n                                Close\n                            </Button>\n                            <Button variant=\"primary\" onClick={handleCreate}>\n                                {isProcessing ? formData.id ? \"Updating....\" : \"Creating..\" : formData.id ? \"Update\" : \"Create\"\n                                }\n                            </Button>\n                        </Modal.Footer>\n                    </form>\n                </Modal.Body>\n\n            </Modal >\n\n\n        </>\n    );\n});\n\nexport default OrderCreate;\n"]},"metadata":{},"sourceType":"module"}