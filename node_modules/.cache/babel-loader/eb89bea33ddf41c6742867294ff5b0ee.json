{"ast":null,"code":"var _jsxFileName = \"/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/posting/printPreview.js\",\n    _s = $RefreshSig$();\n\nimport { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport BalanceSheetPrintPreviewContent from './printPreviewContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst BalanceSheetPrintPreview = /*#__PURE__*/forwardRef(_c = _s((props, ref) => {\n  _s();\n\n  useImperativeHandle(ref, () => ({\n    open(modelObj) {\n      console.log(\"modelObj:\", modelObj);\n\n      if (modelObj) {\n        model = modelObj;\n        setModel({ ...model\n        });\n\n        if (model.store_id) {\n          getStore(model.store_id);\n        }\n        /*\n        if (model.reference_model===\"customer\") {\n            getCustomer(model.reference_id);\n        }\n        */\n\n        /*\n        if (model.delivered_by) {\n            getUser(model.delivered_by);\n        }\n        \n         if (model.delivered_by_signature_id) {\n            getSignature(model.delivered_by_signature_id);\n        }\n        */\n\n\n        let pageSize = 20;\n        model.pageSize = pageSize;\n        let totalPosts = model.posts.length;\n        let top = 0;\n        let totalPagesInt = parseInt(totalPosts / pageSize);\n        let totalPagesFloat = parseFloat(totalPosts / pageSize);\n        let totalPages = totalPagesInt;\n\n        if (totalPagesFloat - totalPagesInt > 0) {\n          totalPages++;\n        }\n\n        model.total_pages = totalPages;\n        model.pages = [];\n        let offset = 0;\n\n        for (let i = 0; i < totalPages; i++) {\n          model.pages.push({\n            top: top,\n            posts: [],\n            lastPage: false,\n            firstPage: false\n          });\n\n          for (let j = offset; j < totalPosts; j++) {\n            for (let k = 0; k < model.posts[j].posts.length; k++) {\n              model.pages[i].posts.push({\n                \"date\": model.posts[j].posts[k].date,\n                \"debit_account\": model.posts[j].posts[k].debit_or_credit === \"debit\" ? \"To \" + model.posts[j].posts[k].account_name + \" A/c #\" + model.posts[j].posts[k].account_number + \" Dr.\" : \"\",\n                \"debit_account_number\": model.posts[j].posts[k].debit_or_credit === \"debit\" ? model.posts[j].posts[k].account_number : \"\",\n                \"credit_account\": model.posts[j].posts[k].debit_or_credit === \"credit\" ? \"By \" + model.posts[j].posts[k].account_name + \" A/c #\" + model.posts[j].posts[k].account_number + \" Cr.\" : \"\",\n                \"credit_account_number\": model.posts[j].posts[k].debit_or_credit === \"credit\" ? model.posts[j].posts[k].account_number : \"\",\n                \"debit_or_credit\": model.posts[j].posts[k].debit_or_credit,\n                \"debit_amount\": model.posts[j].posts[k].debit ? model.posts[j].posts[0].debit : \"\",\n                \"credit_amount\": model.posts[j].posts[k].credit ? model.posts[j].posts[0].credit : \"\",\n                \"reference_code\": model.posts[j].reference_code,\n                \"reference_model\": model.posts[j].reference_model\n              });\n            } //  model.pages[i].posts.push(model.posts[j]);\n\n\n            if (model.pages[i].posts.length === pageSize) {\n              break;\n            }\n          }\n\n          if (model.pages[i].posts.length < pageSize) {\n            for (let s = model.pages[i].posts.length; s < pageSize; s++) {\n              model.pages[i].posts.push({});\n            }\n          }\n\n          top += 1557; //1057\n\n          offset += pageSize;\n\n          if (i === 0) {\n            model.pages[i].firstPage = true;\n          }\n\n          if (i + 1 === totalPages) {\n            model.pages[i].lastPage = true;\n          }\n        }\n\n        console.log(\"model.pages:\", model.pages);\n        console.log(\"model.posts:\", model.posts); //  getQRCodeContents();\n        //model.qr_content = getQRCodeContents();\n        //setModel({ ...model });\n\n        setShow(true);\n        console.log(\"model:\", model);\n      }\n    }\n\n  }));\n  const cookies = new Cookies();\n  let [model, setModel] = useState({});\n  const [show, setShow] = useState(props.show);\n\n  function handleClose() {\n    setShow(false);\n  }\n\n  let [qrContent, setQrContent] = useState(\"\");\n\n  function getQRCodeContents() {\n    qrContent = \"\";\n\n    if (model.code) {\n      qrContent += \"Invoice #: \" + model.code + \"<br />\";\n    }\n\n    if (model.store) {\n      qrContent += \"Store: \" + model.store.name + \"<br />\";\n    }\n\n    if (model.customer) {\n      qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n    }\n\n    if (model.net_total) {\n      qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n    }\n\n    qrContent += \"Store: Test <br />\";\n    setQrContent(qrContent);\n    model.qr_content = qrContent;\n    setModel({ ...model\n    });\n    console.log(\"QR content:\", model.qr_content);\n    return model.qr_content;\n  }\n\n  function getStore(id) {\n    console.log(\"inside get Store\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/store/' + id, requestOptions).then(async response => {\n      var _response$headers$get;\n\n      const isJson = (_response$headers$get = response.headers.get('content-type')) === null || _response$headers$get === void 0 ? void 0 : _response$headers$get.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let storeData = data.result;\n      model.store = storeData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n\n  function getCustomer(id) {\n    console.log(\"inside get Customer\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/customer/' + id, requestOptions).then(async response => {\n      var _response$headers$get2;\n\n      const isJson = (_response$headers$get2 = response.headers.get('content-type')) === null || _response$headers$get2 === void 0 ? void 0 : _response$headers$get2.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let customerData = data.result;\n      model.customer = customerData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n\n  function getUser(id) {\n    console.log(\"inside get User(Delivered by)\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/user/' + id, requestOptions).then(async response => {\n      var _response$headers$get3;\n\n      const isJson = (_response$headers$get3 = response.headers.get('content-type')) === null || _response$headers$get3 === void 0 ? void 0 : _response$headers$get3.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let userData = data.result;\n      model.delivered_by_user = userData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n\n  function getSignature(id) {\n    console.log(\"inside get Signature\");\n    const requestOptions = {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': cookies.get('access_token')\n      }\n    };\n    fetch('/v1/signature/' + id, requestOptions).then(async response => {\n      var _response$headers$get4;\n\n      const isJson = (_response$headers$get4 = response.headers.get('content-type')) === null || _response$headers$get4 === void 0 ? void 0 : _response$headers$get4.includes('application/json');\n      const data = isJson && (await response.json()); // check for error response\n\n      if (!response.ok) {\n        const error = data && data.errors;\n        return Promise.reject(error);\n      }\n\n      console.log(\"Response:\");\n      console.log(data);\n      let signatureData = data.result;\n      model.delivered_by_signature = signatureData;\n      setModel({ ...model\n      });\n    }).catch(error => {});\n  }\n  /*\n  function print() {\n      console.log(\"Print\");\n  }\n  */\n\n\n  const printAreaRef = useRef();\n\n  function getFileName() {\n    let filename = \"Sales_\";\n\n    if (model.id) {\n      filename += \"_#\" + model.code;\n    }\n\n    return filename;\n  }\n\n  const handlePrint = useReactToPrint({\n    content: () => printAreaRef.current,\n    documentTitle: getFileName()\n  });\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      show: show,\n      scrollable: true,\n      size: \"xl\",\n      fullscreen: true,\n      onHide: handleClose,\n      animation: false,\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        children: [/*#__PURE__*/_jsxDEV(Modal.Title, {\n          children: \"Balance sheet preview\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col align-self-end text-end\",\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            className: \"btn btn-primary mb-3\",\n            onClick: handlePrint,\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-printer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 25\n            }, this), \" Print\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn-close\",\n            onClick: handleClose,\n            \"aria-label\": \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: printAreaRef,\n          children: /*#__PURE__*/_jsxDEV(BalanceSheetPrintPreviewContent, {\n            model: model\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n}, \"VzECNTOygkavqg0guOdvIcQjIBo=\", false, function () {\n  return [useImperativeHandle, useReactToPrint];\n}));\n_c2 = BalanceSheetPrintPreview;\nexport default BalanceSheetPrintPreview;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"BalanceSheetPrintPreview$forwardRef\");\n$RefreshReg$(_c2, \"BalanceSheetPrintPreview\");","map":{"version":3,"sources":["/Users/sirin/go/src/github.com/sirinibin/reactjs-pos/src/posting/printPreview.js"],"names":["React","useState","useRef","forwardRef","useImperativeHandle","Modal","Button","BalanceSheetPrintPreviewContent","Cookies","useReactToPrint","Invoice","BalanceSheetPrintPreview","props","ref","open","modelObj","console","log","model","setModel","store_id","getStore","pageSize","totalPosts","posts","length","top","totalPagesInt","parseInt","totalPagesFloat","parseFloat","totalPages","total_pages","pages","offset","i","push","lastPage","firstPage","j","k","date","debit_or_credit","account_name","account_number","debit","credit","reference_code","reference_model","s","setShow","cookies","show","handleClose","qrContent","setQrContent","getQRCodeContents","code","store","name","customer","net_total","qr_content","id","requestOptions","method","headers","get","fetch","then","response","isJson","includes","data","json","ok","error","errors","Promise","reject","storeData","result","catch","getCustomer","customerData","getUser","userData","delivered_by_user","getSignature","signatureData","delivered_by_signature","printAreaRef","getFileName","filename","handlePrint","content","current","documentTitle"],"mappings":";;;AAAA,SAASA,KAAT,EAAgBC,QAAhB,EAA0BC,MAA1B,EAAkCC,UAAlC,EAA8CC,mBAA9C,QAAyE,OAAzE;AACA,SAASC,KAAT,EAAgBC,MAAhB,QAA8B,iBAA9B;AACA,OAAOC,+BAAP,MAA4C,0BAA5C;AACA,OAAOC,OAAP,MAAoB,kBAApB;AACA,SAASC,eAAT,QAAgC,gBAAhC;AACA,SAASC,OAAT,QAAwB,eAAxB;;;AAEA,MAAMC,wBAAwB,gBAAGR,UAAU,SAAC,CAACS,KAAD,EAAQC,GAAR,KAAgB;AAAA;;AAExDT,EAAAA,mBAAmB,CAACS,GAAD,EAAM,OAAO;AAC5BC,IAAAA,IAAI,CAACC,QAAD,EAAW;AACXC,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBF,QAAzB;;AACA,UAAIA,QAAJ,EAAc;AACVG,QAAAA,KAAK,GAAGH,QAAR;AACAI,QAAAA,QAAQ,CAAC,EAAE,GAAGD;AAAL,SAAD,CAAR;;AAEA,YAAIA,KAAK,CAACE,QAAV,EAAoB;AAChBC,UAAAA,QAAQ,CAACH,KAAK,CAACE,QAAP,CAAR;AACH;AAED;AAChB;AACA;AACA;AACA;;AAEgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGgB,YAAIE,QAAQ,GAAG,EAAf;AACAJ,QAAAA,KAAK,CAACI,QAAN,GAAiBA,QAAjB;AACA,YAAIC,UAAU,GAAGL,KAAK,CAACM,KAAN,CAAYC,MAA7B;AACA,YAAIC,GAAG,GAAG,CAAV;AACA,YAAIC,aAAa,GAAGC,QAAQ,CAACL,UAAU,GAAGD,QAAd,CAA5B;AACA,YAAIO,eAAe,GAAGC,UAAU,CAACP,UAAU,GAAGD,QAAd,CAAhC;AAEA,YAAIS,UAAU,GAAGJ,aAAjB;;AACA,YAAKE,eAAe,GAAGF,aAAnB,GAAoC,CAAxC,EAA2C;AACvCI,UAAAA,UAAU;AACb;;AAEDb,QAAAA,KAAK,CAACc,WAAN,GAAoBD,UAApB;AAGAb,QAAAA,KAAK,CAACe,KAAN,GAAc,EAAd;AAGA,YAAIC,MAAM,GAAG,CAAb;;AAEA,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,UAApB,EAAgCI,CAAC,EAAjC,EAAqC;AACjCjB,UAAAA,KAAK,CAACe,KAAN,CAAYG,IAAZ,CAAiB;AACbV,YAAAA,GAAG,EAAEA,GADQ;AAEbF,YAAAA,KAAK,EAAE,EAFM;AAGba,YAAAA,QAAQ,EAAE,KAHG;AAIbC,YAAAA,SAAS,EAAE;AAJE,WAAjB;;AAOA,eAAK,IAAIC,CAAC,GAAGL,MAAb,EAAqBK,CAAC,GAAGhB,UAAzB,EAAqCgB,CAAC,EAAtC,EAA0C;AACtC,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBC,MAAzC,EAAiDe,CAAC,EAAlD,EAAsD;AAClDtB,cAAAA,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeX,KAAf,CAAqBY,IAArB,CAA0B;AACtB,wBAAQlB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBC,IADV;AAEtB,iCAAiBvB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBE,eAAxB,KAA4C,OAA5C,GAAsD,QAAMxB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBG,YAA9B,GAA2C,QAA3C,GAAoDzB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBI,cAA5E,GAA2F,MAAjJ,GAA0J,EAFrJ;AAGtB,wCAAwB1B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBE,eAAxB,KAA4C,OAA5C,GAAsDxB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBI,cAA9E,GAA+F,EAHjG;AAItB,kCAAkB1B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBE,eAAxB,KAA4C,QAA5C,GAAuD,QAAMxB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBG,YAA9B,GAA2C,QAA3C,GAAoDzB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBI,cAA5E,GAA2F,MAAlJ,GAA2J,EAJvJ;AAKtB,yCAAyB1B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBE,eAAxB,KAA4C,QAA5C,GAAuDxB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBI,cAA/E,GAAgG,EALnG;AAMtB,mCAAmB1B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBE,eANrB;AAOtB,gCAAgBxB,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBK,KAAxB,GAAgC3B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqB,CAArB,EAAwBqB,KAAxD,GAAgE,EAP1D;AAQtB,iCAAiB3B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqBgB,CAArB,EAAwBM,MAAxB,GAAiC5B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAef,KAAf,CAAqB,CAArB,EAAwBsB,MAAzD,GAAkE,EAR7D;AAStB,kCAAkB5B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAeQ,cATX;AAUtB,mCAAmB7B,KAAK,CAACM,KAAN,CAAYe,CAAZ,EAAeS;AAVZ,eAA1B;AAYH,aAdqC,CAetC;;;AAEA,gBAAI9B,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeX,KAAf,CAAqBC,MAArB,KAAgCH,QAApC,EAA8C;AAC1C;AACH;AACJ;;AAED,cAAIJ,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeX,KAAf,CAAqBC,MAArB,GAA8BH,QAAlC,EAA4C;AACxC,iBAAK,IAAI2B,CAAC,GAAG/B,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeX,KAAf,CAAqBC,MAAlC,EAA0CwB,CAAC,GAAG3B,QAA9C,EAAwD2B,CAAC,EAAzD,EAA6D;AACzD/B,cAAAA,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeX,KAAf,CAAqBY,IAArB,CAA0B,EAA1B;AACH;AACJ;;AAEDV,UAAAA,GAAG,IAAI,IAAP,CApCiC,CAoCpB;;AACbQ,UAAAA,MAAM,IAAIZ,QAAV;;AAEA,cAAIa,CAAC,KAAK,CAAV,EAAa;AACTjB,YAAAA,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeG,SAAf,GAA2B,IAA3B;AACH;;AAED,cAAKH,CAAC,GAAG,CAAL,KAAYJ,UAAhB,EAA4B;AACxBb,YAAAA,KAAK,CAACe,KAAN,CAAYE,CAAZ,EAAeE,QAAf,GAA0B,IAA1B;AACH;AACJ;;AAEDrB,QAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BC,KAAK,CAACe,KAAlC;AACAjB,QAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BC,KAAK,CAACM,KAAlC,EA9FU,CA+FV;AACA;AACA;;AAEA0B,QAAAA,OAAO,CAAC,IAAD,CAAP;AACAlC,QAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBC,KAAtB;AACH;AAEJ;;AA1G2B,GAAP,CAAN,CAAnB;AA8GA,QAAMiC,OAAO,GAAG,IAAI3C,OAAJ,EAAhB;AAEA,MAAI,CAACU,KAAD,EAAQC,QAAR,IAAoBlB,QAAQ,CAAC,EAAD,CAAhC;AAEA,QAAM,CAACmD,IAAD,EAAOF,OAAP,IAAkBjD,QAAQ,CAACW,KAAK,CAACwC,IAAP,CAAhC;;AAEA,WAASC,WAAT,GAAuB;AACnBH,IAAAA,OAAO,CAAC,KAAD,CAAP;AACH;;AAGD,MAAI,CAACI,SAAD,EAAYC,YAAZ,IAA4BtD,QAAQ,CAAC,EAAD,CAAxC;;AAEA,WAASuD,iBAAT,GAA6B;AACzBF,IAAAA,SAAS,GAAG,EAAZ;;AAEA,QAAIpC,KAAK,CAACuC,IAAV,EAAgB;AACZH,MAAAA,SAAS,IAAI,gBAAgBpC,KAAK,CAACuC,IAAtB,GAA6B,QAA1C;AACH;;AAED,QAAIvC,KAAK,CAACwC,KAAV,EAAiB;AACbJ,MAAAA,SAAS,IAAI,YAAYpC,KAAK,CAACwC,KAAN,CAAYC,IAAxB,GAA+B,QAA5C;AACH;;AAED,QAAIzC,KAAK,CAAC0C,QAAV,EAAoB;AAChBN,MAAAA,SAAS,IAAI,eAAepC,KAAK,CAAC0C,QAAN,CAAeD,IAA9B,GAAqC,QAAlD;AACH;;AAGD,QAAIzC,KAAK,CAAC2C,SAAV,EAAqB;AACjBP,MAAAA,SAAS,IAAI,gBAAgBpC,KAAK,CAAC2C,SAAtB,GAAkC,QAA/C;AACH;;AACDP,IAAAA,SAAS,IAAI,oBAAb;AAEAC,IAAAA,YAAY,CAACD,SAAD,CAAZ;AACApC,IAAAA,KAAK,CAAC4C,UAAN,GAAmBR,SAAnB;AACAnC,IAAAA,QAAQ,CAAC,EAAE,GAAGD;AAAL,KAAD,CAAR;AACAF,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BC,KAAK,CAAC4C,UAAjC;AAEA,WAAO5C,KAAK,CAAC4C,UAAb;AACH;;AAED,WAASzC,QAAT,CAAkB0C,EAAlB,EAAsB;AAClB/C,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACA,UAAM+C,cAAc,GAAG;AACnBC,MAAAA,MAAM,EAAE,KADW;AAEnBC,MAAAA,OAAO,EAAE;AACL,wBAAgB,kBADX;AAEL,yBAAiBf,OAAO,CAACgB,GAAR,CAAY,cAAZ;AAFZ;AAFU,KAAvB;AAQAC,IAAAA,KAAK,CAAC,eAAeL,EAAhB,EAAoBC,cAApB,CAAL,CACKK,IADL,CACU,MAAMC,QAAN,IAAkB;AAAA;;AACpB,YAAMC,MAAM,4BAAGD,QAAQ,CAACJ,OAAT,CAAiBC,GAAjB,CAAqB,cAArB,CAAH,0DAAG,sBAAsCK,QAAtC,CAA+C,kBAA/C,CAAf;AACA,YAAMC,IAAI,GAAGF,MAAM,KAAI,MAAMD,QAAQ,CAACI,IAAT,EAAV,CAAnB,CAFoB,CAIpB;;AACA,UAAI,CAACJ,QAAQ,CAACK,EAAd,EAAkB;AACd,cAAMC,KAAK,GAAIH,IAAI,IAAIA,IAAI,CAACI,MAA5B;AACA,eAAOC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH;;AAED5D,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYwD,IAAZ;AACA,UAAIO,SAAS,GAAGP,IAAI,CAACQ,MAArB;AACA/D,MAAAA,KAAK,CAACwC,KAAN,GAAcsB,SAAd;AAEA7D,MAAAA,QAAQ,CAAC,EAAE,GAAGD;AAAL,OAAD,CAAR;AACH,KAjBL,EAkBKgE,KAlBL,CAkBWN,KAAK,IAAI,CAEf,CApBL;AAqBH;;AAID,WAASO,WAAT,CAAqBpB,EAArB,EAAyB;AACrB/C,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACA,UAAM+C,cAAc,GAAG;AACnBC,MAAAA,MAAM,EAAE,KADW;AAEnBC,MAAAA,OAAO,EAAE;AACL,wBAAgB,kBADX;AAEL,yBAAiBf,OAAO,CAACgB,GAAR,CAAY,cAAZ;AAFZ;AAFU,KAAvB;AAQAC,IAAAA,KAAK,CAAC,kBAAkBL,EAAnB,EAAuBC,cAAvB,CAAL,CACKK,IADL,CACU,MAAMC,QAAN,IAAkB;AAAA;;AACpB,YAAMC,MAAM,6BAAGD,QAAQ,CAACJ,OAAT,CAAiBC,GAAjB,CAAqB,cAArB,CAAH,2DAAG,uBAAsCK,QAAtC,CAA+C,kBAA/C,CAAf;AACA,YAAMC,IAAI,GAAGF,MAAM,KAAI,MAAMD,QAAQ,CAACI,IAAT,EAAV,CAAnB,CAFoB,CAIpB;;AACA,UAAI,CAACJ,QAAQ,CAACK,EAAd,EAAkB;AACd,cAAMC,KAAK,GAAIH,IAAI,IAAIA,IAAI,CAACI,MAA5B;AACA,eAAOC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH;;AAED5D,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYwD,IAAZ;AACA,UAAIW,YAAY,GAAGX,IAAI,CAACQ,MAAxB;AACA/D,MAAAA,KAAK,CAAC0C,QAAN,GAAiBwB,YAAjB;AACAjE,MAAAA,QAAQ,CAAC,EAAE,GAAGD;AAAL,OAAD,CAAR;AACH,KAhBL,EAiBKgE,KAjBL,CAiBWN,KAAK,IAAI,CAEf,CAnBL;AAoBH;;AAED,WAASS,OAAT,CAAiBtB,EAAjB,EAAqB;AACjB/C,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ;AACA,UAAM+C,cAAc,GAAG;AACnBC,MAAAA,MAAM,EAAE,KADW;AAEnBC,MAAAA,OAAO,EAAE;AACL,wBAAgB,kBADX;AAEL,yBAAiBf,OAAO,CAACgB,GAAR,CAAY,cAAZ;AAFZ;AAFU,KAAvB;AAQAC,IAAAA,KAAK,CAAC,cAAcL,EAAf,EAAmBC,cAAnB,CAAL,CACKK,IADL,CACU,MAAMC,QAAN,IAAkB;AAAA;;AACpB,YAAMC,MAAM,6BAAGD,QAAQ,CAACJ,OAAT,CAAiBC,GAAjB,CAAqB,cAArB,CAAH,2DAAG,uBAAsCK,QAAtC,CAA+C,kBAA/C,CAAf;AACA,YAAMC,IAAI,GAAGF,MAAM,KAAI,MAAMD,QAAQ,CAACI,IAAT,EAAV,CAAnB,CAFoB,CAIpB;;AACA,UAAI,CAACJ,QAAQ,CAACK,EAAd,EAAkB;AACd,cAAMC,KAAK,GAAIH,IAAI,IAAIA,IAAI,CAACI,MAA5B;AACA,eAAOC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH;;AAGD5D,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYwD,IAAZ;AACA,UAAIa,QAAQ,GAAGb,IAAI,CAACQ,MAApB;AACA/D,MAAAA,KAAK,CAACqE,iBAAN,GAA0BD,QAA1B;AACAnE,MAAAA,QAAQ,CAAC,EAAE,GAAGD;AAAL,OAAD,CAAR;AACH,KAjBL,EAkBKgE,KAlBL,CAkBWN,KAAK,IAAI,CAEf,CApBL;AAqBH;;AAED,WAASY,YAAT,CAAsBzB,EAAtB,EAA0B;AACtB/C,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACA,UAAM+C,cAAc,GAAG;AACnBC,MAAAA,MAAM,EAAE,KADW;AAEnBC,MAAAA,OAAO,EAAE;AACL,wBAAgB,kBADX;AAEL,yBAAiBf,OAAO,CAACgB,GAAR,CAAY,cAAZ;AAFZ;AAFU,KAAvB;AAQAC,IAAAA,KAAK,CAAC,mBAAmBL,EAApB,EAAwBC,cAAxB,CAAL,CACKK,IADL,CACU,MAAMC,QAAN,IAAkB;AAAA;;AACpB,YAAMC,MAAM,6BAAGD,QAAQ,CAACJ,OAAT,CAAiBC,GAAjB,CAAqB,cAArB,CAAH,2DAAG,uBAAsCK,QAAtC,CAA+C,kBAA/C,CAAf;AACA,YAAMC,IAAI,GAAGF,MAAM,KAAI,MAAMD,QAAQ,CAACI,IAAT,EAAV,CAAnB,CAFoB,CAIpB;;AACA,UAAI,CAACJ,QAAQ,CAACK,EAAd,EAAkB;AACd,cAAMC,KAAK,GAAIH,IAAI,IAAIA,IAAI,CAACI,MAA5B;AACA,eAAOC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH;;AAED5D,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYwD,IAAZ;AACA,UAAIgB,aAAa,GAAGhB,IAAI,CAACQ,MAAzB;AACA/D,MAAAA,KAAK,CAACwE,sBAAN,GAA+BD,aAA/B;AACAtE,MAAAA,QAAQ,CAAC,EAAE,GAAGD;AAAL,OAAD,CAAR;AACH,KAhBL,EAiBKgE,KAjBL,CAiBWN,KAAK,IAAI,CACf,CAlBL;AAmBH;AAID;AACJ;AACA;AACA;AACA;;;AAEI,QAAMe,YAAY,GAAGzF,MAAM,EAA3B;;AAEA,WAAS0F,WAAT,GAAuB;AACnB,QAAIC,QAAQ,GAAG,QAAf;;AAEA,QAAI3E,KAAK,CAAC6C,EAAV,EAAc;AACV8B,MAAAA,QAAQ,IAAI,OAAO3E,KAAK,CAACuC,IAAzB;AACH;;AAED,WAAOoC,QAAP;AACH;;AAED,QAAMC,WAAW,GAAGrF,eAAe,CAAC;AAChCsF,IAAAA,OAAO,EAAE,MAAMJ,YAAY,CAACK,OADI;AAEhCC,IAAAA,aAAa,EAAEL,WAAW;AAFM,GAAD,CAAnC;AAMA,sBAAQ;AAAA,2BACJ,QAAC,KAAD;AAAO,MAAA,IAAI,EAAExC,IAAb;AAAmB,MAAA,UAAU,EAAE,IAA/B;AAAqC,MAAA,IAAI,EAAC,IAA1C;AAA+C,MAAA,UAAU,MAAzD;AAA0D,MAAA,MAAM,EAAEC,WAAlE;AAA+E,MAAA,SAAS,EAAE,KAA1F;AAAA,8BACI,QAAC,KAAD,CAAO,MAAP;AAAA,gCACI,QAAC,KAAD,CAAO,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI;AAAK,UAAA,SAAS,EAAC,6BAAf;AAAA,kCACI,QAAC,MAAD;AAAQ,YAAA,OAAO,EAAC,SAAhB;AAA0B,YAAA,SAAS,EAAC,sBAApC;AAA2D,YAAA,OAAO,EAAEyC,WAApE;AAAA,oCACI;AAAG,cAAA,SAAS,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA,oBADJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,eAII;AACI,YAAA,IAAI,EAAC,QADT;AAEI,YAAA,SAAS,EAAC,WAFd;AAGI,YAAA,OAAO,EAAEzC,WAHb;AAII,0BAAW;AAJf;AAAA;AAAA;AAAA;AAAA,kBAJJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,eAiBI,QAAC,KAAD,CAAO,IAAP;AAAA,+BACI;AAAK,UAAA,GAAG,EAAEsC,YAAV;AAAA,iCACI,QAAC,+BAAD;AAAiC,YAAA,KAAK,EAAEzE;AAAxC;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cAjBJ,eAsBI,QAAC,KAAD,CAAO,MAAP;AAAA;AAAA;AAAA;AAAA,cAtBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADI,mBAAR;AAoCH,CA3V0C;AAAA,UAEvCd,mBAFuC,EAiTnBK,eAjTmB;AAAA,GAA3C;MAAME,wB;AA6VN,eAAeA,wBAAf","sourcesContent":["import { React, useState, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport { Modal, Button } from 'react-bootstrap';\nimport BalanceSheetPrintPreviewContent from './printPreviewContent.js';\nimport Cookies from \"universal-cookie\";\nimport { useReactToPrint } from 'react-to-print';\nimport { Invoice } from '@axenda/zatca';\n\nconst BalanceSheetPrintPreview = forwardRef((props, ref) => {\n\n    useImperativeHandle(ref, () => ({\n        open(modelObj) {\n            console.log(\"modelObj:\", modelObj);\n            if (modelObj) {\n                model = modelObj;\n                setModel({ ...model })\n\n                if (model.store_id) {\n                    getStore(model.store_id);\n                }\n\n                /*\n                if (model.reference_model===\"customer\") {\n                    getCustomer(model.reference_id);\n                }\n                */\n\n                /*\n                if (model.delivered_by) {\n                    getUser(model.delivered_by);\n                }\n                \n\n                if (model.delivered_by_signature_id) {\n                    getSignature(model.delivered_by_signature_id);\n                }\n                */\n\n                let pageSize = 20;\n                model.pageSize = pageSize;\n                let totalPosts = model.posts.length;\n                let top = 0;\n                let totalPagesInt = parseInt(totalPosts / pageSize);\n                let totalPagesFloat = parseFloat(totalPosts / pageSize);\n\n                let totalPages = totalPagesInt;\n                if ((totalPagesFloat - totalPagesInt) > 0) {\n                    totalPages++;\n                }\n\n                model.total_pages = totalPages;\n\n\n                model.pages = [];\n\n\n                let offset = 0;\n\n                for (let i = 0; i < totalPages; i++) {\n                    model.pages.push({\n                        top: top,\n                        posts: [],\n                        lastPage: false,\n                        firstPage: false,\n                    });\n\n                    for (let j = offset; j < totalPosts; j++) {\n                        for (let k = 0; k < model.posts[j].posts.length; k++) {\n                            model.pages[i].posts.push({\n                                \"date\": model.posts[j].posts[k].date,\n                                \"debit_account\": model.posts[j].posts[k].debit_or_credit === \"debit\" ? \"To \"+model.posts[j].posts[k].account_name+\" A/c #\"+model.posts[j].posts[k].account_number+\" Dr.\" : \"\",\n                                \"debit_account_number\": model.posts[j].posts[k].debit_or_credit === \"debit\" ? model.posts[j].posts[k].account_number : \"\",\n                                \"credit_account\": model.posts[j].posts[k].debit_or_credit === \"credit\" ? \"By \"+model.posts[j].posts[k].account_name+\" A/c #\"+model.posts[j].posts[k].account_number+\" Cr.\" : \"\",\n                                \"credit_account_number\": model.posts[j].posts[k].debit_or_credit === \"credit\" ? model.posts[j].posts[k].account_number : \"\",\n                                \"debit_or_credit\": model.posts[j].posts[k].debit_or_credit,\n                                \"debit_amount\": model.posts[j].posts[k].debit ? model.posts[j].posts[0].debit : \"\",\n                                \"credit_amount\": model.posts[j].posts[k].credit ? model.posts[j].posts[0].credit : \"\",\n                                \"reference_code\": model.posts[j].reference_code,\n                                \"reference_model\": model.posts[j].reference_model,\n                            });\n                        }\n                        //  model.pages[i].posts.push(model.posts[j]);\n\n                        if (model.pages[i].posts.length === pageSize) {\n                            break;\n                        }\n                    }\n\n                    if (model.pages[i].posts.length < pageSize) {\n                        for (let s = model.pages[i].posts.length; s < pageSize; s++) {\n                            model.pages[i].posts.push({});\n                        }\n                    }\n\n                    top += 1557; //1057\n                    offset += pageSize;\n\n                    if (i === 0) {\n                        model.pages[i].firstPage = true;\n                    }\n\n                    if ((i + 1) === totalPages) {\n                        model.pages[i].lastPage = true;\n                    }\n                }\n\n                console.log(\"model.pages:\", model.pages);\n                console.log(\"model.posts:\", model.posts);\n                //  getQRCodeContents();\n                //model.qr_content = getQRCodeContents();\n                //setModel({ ...model });\n\n                setShow(true);\n                console.log(\"model:\", model);\n            }\n\n        },\n\n    }));\n\n    const cookies = new Cookies();\n\n    let [model, setModel] = useState({});\n\n    const [show, setShow] = useState(props.show);\n\n    function handleClose() {\n        setShow(false);\n    }\n\n\n    let [qrContent, setQrContent] = useState(\"\");\n\n    function getQRCodeContents() {\n        qrContent = \"\";\n\n        if (model.code) {\n            qrContent += \"Invoice #: \" + model.code + \"<br />\";\n        }\n\n        if (model.store) {\n            qrContent += \"Store: \" + model.store.name + \"<br />\";\n        }\n\n        if (model.customer) {\n            qrContent += \"Customer: \" + model.customer.name + \"<br />\";\n        }\n\n\n        if (model.net_total) {\n            qrContent += \"Net Total: \" + model.net_total + \"<br />\";\n        }\n        qrContent += \"Store: Test <br />\";\n\n        setQrContent(qrContent);\n        model.qr_content = qrContent;\n        setModel({ ...model });\n        console.log(\"QR content:\", model.qr_content);\n\n        return model.qr_content;\n    }\n\n    function getStore(id) {\n        console.log(\"inside get Store\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/store/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let storeData = data.result;\n                model.store = storeData;\n\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n\n\n    function getCustomer(id) {\n        console.log(\"inside get Customer\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/customer/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let customerData = data.result;\n                model.customer = customerData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getUser(id) {\n        console.log(\"inside get User(Delivered by)\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/user/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n\n                console.log(\"Response:\");\n                console.log(data);\n                let userData = data.result;\n                model.delivered_by_user = userData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n\n            });\n    }\n\n    function getSignature(id) {\n        console.log(\"inside get Signature\");\n        const requestOptions = {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': cookies.get('access_token'),\n            },\n        };\n\n        fetch('/v1/signature/' + id, requestOptions)\n            .then(async response => {\n                const isJson = response.headers.get('content-type')?.includes('application/json');\n                const data = isJson && await response.json();\n\n                // check for error response\n                if (!response.ok) {\n                    const error = (data && data.errors);\n                    return Promise.reject(error);\n                }\n\n                console.log(\"Response:\");\n                console.log(data);\n                let signatureData = data.result;\n                model.delivered_by_signature = signatureData;\n                setModel({ ...model });\n            })\n            .catch(error => {\n            });\n    }\n\n\n\n    /*\n    function print() {\n        console.log(\"Print\");\n    }\n    */\n\n    const printAreaRef = useRef();\n\n    function getFileName() {\n        let filename = \"Sales_\";\n\n        if (model.id) {\n            filename += \"_#\" + model.code;\n        }\n\n        return filename;\n    }\n\n    const handlePrint = useReactToPrint({\n        content: () => printAreaRef.current,\n        documentTitle: getFileName(),\n    });\n\n\n    return (<>\n        <Modal show={show} scrollable={true} size=\"xl\" fullscreen onHide={handleClose} animation={false}>\n            <Modal.Header>\n                <Modal.Title>Balance sheet preview</Modal.Title>\n                <div className=\"col align-self-end text-end\">\n                    <Button variant=\"primary\" className=\"btn btn-primary mb-3\" onClick={handlePrint}>\n                        <i className=\"bi bi-printer\"></i> Print\n                    </Button>\n                    <button\n                        type=\"button\"\n                        className=\"btn-close\"\n                        onClick={handleClose}\n                        aria-label=\"Close\"\n                    ></button>\n\n                </div>\n\n            </Modal.Header>\n            <Modal.Body>\n                <div ref={printAreaRef}>\n                    <BalanceSheetPrintPreviewContent model={model} />\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n                {/*\n                <Button variant=\"secondary\" onClick={handleClose}>\n                    Close\n                </Button>\n                <Button variant=\"primary\" onClick={handleClose}>\n                    Save Changes\n                </Button>\n                */}\n            </Modal.Footer>\n        </Modal>\n    </>);\n\n});\n\nexport default BalanceSheetPrintPreview;"]},"metadata":{},"sourceType":"module"}